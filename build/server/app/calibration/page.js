(()=>{var e={};e.id=8723,e.ids=[8723],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},38316:e=>{"use strict";e.exports=require("zod")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},73292:e=>{"use strict";e.exports=require("fs/promises")},98188:e=>{"use strict";e.exports=require("module")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},14521:e=>{"use strict";e.exports=require("readline")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},26144:e=>{"use strict";e.exports=require("vm")},71267:e=>{"use strict";e.exports=require("worker_threads")},32942:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c});var n=r(46855),i=r(12875),s=r(7611),a=r.n(s),o=r(32600),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["calibration",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,99024)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,78796)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,14749)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/layout.tsx"],template:[()=>Promise.resolve().then(r.bind(r,22709)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/template.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,28626,23)),"next/dist/client/components/not-found-error"]}],d=["/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx"],u="/calibration/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new n.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/calibration/page",pathname:"/calibration",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},2376:(e,t,r)=>{Promise.resolve().then(r.bind(r,72992))},72992:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Page});var n=r(28793),i=r(13293),s=r(3966),a=r(15611),o=r(57748),l=r(23681),c=r(37993);let d={duration:150},Button=e=>{let[t]=(0,a.u)();return(0,n.jsxs)("li",{className:(0,o.d)("flex"),children:["before"===e.subButtonPosition&&n.jsx("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),n.jsx("div",{className:(0,o.d)("flex items-center",e.isActive&&"dark:bg-zinc-800"),children:(0,n.jsxs)("button",{onClick:e.onClick,type:"button",title:e.title,className:(0,l.m)("flex items-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-800 dark:text-zinc-200 hover:text-zinc-900 dark:hover:text-zinc-100",e.isActive?"hover:text-brand:600 text-brand-600 dark:text-brand-500 dark:hover:text-brand-500":"",e.hidden?"hidden":"",e.className),children:[e.isLoading&&n.jsx(c.$,{noMargin:!0,className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.icon&&!e.isLoading&&n.jsx(e.icon,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.name&&n.jsx("span",{className:"inline",children:e.name})]})}),null!=e.subButtonPosition&&"before"!==e.subButtonPosition&&n.jsx("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),null==e.subButtonPosition&&e.children&&e.children]},e.id)};function Toolbar(e){let[t]=(0,a.u)(d);return n.jsx("nav",{className:(0,l.m)("flex overflow-hidden rounded-md border border-zinc-200 bg-white shadow dark:border-zinc-800 dark:bg-zinc-900/80",e.className),"aria-label":"Breadcrumb",children:n.jsx("ol",{role:"list",className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",ref:t,children:e.buttons.map(t=>{let r=e.subButtons?.filter(e=>e.parent===t.id);return t.hidden?null:(0,s.createElement)(Button,{...t,key:t.id},null!=r&&r.length>0&&t.isActive?r.map(e=>e.hidden?null:(0,s.createElement)(Button,{...e,key:e.id})):t.children)})})})}var u=r(54743),m=r(11438),x=r(18391),p=r(82542),h=r(10654),f=r(49376),b=r(50036),g=r(65073),v=r(88737),y=r(76690),k=r(13728);let useDebounce=(e,t)=>{let r=(0,s.useRef)(),n=(0,s.useRef)([]);return(0,s.useEffect)(()=>()=>{r.current&&clearTimeout(r.current)},[]),(0,s.useCallback)((...i)=>{n.current=i,r.current||(r.current=setTimeout(()=>{e(...n.current),r.current=void 0},t))},[e,t])};var w=r(61739),j=r(21410),N=r(28874),z=r(76871);let C={pixelPrMm:160,outerNozzleDiameter:1,flipVertical:!1,flipHorizontal:!1},CameraSettingsDialog=e=>{let t=(0,s.useRef)(!1),[r,i,a]=(0,N.Fu)("RatOS","camera-settings",C),[o,c]=(0,s.useState)(a.isFetched?r.pixelPrMm.toFixed(2):null),[d,u]=(0,s.useState)(a.isFetched?r.outerNozzleDiameter.toFixed(2):null),m=useDebounce(i,200);return(0,s.useEffect)(()=>{a.isFetched&&!1===t.current&&(c(r?.pixelPrMm.toFixed(2)??C.pixelPrMm.toFixed(2)),u(r?.outerNozzleDiameter.toFixed(2)??C.outerNozzleDiameter.toFixed(2)),t.current=!0)},[r,a.isFetched]),(0,n.jsxs)("div",{className:(0,l.m)("scroll absolute left-5 top-1/2 max-h-[50%] w-80 -translate-y-1/2 transform-gpu overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 p-5 shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?"translate-x-0 opacity-100":"pointer-events-none -translate-x-8 opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:[(0,n.jsxs)("h3",{className:"flex flex-1 items-center justify-between text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:[n.jsx("span",{children:"Camera Settings"}),n.jsx(z,{className:"h-5 w-5 cursor-pointer",onClick:()=>e.toggle(!e.isVisible)})]}),(0,n.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 dark:border-zinc-800",children:[n.jsx(w.o,{label:"Pixel per mm",type:"number",value:o??"",placeholder:a.isFetched?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);c(e),isNaN(t)||m(e=>({...e,pixelPrMm:t}))},error:isNaN(parseFloat(o??""))?"Not a valid number":void 0}),n.jsx(w.o,{label:"Outer Nozzle Diameter",type:"number",step:.1,value:d??"",placeholder:a.isFetched?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);console.log(e,t),u(e),isNaN(t)||m(e=>({...e,outerNozzleDiameter:t}))},error:isNaN(parseFloat(d??""))?"Not a valid number":void 0}),n.jsx(j.Z,{label:"Flip vertical",onChange:e=>i({...r??C,flipVertical:e??!1}),description:"Whether to flip the camera vertically",value:r?.flipVertical??C.flipVertical}),n.jsx(j.Z,{label:"Flip hoprizontal",onChange:e=>i({...r??C,flipHorizontal:e??!1}),description:"Whether to flip the camera horizontally",value:r?.flipHorizontal??C.flipHorizontal})]})]})};var S=r(24607);let ExposureIcon=e=>(0,n.jsxs)("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",className:e.className,children:[n.jsx("path",{fill:"currentColor",d:"M456,40H56A16,16,0,0,0,40,56V456a16,16,0,0,0,16,16H456a16,16,0,0,0,16-16V56A16,16,0,0,0,456,40ZM72,72H417.373L72,417.373ZM440,440H94.627L440,94.627Z"}),n.jsx("polygon",{fill:"currentColor",points:"336 368 336 408 368 408 368 368 408 368 408 336 368 336 368 296 336 296 336 336 296 336 296 368 336 368"}),n.jsx("rect",{width:"112",height:"32",x:"112",y:"136",fill:"currentColor"})]});var _=r(89169),A=r(45186),O=r(80332),E=r(28821);let useGcodeCommand=()=>{let e=(0,N.xH)("printer.gcode.script");return(0,s.useCallback)(async(t,...r)=>{let n=[t[0]];r.forEach((e,r)=>{n.push(e.toString(),t[r+1])});let i=n.join("");await e.mutateAsync({script:i}),console.log(i)},[e])},FocusControls=e=>{let t=useGcodeCommand();return n.jsx("div",{className:(0,l.m)("scroll absolute transform-gpu overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?" -translate-y-full opacity-100":"pointer-events-none  -translate-y-2/3  opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:(0,n.jsxs)("ol",{className:"flex flex-col divide-y divide-zinc-200 dark:divide-zinc-800",children:[n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z1`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(_,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+1.0"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z0.5`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(A,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+0.5"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z0.1`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(A,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+0.1"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-0.1`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(O,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-0.1"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-0.5`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(O,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-0.5"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-1.0`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(E,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-1.0"})]})})})]})})},useWindowSize=()=>{let[e,t]=(0,s.useState)({width:0,height:0});return(0,s.useEffect)(()=>{let handleResize=()=>{requestAnimationFrame(()=>{t({width:0,height:0})})};return window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[]),e};var P=r(35235),T=r(24874);let parseOptions=e=>{let t=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\.\d+\])/g),r=[];for(let e of t){let[t,n]=e[2].slice(1,-1).split("..").map(e=>parseInt(e,10)),i=r.find(t=>t.key===e[1]);i&&"max"in i&&i.max&&i.max<=n||r.push({key:e[1],min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:n})}let n=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\d+\.\.\d+\.\d+\])/g);for(let e of n){let[t,n]=e[2].slice(1,-1).split("..").map(e=>parseFloat(e)),i=r.find(t=>t.key===e[1]);i&&"max"in i&&i.max&&i.max<=n||r.push({key:e[1],float:!0,min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:n})}let i=e.matchAll(/- available option:\s(\w+)\s.+(\[false\.\.true\])/g);for(let e of i)r.push({key:e[1],toggle:!0});return r},R=k.z.number().min(4).max(3522),L=k.z.number().min(254).max(4095),useCameraSettings=e=>{let[t,r]=(0,s.useState)([]),n=(0,s.useCallback)(async t=>{let r=R.parse(t);await fetch(`${e}/option?exposure=${r}`)},[e]),i=(0,s.useCallback)(async t=>{let r=L.parse(t);await fetch(`${e}/option?digitalgain=${r}`)},[e]),a=(0,s.useCallback)(async t=>{let n=await fetch(`${e}/option?compressionquality=${t}`);r(parseOptions(await n.text()))},[e]),o=(0,s.useCallback)(async(r,n)=>{let i=t.find(e=>e.key===r);if(null==i)throw Error(`Invalid option ${r}`);if(i&&"toggle"in i&&"boolean"!=typeof n)throw Error(`Expect a boolean value for ${r}, got ${n}`);if(i&&"max"in i&&("number"!=typeof n||i.min>n||i.max<n))throw Error(`Value ${n} is out of range for ${r}`);try{let t=await fetch(`${e}/option?${r}=${n}`);return t.ok}catch(e){return!1}},[t,e]);return(0,s.useEffect)(()=>{a(100)},[a]),{exposure:n,digitalGain:i,options:t,setOption:o}},Slider=({onChange:e,min:t,max:r,initialValue:i,step:a})=>{let[o,l]=(0,s.useState)(i??t),c=useDebounce((0,s.useCallback)(t=>{e?.(t)},[e]),100),d=(0,s.useCallback)(e=>{let t=a?parseFloat(e.target.value):parseInt(e.target.value,10);l(t),c(t)},[c,a]);return(0,n.jsxs)("div",{className:"relative mb-6",children:[n.jsx("input",{type:"range",value:o,onChange:d,min:t,max:r,step:a??1,className:"h-2 w-full cursor-pointer appearance-none rounded-lg bg-zinc-200 dark:bg-zinc-700"}),(0,n.jsxs)("span",{className:"absolute -bottom-6 start-0 text-sm text-zinc-500 dark:text-zinc-400",children:["Min (",t,")"]}),n.jsx("span",{className:"absolute -bottom-6 start-1/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(r/3).toFixed(2)}),n.jsx("span",{className:"absolute -bottom-6 start-2/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(r/3*2).toFixed(2)}),(0,n.jsxs)("span",{className:"absolute -bottom-6 end-0 text-sm text-zinc-500 dark:text-zinc-400",children:["Max (",r,")"]})]})},getCameraUrl=()=>{let e=(0,T.X)();return null==e||""==e.trim()?"/webcam":`http://${e}/webcam`};function Page(){let[e,t]=(0,s.useState)(getCameraUrl());(0,s.useEffect)(()=>{t(getCameraUrl())},[]);let{videoRef:r,connectionState:d}=function(e){let t=(0,s.useRef)(null),r=(0,s.useRef)(null),n=(0,s.useRef)(null),i=(0,s.useRef)(e),a=(0,s.useRef)(!1),[o,l]=(0,s.useState)(null),c=(0,s.useRef)(null),d=(0,s.useCallback)(e=>{if(e.candidate)return fetch(i.current,{body:JSON.stringify({type:"remote_candidate",id:c.current,candidates:[e.candidate]}),headers:{"Content-Type":"application/json"},method:"POST"}).catch(function(e){window.console.error(e)})},[]),u=(0,s.useCallback)(async()=>{n.current&&(n.current.close(),n.current=null),a.current=!0;try{l("new");var i={sdpSemantics:"unified-plan"};document.getElementById("use-stun")&&document.getElementById("use-stun").checked&&(i.iceServers=[{urls:["stun:stun.l.google.com:19302"]}]);let a=new URLSearchParams(e),o=Object.fromEntries(a.entries()),u=await fetch(e,{body:JSON.stringify({type:"request",res:o.res}),headers:{"Content-Type":"application/json"},method:"POST"});if(u.ok){let a=await u.json();a.iceServers&&(i.iceServers=a.iceServers),n.current=new RTCPeerConnection(i),n.current.addTransceiver("video",{direction:"recvonly"}),n.current.addEventListener("track",function(e){if(console.log("track event "+e.track.kind,e.streams),"video"==e.track.kind){if(t.current)t.current.srcObject=e.streams[0];else throw Error("No video ref to set src on")}else r.current&&(r.current.srcObject=e.streams[0])}),n.current.addEventListener("connectionstatechange",()=>{let e=n.current?.connectionState;console.log(e),l(e??null)}),c.current=a.id,await n.current.setRemoteDescription(a);let o=await n.current.createAnswer();await n.current.setLocalDescription(o),await new Promise(function(e){if(null==n.current)throw Error("peerConnection.current is null");"complete"===n.current.iceGatheringState?e(null):n.current.addEventListener("icegatheringstatechange",function checkState(){if(null==n.current)throw Error("peerConnection.current is null");"complete"===n.current.iceGatheringState&&(n.current.removeEventListener("icegatheringstatechange",checkState),e(null))})}),n.current.addEventListener("icecandidate",d);var s=n.current.localDescription;if(null==s)throw Error("No offer from peerConnection");await fetch(e,{body:JSON.stringify({type:s.type,id:c.current,sdp:s.sdp}),headers:{"Content-Type":"application/json"},method:"POST"})}else l("failed")}catch(e){console.error(e),l("failed")}finally{a.current=!1}},[d,e]);return(0,s.useEffect)(()=>{e&&!1===a.current?u():n.current&&!1===a.current&&n.current.close()},[u,e]),(0,s.useEffect)(()=>{if(["failed","disconnected"].includes(o??"")){let e=setTimeout(()=>{u()},5e3);return()=>clearTimeout(e)}},[u,o]),{videoRef:t,audioRef:r,connectionState:o,close:(0,s.useCallback)(()=>{n.current?.close()},[])}}(e+"/webrtc"),[k]=(0,N.Fu)("RatOS","camera-settings"),w=(0,s.useRef)(null),j=(0,s.useRef)(null),[z,C]=(0,s.useState)(null),[_,A]=(0,s.useState)({x:!1,y:!1}),{exposure:O,digitalGain:E,options:T,setOption:R}=useCameraSettings(e),[L,$]=(0,s.useState)(!1),[M,q]=(0,s.useState)(!1),[B,F]=(0,s.useState)(!1),[G,D]=(0,s.useState)(!1),[Z,H]=(0,s.useState)(!1),[I,W]=(0,s.useState)(!1),[V,X]=(0,s.useState)(!1),[U,J]=(0,s.useState)(!1),[Q,Y]=(0,s.useState)(!1),[K,ee]=(0,s.useState)(1),[et,er]=(0,s.useState)(!1),en=useGcodeCommand(),[ei]=(0,a.u)(),es=useWindowSize(),ea=(0,N.Q)("toolhead"),eo=ea?.toolhead.extruder==="extruder"?"T0":"T1",el=(0,s.useCallback)(e=>{let t=r.current?.videoWidth??1,n=w.current?.getBoundingClientRect().width??1;return e*K*(n>0&&t>0?n/t:1)},[r.current,K,es]),ec=(0,s.useCallback)(e=>{let t=r.current?.videoWidth??1,n=w.current?.getBoundingClientRect().width??1;return e/K/(n>0&&t>0?n/t:1)},[r,K]),ed=(0,s.useCallback)(e=>el(e)*(k?.pixelPrMm??0),[el,k?.pixelPrMm,es]),eu=(0,s.useCallback)(e=>ec(e)/(k?.pixelPrMm??0),[ec,k?.pixelPrMm]),[em,ex]=(0,S.S)([K],2e3,!0),ep=em||G,eh=(0,s.useCallback)(()=>{D(e=>!e),ex()},[ex]);(0,u.useGesture)({onDrag:e=>{if(e.dragging)C([e.offset[0],e.offset[1]]),A({x:e._movementBound[0],y:e._movementBound[1]});else{let e=eu(z?.[0]??0)*(k?.flipHorizontal?1:-1),t=eu(z?.[1]??0)*(k?.flipVertical?1:-1);en`_NOZZLE_CALIBRATION_MOVE X=${e} Y=${t}`,C(null),A({x:!1,y:!1})}},onDrop:()=>{console.log("drop")},onPinch:e=>{ee(t=>Math.max(Math.min(t*e.offset[0],10),1))},onWheel:e=>{0!=e.delta[1]&&!1!=e.wheeling&&!1!=e.intentional&&(e.delta[1]<0?ee(e=>Math.max(.85*e,1)):ee(e=>Math.min(1.15*e,10)))}},{target:r,enabled:"connected"===d,drag:{enabled:L,from:()=>[0,0],bounds:{left:-ed(1),right:ed(1),top:-ed(1),bottom:ed(1)},rubberband:!0},wheel:{axis:"y",rubberband:!1},pinch:{scaleBounds:{min:1,max:10},pinchOnWheel:!1,rubberband:!0}});let ef=[{icon:i,id:"home",title:"Home the printer (G28)",isLoading:M,onClick:async()=>{q(!0),await en`G28`,q(!1)},isActive:ea?.toolhead.homed_axes==="xyz"},{name:"T0",id:"t0",title:"Switch to tool 0 (T0)",onClick:()=>{en`_NOZZLE_CALIBRATION_LOAD_TOOL T=0`},isActive:"T0"===eo},{name:"T1",id:"t1",title:"Switch to tool 1 (T1)",onClick:()=>{en`_NOZZLE_CALIBRATION_LOAD_TOOL T=1`},isActive:"T1"===eo}],eb=[{icon:m,id:"zoom",title:`${ep?"Hide":"Show"} zoom controls`,subButtonPosition:"before",className:"font-mono",name:K>=10?"MAX!":(0,n.jsxs)(n.Fragment,{children:[n.jsx(P.ZP,{preserveValue:!0,start:0,end:Math.round(100*K),duration:.15}),"%"]}),onClick:()=>{eh()},isActive:ep},{icon:x,id:"light",title:`${Q?"Turn off":"Turn on"} the LEDs`,onClick:()=>{let e=!Q;en`_NOZZLE_CALIBRATION_SWITCH_LED STATE=${e?1:0}`,Y(e)},isActive:Q}],eg=(0,s.useMemo)(()=>[{name:"Settings",icon:p,id:"settings",title:"Show camera settings dialog",onClick:()=>{F(e=>!e)},isActive:B},{name:"T0"===eo?"Set reference":"Set offset",icon:h,id:"reference",title:`Set the ${"T0"===eo?"T0 reference point":"T1 offset"}`,onClick:()=>{en`_NOZZLE_CALIBRATION_SET_TOOL`},isActive:!1},{name:"Move",icon:f,id:"move",title:`${L?"Disable":"Enable"} drag and drop calibration`,onClick:()=>{$(e=>!e)},isActive:L}],[L,en,B,eo]),ev=(0,s.useMemo)(()=>{let e=[{icon:b,id:"settings",subButtonPosition:"before",title:`${et?"Hide":"Show"} camera controls`,onClick:()=>{er(e=>!e)},isActive:et}];return e},[et]),ey=(0,s.useMemo)(()=>{let e=[{icon:g,id:"focus",parent:"settings",hidden:I||U||Z,name:"Focus",title:`${V?"Hide":"Show"} focus controls`,children:n.jsx(FocusControls,{isVisible:V,toggle:X}),onClick:()=>{console.log("exposure controls"),X(e=>!e),H(!1),W(!1),J(!1)},isActive:V},{icon:ExposureIcon,id:"exposure",parent:"settings",hidden:I||U||V,title:`${Z?"Hide":"Show"} exposure controls`,name:"Exposure",onClick:()=>{console.log("exposure controls"),H(e=>!e),W(!1),J(!1),X(!1)},isActive:Z},{icon:v,id:"color",parent:"settings",title:`${I?"Hide":"Show"} color controls`,hidden:Z||U||V,name:"Color",onClick:()=>{W(e=>!e),H(!1),J(!1),X(!1)},isActive:I},{icon:y,id:"advanced-camera-controls",parent:"settings",title:`${U?"Hide":"Show"} advanced camera controls`,name:"Advanced",hidden:Z||I||V,onClick:()=>{J(e=>!e),H(!1),W(!1),X(!1)},isActive:U}];return e.reverse()},[U,Z,V,I]),ek=null==z?0:z[0]/K,ew=null==z?0:z[1]/K,ej=(0,s.useMemo)(()=>ed(k?k.outerNozzleDiameter/2:0),[k,ed]),eN=(0,s.useMemo)(()=>null==w.current||"connected"!==d?0:ej/w.current.getBoundingClientRect().width*100,[d,ej]),ez=(0,s.useMemo)(()=>null==w.current||"connected"!==d?0:ej/w.current.getBoundingClientRect().height*100,[d,ej]);return n.jsx("div",{className:"flex h-[calc(100vh_-_64px)] w-full items-center",ref:j,children:(0,n.jsxs)("div",{className:"relative mx-auto flex max-h-full min-h-[50vh] min-w-[50vw] max-w-fit items-center overflow-hidden rounded-2xl object-contain shadow-lg",ref:w,children:[n.jsx("video",{ref:r,className:(0,l.m)("h-full max-h-full w-full min-w-full max-w-full transform-gpu touch-none",L&&"cursor-move",null==z&&"transition-transform ease-in-out"),style:{transform:`scale3d(${K*(k?.flipHorizontal?-1:1)}, ${K*(k?.flipVertical?-1:1)}, 1) translate3d(${ek*(k?.flipHorizontal?-1:1)}px, ${ew*(k?.flipVertical?-1:1)}px, 0)`},autoPlay:!0,muted:!0,playsInline:!0}),n.jsx(Toolbar,{className:"absolute left-5 top-5",buttons:ef}),n.jsx(Toolbar,{className:"absolute bottom-5 right-5 overflow-visible",buttons:ev,subButtons:ey}),n.jsx(Toolbar,{className:"absolute right-5 top-5",buttons:eb,subButtons:[{name:"1X",id:"1x",parent:"zoom",title:"Set zoom to 1X (100%)",className:"font-mono",onClick:()=>{ee(1)},isActive:!1},{name:"2X",id:"2x",parent:"zoom",title:"Set zoom to 2X (200%)",className:"font-mono",onClick:()=>{ee(2)},isActive:!1},{name:"4X",id:"4x",parent:"zoom",title:"Set zoom to 4X (400%)",className:"font-mono",onClick:()=>{ee(4)},isActive:!1}]}),n.jsx(Toolbar,{className:"absolute bottom-5 left-5",buttons:eg}),n.jsx(CameraSettingsDialog,{isVisible:B,toggle:F}),(0,n.jsxs)("div",{className:(0,o.d)("pointer-events-none absolute inset-0 flex items-center justify-center"),children:[n.jsx("div",{className:(0,o.d)("absolute inset-0",_.x&&_.x>0?"left-0 right-2/3 bg-gradient-to-r from-red-500/70 to-red-500/0":"left-2/3 right-0 bg-gradient-to-l from-red-500/70 to-red-500/0"),style:{opacity:_.x?Math.abs(_.x-(z?.[0]??0))/200:0}}),n.jsx("div",{className:(0,o.d)("absolute inset-0",_.y&&_.y>0?"bottom-2/3 top-0 bg-gradient-to-b from-red-500/70 to-red-500/0":"bottom-0 top-2/3 bg-gradient-to-t from-red-500/70 to-red-500/0"),style:{opacity:_.y?Math.abs(_.y-(z?.[1]??0))/200:0}}),(0,n.jsxs)("svg",{width:"100%",height:"100%",children:[n.jsx("circle",{cx:"50%",cy:"50%",r:ed(.2),fill:"none",className:(0,o.d)("stroke-brand-500 transition-all ease-in-out","connected"===d&&ej>0?"opacity-100":"opacity-0"),strokeWidth:"2"}),n.jsx("circle",{cx:"50%",cy:"50%",r:ej,fill:"none",className:(0,o.d)("stroke-brand-500 transition-all ease-in-out","connected"===d&&ej>0?"opacity-50":"opacity-0"),strokeWidth:"2"}),n.jsx("rect",{x:"50%",y:`${50-ez}%`,height:`${2*ez}%`,width:2,className:(0,o.d)("fill-brand-500/50 transition-all ease-in-out","connected"===d&&ej>0?"opacity-100":"opacity-0")}),n.jsx("rect",{x:`${50-eN}%`,y:"50%",width:`${2*eN}%`,height:2,className:(0,o.d)("fill-brand-500/50 transition-all ease-in-out","connected"===d&&ej>0?"opacity-100":"opacity-0")})]})]}),n.jsx("div",{className:"absolute bottom-24 left-1/4 right-1/4 max-h-[50%] overflow-y-scroll rounded-md bg-zinc-900/70 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",children:(0,n.jsxs)("div",{ref:ei,children:[Z&&T.filter(e=>e.key.toLowerCase().includes("gain")||e.key.toLowerCase().includes("exposure")||e.key.startsWith("Ae")||e.key.toLowerCase().includes("brightness")).filter(e=>"ColourGains"!==e.key).map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{min:"toggle"in e?0:"min"in e?e.min:0,max:"toggle"in e?0:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>R(e.key,"toggle"in e?!!t:t)})]},e.key)),I&&T.filter(e=>e.key.toLowerCase().includes("saturation")||e.key.toLowerCase().includes("contrast")||e.key.startsWith("Awb")).map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{min:"toggle"in e?0:"min"in e?e.min:0,max:"toggle"in e?0:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>R(e.key,"toggle"in e?!!t:t)})]},e.key)),U&&T.map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{min:"toggle"in e?0:"min"in e?e.min:0,max:"toggle"in e?0:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>R(e.key,"toggle"in e?!!t:t)})]},e.key))]})}),(0,n.jsxs)("div",{className:(0,l.m)("pointer-events-none absolute inset-0 flex items-center justify-center"),children:[n.jsx("h3",{className:(0,l.m)("absolute inset-0 flex items-center justify-center text-xl font-semibold text-rose-500 transition-all dark:text-rose-500","failed"===d?"animate-pulse opacity-100":"opacity-0"),children:"Webcam stream not found"}),n.jsx(c.$,{noMargin:!0,className:(0,l.m)("h-1/3 w-1/3 animate-spin text-inherit transition-all","text-green-500 dark:text-green-500",("connected"===d||"failed"===d)&&"opacity-0","failed"===d&&"text-rose-500 dark:text-rose-500","connecting"===d&&"text-brand-500 dark:text-brand-500","closed"===d&&"text-yellow-500 dark:text-yellow-500","disconnected"===d&&"text-amber-500 dark:text-amber-500","new"===d&&"text-sky-500 dark:text-sky-500")})]})]})})}},37993:(e,t,r)=>{"use strict";r.d(t,{$:()=>Spinner});var n=r(28793),i=r(23681);let Spinner=e=>(0,n.jsxs)("svg",{className:(0,i.m)("h-5 w-5 animate-spin text-black dark:text-white",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},78796:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>WizardLayout});var n=r(86700),i=r(16239);function WizardLayout({children:e}){return(0,i.headers)().get("x-configurator"),n.jsx("main",{className:"",children:n.jsx("div",{className:"mx-auto max-w-full",children:e})})}},99024:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>a,__esModule:()=>s,default:()=>l});var n=r(23646);let i=(0,n.createProxy)(String.raw`/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx`),{__esModule:s,$$typeof:a}=i,o=i.default,l=o}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[5793,8648,6212,9949,8726,3452],()=>__webpack_exec__(32942));module.exports=r})();