(()=>{var e={};e.id=8723,e.ids=[8723],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},38316:e=>{"use strict";e.exports=require("zod")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},73292:e=>{"use strict";e.exports=require("fs/promises")},98188:e=>{"use strict";e.exports=require("module")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},14521:e=>{"use strict";e.exports=require("readline")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},26144:e=>{"use strict";e.exports=require("vm")},71267:e=>{"use strict";e.exports=require("worker_threads")},32942:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c});var n=r(46855),i=r(12875),a=r(7611),s=r.n(a),o=r(32600),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["calibration",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,99024)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,78796)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,14749)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/layout.tsx"],template:[()=>Promise.resolve().then(r.bind(r,22709)),"/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/template.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,28626,23)),"next/dist/client/components/not-found-error"]}],d=["/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx"],u="/calibration/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new n.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/calibration/page",pathname:"/calibration",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},2376:(e,t,r)=>{Promise.resolve().then(r.bind(r,99901))},99901:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Page});var n=r(28793),i=r(13293),a=r(3966),s=r(15611),o=r(57748),l=r(23681),c=r(37993);let d={duration:150},Button=e=>{let[t]=(0,s.u)();return(0,n.jsxs)("li",{className:(0,o.d)("flex"),children:["before"===e.subButtonPosition&&n.jsx("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),n.jsx("div",{className:(0,o.d)("flex items-center",e.isActive&&"dark:bg-zinc-800"),children:(0,n.jsxs)("button",{onClick:e.onClick,type:"button",title:e.title,className:(0,l.m)("flex items-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 transition-transform hover:text-black active:scale-95 dark:text-zinc-300 dark:hover:text-white",e.isActive?"hover:text-brand:600 text-brand-600 dark:text-brand-500 dark:hover:text-brand-500":"",e.hidden?"hidden":"",e.className),children:[e.isLoading&&n.jsx(c.$,{noMargin:!0,className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.icon&&!e.isLoading&&n.jsx(e.icon,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.name&&n.jsx("span",{className:"inline",children:e.name})]})}),null!=e.subButtonPosition&&"before"!==e.subButtonPosition&&n.jsx("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),null==e.subButtonPosition&&e.children&&e.children]},e.id)};function Toolbar(e){let[t]=(0,s.u)(d);return n.jsx("nav",{className:(0,l.m)("flex overflow-hidden rounded-md border border-zinc-200 bg-white shadow dark:border-zinc-800 dark:bg-zinc-900/80",e.className),"aria-label":"Breadcrumb",children:n.jsx("ol",{role:"list",className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",ref:t,children:e.buttons.map(t=>{let r=e.subButtons?.filter(e=>e.parent===t.id);return t.hidden?null:(0,a.createElement)(Button,{...t,key:t.id},null!=r&&r.length>0&&t.isActive?r.map(e=>e.hidden?null:(0,a.createElement)(Button,{...e,key:e.id})):t.children)})})})}var u=r(54743),m=r(11438),x=r(18391),h=r(82542),p=r(10654),f=r(49376),g=r(50036),b=r(65073),v=r(88737),y=r(76690),k=r(61739),w=r(21410),j=r(28874);let useDebounce=(e,t)=>{let r=(0,a.useRef)(),n=(0,a.useRef)([]);return(0,a.useEffect)(()=>()=>{r.current&&clearTimeout(r.current)},[]),(0,a.useCallback)((...i)=>{n.current=i,r.current||(r.current=setTimeout(()=>{e(...n.current),r.current=void 0},t))},[e,t])};var N=r(76871);let z={pixelPrMm:160,outerNozzleDiameter:1,flipVertical:!1,flipHorizontal:!1},CameraSettingsDialog=e=>{let t=(0,a.useRef)(!1),[r,i,s]=(0,j.Fu)("RatOS","camera-settings",z),[o,c]=(0,a.useState)(s.isFetched?r.pixelPrMm.toFixed(2):null),[d,u]=(0,a.useState)(s.isFetched?r.outerNozzleDiameter.toFixed(2):null),m=useDebounce(i,200);return(0,a.useEffect)(()=>{s.isFetched&&!1===t.current&&(c(r?.pixelPrMm.toFixed(2)??z.pixelPrMm.toFixed(2)),u(r?.outerNozzleDiameter.toFixed(2)??z.outerNozzleDiameter.toFixed(2)),t.current=!0)},[r,s.isFetched]),(0,n.jsxs)("div",{className:(0,l.m)("scroll absolute left-5 top-1/2 max-h-[50%] w-80 -translate-y-1/2 transform-gpu overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 p-5 shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?"translate-x-0 opacity-100":"pointer-events-none -translate-x-8 opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:[(0,n.jsxs)("h3",{className:"flex flex-1 items-center justify-between text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:[n.jsx("span",{children:"Camera Settings"}),n.jsx(N,{className:"h-5 w-5 cursor-pointer",onClick:()=>e.toggle(!e.isVisible)})]}),(0,n.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 dark:border-zinc-800",children:[n.jsx(k.o,{label:"Pixel per mm",type:"number",value:o??"",placeholder:s.isFetched?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);c(e),isNaN(t)||m(e=>({...e,pixelPrMm:t}))},error:isNaN(parseFloat(o??""))?"Not a valid number":void 0}),n.jsx(k.o,{label:"Outer Nozzle Diameter",type:"number",step:.1,value:d??"",placeholder:s.isFetched?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);console.log(e,t),u(e),isNaN(t)||m(e=>({...e,outerNozzleDiameter:t}))},error:isNaN(parseFloat(d??""))?"Not a valid number":void 0}),n.jsx(w.Z,{label:"Flip vertical",onChange:e=>i({...r??z,flipVertical:e??!1}),description:"Whether to flip the camera vertically",value:r?.flipVertical??z.flipVertical}),n.jsx(w.Z,{label:"Flip hoprizontal",onChange:e=>i({...r??z,flipHorizontal:e??!1}),description:"Whether to flip the camera horizontally",value:r?.flipHorizontal??z.flipHorizontal})]})]})};var C=r(24607);let ExposureIcon=e=>(0,n.jsxs)("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",className:e.className,children:[n.jsx("path",{fill:"currentColor",d:"M456,40H56A16,16,0,0,0,40,56V456a16,16,0,0,0,16,16H456a16,16,0,0,0,16-16V56A16,16,0,0,0,456,40ZM72,72H417.373L72,417.373ZM440,440H94.627L440,94.627Z"}),n.jsx("polygon",{fill:"currentColor",points:"336 368 336 408 368 408 368 368 408 368 408 336 368 336 368 296 336 296 336 336 296 336 296 368 336 368"}),n.jsx("rect",{width:"112",height:"32",x:"112",y:"136",fill:"currentColor"})]});var S=r(89169),_=r(45186),O=r(80332),P=r(28821);let useGcodeCommand=()=>{let e=(0,j.xH)("printer.gcode.script");return(0,a.useCallback)(async(t,...r)=>{let n=[t[0]];r.forEach((e,r)=>{n.push(e.toString(),t[r+1])});let i=n.join("");await e.mutateAsync({script:i}),console.log(i)},[e])},FocusControls=e=>{let t=useGcodeCommand();return n.jsx("div",{className:(0,l.m)("scroll absolute transform-gpu overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?" -translate-y-full opacity-100":"pointer-events-none  -translate-y-2/3  opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:(0,n.jsxs)("ol",{className:"flex flex-col divide-y divide-zinc-200 dark:divide-zinc-800",children:[n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z1`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(S,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+1.0"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z0.5`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(_,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+0.5"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z0.1`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(_,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"+0.1"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-0.1`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(O,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-0.1"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-0.5`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(O,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-0.5"})]})})}),n.jsx("li",{className:(0,o.d)("flex"),children:n.jsx("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,n.jsxs)("button",{onClick:()=>t`G91\nG0 Z-1.0`,type:"button",className:(0,l.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[n.jsx(P,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),n.jsx("span",{className:"inline",children:"-1.0"})]})})})]})})},useWindowSize=()=>{let[e,t]=(0,a.useState)({width:0,height:0});return(0,a.useEffect)(()=>{let handleResize=()=>{requestAnimationFrame(()=>{t({width:0,height:0})})};return window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[]),e};var R=r(35235),A=r(24874);let parseOptions=e=>{let t=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\.\d+\])/g),r=[];for(let e of t){let[t,n]=e[2].slice(1,-1).split("..").map(e=>parseInt(e,10)),i=r.find(t=>t.key===e[1]);i&&"max"in i&&i.max&&i.max<=n||r.push({key:e[1],min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:n})}let n=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\d+\.\.\d+\.\d+\])/g);for(let e of n){let[t,n]=e[2].slice(1,-1).split("..").map(e=>parseFloat(e)),i=r.find(t=>t.key===e[1]);i&&"max"in i&&i.max&&i.max<=n||r.push({key:e[1],float:!0,min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:n})}let i=e.matchAll(/- available option:\s(\w+)\s.+(\[false\.\.true\])/g);for(let e of i)r.push({key:e[1],toggle:!0});return r};var T=r(73992);let useCameraSettings=(e,t=!1)=>{let[r,n]=(0,a.useState)([]),i=(0,j.bL)("RatOS","camera-stream-settings"),s=(0,j.A4)("RatOS","camera-stream-settings"),o=(0,a.useRef)(s.data);o.current=s.data;let l=(0,a.useMemo)(()=>r.map(e=>(e.value=o.current?.[e.key]?.value??e.value,e)),[r]),c=(0,a.useCallback)(async t=>{let r=await fetch(`${e}/option?compressionquality=${t}`);n(parseOptions(await r.text()))},[e]),d=(0,a.useCallback)(async(t,n)=>{let a=r.find(e=>e.key===t);if(null==a)throw Error(`Invalid option ${t}`);if(a&&"toggle"in a&&"boolean"!=typeof n)throw Error(`Expect a boolean value for ${t}, got ${n}`);if(a&&"max"in a&&("number"!=typeof n||a.min>n||a.max<n))throw Error(`Value ${n} is out of range for ${t}`);try{let r=await fetch(`${e}/option?${t}=${n.toString()}`);return console.log(r.ok,s.isInitialLoading),r.ok&&!1===s.isInitialLoading&&(console.log("saving",t,n,o.current,(0,T.T)(o.current??{},{[t]:{value:n}})),await i.mutateAsync((0,T.T)(o.current??{},{[t]:{value:n}}))),r.ok}catch(e){return!1}},[r,i,e,s]);return(0,a.useEffect)(()=>{if(t&&c(100),t&&s.isFetched&&null!=o.current)for(let t in o.current){let r=o.current[t]?.value;r&&fetch(`${e}/option?${t}=${r.toString()}`)}},[s.isFetched,e,t,c]),{options:l,setOption:d}},Slider=({onChange:e,min:t,max:r,initialValue:i,step:s,isBoolean:o})=>{let[l,c]=(0,a.useState)(i??t),d=useDebounce((0,a.useCallback)(t=>{e?.(t)},[e]),100),u=(0,a.useCallback)(e=>{let t=s?parseFloat(e.target.value):parseInt(e.target.value,10);c(t),d(t)},[d,s]);return(0,n.jsxs)("div",{className:"relative mb-6",children:[n.jsx("input",{type:"range",value:l,onChange:u,min:t,max:r,step:s??1,className:"h-2 w-full cursor-pointer appearance-none rounded-lg bg-zinc-200 dark:bg-zinc-700"}),n.jsx("span",{className:"absolute -bottom-6 start-0 text-sm text-zinc-500 dark:text-zinc-400",children:o?"Off":`Min (${t})`}),!o&&n.jsx("span",{className:"absolute -bottom-6 start-1/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(r/3).toFixed(2)}),!o&&n.jsx("span",{className:"absolute -bottom-6 start-2/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(r/3*2).toFixed(2)}),n.jsx("span",{className:"absolute -bottom-6 end-0 text-sm text-zinc-500 dark:text-zinc-400",children:o?"On":`Max (${r})`})]})},getCameraUrl=()=>{let e=(0,A.X)();return null==e||""==e.trim()?"/webcam":`http://${e}/webcam`};function Page(){let[e,t]=(0,a.useState)(getCameraUrl());(0,a.useEffect)(()=>{t(getCameraUrl())},[]);let{videoRef:r,connectionState:d}=function(e){let t=(0,a.useRef)(null),r=(0,a.useRef)(null),n=(0,a.useRef)(null),i=(0,a.useRef)(e),s=(0,a.useRef)(!1),[o,l]=(0,a.useState)(null),c=(0,a.useRef)(null),d=(0,a.useCallback)(e=>{if(e.candidate)return fetch(i.current,{body:JSON.stringify({type:"remote_candidate",id:c.current,candidates:[e.candidate]}),headers:{"Content-Type":"application/json"},method:"POST"}).catch(function(e){window.console.error(e)})},[]),u=(0,a.useCallback)(async()=>{n.current&&(n.current.close(),n.current=null),s.current=!0;try{l("new");var i={sdpSemantics:"unified-plan"};document.getElementById("use-stun")&&document.getElementById("use-stun").checked&&(i.iceServers=[{urls:["stun:stun.l.google.com:19302"]}]);let s=new URLSearchParams(e),o=Object.fromEntries(s.entries()),u=await fetch(e,{body:JSON.stringify({type:"request",res:o.res}),headers:{"Content-Type":"application/json"},method:"POST"});if(u.ok){let s=await u.json();s.iceServers&&(i.iceServers=s.iceServers),n.current=new RTCPeerConnection(i),n.current.addTransceiver("video",{direction:"recvonly"}),n.current.addEventListener("track",function(e){if("video"==e.track.kind){if(t.current)t.current.srcObject=e.streams[0];else throw Error("No video ref to set src on")}else r.current&&(r.current.srcObject=e.streams[0])}),n.current.addEventListener("connectionstatechange",()=>{let e=n.current?.connectionState;l(e??null)}),c.current=s.id,await n.current.setRemoteDescription(s);let o=await n.current.createAnswer();await n.current.setLocalDescription(o),await new Promise(function(e){if(null==n.current)throw Error("peerConnection.current is null");"complete"===n.current.iceGatheringState?e(null):n.current.addEventListener("icegatheringstatechange",function checkState(){if(null==n.current)throw Error("peerConnection.current is null");"complete"===n.current.iceGatheringState&&(n.current.removeEventListener("icegatheringstatechange",checkState),e(null))})}),n.current.addEventListener("icecandidate",d);var a=n.current.localDescription;if(null==a)throw Error("No offer from peerConnection");await fetch(e,{body:JSON.stringify({type:a.type,id:c.current,sdp:a.sdp}),headers:{"Content-Type":"application/json"},method:"POST"})}else l("failed")}catch(e){console.error(e),l("failed")}finally{s.current=!1}},[d,e]);return(0,a.useEffect)(()=>{e&&!1===s.current?u():n.current&&!1===s.current&&n.current.close()},[u,e]),(0,a.useEffect)(()=>{if(["failed","disconnected"].includes(o??"")){let e=setTimeout(()=>{u()},5e3);return()=>clearTimeout(e)}},[u,o]),{videoRef:t,audioRef:r,connectionState:o,close:(0,a.useCallback)(()=>{n.current?.close()},[])}}(e+"/webrtc"),[k]=(0,j.Fu)("RatOS","camera-settings"),w=(0,a.useRef)(null),N=(0,a.useRef)(null),[z,S]=(0,a.useState)(null),[_,O]=(0,a.useState)({x:!1,y:!1}),{options:P,setOption:A}=useCameraSettings(e,"connected"===d),[T,E]=(0,a.useState)(!1),[L,$]=(0,a.useState)(!1),[M,q]=(0,a.useState)(!1),[B,F]=(0,a.useState)(!1),[G,I]=(0,a.useState)(!1),[Z,D]=(0,a.useState)(!1),[H,V]=(0,a.useState)(!1),[W,X]=(0,a.useState)(!1),[U,J]=(0,a.useState)(!1),[Y,Q]=(0,a.useState)(!1),[K,ee]=(0,a.useState)(1),[et,er]=(0,a.useState)(!1),en=useGcodeCommand(),[ei]=(0,s.u)(),ea=useWindowSize(),es=(0,j.Q)(e=>({tool:"extruder"===e.toolhead.extruder?"T0":"T1",homed_axes:e.toolhead.homed_axes}),"toolhead"),[eo]=(0,C.S)([U],200,!0),[el]=(0,C.I)([U],190,10,!0),ec=(0,a.useCallback)(e=>{let t=r.current?.videoWidth??1,n=w.current?.getBoundingClientRect().width??1;return e*K*(n>0&&t>0?n/t:1)},[r.current,K,ea]),ed=(0,a.useCallback)(e=>{let t=r.current?.videoWidth??1,n=w.current?.getBoundingClientRect().width??1;return e/K/(n>0&&t>0?n/t:1)},[r,K]),eu=(0,a.useCallback)(e=>ec(e)*(k?.pixelPrMm??0),[ec,k?.pixelPrMm,ea]),em=(0,a.useCallback)(e=>ed(e)/(k?.pixelPrMm??0),[ed,k?.pixelPrMm]),[ex,eh]=(0,C.S)([K],2e3,!0),ep=ex||B,ef=(0,a.useCallback)(()=>{F(e=>!e),eh()},[eh]);(0,u.useGesture)({onDrag:e=>{if(e.dragging)S([e.offset[0],e.offset[1]]),O({x:e._movementBound[0],y:e._movementBound[1]});else{let e=-1*em(z?.[0]??0),t=-1*em(z?.[1]??0);en`_NOZZLE_CALIBRATION_MOVE X=${e} Y=${t}`,S(null),O({x:!1,y:!1})}},onPinch:e=>{ee(t=>Math.max(Math.min(t*e.offset[0],10),1))},onWheel:e=>{0!=e.delta[1]&&!1!=e.wheeling&&!1!=e.intentional&&(e.delta[1]<0?ee(e=>Math.max(.85*e,1)):ee(e=>Math.min(1.15*e,10)))}},{target:r,enabled:"connected"===d,drag:{enabled:T,from:()=>[0,0],bounds:{left:-eu(1),right:eu(1),top:-eu(1),bottom:eu(1)},rubberband:!0},wheel:{axis:"y",rubberband:!1},pinch:{scaleBounds:{min:1,max:10},pinchOnWheel:!1,rubberband:!0}});let eg=[{icon:i,id:"home",title:"Home the printer (G28)",isLoading:L,onClick:async()=>{$(!0),await en`G28`,$(!1)},isActive:es?.homed_axes==="xyz"},{name:"T0",id:"t0",title:"Switch to tool 0 (T0)",onClick:()=>{en`_NOZZLE_CALIBRATION_LOAD_TOOL T=0`},isActive:es?.tool==="T0"},{name:"T1",id:"t1",title:"Switch to tool 1 (T1)",onClick:()=>{en`_NOZZLE_CALIBRATION_LOAD_TOOL T=1`},isActive:es?.tool==="T1"}],eb=[{icon:m,id:"zoom",title:`${ep?"Hide":"Show"} zoom controls`,subButtonPosition:"before",className:"font-mono",name:K>=10?"MAX!":(0,n.jsxs)(n.Fragment,{children:[n.jsx(R.ZP,{preserveValue:!0,start:0,end:Math.round(100*K),duration:.15}),"%"]}),onClick:()=>{ef()},isActive:ep},{icon:x,id:"light",title:`${Y?"Turn off":"Turn on"} the LEDs`,onClick:()=>{let e=!Y;en`_NOZZLE_CALIBRATION_SWITCH_LED STATE=${e?1:0}`,Q(e)},isActive:Y}],ev=(0,a.useMemo)(()=>[{name:"Settings",icon:h,id:"settings",title:"Show camera settings dialog",onClick:()=>{q(e=>!e)},isActive:M},{name:es?.tool==="T0"?"Set reference":"Set offset",icon:p,isLoading:eo,id:"reference",title:`Set the ${es?.tool==="T0"?"T0 reference point":"T1 offset"}`,onClick:async()=>{J(!0),await en`_NOZZLE_CALIBRATION_SET_TOOL`,J(!1)},isActive:eo},{name:"Move",icon:f,id:"move",title:`${T?"Disable":"Enable"} drag and drop calibration`,onClick:()=>{E(e=>!e)},isActive:T}],[M,es,eo,T,en]),ey=(0,a.useMemo)(()=>{let e=[{icon:g,id:"settings",subButtonPosition:"before",title:`${et?"Hide":"Show"} camera controls`,onClick:()=>{er(e=>!e)},isActive:et}];return e},[et]),ek=(0,a.useMemo)(()=>{let e=[{icon:b,id:"focus",parent:"settings",hidden:Z||W||G,name:"Focus",title:`${H?"Hide":"Show"} focus controls`,children:n.jsx(FocusControls,{isVisible:H,toggle:V}),onClick:()=>{V(e=>!e),I(!1),D(!1),X(!1)},isActive:H},{icon:ExposureIcon,id:"exposure",parent:"settings",hidden:Z||W||H,title:`${G?"Hide":"Show"} exposure controls`,name:"Exposure",onClick:()=>{I(e=>!e),D(!1),X(!1),V(!1)},isActive:G},{icon:v,id:"color",parent:"settings",title:`${Z?"Hide":"Show"} color controls`,hidden:G||W||H,name:"Color",onClick:()=>{D(e=>!e),I(!1),X(!1),V(!1)},isActive:Z},{icon:y,id:"advanced-camera-controls",parent:"settings",title:`${W?"Hide":"Show"} advanced camera controls`,name:"Advanced",hidden:G||Z||H,onClick:()=>{X(e=>!e),I(!1),D(!1),V(!1)},isActive:W}];return e.reverse()},[W,G,H,Z]),ew=null==z?0:z[0]/K,ej=null==z?0:z[1]/K,eN=(0,a.useMemo)(()=>eu(.2),[eu]),ez=(0,a.useMemo)(()=>eo?eN:eu(k?k.outerNozzleDiameter/2:0),[eu,eo,eN,k]),eC=(0,a.useMemo)(()=>null==w.current||"connected"!==d?0:ez/w.current.getBoundingClientRect().width*100,[d,ez]),eS=(0,a.useMemo)(()=>null==w.current||"connected"!==d?0:ez/w.current.getBoundingClientRect().height*100,[d,ez]),e_=(0,a.useMemo)(()=>eu(.01),[eu]);return n.jsx("div",{className:"flex h-[calc(100vh_-_64px)] w-full items-center",ref:N,children:(0,n.jsxs)("div",{className:"relative mx-auto flex h-full max-h-full min-h-[50vh] min-w-[50vw] max-w-fit items-center overflow-hidden object-contain shadow-lg",ref:w,children:[n.jsx("video",{ref:r,className:(0,l.m)("h-full max-h-full w-full min-w-full max-w-full transform-gpu touch-none",T&&"cursor-move",null==z&&"transition-transform ease-in-out"),style:{transform:`scale3d(${K*(k?.flipHorizontal?-1:1)}, ${K*(k?.flipVertical?-1:1)}, 1) translate3d(${ew*(k?.flipHorizontal?-1:1)}px, ${ej*(k?.flipVertical?-1:1)}px, 0)`},autoPlay:!0,muted:!0,playsInline:!0}),n.jsx(Toolbar,{className:"absolute left-5 top-5",buttons:eg}),n.jsx(Toolbar,{className:"absolute bottom-5 right-5 overflow-visible",buttons:ey,subButtons:ek}),n.jsx(Toolbar,{className:"absolute right-5 top-5",buttons:eb,subButtons:[{name:"1X",id:"1x",parent:"zoom",title:"Set zoom to 1X (100%)",className:"font-mono",onClick:()=>{ee(1)},isActive:!1},{name:"2X",id:"2x",parent:"zoom",title:"Set zoom to 2X (200%)",className:"font-mono",onClick:()=>{ee(2)},isActive:!1},{name:"4X",id:"4x",parent:"zoom",title:"Set zoom to 4X (400%)",className:"font-mono",onClick:()=>{ee(4)},isActive:!1}]}),n.jsx(Toolbar,{className:"absolute bottom-5 left-5",buttons:ev}),n.jsx(CameraSettingsDialog,{isVisible:M,toggle:q}),(0,n.jsxs)("div",{className:(0,o.d)("pointer-events-none absolute inset-0 flex items-center justify-center"),children:[n.jsx("div",{className:(0,o.d)("absolute inset-0",_.x&&_.x>0?"left-0 right-2/3 bg-gradient-to-r from-red-500/70 to-red-500/0":"left-2/3 right-0 bg-gradient-to-l from-red-500/70 to-red-500/0"),style:{opacity:_.x?Math.abs(_.x-(z?.[0]??0))/200:0}}),n.jsx("div",{className:(0,o.d)("absolute inset-0",_.y&&_.y>0?"bottom-2/3 top-0 bg-gradient-to-b from-red-500/70 to-red-500/0":"bottom-0 top-2/3 bg-gradient-to-t from-red-500/70 to-red-500/0"),style:{opacity:_.y?Math.abs(_.y-(z?.[1]??0))/200:0}}),(0,n.jsxs)("svg",{width:"100%",height:"100%",children:[(0,n.jsxs)("g",{className:(0,o.d)("connected"===d&&ez>0?"opacity-100":"opacity-0"),children:[n.jsx("rect",{x:"50%",y:`${50-eS}%`,height:`${2*eS}%`,width:e_,shapeRendering:"geometricPrecision",className:"fill-brand-500 transition-all ease-in-out",style:{transform:`translateX(-${e_/2})`}}),n.jsx("rect",{x:`${50-eC}%`,y:"50%",width:`${2*eC}%`,height:e_,shapeRendering:"geometricPrecision",className:"fill-brand-500 transition-all ease-in-out",style:{transform:`translateY(-${e_/2})`}})]}),n.jsx("circle",{cx:"50%",cy:"50%",r:el?ez:1.5*ez,fill:"none",className:(0,o.d)("ease-out",el?"fill-brand-300":"fill-brand-300/0 transition-all duration-700"),shapeRendering:"geometricPrecision",strokeWidth:0}),n.jsx("circle",{cx:"50%",cy:"50%",r:eN,fill:"none",className:(0,o.d)("stroke-brand-500 transition-all ease-in-out","connected"===d&&ez>0?"opacity-100":"opacity-0"),shapeRendering:"geometricPrecision",strokeWidth:e_}),n.jsx("circle",{cx:"50%",cy:"50%",r:ez,fill:"none",className:(0,o.d)("stroke-brand-500 transition-all ease-in-out","connected"===d&&ez>0?"opacity-100":"opacity-0"),shapeRendering:"geometricPrecision",strokeWidth:e_})]})]}),n.jsx("div",{className:"absolute bottom-24 left-1/4 right-1/4 max-h-[50%] overflow-y-scroll rounded-md bg-zinc-900/70 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",children:(0,n.jsxs)("div",{ref:ei,children:[G&&P.filter(e=>e.key.toLowerCase().includes("gain")||e.key.toLowerCase().includes("exposure")||e.key.startsWith("Ae")||e.key.toLowerCase().includes("brightness")).filter(e=>"ColourGains"!==e.key).map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>A(e.key,"toggle"in e?!!t:t)})]},e.key)),Z&&P.filter(e=>e.key.toLowerCase().includes("saturation")||e.key.toLowerCase().includes("contrast")||e.key.startsWith("Awb")).map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>A(e.key,"toggle"in e?!!t:t)})]},e.key)),W&&P.map(e=>(0,n.jsxs)("div",{className:"p-4",children:[n.jsx("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),n.jsx(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>A(e.key,"toggle"in e?!!t:t)})]},e.key))]})}),(0,n.jsxs)("div",{className:(0,l.m)("pointer-events-none absolute inset-0 flex items-center justify-center"),children:[n.jsx("h3",{className:(0,l.m)("absolute inset-0 flex items-center justify-center text-xl font-semibold text-rose-500 transition-all dark:text-rose-500","failed"===d?"animate-pulse opacity-100":"opacity-0"),children:"Webcam stream not found"}),n.jsx(c.$,{noMargin:!0,className:(0,l.m)("h-1/3 w-1/3 animate-spin text-inherit transition-all","text-green-500 dark:text-green-500",("connected"===d||"failed"===d)&&"opacity-0","failed"===d&&"text-rose-500 dark:text-rose-500","connecting"===d&&"text-brand-500 dark:text-brand-500","closed"===d&&"text-yellow-500 dark:text-yellow-500","disconnected"===d&&"text-amber-500 dark:text-amber-500","new"===d&&"text-sky-500 dark:text-sky-500")})]})]})})}},78796:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>WizardLayout});var n=r(86700),i=r(16239);function WizardLayout({children:e}){return(0,i.headers)().get("x-configurator"),n.jsx("main",{className:"",children:n.jsx("div",{className:"mx-auto max-w-full",children:e})})}},99024:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>s,__esModule:()=>a,default:()=>l});var n=r(23646);let i=(0,n.createProxy)(String.raw`/home/runner/work/RatOS-configurator/RatOS-configurator/src/app/calibration/page.tsx`),{__esModule:a,$$typeof:s}=i,o=i.default,l=o}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[5793,8648,6212,9949,8726,4825],()=>__webpack_exec__(32942));module.exports=r})();