"use strict";exports.id=1710,exports.ids=[1710],exports.modules={35273:(e,t,r)=>{r.d(t,{wq:()=>PrinterConnectionHeader,Ch:()=>PrinterStateHeader});var a=r(96603),i=r(61418),n=r(30240),l=r(61331),s=r(21957),o=r(99234),d=r(51495);let useKlippyStateHandler=()=>{let{query:e,lastMessage:t}=(0,o.oK)({passThroughUpdateMethods:["notify_klippy_ready","notify_klippy_shutdown","notify_klippy_disconnected"]}),[r,a]=(0,d.useState)("unknown"),i=(0,d.useCallback)(async()=>{if(null!=e)try{let t=await e("server.info");if(t?.klippy_state==null)return;let r=t.klippy_state;a(r),"startup"===r&&setTimeout(()=>{i()},2e3)}catch(e){a("unknown")}},[e,a]);return(0,d.useEffect)(()=>{null!=e&&i()},[e,i]),(0,d.useEffect)(()=>{t&&"method"in t&&"notify_klippy_ready"===t.method&&a("ready"),t&&"method"in t&&"notify_klippy_shutdown"===t.method&&a("shutdown"),t&&"method"in t&&"notify_klippy_disconnected"===t.method&&(a("unknown"),i())},[t,i,a]),r},klipperStateToText=e=>{switch(e){case"error":return"Klipper State: Error";case"ready":return"Klipper State: Ready";case"shutdown":return"Klipper State: Shutdown";case"startup":return"Klipper State: Startup";default:return"Klipper State: Unknown"}},KlippyStateBadge=e=>{let t=useKlippyStateHandler(),r="orange";switch(t){case"error":r="red";break;case"ready":r="brand";break;case"shutdown":case"unknown":default:r="orange";break;case"startup":r="yellow"}return(0,a.jsxs)(l.Ct,{color:r,title:klipperStateToText(t),children:[a.jsx("svg",{className:(0,i.dV)((0,l._1)({color:r}),"h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:a.jsx("circle",{cx:4,cy:4,r:3})}),"Klipper"]})},moonrakerStatusToText=e=>{switch(e){case"not-running":return"Moonraker State: Not Running";case"connected":return"Moonraker State: Connected";case"connecting":return"Moonraker State: Connecting";default:return"Moonraker State: Unknown"}},MoonrakerStateBadge=e=>{let{status:t}=(0,o.oK)(),r="orange";switch(t){case"not-running":r="red";break;case"connected":r="brand";break;case"connecting":r="yellow";break;default:r="orange"}return(0,a.jsxs)(l.Ct,{color:r,title:moonrakerStatusToText(t),children:[a.jsx("svg",{className:(0,i.dV)((0,l._1)({color:r}),"h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:a.jsx("circle",{cx:4,cy:4,r:3})}),"Moonraker"]})};var c=r(86053),u=r(36986);let PrinterHeader=e=>(0,a.jsxs)("div",{className:"mt-6 @container",children:[a.jsx("div",{className:"border-t border-white/10 bg-zinc-700/15 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-7xl flex-row items-center justify-between gap-x-8 gap-y-4 px-4 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[a.jsx("div",{className:(0,i.m6)("flex-none rounded-full bg-green-400/10 p-1 text-zinc-400",e.stateColorClass),children:a.jsx("div",{className:"h-2 w-2 rounded-full bg-current"})}),a.jsx("h1",{className:"flex gap-x-3 text-base leading-7",children:e.breadcrumb?.map((t,r)=>a.jsxs(d.Fragment,{children:[a.jsx("span",{className:"font-semibold text-white",children:t}),r<(e.breadcrumb?.length??0)-1&&a.jsx("span",{className:"text-zinc-400",children:"/"})]},r))})]}),a.jsx("div",{className:"capitalize",children:e.badges})]})}),a.jsx("header",{className:"sticky top-14 z-10 flex flex-grow-0 items-center gap-1 border-y border-b-white/10 border-t-white/5 bg-zinc-700/10 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"mx-auto w-full max-w-7xl gap-x-8 px-4 py-4",children:[a.jsx("h3",{className:"dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-xl font-medium focus:ring-0 focus:ring-offset-0",children:e.title}),a.jsx("p",{className:"dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-base font-medium text-muted-foreground focus:ring-0 focus:ring-offset-0 dark:text-muted-foreground",children:e.description})]})})]}),PrinterStateHeader=e=>{let t=(0,s.PF)("general.printername",{initialData:"Loading..."}),r=(0,u.useRecoilValue)(c.Xu),p=(0,o.DS)("server.info"),m=(0,o.hS)("print_stats"),x=m.data?.print_stats.state,f=(0,d.useMemo)(()=>{let e=[t.data??"RatOS"];return p.isLoading?e.push("Loading..."):r?.name&&e.push(r.name),e},[p.isLoading,t.data,r?.name]),g=(0,n.O)();return g?a.jsx(PrinterHeader,{stateColorClass:(0,i.dV)(p.data?.klippy_state==="error"&&"bg-red-400/10 text-red-400",p.data?.klippy_state==="startup"&&"bg-amber-400/10 text-amber-400",p.data?.klippy_state==="ready"&&"bg-green-400/10 text-green-400",p.data?.klippy_state==="shutdown"&&"bg-red-400/10 text-red-400"),breadcrumb:f,badges:a.jsx(l.Ct,{className:"order-first capitalize @screen-sm:order-none",color:void 0===x?"gray":"canceled"==x?"pink":"complete"==x?"green":"error"==x?"red":"paused"===x?"sky":"printing"===x?"yellow":"standby"===x?"brand":"gray",children:void 0===x?"Offline":x??"Loading..."}),title:e.title,description:e.description}):a.jsx(PrinterStateLoadingHeader,{})},PrinterConnectionHeader=e=>{let t=(0,s.PF)("general.printername",{initialData:"Loading..."}),r=(0,u.useRecoilValue)(c.Xu),l=(0,o.DS)("server.info"),p=(0,n.O)(),m=(0,d.useMemo)(()=>{let e=[t.data??"RatOS"];return l.isLoading?e.push("Loading..."):r?.name&&e.push(r.name),e},[l.isLoading,t.data,r?.name]);return p?a.jsx(PrinterHeader,{stateColorClass:(0,i.dV)(l.data?.klippy_state==="error"&&"bg-red-400/10 text-red-400",l.data?.klippy_state==="startup"&&"bg-amber-400/10 text-amber-400",l.data?.klippy_state==="ready"&&"bg-green-400/10 text-green-400",l.data?.klippy_state==="shutdown"&&"bg-red-400/10 text-red-400"),breadcrumb:m,badges:(0,a.jsxs)("div",{className:"inline-flex space-x-1 sm:flex-row-reverse sm:justify-end sm:space-x-2 sm:space-y-0 md:flex-row",children:[a.jsx(KlippyStateBadge,{}),a.jsx(MoonrakerStateBadge,{})]}),title:e.title,description:e.description}):a.jsx(PrinterStateLoadingHeader,{})},PrinterStateLoadingHeader=()=>a.jsx(PrinterHeader,{stateColorClass:"bg-gray-400/10 text-gray-400",breadcrumb:["RatOS","Loading..."],title:"Loading printer state...",description:"Please wait while RatOS loads your printer state",badges:(0,a.jsxs)("div",{className:"flex space-x-1 sm:flex-row-reverse sm:justify-end sm:space-x-2 sm:space-y-0 md:flex-row",children:[a.jsx(KlippyStateBadge,{}),a.jsx(MoonrakerStateBadge,{})]})})},78765:(e,t,r)=>{r.d(t,{o:()=>QueryStatus});var a=r(96603),i=r(50089),n=r(24240),l=r(78438);let QueryStatus=e=>{let t=null;return e.isError&&(t=a.jsx("div",{className:"mb-4",children:a.jsx(i.B,{children:e.error?.message})})),e.isLoading&&(t=a.jsx("div",{className:"mb-4 flex items-center justify-center",children:a.jsx(n.$,{})})),a.jsx(l.i,{children:t})}},85874:(e,t,r)=>{r.d(t,{o:()=>FileChanges});var a=r(96603),i=r(51495),n=r(76461),l=r(68797),s=r(39470),o=r(24042),d=r(41380);r(18089);var c=r(54827),u=r(19623),p=r(61418);let TwoColumns=e=>a.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"1.5",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:(0,p.m6)("h-6 w-6",e.className),children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M 12 4.5 L 12 19.5 M 4.125 19.5 L 19.875 19.5 C 20.496 19.5 21 18.996 21 18.375 L 21 5.625 C 21 5.004 20.496 4.5 19.875 4.5 L 4.125 4.5 C 3.504 4.5 3 5.004 3 5.625 L 3 18.375 C 3 18.996 3.504 19.5 4.125 19.5 Z"})}),SingleColumn=e=>a.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"1.5",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:(0,p.m6)("h-6 w-6",e.className),children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M 4.125 19.5 L 19.875 19.5 C 20.496 19.5 21 18.996 21 18.375 L 21 5.625 C 21 5.004 20.496 4.5 19.875 4.5 L 4.125 4.5 C 3.504 4.5 3 5.004 3 5.625 L 3 18.375 C 3 18.996 3.504 19.5 4.125 19.5 Z"})}),proccessTokens=e=>{if(!e)return;let t={highlight:!1,enhancers:[(0,d.BF)(e,{type:"block"})]};try{return(0,d.wS)(e,t)}catch(e){return}},DiffModal=e=>{let{isOpen:t,setIsOpen:r}=e,[n,l]=(0,i.useState)("unified"),m=(0,i.useCallback)(()=>{r(!1)},[r]),x=(0,i.useMemo)(()=>(0,d.z2)(e.diff),[e.diff]),f="changed"===e.state?"modify":"created"===e.state?"add":"delete";return a.jsx(s.u.Root,{show:t,as:i.Fragment,appear:!0,children:a.jsx(o.V,{as:"div",className:"git-diff fixed inset-0 z-50 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",onClose:m,children:(0,a.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[a.jsx(s.u.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:a.jsx(o.V.Overlay,{className:"fixed inset-0 bg-zinc-500 bg-opacity-75 transition-opacity dark:bg-zinc-950 dark:bg-opacity-75"})}),a.jsx("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"â€‹"}),a.jsx(s.u.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsxs)("div",{className:"relative inline-flex max-h-[80vh] max-w-screen-2xl transform flex-col overflow-hidden rounded-lg bg-white py-4 text-left align-bottom shadow-xl transition-all dark:bg-zinc-800 sm:my-8 sm:w-full sm:py-6 sm:align-middle",children:[(0,a.jsxs)(o.V.Title,{as:"h3",className:"flex items-center justify-between border-b border-zinc-200 px-4 pb-4 text-lg font-semibold leading-6 text-zinc-900 dark:border-zinc-700 dark:text-zinc-100 sm:px-6",children:[a.jsx("div",{children:e.title}),(0,a.jsxs)("div",{className:"relative flex flex-nowrap items-center space-x-2 text-zinc-500 dark:text-zinc-400",children:[a.jsx("button",{className:(0,p.dV)("unified"===n?"cursor-default text-sky-600 dark:text-sky-400":"hover:text-zinc-800 dark:hover:text-zinc-100"),onClick:()=>l("unified"),title:"Unified View",children:a.jsx(SingleColumn,{className:"h-6 w-6"})}),a.jsx("button",{className:(0,p.dV)("split"===n?"cursor-default text-sky-600 dark:text-sky-400":"hover:text-zinc-800 dark:hover:text-zinc-100"),onClick:()=>l("split"),title:"Split View",children:a.jsx(TwoColumns,{className:"h-6 w-6"})}),a.jsx("div",{className:"!ml-4 !mr-1 h-6 border-l border-l-zinc-200 dark:border-l-zinc-800"}),a.jsx("button",{className:"hover:text-zinc-800 dark:hover:text-zinc-100",onClick:m,children:a.jsx(c,{className:"h-6 w-6"})})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",children:x.map(({hunks:e},t)=>a.jsx(d.zI,{hunks:e,viewType:n,diffType:f,tokens:proccessTokens(e)},t))}),(0,a.jsxs)("div",{className:"flex-end flex flex-row items-center justify-end space-x-2 border-t border-zinc-200 px-4 pt-4 dark:border-zinc-700 sm:px-6 sm:pt-6",children:[e.buttons??null,a.jsx(u.z,{variant:"plain",onClick:m,children:"Close"})]})]})})]})})})};var m=r(6957),x=r(5955),f=r(61709);let g=(0,f.j)("flex-none rounded-full p-1 relative flex",{variants:{state:{success:"dark:text-green-400 text-green-500 bg-green-400/20",info:"dark:text-sky-400 text-sky-500 bg-sky-400/20",warning:"dark:text-yellow-400 text-yellow-500 bg-yellow-400/20",danger:"dark:text-rose-400 text-rose-500 bg-rose-400/20",indeterminate:"dark:text-zinc-400 text-zinc-500 bg-zinc-500/20",plain:"dark:text-zinc-400 text-zinc-500 bg-zinc-500/20",primary:"dark:text-brand-400 text-brand-500 bg-brand-500/20"}}}),StateCircle=e=>(0,a.jsxs)("div",{className:g(e),children:[a.jsx("div",{title:e.title,className:(0,p.m6)("absolute inset-0 transition-all duration-700",e.ping?"opacity-100":"opacity-0",e.pingClassName??"z-2"),children:a.jsx("div",{className:(0,p.m6)("absolute inset-0 inline-flex animate-ping rounded-full bg-current opacity-0 ease-out")})}),a.jsx("div",{className:"h-2 w-2 rounded-full bg-current"})]});var h=r(61331),b=r(63728),v=r(28986),y=r(78765);let ChangedFile=e=>{let{addFileToIgnore:t,addFileToOverwrite:r,file:n,removeFileToIgnore:l,removeFileToOverwrite:o,isMarkedIgnored:d,isMarkedOverwritten:c}=e,[f,g]=(0,i.useState)(!1),y=(0,i.useCallback)(e=>{g(!0)},[]),k="changed"===n.state&&(n.overwrite||c)||"created"===n.state||"removed"===n.state,j="changed"===n.state,w="created"===n.state||"removed"===n.state||"changed"===n.state,N=c||n.overwrite&&n.exists,S=w&&!d&&!N&&!k&&!0===n.changedFromConfig;n.state,n.state,n.state;let R=(0,i.useMemo)(()=>{if("RatOS.cfg"===n.fileName)return[];let e=null,a=null,i=null,s=null,u=null;return N&&!d?e={title:"Skip",intent:"indeterminate",action:c?o:t}:j&&(i={title:"Overwrite",intent:"warning",action:d?l:r}),w&&!d?a={title:"Ignore",intent:S?"danger":"indeterminate",action:t}:d&&("removed"===n.state?u={title:"Delete",intent:"danger",action:l}:w&&(s={title:"Write",intent:"success",action:l})),[e,a,i,s,u].filter(Boolean)},[t,r,n.fileName,n.state,w,d,d,c,j,N,S,l,o]),C=(0,i.useMemo)(()=>S?"danger":"changed"===n.state?d&&n.overwrite||N&&!n.overwrite?"warning":N?"success":"indeterminate":"created"===n.state?d?"danger":"success":"removed"!==n.state||d?"indeterminate":"warning",[n.overwrite,n.state,d,N,S]),[z]=(0,b.S)([C],4e3);return(0,a.jsxs)("li",{className:"flex items-center justify-between gap-x-6 py-5",children:[n?.diff!=null&&a.jsx(DiffModal,{diff:n.diff,title:`Changes to ${n.fileName}`,state:n.state,setIsOpen:g,buttons:R.map(e=>a.jsx(u.z,{onClick:()=>{e.action(n.fileName),g(!1)},variant:e.intent,children:e.title},e.title)),isOpen:f}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[a.jsx(StateCircle,{state:C,ping:z}),a.jsx("p",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:n.fileName}),a.jsx(h.Ct,{size:"sm",color:"changed"===n.state?n.changedFromConfig?"yellow":"sky":"created"===n.state?"green":"removed"===n.state?"rose":"gray",children:"changed"===n.state?n.changedFromConfig?"Pending changes":"Changed on disk":"created"===n.state?"New file":"removed"===n.state?"Deleted":"No updates"}),n.changedOnDisk&&a.jsx(h.Ct,{size:"sm",color:"sky",children:"Changed on disk"})]}),a.jsx("div",{className:"mt-1 flex items-center gap-x-2 text-xs leading-5 text-zinc-500 dark:text-zinc-400",children:(0,a.jsxs)("p",{className:"",children:["changed"===n.state&&(N&&!d?"File will be backed up and overwritten."+("RatOS.cfg"!=n.fileName?" Any changes you've made can be recovered from the backup.":""):S?"Please review the changes and make a decision.":"File will be skipped."),"created"===n.state&&(d?"File will be skipped.":"File will be created."),"removed"===n.state&&(d?"File will remain untouched.":"File will be deleted."),"unchanged"===n.state&&(n.changedOnDisk?"File has user modifications.":"File remains untouched.")]})})]}),(0,a.jsxs)("div",{className:"flex flex-none items-center gap-x-4",children:[a.jsx("div",{className:"flex flex-none items-center",children:S?a.jsx(u.z,{variant:"info",onClick:()=>y(n),children:"Review changes"}):a.jsx(v,{className:"h-5 w-5 text-green-500 dark:text-brand-500","aria-hidden":"true"})}),(0,a.jsxs)(m.v,{as:"div",className:"relative flex-none",children:[(0,a.jsxs)(m.v.Button,{className:"-m-2.5 block p-2.5 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100",children:[a.jsx("span",{className:"sr-only",children:"Open options"}),a.jsx(x,{className:"h-5 w-5","aria-hidden":"true"})]}),a.jsx(s.u,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsxs)(m.v.Items,{className:"absolute right-0 z-10 mt-2 w-32 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-zinc-900/5 focus:outline-none dark:bg-zinc-900 dark:ring-zinc-100/5",children:[R.map(e=>a.jsx(m.v.Item,{children:({active:t,disabled:r})=>a.jsx("span",{onClick:()=>e.action(n.fileName),className:(0,p.dV)(t?"bg-zinc-50 dark:bg-zinc-800":"",r?"cursor-not-allowed opacity-50":"cursor-pointer","block px-3 py-1 text-sm leading-6 text-zinc-800 dark:text-zinc-200"),children:e.title})},e.title)),a.jsx(m.v.Item,{disabled:null==n.diff,children:({active:e,disabled:t})=>a.jsx("span",{onClick:()=>y(n),className:(0,p.dV)(e?"bg-zinc-50 dark:bg-zinc-800":"",t?"cursor-not-allowed opacity-50":"cursor-pointer","block px-3 py-1 text-sm leading-6 text-zinc-800 dark:text-zinc-200"),children:"View diff"})})]})})]})]})]},n.fileName)},FileChanges=e=>{let{serializedConfig:t,onFilesToIgnoreChange:r,onFilesToOverwriteChange:s}=e,[o,d]=(0,i.useState)([]),c=(0,i.useCallback)(e=>{d(t=>t.includes(e)?t:[...t,e])},[]),u=(0,i.useCallback)(e=>{d(t=>t.includes(e)?t.filter(t=>t!==e):t)},[]),[p,m]=(0,i.useState)([]),x=(0,i.useCallback)(e=>{m(t=>t.includes(e)?t:[...t,e])},[]),f=(0,i.useCallback)(e=>{m(t=>t.includes(e)?t.filter(t=>t!==e):t)},[]);(0,i.useEffect)(()=>{s(o)},[o,s]),(0,i.useEffect)(()=>{r(p)},[p,r]);let g=n.SX.useUtils().client,h=(0,l.a)({queryKey:["printer.filesToWrite",t],queryFn:async()=>{let e=await g.printer.getFilesToWrite.mutate({config:t??{}});return e},enabled:null!=t});return(0,a.jsxs)(a.Fragment,{children:[a.jsx("ul",{role:"list",className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:h.data?.map(e=>a.jsx(ChangedFile,{file:e,isMarkedIgnored:p.includes(e.fileName),isMarkedOverwritten:o.includes(e.fileName),addFileToIgnore:x,addFileToOverwrite:c,removeFileToIgnore:f,removeFileToOverwrite:u},e.fileName))}),a.jsx(y.o,{...h})]})}},75310:(e,t,r)=>{r.d(t,{l:()=>PrinterRailSettings});var a=r(96603),i=r(30006),n=r(51495),l=r(95597),s=r(4106),o=r(61331),d=r(55260),c=r(29340),u=r(18391),p=r(62108),m=r(36986),x=r(74321),f=r(30819),g=r(79030),h=r(86053),b=r(82251),v=r(76461),y=r(61418),k=r(13728),j=r(30413),w=r(47994),N=r(73367);k.z.array(f.g6);let PrinterRailSettings=e=>{let t=(0,b.YC)(),r=t.find(t=>t.getExtruderAxis()===e.printerRail.axis),k=t.every(e=>e.hasToolboard()),S=r?.getExtruderAxis()===e.printerRailDefault.axis&&r?.hasToolboard(),R=S?r.getToolboard():e.selectedBoard,[C,z]=(0,n.useState)(!!e.performanceMode),D=(0,m.useSetRecoilState)((0,h.ew)(e.printerRail.axis)),M=(0,m.useRecoilValue)(h.q7),[T,_]=(0,n.useState)(e.printerRail.motorSlot&&e.selectedBoard?.motorSlots?.[e.printerRail.motorSlot]?e.printerRail.motorSlot:void 0),F=R?.integratedDrivers?R.integratedDrivers[T??(e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis)]??R.integratedDrivers[e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis]:null,[L,O]=(0,n.useState)(null!=F?(0,g.Df)(F)??e.printerRail.driver:e.printerRail.driver),[P,B]=(0,n.useState)(e.printerRail.stepper),[V,E]=(0,n.useState)(C?e.printerRailDefault.performanceMode?.homingSpeed??e.printerRailDefault.homingSpeed:e.printerRailDefault.homingSpeed),I=null==e.errors?0:Object.keys(e.errors).reduce((t,r)=>{let a=e.errors?.[r];if(null==a)return t;let i=Array.isArray(a)?a.length:a._errors.length;return t+i},0),H=(0,n.useCallback)(r=>null!=r&&M.some(a=>{let i=t.find(e=>e.getExtruderAxis()===a.axis);return!(a.axis===e.printerRail.axis||i?.hasToolboard())&&a.motorSlot===r}),[M,e.printerRail.axis,t]),K=v.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,canUseExtruderlessConfigs:k,boardPath:R?.path??""},{enabled:!!R});(0,n.useEffect)(()=>{K.data&&null==T&&R?.motorSlots?.[K.data]!=null&&_(K.data)},[R,K.data,T,e.printerRailDefault.axis]);let A=(0,f.Wx)(R,L).map(e=>({...e,badge:null!=(0,s.a)(P,L,e.id,void 0,C)?{children:"Tuned Preset",color:"sky"}:void 0})),[W,U]=(0,n.useState)(A.find(t=>t.id===e.printerRail.voltage)??A.find(t=>t.id===(C&&e.printerRailDefault.performanceMode?.voltage?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage))??A[0]),[Y,Q]=(0,n.useState)(e.printerRail.current),q=(0,n.useMemo)(()=>(0,s.a)(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),X=(0,n.useMemo)(()=>(0,s.a)(P,L,W.id,void 0,C),[P,L,W,C]),Z=(0,n.useMemo)(()=>(0,s.a)(P,L,W.id,Y,C),[P,L,W,C,Y]),$=l.N.filter(e=>"UART"===e.protocol||R?.stepperSPI!=null).map(e=>({...e,badge:null!=(0,s.a)(P,e,W.id,void 0,C)?{children:"Tuned Preset",color:"sky"}:void 0})),G=s.B.map(e=>({...e,badge:null!=(0,s.a)(e,L,W.id,void 0,C)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,n.useEffect)(()=>{(0,f.R_)(e.printerRail,e.printerRailDefault,!e.performanceMode)&&(e.performanceMode&&e.printerRailDefault.performanceMode?(E(e.printerRailDefault.performanceMode.homingSpeed??e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&U(A.find(t=>t.id===(e.printerRailDefault.performanceMode?.voltage??e.printerRailDefault.voltage))??A[0]),null!=e.printerRailDefault.performanceMode.current&&Q(e.printerRailDefault.performanceMode.current)):(E(e.printerRailDefault.homingSpeed),U(A.find(t=>t.id===e.printerRailDefault.voltage)??A[0]),Q(e.printerRailDefault.current))),z(!!e.performanceMode)},[e.performanceMode]),(0,n.useEffect)(()=>{let e=A.find(e=>e.id===W.id);!e&&(U(X?A.find(e=>e.id===X.voltage)??A[0]:A[0]),X&&Q(X.run_current))},[A,W,X]),(0,n.useEffect)(()=>{let t={axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,homingSpeed:V,motorSlot:T,driver:L,voltage:W.id,stepper:P,current:Y},r=(0,g.Yz)(t),a=(0,g.Yz)(e.printerRail),i=Object.keys(r).some(e=>r[e]!==a[e]);i&&D(r)},[Y,L,e.printerRail,V,D,P,W.id,T]);let J=X&&X.run_current===Y,ee="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===f.po.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase(),et=R?.motorSlots!=null&&Object.keys(R.motorSlots).length>0?Object.keys(R.motorSlots).map(t=>{if(R.motorSlots?.[t].title==null)return null;let r=R.motorSlots?.[t].diag_pin!=null,a=R.motorSlots?.[t].endstop_pin!=null,i=H(t),n=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!r;return{id:t,title:R.motorSlots?.[t].title,disabled:n,badge:[r?void 0:{children:"No diag pin",color:n?"red":"gray"},a?void 0:{children:"No endstop pin",color:"gray"},!0===i?{children:"In use",color:"orange"}:void 0].filter(Boolean)}}).filter(Boolean):null,er=(0,n.useMemo)(()=>{if(null==T||R?.motorSlots?.[T].title==null)return;let t=R.motorSlots?.[T].diag_pin!=null,r=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!t;return!t&&r?{children:"No diag pin",color:"red"}:void 0},[R,T,e.printerRailDefault.axis]);return a.jsx(j.M,{children:e.isVisible&&(0,a.jsxs)(w.Card,{exit:{opacity:0,scale:.9,y:-40},initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},className:(0,y.m6)("break-inside-avoid-column",I>0&&(0,o.iA)({color:"red"}),I>0&&(0,o.xU)({color:"red"})),children:[(0,a.jsxs)(N.Ol,{className:"",children:[a.jsx(N.ll,{className:(0,y.m6)(I>0&&"text-red-900/80 dark:text-red-100"),children:ee}),a.jsx(N.SZ,{className:(0,y.m6)(I>0&&"text-red-800/80 dark:text-red-100/60"),children:e.printerRail.axisDescription})]}),(0,a.jsxs)(N.aY,{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[et&&a.jsx("div",{className:"col-span-2",children:a.jsx(i.Lt,{label:"Motor Slot",options:et,error:e.errors?.motorSlot?._errors.join("\n"),onSelect:e=>{_(e.id),R?.integratedDrivers?.[e.id]!=null&&O((0,g.Df)(R.integratedDrivers[e.id])??L)},value:T?et.find(e=>e.id===T):void 0,badge:er})}),a.jsx("div",{className:"col-span-2",children:a.jsx(i.Lt,{label:"Driver",options:$,onSelect:O,value:L,disabled:null!=F,badge:[null!=F?{children:"Integrated",color:"sky"}:void 0,S?{children:"Toolboard",color:"yellow"}:void 0].filter(Boolean)})}),a.jsx("div",{className:"col-span-2",children:a.jsx(i.Lt,{label:"Stepper",options:G,onSelect:B,value:P})}),a.jsx("div",{className:"col-span-1",children:a.jsx(i.Lt,{label:"Voltage",options:A,onSelect:U,value:W})}),a.jsx("div",{className:"col-span-1",children:a.jsx(d.o,{type:"number",label:"Current",value:Y,onChange:Q,inputMode:"decimal",step:"any",min:0,max:L.maxCurrent})}),P.maxPeakCurrent/1.41<Y&&(0,a.jsxs)(c.j,{Icon:x,color:"yellow",title:"Stepper overcurrent!",className:"col-span-2",children:["Your stepper motor is rated for ",Math.floor(100*P.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",Y,"A."]}),null!=Z&&a.jsx(c.j,{Icon:u,color:"brand",title:"Driver tuning applied!",className:"col-span-2",children:"RatOS preset applied automatically."}),Z?.run_current!==q?.run_current&&X&&!J&&(0,a.jsxs)(c.j,{Icon:p,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-2",children:["RatOS has a recommended preset for your current settings at ",X.run_current,"A. You can"," ",(0,a.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>Q(X.run_current),children:["change the current to ",X.run_current,"A"]})," ","to apply the preset automatically."]})]})]},e.printerRail.axis)})}},73367:(e,t,r)=>{r.d(t,{Ol:()=>l,SZ:()=>o,aY:()=>d,eW:()=>c,ll:()=>s});var a=r(96603),i=r(51495),n=r(368);let l=i.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let s=i.forwardRef(({className:e,...t},r)=>a.jsx("h3",{ref:r,className:(0,n.cn)("font-semibold leading-none tracking-tight",e),...t}));s.displayName="CardTitle";let o=i.forwardRef(({className:e,...t},r)=>a.jsx("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",e),...t}));o.displayName="CardDescription";let d=i.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent";let c=i.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t}));c.displayName="CardFooter"},21957:(e,t,r)=>{r.d(t,{PF:()=>useMainsailQuery}),r(51495);var a=r(99234);let useMainsailQuery=(e,t)=>(0,a.A4)("mainsail",e,t)}};