"use strict";exports.id=5310,exports.ids=[5310],exports.modules={75310:(e,r,t)=>{t.d(r,{l:()=>PrinterRailSettings});var i=t(96603),a=t(30006),l=t(51495),o=t(95597),n=t(4106),s=t(61331),d=t(55260),p=t(29340),u=t(18391),c=t(62108),m=t(36986),x=t(74321),f=t(30819),R=t(79030),g=t(86053),h=t(82251),v=t(76461),S=t(61418),D=t(13728),b=t(30413),y=t(47994);D.z.array(f.g6);let PrinterRailSettings=e=>{let r=(0,h.YC)(),t=r.find(r=>r.getExtruderAxis()===e.printerRail.axis),D=r.every(e=>e.hasToolboard()),j=t?.getExtruderAxis()===e.printerRailDefault.axis&&t?.hasToolboard(),M=j?t.getToolboard():e.selectedBoard,[k,N]=(0,l.useState)(!!e.performanceMode),_=(0,m.useSetRecoilState)((0,g.ew)(e.printerRail.axis)),A=(0,m.useRecoilValue)(g.q7),[C,T]=(0,l.useState)(e.printerRail.motorSlot&&e.selectedBoard?.motorSlots?.[e.printerRail.motorSlot]?e.printerRail.motorSlot:void 0),E=M?.integratedDrivers&&(M.integratedDrivers[C??e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis]??M.integratedDrivers[e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis]),[P,z]=(0,l.useState)(null!=E?(0,R.Df)(E)??e.printerRail.driver:e.printerRail.driver),[W,B]=(0,l.useState)(e.printerRail.stepper),[I,L]=(0,l.useState)(k?e.printerRailDefault.performanceMode?.homingSpeed??e.printerRailDefault.homingSpeed:e.printerRailDefault.homingSpeed),O=null==e.errors?0:Object.keys(e.errors).reduce((r,t)=>{let i=e.errors?.[t];if(null==i)return r;let a=Array.isArray(i)?i.length:i._errors.length;return r+a},0),Y=(0,l.useCallback)(t=>null!=t&&A.some(i=>{let a=r.find(e=>e.getExtruderAxis()===i.axis);return!(i.axis===e.printerRail.axis||a?.hasToolboard())&&i.motorSlot===t}),[A,e.printerRail.axis,r]),U=v.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,canUseExtruderlessConfigs:D,boardPath:M?.path??""},{enabled:!!M});(0,l.useEffect)(()=>{U.data&&null==C&&M?.motorSlots?.[U.data]!=null&&T(U.data)},[M,U.data,C,e.printerRailDefault.axis]);let w=(0,f.Wx)(M,P).map(e=>({...e,badge:null!=(0,n.a)(W,P,e.id,void 0,k)?{children:"Tuned Preset",color:"sky"}:void 0})),[V,q]=(0,l.useState)(w.find(r=>r.id===e.printerRail.voltage)??w.find(r=>r.id===(k&&e.printerRailDefault.performanceMode?.voltage?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage))??w[0]),[Q,X]=(0,l.useState)(e.printerRail.current),F=(0,l.useMemo)(()=>(0,n.a)(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),G=(0,l.useMemo)(()=>(0,n.a)(W,P,V.id,void 0,k),[W,P,V,k]),H=(0,l.useMemo)(()=>(0,n.a)(W,P,V.id,Q,k),[W,P,V,k,Q]),J=o.N.filter(e=>"UART"===e.protocol||M?.stepperSPI!=null).map(e=>({...e,badge:null!=(0,n.a)(W,e,V.id,void 0,k)?{children:"Tuned Preset",color:"sky"}:void 0})),K=n.B.map(e=>({...e,badge:null!=(0,n.a)(e,P,V.id,void 0,k)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,l.useEffect)(()=>{(0,f.R_)(e.printerRail,e.printerRailDefault,!e.performanceMode)&&(e.performanceMode&&e.printerRailDefault.performanceMode?(L(e.printerRailDefault.performanceMode.homingSpeed??e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&q(w.find(r=>r.id===(e.printerRailDefault.performanceMode?.voltage??e.printerRailDefault.voltage))??w[0]),null!=e.printerRailDefault.performanceMode.current&&X(e.printerRailDefault.performanceMode.current)):(L(e.printerRailDefault.homingSpeed),q(w.find(r=>r.id===e.printerRailDefault.voltage)??w[0]),X(e.printerRailDefault.current))),N(!!e.performanceMode)},[e.performanceMode]),(0,l.useEffect)(()=>{let e=w.find(e=>e.id===V.id);!e&&(q(G?w.find(e=>e.id===G.voltage)??w[0]:w[0]),G&&X(G.run_current))},[w,V,G]),(0,l.useEffect)(()=>{let r={axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,homingSpeed:I,motorSlot:C,driver:P,voltage:V.id,stepper:W,current:Q},t=(0,R.Yz)(r),i=(0,R.Yz)(e.printerRail),a=Object.keys(t).some(e=>t[e]!==i[e]);a&&_(t)},[Q,P,e.printerRail,I,_,W,V.id,C]);let Z=G&&G.run_current===Q,$="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===f.po.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase(),ee=M?.motorSlots!=null&&Object.keys(M.motorSlots).length>0?Object.keys(M.motorSlots).map(r=>{if(M.motorSlots?.[r].title==null)return null;let t=M.motorSlots?.[r].diag_pin!=null,i=M.motorSlots?.[r].endstop_pin!=null,a=Y(r),l=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!t;return{id:r,title:M.motorSlots?.[r].title,disabled:l,badge:[t?void 0:{children:"No diag pin",color:l?"red":"gray"},i?void 0:{children:"No endstop pin",color:"gray"},!0===a?{children:"In use",color:"orange"}:void 0].filter(Boolean)}}).filter(Boolean):null,er=(0,l.useMemo)(()=>{if(null==C||M?.motorSlots?.[C].title==null)return;let r=M.motorSlots?.[C].diag_pin!=null,t=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!r;return!r&&t?{children:"No diag pin",color:"red"}:void 0},[M,C,e.printerRailDefault.axis]);return i.jsx(b.M,{children:e.isVisible&&(0,i.jsxs)(y.Card,{exit:{opacity:0,scale:.9,y:-40},initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},className:(0,S.m6)("break-inside-avoid-column p-4",O>0&&(0,s.iA)({color:"red"}),O>0&&(0,s.xU)({color:"red"})),children:[(0,i.jsxs)("div",{className:"",children:[i.jsx("h3",{className:(0,S.m6)("text-sm font-bold leading-6 text-zinc-700 dark:text-zinc-300",O>0&&"text-red-900/80 dark:text-red-100"),children:$}),i.jsx("p",{className:(0,S.m6)("text-sm text-zinc-500 dark:text-zinc-400",O>0&&"text-red-800/80 dark:text-red-100/60"),children:e.printerRail.axisDescription})]}),(0,i.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[ee&&i.jsx("div",{className:"col-span-2",children:i.jsx(a.Lt,{label:"Motor Slot",options:ee,error:e.errors?.motorSlot?._errors.join("\n"),onSelect:e=>{T(e.id)},value:C?ee.find(e=>e.id===C):void 0,badge:er})}),i.jsx("div",{className:"col-span-2",children:i.jsx(a.Lt,{label:"Driver",options:J,onSelect:z,value:P,disabled:null!=E,badge:[null!=E?{children:"Integrated",color:"sky"}:void 0,j?{children:"Toolboard",color:"yellow"}:void 0].filter(Boolean)})}),i.jsx("div",{className:"col-span-2",children:i.jsx(a.Lt,{label:"Stepper",options:K,onSelect:B,value:W})}),i.jsx("div",{className:"col-span-1",children:i.jsx(a.Lt,{label:"Voltage",options:w,onSelect:q,value:V})}),i.jsx("div",{className:"col-span-1",children:i.jsx(d.o,{type:"number",label:"Current",value:Q,onChange:X,inputMode:"decimal",step:"any",min:0,max:P.maxCurrent})}),W.maxPeakCurrent/1.41<Q&&(0,i.jsxs)(p.j,{Icon:x,color:"yellow",title:"Stepper overcurrent!",className:"col-span-2",children:["Your stepper motor is rated for ",Math.floor(100*W.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",Q,"A."]}),null!=H&&i.jsx(p.j,{Icon:u,color:"brand",title:"Driver tuning applied!",className:"col-span-2",children:"RatOS preset applied automatically."}),H?.run_current!==F?.run_current&&G&&!Z&&(0,i.jsxs)(p.j,{Icon:c,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-2",children:["RatOS has a recommended preset for your current settings at ",G.run_current,"A. You can"," ",(0,i.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>X(G.run_current),children:["change the current to ",G.run_current,"A"]})," ","to apply the preset automatically."]})]})]},e.printerRail.axis)})}}};