"use strict";exports.id=5310,exports.ids=[5310],exports.modules={75310:(e,r,t)=>{t.d(r,{l:()=>PrinterRailSettings});var i=t(96603),l=t(30006),a=t(51495),o=t(95597),n=t(4106),s=t(61331),d=t(55260),u=t(29340),p=t(18391),c=t(62108),m=t(36986),x=t(74321),f=t(30819),R=t(79030),g=t(86053),h=t(82251),v=t(76461),S=t(61418),D=t(13728),b=t(43022),y=t(85841);D.z.array(f.g6);let PrinterRailSettings=e=>{let r=(0,h.YC)(),t=r.find(r=>r.getExtruderAxis()===e.printerRail.axis),D=r.every(e=>e.hasToolboard()),j=t?.getExtruderAxis()===e.printerRailDefault.axis&&t?.hasToolboard(),M=j?t.getToolboard():e.selectedBoard,[k,N]=(0,a.useState)(!!e.performanceMode),_=(0,m.useSetRecoilState)((0,g.ew)(e.printerRail.axis)),A=(0,m.useRecoilValue)(g.q7),E=M?.integratedDrivers&&M.integratedDrivers[e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis],[T,C]=(0,a.useState)(null!=E?(0,R.Df)(E)??e.printerRail.driver:e.printerRail.driver),[P,z]=(0,a.useState)(e.printerRail.stepper),[B,I]=(0,a.useState)(k?e.printerRailDefault.performanceMode?.homingSpeed??e.printerRailDefault.homingSpeed:e.printerRailDefault.homingSpeed),[L,O]=(0,a.useState)(e.printerRail.motorSlot&&e.selectedBoard?.motorSlots?.[e.printerRail.motorSlot]?e.printerRail.motorSlot:void 0),W=v.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,canUseExtruderlessConfigs:D,boardPath:M?.path??""},{enabled:!!M}),Y=null==e.errors?0:Object.keys(e.errors).reduce((r,t)=>{let i=e.errors?.[t];if(null==i)return r;let l=Array.isArray(i)?i.length:i._errors.length;return r+l},0),w=(0,a.useCallback)(t=>null!=t&&A.some(i=>{let l=r.find(e=>e.getExtruderAxis()===i.axis);return!(i.axis===e.printerRail.axis||l?.hasToolboard())&&i.motorSlot===t}),[A,e.printerRail.axis,r]);(0,a.useEffect)(()=>{W.data&&null==L&&M?.motorSlots?.[W.data]!=null&&O(W.data)},[M,W.data,L,e.printerRailDefault.axis]);let U=(0,f.Wx)(M,T).map(e=>({...e,badge:null!=(0,n.a)(P,T,e.id,void 0,k)?{children:"Tuned Preset",color:"sky"}:void 0})),[V,q]=(0,a.useState)(U.find(r=>r.id===e.printerRail.voltage)??U.find(r=>r.id===(k&&e.printerRailDefault.performanceMode?.voltage?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage))??U[0]),[Q,X]=(0,a.useState)(e.printerRail.current),F=(0,a.useMemo)(()=>(0,n.a)(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),G=(0,a.useMemo)(()=>(0,n.a)(P,T,V.id,void 0,k),[P,T,V,k]),H=(0,a.useMemo)(()=>(0,n.a)(P,T,V.id,Q,k),[P,T,V,k,Q]),J=o.N.filter(e=>"UART"===e.protocol||M?.stepperSPI!=null).map(e=>({...e,badge:null!=(0,n.a)(P,e,V.id,void 0,k)?{children:"Tuned Preset",color:"sky"}:void 0})),K=n.B.map(e=>({...e,badge:null!=(0,n.a)(e,T,V.id,void 0,k)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,a.useEffect)(()=>{(0,f.R_)(e.printerRail,e.printerRailDefault,!e.performanceMode)&&(e.performanceMode&&e.printerRailDefault.performanceMode?(I(e.printerRailDefault.performanceMode.homingSpeed??e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&q(U.find(r=>r.id===(e.printerRailDefault.performanceMode?.voltage??e.printerRailDefault.voltage))??U[0]),null!=e.printerRailDefault.performanceMode.current&&X(e.printerRailDefault.performanceMode.current)):(I(e.printerRailDefault.homingSpeed),q(U.find(r=>r.id===e.printerRailDefault.voltage)??U[0]),X(e.printerRailDefault.current))),N(!!e.performanceMode)},[e.performanceMode]),(0,a.useEffect)(()=>{let e=U.find(e=>e.id===V.id);!e&&(q(G?U.find(e=>e.id===G.voltage)??U[0]:U[0]),G&&X(G.run_current))},[U,V,G]),(0,a.useEffect)(()=>{let r={axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,homingSpeed:B,motorSlot:L,driver:T,voltage:V.id,stepper:P,current:Q},t=(0,R.Yz)(r),i=(0,R.Yz)(e.printerRail),l=Object.keys(t).some(e=>t[e]!==i[e]);l&&_(t)},[Q,T,e.printerRail,B,_,P,V.id,L]);let Z=G&&G.run_current===Q,$="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===f.po.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase(),ee=M?.motorSlots!=null&&Object.keys(M.motorSlots).length>0?Object.keys(M.motorSlots).map(r=>{if(M.motorSlots?.[r].title==null)return null;let t=M.motorSlots?.[r].diag_pin!=null,i=M.motorSlots?.[r].endstop_pin!=null,l=w(r),a=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!t;return{id:r,title:M.motorSlots?.[r].title,disabled:a,badge:[t?void 0:{children:"No diag pin",color:a?"red":"gray"},i?void 0:{children:"No endstop pin",color:"gray"},!0===l?{children:"In use",color:"orange"}:void 0].filter(Boolean)}}).filter(Boolean):null,er=(0,a.useMemo)(()=>{if(null==L||M?.motorSlots?.[L].title==null)return;let r=M.motorSlots?.[L].diag_pin!=null,t=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!r;return!r&&t?{children:"No diag pin",color:"red"}:void 0},[M,L,e.printerRailDefault.axis]);return i.jsx(b.M,{children:e.isVisible&&(0,i.jsxs)(y.E.div,{exit:{opacity:0,scale:.9,y:-40},initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},className:(0,S.m6)("break-inside-avoid-column rounded-md border border-zinc-300 p-4 shadow-lg dark:border-zinc-700",Y>0&&(0,s.iA)({color:"red"}),Y>0&&(0,s.xU)({color:"red"})),children:[(0,i.jsxs)("div",{className:"",children:[i.jsx("h3",{className:(0,S.m6)("text-sm font-bold leading-6 text-zinc-700 dark:text-zinc-300",Y>0&&"text-red-900/80 dark:text-red-100"),children:$}),i.jsx("p",{className:(0,S.m6)("text-sm text-zinc-500 dark:text-zinc-400",Y>0&&"text-red-800/80 dark:text-red-100/60"),children:e.printerRail.axisDescription})]}),(0,i.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[ee&&i.jsx("div",{className:"col-span-2",children:i.jsx(l.Lt,{label:"Motor Slot",options:ee,error:e.errors?.motorSlot?._errors.join("\n"),onSelect:e=>{O(e.id)},value:L?ee.find(e=>e.id===L):void 0,badge:er})}),i.jsx("div",{className:"col-span-2",children:i.jsx(l.Lt,{label:"Driver",options:J,onSelect:C,value:T,disabled:null!=E,badge:[null!=E?{children:"Integrated",color:"sky"}:void 0,j?{children:"Toolboard",color:"yellow"}:void 0].filter(Boolean)})}),i.jsx("div",{className:"col-span-2",children:i.jsx(l.Lt,{label:"Stepper",options:K,onSelect:z,value:P})}),i.jsx("div",{className:"col-span-1",children:i.jsx(l.Lt,{label:"Voltage",options:U,onSelect:q,value:V})}),i.jsx("div",{className:"col-span-1",children:i.jsx(d.o,{type:"number",label:"Current",value:Q,onChange:X,inputMode:"decimal",step:"any",min:0,max:T.maxCurrent})}),P.maxPeakCurrent/1.41<Q&&(0,i.jsxs)(u.j,{Icon:x,color:"yellow",title:"Stepper overcurrent!",className:"col-span-2",children:["Your stepper motor is rated for ",Math.floor(100*P.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",Q,"A."]}),null!=H&&i.jsx(u.j,{Icon:p,color:"brand",title:"Driver tuning applied!",className:"col-span-2",children:"RatOS preset applied automatically."}),H?.run_current!==F?.run_current&&G&&!Z&&(0,i.jsxs)(u.j,{Icon:c,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-2",children:["RatOS has a recommended preset for your current settings at ",G.run_current,"A. You can"," ",(0,i.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>X(G.run_current),children:["change the current to ",G.run_current,"A"]})," ","to apply the preset automatically."]})]})]},e.printerRail.axis)})}}};