(()=>{"use strict";var e={14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},16432:(e,r,t)=>{var a=t(12530),i=t(50509),n=t(24906),s=t(74934),_=t(90345),u=t(1458),p=t(84518),l=t(83600),o=t(68653),c=t(6704),f=t(95754),w=t(22212),b=t(40401),m=t(33183),d=t(58966),q=t(63969),h=t(75427),g=t(60562),x=t(10265);let detrendSignal=e=>(0,g.tidy)(()=>(0,g.sub)(e,(0,g.mean)(e,0,!0))),k=.5,getFFTSize=(e,r=k)=>1<<Math.floor(e*r-1).toString(2).length;async function powerSpectralDensity(e,r,t){let{fftSize:a,_scaling:i}=Object.assign({fftSize:getFFTSize(r,k),_scaling:"psd"},t);if("psd"!=i&&"none"!=i)throw Error("Unknown scaling");let n="none"===i?1:2,s=g.signal.hannWindow(a),_=await (0,g.tidy)(()=>(0,g.div)((0,g.div)(1,(0,g.sum)((0,g.pow)(s,2))),r)).array(),u=t?.isDetrended?e:detrendSignal(e),p=g.signal.stft(u,a,Math.floor(a/2),a,g.signal.hannWindow),l=await p.array();p.dispose(),u.dispose(),s.dispose();let o=l.map(e=>{let t=[],s=[],u=0,p=0,l=r/a;for(var o=0;o<e.length-1;o+=2){let r=(0===o?0:o/2)*l;if(r>200)continue;let a=(o+2)/2*l,c=e[o]**2+e[o+1]**2;c*=_,"psd"==i&&o>0&&a<200&&(c*=n),c>u&&(u=c),c<p&&(p=c),t.push(c),s.push(r)}return{estimates:t,frequencies:s,powerRange:new x.NumberRange(p,u)}}),c=welch(o);return c}let welch=async e=>{if(0==e.length)throw Error("Unable to calculate any PSD estimates");let r=e[0].estimates.length,t=new Float64Array(r).fill(0);for(let a=0;a<e.length;a++)for(let i=0;i<r;i++)t[i]+=e[a].estimates[i];let a=0,i=0;for(let n=0;n<r;n++)t[n]=t[n]/e.length,t[n]>a&&(a=t[n]),t[n]<i&&(i=t[n]);return{estimates:t,frequencies:Float64Array.from(e[0].frequencies),powerRange:new x.NumberRange(i,a)}},sumPSDs=e=>{let r=e[0].estimates.length,t=new Float64Array(r).fill(0);for(let a=0;a<e.length;a++)for(let i=0;i<r;i++)t[i]+=e[a].estimates[i];let{minPower:a,maxPower:i}=e.reduce((e,r)=>(r.powerRange.min<e.minPower&&(e.minPower=r.powerRange.min),r.powerRange.max>e.maxPower&&(e.maxPower=r.powerRange.max),e),{minPower:0,maxPower:0});return{estimates:t,frequencies:Float64Array.from(e[0].frequencies),powerRange:new x.NumberRange(a,i)}};t(47989);var y=t(41060),v=t(253),P=t(72201);let bufferFifo=e=>(0,P.z)((0,s.R)((r,t)=>{let a=[...r,t].slice(-e);return a},[]),(0,_.h)(r=>r.length>=e));navigator.gpu?(0,g.setBackend)("webgl"):(0,g.setBackend)("webgpu");let runPSD=async(e,r=!1)=>{let t=new y.Z(e.length).div(new y.Z(e[e.length-1][0]).minus(e[0][0]).shiftedBy(-3)).decimalPlaces(0,y.Z.ROUND_FLOOR).toNumber(),a=(0,g.tidy)(()=>{let r=(0,g.tensor2d)(e.map(e=>[e[1],e[2],e[3]])),[t,a,i]=(0,g.split)(r,3,1),n=(0,g.reshape)(t,[t.shape[0]]),s=(0,g.reshape)(a,[a.shape[0]]),_=(0,g.reshape)(i,[i.shape[0]]);return{x:n,y:s,z:_}}),[i,n,s]=await Promise.all([powerSpectralDensity(a.x,t,{isDetrended:!0}),powerSpectralDensity(a.y,t,{isDetrended:!0}),powerSpectralDensity(a.z,t,{isDetrended:!0})]);return Object.values(a).forEach(e=>e.dispose()),{x:i,y:n,z:s,total:sumPSDs([i,n,s])}},O=new a.x,S=O.asObservable(),D=new a.x,R=D.asObservable(),createPSDProcessor=(e,r)=>{let t=!0;return R.pipe((0,i.x)(),(0,n.w)((t,a)=>{if(a)return e.pipe((0,s.R)((e,r)=>(e.push(r),e),[]),(0,_.h)(e=>e.length>3200),(0,u.U)(e=>({samples:e,onAccumulationComplete:a})));if(!a&&t.onAccumulationComplete){let e=t.onAccumulationComplete;runPSD(t.samples,!0).then(r=>{e(r)})}return r.pipe((0,p.w)(r=>e.pipe(bufferFifo(r))),(0,u.U)(e=>({samples:e,onAccumulationComplete:!1})))},{samples:[],onAccumulationComplete:!1}),(0,l.P)(()=>S,{leading:t,trailing:!0}),(0,o.b)(({samples:e,onAccumulationComplete:r})=>(t&&(t=!1),(0,c.x)((0,f.D)(runPSD(e).then(e=>(O.next({}),e))),w.z))))},A=null,z=new a.x,F=z.asObservable(),C=new a.x,j=C.asObservable().pipe((0,b.d)({bufferSize:1,refCount:!1}));(0,v.YX)(class{work(e){return e.pipe((0,m.z)(e=>{switch(e.command){case"accumulate":if(!this.isAccumulating&&!0===e.payload)return this.isAccumulating=!0,(0,d.T)((0,q.of)({type:"accumulation_started"}),(0,c.x)((0,f.D)(new Promise((e,r)=>{D.next(r=>{e(r)})})).pipe((0,u.U)(e=>({type:"accumulation_finished",psd:e}))),w.z));return this.isAccumulating=!1,D.next(!1),O.next({}),h.E;case"sampleInput":if(z.next(e.payload),null==A)return A=createPSDProcessor(F,j),D.next(!1),A.pipe((0,u.U)(e=>({type:"psd",psd:e})));return h.E;case"specSampleRateInput":return this.isAccumulating||D.next(!1),C.next(e.payload),h.E;default:return h.E}}))}selectTransferables(e){switch(e.type){case"psd":case"accumulation_finished":return[e.psd.x.estimates.buffer,e.psd.x.frequencies.buffer,e.psd.y.estimates.buffer,e.psd.y.frequencies.buffer,e.psd.z.estimates.buffer,e.psd.z.frequencies.buffer,e.psd.total.estimates.buffer,e.psd.total.frequencies.buffer];default:return[]}}constructor(){this.isAccumulating=!1}})}},r={};function __webpack_require__(t){var a=r[t];if(void 0!==a)return a.exports;var i=r[t]={exports:{}},n=!0;try{e[t].call(i.exports,i,i.exports,__webpack_require__),n=!1}finally{n&&delete r[t]}return i.exports}__webpack_require__.m=e,__webpack_require__.x=()=>{var e=__webpack_require__.O(void 0,[2696,4262,222,6693],()=>__webpack_require__(16432));return __webpack_require__.O(e)},(()=>{var e=[];__webpack_require__.O=(r,t,a,i)=>{if(t){i=i||0;for(var n=e.length;n>0&&e[n-1][2]>i;n--)e[n]=e[n-1];e[n]=[t,a,i];return}for(var s=1/0,n=0;n<e.length;n++){for(var[t,a,i]=e[n],_=!0,u=0;u<t.length;u++)s>=i&&Object.keys(__webpack_require__.O).every(e=>__webpack_require__.O[e](t[u]))?t.splice(u--,1):(_=!1,i<s&&(s=i));if(_){e.splice(n--,1);var p=a();void 0!==p&&(r=p)}}return r}})(),__webpack_require__.d=(e,r)=>{for(var t in r)__webpack_require__.o(r,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce((r,t)=>(__webpack_require__.f[t](e,r),r),[])),__webpack_require__.u=e=>""+e+".js",__webpack_require__.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e={4965:1};__webpack_require__.O.require=r=>e[r];var installChunk=r=>{var t=r.modules,a=r.ids,i=r.runtime;for(var n in t)__webpack_require__.o(t,n)&&(__webpack_require__.m[n]=t[n]);i&&i(__webpack_require__);for(var s=0;s<a.length;s++)e[a[s]]=1;__webpack_require__.O()};__webpack_require__.f.require=(r,t)=>{e[r]||installChunk(require("./"+__webpack_require__.u(r)))}})(),(()=>{var e=__webpack_require__.x;__webpack_require__.x=()=>(__webpack_require__.e(2696),__webpack_require__.e(4262),__webpack_require__.e(222),__webpack_require__.e(6693),e())})();var t=__webpack_require__.x();module.exports=t})();