{"version":3,"file":"static/chunks/3409-54bba2a96ca95988.js","mappings":"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","sources":["webpack://_N_E/ignored|/home/runner/work/RatOS-configurator/RatOS-configurator/src/node_modules/.pnpm/object-inspect@1.13.1/node_modules/object-inspect|./util.inspect","webpack://_N_E/./app/_helpers/logger.ts","webpack://_N_E/./components/common/spinner.tsx","webpack://_N_E/./helpers/logger.ts","webpack://_N_E/./helpers/trpc.ts","webpack://_N_E/./helpers/util.ts","webpack://_N_E/./moonraker/migrations.ts","webpack://_N_E/./moonraker/hooks.tsx","webpack://_N_E/./utils/trpc.ts","webpack://_N_E/./zods/util.tsx","webpack://_N_E/<anon>"],"sourcesContent":["/* (ignored) */","import pino from 'pino';\nimport { globalPinoOpts } from '@/helpers/logger';\nimport { trpcClient } from '@/helpers/trpc';\nimport { PinoLogEvent } from '@/zods/util';\nimport { prettyFactory, write } from 'pino-pretty-browser';\n\nconst send = async function (level: pino.Level, logEvent: pino.LogEvent) {\n\ttrpcClient.clientLog.mutate({ level, logEvent: PinoLogEvent.parse(logEvent) });\n};\n\nlet logger: pino.Logger | null = null;\nexport const getLogger = () => {\n\tif (logger != null) {\n\t\treturn logger;\n\t}\n\tlogger = pino({\n\t\t...globalPinoOpts,\n\t\tbrowser: {\n\t\t\ttransmit: {\n\t\t\t\tsend,\n\t\t\t},\n\t\t},\n\t});\n\treturn logger;\n};\n","import { twMerge } from 'tailwind-merge';\n\nexport const Spinner: React.FC<{ className?: string; noMargin?: boolean; strokeWidth?: number }> = (props) => {\n\treturn (\n\t\t<svg\n\t\t\tclassName={twMerge(\n\t\t\t\t'h-5 w-5 animate-spin text-black/50 dark:text-white/50',\n\t\t\t\t!props.noMargin ? '-ml-1 mr-3' : '',\n\t\t\t\tprops.className,\n\t\t\t)}\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\tfill=\"none\"\n\t\t\tviewBox=\"0 0 24 24\"\n\t\t>\n\t\t\t<circle\n\t\t\t\tclassName=\"opacity-20\"\n\t\t\t\tcx=\"12\"\n\t\t\t\tcy=\"12\"\n\t\t\t\tr=\"10\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tstrokeWidth={props.strokeWidth ?? 4}\n\t\t\t></circle>\n\t\t\t<circle\n\t\t\t\tclassName=\"opacity-100\"\n\t\t\t\tcx=\"12\"\n\t\t\t\tcy=\"12\"\n\t\t\t\tr=\"10\"\n\t\t\t\tstrokeDasharray={(Math.PI * 10) / 3}\n\t\t\t\tstrokeLinecap=\"round\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tstrokeWidth={props.strokeWidth ?? 4}\n\t\t\t></circle>\n\t\t</svg>\n\t);\n};\n","import { LoggerOptions } from 'pino';\n\nexport const globalPinoOpts: LoggerOptions = {\n\ttimestamp: true,\n\tlevel: process.env.NODE_ENV === 'development' ? 'debug' : 'info',\n};\n","import { proxyClient, trpc } from '@/utils/trpc';\nexport { trpc, proxyClient as trpcClient };\n","'use client';\nexport const getHost = () => {\n\treturn process.env.NEXT_PUBLIC_KLIPPER_HOSTNAME != null && process.env.NEXT_PUBLIC_KLIPPER_HOSTNAME.trim() != ''\n\t\t? process.env.NEXT_PUBLIC_KLIPPER_HOSTNAME\n\t\t: typeof window !== 'undefined' && window.location?.hostname != null\n\t\t\t? window.location.hostname\n\t\t\t: null;\n};\n","/* eslint-disable no-console */\nimport { getHost } from '@/helpers/util';\nimport { MoonrakerDBItemResponse } from '@/moonraker/types';\n\ninterface Migration {\n\tversion: number;\n\tdescription: string;\n\tup: () => Promise<{ result: string }>;\n\tdown: () => Promise<{ result: string }>;\n}\n\nexport const migrations: Migration[] = [\n\t{\n\t\tversion: 1,\n\t\tdescription: \"Undo double JSON encoding of RatOS's data\",\n\t\tup: async () => {\n\t\t\tconst res = await window.fetch(`http://${getHost()}/server/database/item?namespace=RatOS`);\n\t\t\tif (res.ok) {\n\t\t\t\tconst data = (await res.json()) as\n\t\t\t\t\t| { result: MoonrakerDBItemResponse<{ [key: string]: unknown }> }\n\t\t\t\t\t| { error: { message: string } };\n\t\t\t\tif ('error' in data) {\n\t\t\t\t\tthrow new Error(data.error.message);\n\t\t\t\t}\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tif (data.result.value == null) {\n\t\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t\t}\n\t\t\t\tfor await (const [key, value] of Object.entries(data.result.value)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst parsed = JSON.parse(value as any);\n\t\t\t\t\t\tconsole.log('Migrating', key, 'from', value, 'to', parsed);\n\t\t\t\t\t\tawait window.fetch(`http://${getHost()}/server/database/item`, {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\tnamespace: 'RatOS',\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\tvalue: parsed,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Error migrating', key, value, 'clearing key');\n\t\t\t\t\t\tawait window.fetch(\n\t\t\t\t\t\t\t`http://${getHost()}/server/database/item?namespace=RatOS&key=${encodeURIComponent(key)}`,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmethod: 'DELETE',\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\t\tnamespace: 'RatOS',\n\t\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn { result: `Succesfully decoded ${result.length} keys.\\n${result.join('\\n')}` };\n\t\t\t} else {\n\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t}\n\t\t},\n\t\tdown: async () => {\n\t\t\t// drop table\n\t\t\tconst res = await window.fetch(`http://${getHost()}/server/database/item?namespace=RatOS`);\n\t\t\tif (res.ok) {\n\t\t\t\tconst data = (await res.json()) as\n\t\t\t\t\t| { result: MoonrakerDBItemResponse<{ [key: string]: unknown }> }\n\t\t\t\t\t| { error: { message: string } };\n\t\t\t\tif ('error' in data) {\n\t\t\t\t\tthrow new Error(data.error.message);\n\t\t\t\t}\n\t\t\t\tif (data.result.value == null) {\n\t\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t\t}\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tfor await (const [key, value] of Object.entries(data.result.value)) {\n\t\t\t\t\tconst encoded = JSON.stringify(value as any);\n\t\t\t\t\tawait window.fetch(`http://${getHost()}/server/database/item`, {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\tnamespace: 'RatOS',\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tvalue: encoded,\n\t\t\t\t\t\t}),\n\t\t\t\t\t});\n\t\t\t\t\tresult.push(`Re-encoded ${key}`);\n\t\t\t\t}\n\t\t\t\treturn { result: `Succesfully re-encoded ${result.length} keys.\\n${result.join('\\n')}` };\n\t\t\t}\n\t\t\treturn { result: 'Nothing to migrate' };\n\t\t},\n\t},\n\t{\n\t\tversion: 2,\n\t\tdescription: 'Change caramba printers to v-core-4 / v-chonk',\n\t\tup: async () => {\n\t\t\tconst res = await window.fetch(`http://${getHost()}/server/database/item?namespace=RatOS`);\n\t\t\tif (res.ok) {\n\t\t\t\tconst data = (await res.json()) as\n\t\t\t\t\t| { result: MoonrakerDBItemResponse<{ [key: string]: unknown }> }\n\t\t\t\t\t| { error: { message: string } };\n\t\t\t\tif ('error' in data) {\n\t\t\t\t\tthrow new Error(data.error.message);\n\t\t\t\t}\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tif (data.result.value == null) {\n\t\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t\t}\n\t\t\t\tfor await (const [key, value] of Object.entries(data.result.value)) {\n\t\t\t\t\tif (key === 'Printer' && typeof value === 'string') {\n\t\t\t\t\t\tconst migratedValue = value.replace(/caramba-chonk/g, 'v-chonk').replace(/caramba/g, 'v-core-4');\n\t\t\t\t\t\tif (migratedValue === value) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tawait window.fetch(`http://${getHost()}/server/database/item`, {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\tnamespace: 'RatOS',\n\t\t\t\t\t\t\t\tkey: 'Printer',\n\t\t\t\t\t\t\t\tvalue: migratedValue,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresult.push(`Migrated ${value} to ${migratedValue}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn { result: `Succesfully migrated ${result.length} keys.\\n${result.join('\\n')}` };\n\t\t\t} else {\n\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t}\n\t\t},\n\t\tdown: async () => {\n\t\t\tconst res = await window.fetch(`http://${getHost()}/server/database/item?namespace=RatOS`);\n\t\t\tif (res.ok) {\n\t\t\t\tconst data = (await res.json()) as\n\t\t\t\t\t| { result: MoonrakerDBItemResponse<{ [key: string]: unknown }> }\n\t\t\t\t\t| { error: { message: string } };\n\t\t\t\tif ('error' in data) {\n\t\t\t\t\tthrow new Error(data.error.message);\n\t\t\t\t}\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tif (data.result.value == null) {\n\t\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t\t}\n\t\t\t\tfor await (const [key, value] of Object.entries(data.result.value)) {\n\t\t\t\t\tif (key === 'Printer' && typeof value === 'string') {\n\t\t\t\t\t\tconst migratedValue = value.replace(/v-chonk/g, 'caramba-chonk').replace(/v-core-4/g, 'caramba');\n\t\t\t\t\t\tif (migratedValue === value) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tawait window.fetch(`http://${getHost()}/server/database/item`, {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\tnamespace: 'RatOS',\n\t\t\t\t\t\t\t\tkey: 'Printer',\n\t\t\t\t\t\t\t\tvalue: migratedValue,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresult.push(`Migrated ${value} to ${migratedValue}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn { result: `Succesfully migrated ${result.length} keys.\\n${result.join('\\n')}` };\n\t\t\t} else {\n\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t}\n\t\t},\n\t},\n];\n\nexport const getCurrentVersion = async (): Promise<number> => {\n\tconst res = await window.fetch(`http://${getHost()}/server/database/item?namespace=RatOS&key=__db_version`);\n\tif (res.ok) {\n\t\tconst data = (await res.json()) as { result: MoonrakerDBItemResponse<number> } | { error: { message: string } };\n\t\tif ('error' in data) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn data.result.value as number;\n\t}\n\treturn 0;\n};\n\nexport const setCurrentVersion = async (version: number) => {\n\tawait window.fetch(`http://${getHost()}/server/database/item`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\tnamespace: 'RatOS',\n\t\t\tkey: '__db_version',\n\t\t\tvalue: version,\n\t\t}),\n\t});\n};\n\nlet isMigrating = false;\nexport const migrate = async (from: number, to: number) => {\n\tif (isMigrating) {\n\t\treturn console.log('Already migrating, ignoring..');\n\t}\n\tif (from === to) {\n\t\treturn console.log('Already at target version');\n\t}\n\tisMigrating = true;\n\ttry {\n\t\tconst migrationsToRun = migrations\n\t\t\t.filter((m) => m.version > from && m.version <= to)\n\t\t\t.sort((a, b) => (from <= to ? a.version - b.version : b.version - a.version));\n\t\tfor await (const migration of migrationsToRun) {\n\t\t\tconst result = await (from < to ? migration.up() : migration.down());\n\t\t\tconsole.log(`Migrated to version ${migration.version}: ${result.result}`);\n\t\t}\n\t\tawait setCurrentVersion(to);\n\t} finally {\n\t\tisMigrating = false;\n\t}\n};\n\nlet isMigrated = false;\nexport const migrateToLatest = async () => {\n\tif (isMigrated) {\n\t\treturn console.log('Already migrated, ignoring..');\n\t}\n\tconst currentVersion = await getCurrentVersion();\n\tconst latestVersion = Math.max(...migrations.map((m) => m.version));\n\tif (currentVersion === latestVersion) {\n\t\tconsole.log('Already at latest version');\n\t\treturn;\n\t}\n\tif (isMigrating) {\n\t\tconsole.log('Already migrating, ignoring..');\n\t\treturn;\n\t}\n\tconsole.log('Migrating to latest version...', currentVersion, latestVersion);\n\tawait migrate(currentVersion, latestVersion);\n\tisMigrated = true;\n\tconsole.log('Migration complete.');\n};\n","'use client';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { UseMutationOptions, UseQueryOptions, useMutation, useQuery } from '@tanstack/react-query';\nimport useWebSocket from 'react-use-websocket';\nimport { migrateToLatest } from '@/moonraker/migrations';\nimport type {\n\tInFlightRequestCallbacks,\n\tInFlightRequestTimeouts,\n\tJSONRPCResponse,\n\tMoonrakerStatus,\n\tMoonrakerSaveItemFn,\n\tMoonrakerNamespaces,\n\tMoonrakerDBItemResponse,\n\tMoonrakerGetItemFn,\n\tMoonrakerNamespaceKeys,\n\tMoonrakerDBValue,\n\tMoonrakerQueryFn,\n\tMoonrakerQueryKeys,\n\tMoonrakerQueryParams,\n\tMoonrakerQueryResult,\n\tMoonrakerMutationKeys,\n\tMoonrakerMutationParams,\n\tMoonrakerMutationResult,\n\tMoonrakerMutationFn,\n\tPrinterObjectKeys,\n\tPrinterObjectsMoonrakerQueryParams,\n\tPrinterObjectResult,\n\tJSONRPCResponseSuccess,\n} from '@/moonraker/types';\nimport { getHost } from '@/helpers/util';\nimport { merge } from 'ts-deepmerge';\nimport deepEqual from 'deep-equal';\nimport { getLogger } from '@/app/_helpers/logger';\n\nlet REQ_ID = 0;\n\nconst getWsURL = () => {\n\tconst host = getHost();\n\tif (host == null || host.trim() == '') {\n\t\treturn null;\n\t}\n\treturn `ws://${host}/websocket`;\n};\n\nconst subscriptions: { [key: number]: Partial<PrinterObjectsMoonrakerQueryParams> } = {};\n\ntype MoonrakerStatusUpdate = { [key in PrinterObjectKeys]: PrinterObjectResult<PrinterObjectKeys> };\n\ninterface MoonrakerHookOptions {\n\tonStatusUpdate?: (status: MoonrakerStatusUpdate) => void;\n\tpassThroughUpdateMethods?: string[];\n}\n\nexport const useMoonraker = (options?: MoonrakerHookOptions) => {\n\tconst inFlightRequests = useRef<InFlightRequestCallbacks>({});\n\tconst inFlightRequestTimeouts = useRef<InFlightRequestTimeouts>({});\n\tconst localSubscriptions = useRef<number[]>([]);\n\tconst onReadyCallbacks = useRef<{ resolve: () => void; reject: () => void }[]>([]);\n\tconst [wsUrl, setWsUrl] = useState(getWsURL());\n\tuseEffect(() => {\n\t\tsetWsUrl(getWsURL());\n\t}, []);\n\n\tconst containsSubscriptionUpdate = useCallback(\n\t\t(jsonMessage: JSONRPCResponse): jsonMessage is JSONRPCResponseSuccess => {\n\t\t\tif ('error' in jsonMessage) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (jsonMessage.method === 'notify_status_update' && jsonMessage.params != null) {\n\t\t\t\tconst res = jsonMessage.params[0] as MoonrakerStatusUpdate;\n\t\t\t\tif (res != null) {\n\t\t\t\t\tfor (const sub of localSubscriptions.current) {\n\t\t\t\t\t\tconst objects = subscriptions[sub];\n\t\t\t\t\t\tif (objects != null) {\n\t\t\t\t\t\t\tfor (const key in objects) {\n\t\t\t\t\t\t\t\tif (res[key as PrinterObjectKeys] != null) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t[],\n\t);\n\n\tconst { lastJsonMessage, sendJsonMessage, readyState } = useWebSocket<JSONRPCResponse>(wsUrl, {\n\t\tfilter: (message) => {\n\t\t\tif (moonrakerStatus !== 'connected') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst parsed = JSON.parse(message.data) as JSONRPCResponse;\n\t\t\t\tif (inFlightRequests.current[parsed.id] != null) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\toptions?.passThroughUpdateMethods?.length &&\n\t\t\t\t\t'method' in parsed &&\n\t\t\t\t\toptions.passThroughUpdateMethods.includes(parsed.method)\n\t\t\t\t) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t} catch (e) {\n\t\t\t\tgetLogger().warn({ e, messageData: message.data }, 'Filter: Failed to parse message');\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tonMessage: (message) => {\n\t\t\tif (options?.onStatusUpdate) {\n\t\t\t\ttry {\n\t\t\t\t\tconst parsed = JSON.parse(message.data) as JSONRPCResponse;\n\t\t\t\t\tif (containsSubscriptionUpdate(parsed)) {\n\t\t\t\t\t\tconst res = parsed.params[0] as MoonrakerStatusUpdate;\n\t\t\t\t\t\toptions.onStatusUpdate?.(res);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tgetLogger().warn({ e, messageData: message.data }, 'OnMessage: Failed to parse message');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tshouldReconnect: (closeEvent) => {\n\t\t\treturn true;\n\t\t},\n\t\treconnectAttempts: Infinity,\n\t\treconnectInterval: 3000,\n\t\tshare: true,\n\t});\n\tconst readyStateRef = useRef(readyState);\n\treadyStateRef.current = readyState;\n\tconst [moonrakerStatus, setMoonrakerStatus] = useState<null | MoonrakerStatus>(\n\t\treadyState === 1 ? 'connected' : 'connecting',\n\t);\n\n\tconst whenReady = useCallback((resolve: () => void, reject: () => void) => {\n\t\tif (readyStateRef.current === 1) {\n\t\t\tresolve();\n\t\t} else {\n\t\t\tonReadyCallbacks.current.push({ resolve, reject });\n\t\t}\n\t}, []);\n\n\tconst isReady = useCallback(\n\t\t() =>\n\t\t\tnew Promise<void>((resolve, reject) => {\n\t\t\t\twhenReady(resolve, reject);\n\t\t\t}),\n\t\t[whenReady],\n\t);\n\tconst moonrakerQuery: MoonrakerQueryFn & MoonrakerMutationFn = useCallback(\n\t\tasync <Response = any,>(method: string, params: any = {}) => {\n\t\t\tconst id = ++REQ_ID;\n\t\t\tawait isReady();\n\t\t\treturn new Promise<Response>((resolve, reject) => {\n\t\t\t\tinFlightRequests.current[id] = (err, result) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn reject(err);\n\t\t\t\t\t}\n\t\t\t\t\tif (result && typeof result === 'object' && 'error' in result && result.error) {\n\t\t\t\t\t\treturn reject(result.error);\n\t\t\t\t\t}\n\t\t\t\t\tif (result == null) {\n\t\t\t\t\t\treturn reject(new Error('No result. Unknown response format.'));\n\t\t\t\t\t}\n\t\t\t\t\tresolve(result as Response);\n\t\t\t\t};\n\t\t\t\tlet timeout = 10 * 1000;\n\t\t\t\tif (method === 'printer.gcode.script') {\n\t\t\t\t\t// Allow 10 minutes for gcode macros.\n\t\t\t\t\ttimeout = 10 * 60 * 1000;\n\t\t\t\t}\n\t\t\t\tinFlightRequestTimeouts.current[id] = window.setTimeout(() => {\n\t\t\t\t\tinFlightRequests.current[id]?.(new Error('Request timed out'), null);\n\t\t\t\t\tdelete inFlightRequests.current[id];\n\t\t\t\t\tdelete inFlightRequestTimeouts.current[id];\n\t\t\t\t}, timeout); // 10 second timeout.\n\t\t\t\tsendJsonMessage({\n\t\t\t\t\tjsonrpc: '2.0',\n\t\t\t\t\tmethod,\n\t\t\t\t\tparams,\n\t\t\t\t\tid: id,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t[isReady, sendJsonMessage],\n\t);\n\n\tconst subscribeToObject = useCallback(\n\t\tasync <TArgs extends [PrinterObjectKeys, ...PrinterObjectKeys[]]>(...args: TArgs) => {\n\t\t\tconst objects = Object.fromEntries(args.map((key) => [key, null])) as PrinterObjectsMoonrakerQueryParams;\n\t\t\tconst allSubscribedObjects = Object.assign(\n\t\t\t\t{},\n\t\t\t\tobjects,\n\t\t\t\t...Object.values(subscriptions).filter((v) => v != null),\n\t\t\t) as PrinterObjectsMoonrakerQueryParams;\n\t\t\tconst q = moonrakerQuery('printer.objects.subscribe' as 'printer.objects.query', {\n\t\t\t\tobjects: allSubscribedObjects,\n\t\t\t});\n\t\t\t// Capture request id we just generated;\n\t\t\tconst reqId = REQ_ID;\n\t\t\tsubscriptions[reqId] = objects;\n\t\t\tlocalSubscriptions.current.push(reqId);\n\n\t\t\tconst res = (await q).status as {\n\t\t\t\t[K in TArgs[number]]: PrinterObjectResult<K>;\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tres,\n\t\t\t\tunsuscribe: async () => {\n\t\t\t\t\tlocalSubscriptions.current = localSubscriptions.current.filter((v) => v !== reqId);\n\t\t\t\t\tif (subscriptions[reqId] == null) {\n\t\t\t\t\t\tdelete subscriptions[reqId];\n\t\t\t\t\t\tconst allSubscribedObjects = Object.assign(\n\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t...Object.values(subscriptions).filter((v) => v != null),\n\t\t\t\t\t\t) as PrinterObjectsMoonrakerQueryParams;\n\t\t\t\t\t\tawait moonrakerQuery('printer.objects.subscribe' as 'printer.objects.query', {\n\t\t\t\t\t\t\tobjects: allSubscribedObjects,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\t[moonrakerQuery],\n\t);\n\n\tconst saveItem = useCallback<MoonrakerSaveItemFn>(\n\t\tasync <Data,>(namespace: MoonrakerNamespaces, key: unknown, value: unknown) => {\n\t\t\tawait isReady();\n\t\t\treturn (await moonrakerQuery('server.database.post_item', {\n\t\t\t\tnamespace: namespace,\n\t\t\t\tkey,\n\t\t\t\tvalue: value,\n\t\t\t})) as Data;\n\t\t},\n\t\t[moonrakerQuery, isReady],\n\t);\n\n\tconst getItem = useCallback<MoonrakerGetItemFn>(\n\t\tasync <Data,>(namespace: MoonrakerNamespaces, key: unknown): Promise<Data | null> => {\n\t\t\tawait isReady();\n\t\t\ttry {\n\t\t\t\tconst result = await moonrakerQuery('server.database.get_item', {\n\t\t\t\t\tnamespace: namespace,\n\t\t\t\t\tkey,\n\t\t\t\t});\n\t\t\t\treturn (result?.value ?? null) as Data;\n\t\t\t} catch (e) {\n\t\t\t\tgetLogger().warn(e);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\t[moonrakerQuery, isReady],\n\t);\n\n\tuseEffect(() => {\n\t\tif (readyState === 1) {\n\t\t\t(async () => {\n\t\t\t\tawait migrateToLatest();\n\t\t\t\tonReadyCallbacks.current.forEach((cb) => cb.resolve());\n\t\t\t\tonReadyCallbacks.current = [];\n\t\t\t\tsetMoonrakerStatus('connected');\n\t\t\t})();\n\t\t} else {\n\t\t\tsetMoonrakerStatus('connecting');\n\t\t}\n\t}, [readyState]);\n\n\tuseEffect(() => {\n\t\tif (lastJsonMessage?.id && inFlightRequests.current[lastJsonMessage.id]) {\n\t\t\twindow.clearTimeout(inFlightRequestTimeouts.current[lastJsonMessage.id]);\n\t\t\tif ('error' in lastJsonMessage) {\n\t\t\t\tinFlightRequests.current[lastJsonMessage.id](new Error(lastJsonMessage.error.message), null);\n\t\t\t} else {\n\t\t\t\tinFlightRequests.current[lastJsonMessage.id](null, lastJsonMessage.result);\n\t\t\t}\n\t\t\tdelete inFlightRequestTimeouts.current[lastJsonMessage.id];\n\t\t\tdelete inFlightRequests.current[lastJsonMessage.id];\n\t\t}\n\t}, [lastJsonMessage]);\n\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tfor (const reqId in inFlightRequestTimeouts.current) {\n\t\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t\t\tdelete inFlightRequestTimeouts.current[reqId];\n\t\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t\t\tdelete inFlightRequests.current[reqId];\n\t\t\t}\n\t\t\tif (localSubscriptions.current.length > 0) {\n\t\t\t\tlocalSubscriptions.current.forEach((sub) => {\n\t\t\t\t\tdelete subscriptions[sub];\n\t\t\t\t});\n\t\t\t\tlocalSubscriptions.current = [];\n\t\t\t\tconst allSubscribedObjects = Object.assign(\n\t\t\t\t\t{},\n\t\t\t\t\t...Object.values(subscriptions).filter((v) => v != null),\n\t\t\t\t) as PrinterObjectsMoonrakerQueryParams;\n\t\t\t\tmoonrakerQuery('printer.objects.subscribe' as 'printer.objects.query', {\n\t\t\t\t\tobjects: Object.keys(allSubscribedObjects).length > 0 ? allSubscribedObjects : null,\n\t\t\t\t}).catch((e) => {\n\t\t\t\t\t// ignore\n\t\t\t\t});\n\t\t\t}\n\t\t\tonReadyCallbacks.current.forEach((cb) => cb.reject());\n\t\t\tonReadyCallbacks.current = [];\n\t\t};\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, []);\n\n\treturn {\n\t\tquery: moonrakerQuery,\n\t\tsaveItem,\n\t\tgetItem,\n\t\tsubscribeToObject,\n\t\tstatus: moonrakerStatus,\n\t\tlastMessage: lastJsonMessage,\n\t\tisReady: readyState === 1,\n\t};\n};\n\nexport const useNamespacedItemQuery = <\n\tN extends MoonrakerNamespaces,\n\tK extends MoonrakerNamespaceKeys<N>,\n\tV extends MoonrakerDBValue<N, K>,\n>(\n\tnamespace: N,\n\tkey: K,\n\toptions?: Omit<UseQueryOptions<V, unknown, V, N[]>, 'queryKey' | 'queryFn'>,\n) => {\n\tconst { getItem } = useMoonraker();\n\treturn useQuery({\n\t\t...options,\n\t\tqueryKey: [namespace, key],\n\t\tqueryFn: async () => {\n\t\t\treturn getItem(namespace, key) as Promise<V>;\n\t\t},\n\t});\n};\n\nexport const useMoonrakerQuery = <\n\tK extends MoonrakerQueryKeys = MoonrakerQueryKeys,\n\tP extends MoonrakerQueryParams<K> = MoonrakerQueryParams<K>,\n\tO extends Omit<\n\t\tUseQueryOptions<MoonrakerQueryResult<K>, unknown, MoonrakerQueryResult<K>, K[]>,\n\t\t'queryKey' | 'queryFn'\n\t> = Omit<UseQueryOptions<MoonrakerQueryResult<K>, unknown, MoonrakerQueryResult<K>, K[]>, 'queryKey' | 'queryFn'>,\n>(\n\t...args: P extends void ? [K, O?] : [K, P, O?]\n) => {\n\tconst { query } = useMoonraker();\n\tconst options = args.length === 3 ? (args[2] as O) : (args[1] as O);\n\tconst params = args.length === 3 ? args[1] : undefined;\n\tconst key = args[0];\n\tconst passed = (args.length === 3 ? [key, params] : [key]) as P extends void ? [K] : [K, P];\n\treturn useQuery({\n\t\t...(options ?? {}),\n\t\tqueryKey: [args[0]],\n\t\tqueryFn: async () => {\n\t\t\treturn query(...passed) as Promise<MoonrakerQueryResult<K>>;\n\t\t},\n\t});\n};\n\nexport const useMoonrakerMutation = <\n\tK extends MoonrakerMutationKeys = MoonrakerMutationKeys,\n\tP extends MoonrakerMutationParams<K> = MoonrakerMutationParams<K>,\n\tO extends Omit<UseMutationOptions<MoonrakerMutationResult<K>, unknown, P, K[]>, 'mutationKey' | 'mutationFn'> = Omit<\n\t\tUseMutationOptions<MoonrakerMutationResult<K>, unknown, P, K[]>,\n\t\t'mutationKey' | 'mutationFn'\n\t>,\n>(\n\t...args: [K, O?]\n) => {\n\tconst { query } = useMoonraker();\n\tconst options = args[1];\n\tconst key = args[0];\n\treturn useMutation({\n\t\t...options,\n\t\tmutationKey: [args[0]],\n\t\tmutationFn: async (params: P) => {\n\t\t\tconst passed = (params ? [key, params] : [key]) as P extends void ? [K] : [K, P];\n\t\t\treturn query(...passed) as Promise<MoonrakerMutationResult<K>>;\n\t\t},\n\t});\n};\n\nexport const usePrinterObjectQuery = <TArgs extends [PrinterObjectKeys, ...PrinterObjectKeys[]]>(...args: TArgs) => {\n\tconst { query } = useMoonraker();\n\treturn useQuery({\n\t\tqueryKey: args,\n\t\tqueryFn: async () => {\n\t\t\tconst objects = Object.fromEntries(args.map((key) => [key, null])) as PrinterObjectsMoonrakerQueryParams;\n\t\t\treturn (await query('printer.objects.query', { objects })).status as {\n\t\t\t\t[K in TArgs[number]]: PrinterObjectResult<K>;\n\t\t\t};\n\t\t},\n\t});\n};\n\nexport const usePrinterObjectSubscription = <\n\tTArgs extends [PrinterObjectKeys, ...PrinterObjectKeys[]],\n\tR extends object = { [K in TArgs[number]]: PrinterObjectResult<K> },\n>(\n\tselect: null | ((res: { [K in TArgs[number]]: PrinterObjectResult<K> }) => R),\n\t...args: TArgs\n) => {\n\tconst [state, setState] = useState<R | null>(null);\n\tconst stateRef = useRef(state);\n\tstateRef.current = state;\n\tconst selectRef = useRef(select);\n\tselectRef.current = select;\n\n\tconst _select = useCallback((res: { [K in TArgs[number]]: PrinterObjectResult<K> }) => {\n\t\tif (selectRef.current == null) {\n\t\t\treturn res as R;\n\t\t}\n\t\treturn selectRef.current?.(res);\n\t}, []);\n\n\tconst keys = useMemo(\n\t\t() => Object.fromEntries(args.map((key) => [key, null])) as PrinterObjectsMoonrakerQueryParams,\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t[JSON.stringify(args.sort())],\n\t);\n\n\tconst { subscribeToObject } = useMoonraker({\n\t\tonStatusUpdate: useCallback(\n\t\t\t(res: MoonrakerStatusUpdate) => {\n\t\t\t\tconst changed = {} as typeof res;\n\t\t\t\tfor (const key in keys) {\n\t\t\t\t\tif (res[key as keyof typeof res] != null) {\n\t\t\t\t\t\tchanged[key as keyof typeof res] = res[key as keyof typeof res];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst changeSelection = _select(changed);\n\t\t\t\tif (changeSelection == null || typeof changeSelection !== 'object') {\n\t\t\t\t\tthrow new Error('Invalid selection function, must return object, got ' + typeof changeSelection);\n\t\t\t\t}\n\t\t\t\tif (Object.keys(changed).length > 0 && deepEqual(changeSelection, stateRef.current) === false) {\n\t\t\t\t\tsetState((prev) => {\n\t\t\t\t\t\treturn merge(prev ?? {}, changeSelection) as R;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t[_select, keys],\n\t\t),\n\t});\n\n\tuseEffect(() => {\n\t\tconst subscription = subscribeToObject(...(Object.keys(keys) as TArgs));\n\t\tsubscription\n\t\t\t.then((sub) => {\n\t\t\t\tsetState(_select(sub.res));\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\tgetLogger().error(e);\n\t\t\t\t}\n\t\t\t});\n\t\treturn () => {\n\t\t\tsubscription\n\t\t\t\t.then((sub) => sub.unsuscribe())\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\t\tgetLogger().error(e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\t}, [_select, keys, subscribeToObject]);\n\n\treturn state;\n};\n\nexport const useNamespacedItemMutation = <\n\tN extends MoonrakerNamespaces,\n\tK extends MoonrakerNamespaceKeys<N>,\n\tV extends MoonrakerDBValue<N, K>,\n>(\n\tnamespace: N,\n\tkey: K,\n\toptions?: Omit<UseMutationOptions<MoonrakerDBItemResponse<V>, unknown, V>, 'mutationKey' | 'mutationFn'>,\n) => {\n\tconst { saveItem } = useMoonraker();\n\treturn useMutation<MoonrakerDBItemResponse<V>, unknown, V>({\n\t\t...options,\n\t\tmutationKey: [namespace, key],\n\t\tmutationFn: (value: V) => saveItem(namespace, key, value) as Promise<MoonrakerDBItemResponse<V>>,\n\t});\n};\n\nexport const useMoonrakerState = <\n\tN extends MoonrakerNamespaces,\n\tK extends MoonrakerNamespaceKeys<N>,\n\tV extends MoonrakerDBValue<N, K>,\n\tVal extends NonNullable<V> | null,\n>(\n\tnamespace: N,\n\tkey: K,\n\tinitialValue: Val = null as Val,\n) => {\n\tconst query = useNamespacedItemQuery(namespace, key, { initialData: initialValue });\n\tconst mutation = useNamespacedItemMutation<N, K, V>(namespace, key);\n\tconst mutate = useCallback(\n\t\tasync (value: V | ((prev: NonNullable<V> | Val) => NonNullable<V> | Val)) => {\n\t\t\tconst newValue =\n\t\t\t\ttypeof value === 'function' ? (value as (prev: NonNullable<V> | Val) => V)(query.data ?? initialValue) : value;\n\t\t\tawait mutation.mutateAsync(newValue, {\n\t\t\t\tonSuccess: () => {\n\t\t\t\t\t// Todo, implement optimistic updates\n\t\t\t\t\tquery.refetch();\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t[initialValue, mutation, query],\n\t);\n\treturn [query.data ?? initialValue, mutate, query, mutation] as const;\n};\n","'use client';\nimport { createTRPCProxyClient, httpBatchLink } from '@trpc/client';\nimport { createTRPCNext } from '@trpc/next';\nimport type { AppRouter } from '@/server/routers/index';\nexport type {\n\tPrinterRouterLike,\n\tDropdownQuery,\n\tDropdownQueryKeys,\n\tDropdownQueryInput,\n\tDropdownQueryOutput,\n} from '@/server/routers/printer';\n\nexport function getBaseUrl() {\n\tif (typeof window !== 'undefined')\n\t\t// browser should use relative path\n\t\treturn '/configure';\n\tif (process.env.RENDER_INTERNAL_HOSTNAME)\n\t\t// reference for render.com\n\t\treturn `http://${process.env.RENDER_INTERNAL_HOSTNAME}:${process.env.PORT}/configure`;\n\t// assume localhost\n\treturn `http://127.0.0.1:${process.env.PORT ?? 3000}/configure`;\n}\nexport const trpc = createTRPCNext<AppRouter>({\n\tconfig() {\n\t\treturn {\n\t\t\tlinks: [\n\t\t\t\thttpBatchLink({\n\t\t\t\t\t/**\n\t\t\t\t\t * @link https://trpc.io/docs/ssr\n\t\t\t\t\t **/\n\t\t\t\t\turl: `${getBaseUrl()}/api/trpc`,\n\t\t\t\t\tmaxURLLength: 2083, // a suitable size\n\t\t\t\t}),\n\t\t\t],\n\t\t};\n\t},\n\toverrides: {\n\t\tuseMutation: {\n\t\t\t/**\n\t\t\t * This function is called whenever a `.useMutation` succeeds\n\t\t\t **/\n\t\t\tasync onSuccess(opts) {\n\t\t\t\t/**\n\t\t\t\t * @note that order here matters:\n\t\t\t\t * The order here allows route changes in `onSuccess` without\n\t\t\t\t * having a flash of content change whilst redirecting.\n\t\t\t\t **/\n\t\t\t\t// Calls the `onSuccess` defined in the `useQuery()`-options:\n\t\t\t\tawait opts.originalFn();\n\t\t\t\t// Invalidate all queries in the react-query cache:\n\t\t\t\tawait opts.queryClient.invalidateQueries();\n\t\t\t},\n\t\t},\n\t},\n\t/**\n\t * @link https://trpc.io/docs/ssr\n\t **/\n\tssr: false,\n});\nexport const proxyClient = createTRPCProxyClient<AppRouter>({\n\tlinks: [\n\t\thttpBatchLink({\n\t\t\t/**\n\t\t\t * @link https://trpc.io/docs/ssr\n\t\t\t **/\n\t\t\turl: `${getBaseUrl()}/api/trpc`,\n\t\t\tmaxURLLength: 2083, // a suitable size\n\t\t}),\n\t],\n});\n","import { z } from 'zod';\n\nexport const PinoLogLevel = z.enum(['trace', 'debug', 'info', 'warn', 'error', 'fatal']);\n\nexport const PinoLogEvent = z.object({\n\tts: z.number(),\n\tmessages: z.array(z.any()),\n\tbindings: z.array(z.record(z.string(), z.any())),\n\tlevel: z.object({\n\t\tlabel: PinoLogLevel,\n\t\tvalue: z.number(),\n\t}),\n});\n"],"names":["send","level","logEvent","trpcClient","clientLog","mutate","PinoLogEvent","parse","logger","getLogger","pino","globalPinoOpts","browser","transmit","Spinner","props","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsxs","svg","className","twMerge","noMargin","xmlns","fill","viewBox","jsx","circle","cx","cy","r","stroke","strokeWidth","strokeDasharray","Math","PI","strokeLinecap","timestamp","getHost","window","process","trim","location","hostname","migrations","version","description","up","res","fetch","concat","ok","result","data","json","error","message","value","key","Object","entries","parsed","JSON","console","log","method","headers","body","stringify","namespace","e","encodeURIComponent","length","join","down","encoded","push","migratedValue","replace","getCurrentVersion","setCurrentVersion","isMigrating","migrate","from","to","migrationsToRun","filter","m","sort","a","b","migration","isMigrated","migrateToLatest","currentVersion","latestVersion","max","map","REQ_ID","getWsURL","host","subscriptions","useMoonraker","inFlightRequests","useRef","inFlightRequestTimeouts","localSubscriptions","onReadyCallbacks","wsUrl","setWsUrl","useState","useEffect","containsSubscriptionUpdate","useCallback","jsonMessage","params","sub","current","objects","lastJsonMessage","sendJsonMessage","readyState","useWebSocket","moonrakerStatus","options","id","passThroughUpdateMethods","includes","warn","messageData","onMessage","onStatusUpdate","shouldReconnect","reconnectAttempts","Infinity","reconnectInterval","share","readyStateRef","setMoonrakerStatus","whenReady","resolve","reject","isReady","Promise","moonrakerQuery","err","timeout","setTimeout","jsonrpc","subscribeToObject","args","fromEntries","allSubscribedObjects","assign","values","v","q","reqId","status","unsuscribe","saveItem","getItem","forEach","cb","clearTimeout","keys","catch","query","lastMessage","useNamespacedItemQuery","useQuery","queryKey","queryFn","useMoonrakerQuery","undefined","passed","useMoonrakerMutation","useMutation","mutationKey","mutationFn","usePrinterObjectQuery","usePrinterObjectSubscription","select","state","setState","stateRef","selectRef","_select","useMemo","changed","changeSelection","deepEqual","merge","prev","subscription","then","Error","useNamespacedItemMutation","useMoonrakerState","initialValue","initialData","mutation","newValue","mutateAsync","onSuccess","refetch","getBaseUrl","trpc","createTRPCNext","config","links","httpBatchLink","url","maxURLLength","overrides","opts","originalFn","queryClient","invalidateQueries","ssr","proxyClient","createTRPCProxyClient","PinoLogLevel","z","enum","object","ts","number","messages","array","any","bindings","record","string","label"],"sourceRoot":""}