"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9672],{88192:function(e,r,l){l.r(r),l.d(r,{Card:function(){return Card}});var i=l(72612),t=l(73918);l(39164);var a=l(73790);let o=(0,t.j)(["relative rounded-lg  bg-white dark:bg-zinc-900/60","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-xl","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_rgba(0,_0,_0,_0.20),_0px_1px_0px_0px_rgba(255,_255,_255,_0.07)_inset]"]),Card=e=>(0,i.jsx)(a.E.div,{...e,className:o({className:e.className}),children:e.children})},59672:function(e,r,l){l.d(r,{l:function(){return PrinterRailSettings}});var i=l(72612),t=l(34640),a=l(39164),o=l(37231),n=l(18311),d=l(39634),s=l(57137),u=l(34471),p=l(39662),c=l(69460),v=l(96588),x=l(31239),f=l(1314),m=l(21264),g=l(32342),R=l(80461),h=l(79293),b=l(63278),S=l(94594),_=l(39762),D=l(88192);S.z.array(f.g6);let PrinterRailSettings=e=>{var r,l,S,y,j,k,M,N,C,E;let A=(0,R.YC)(),T=A.find(r=>r.getExtruderAxis()===e.printerRail.axis),P=A.every(e=>e.hasToolboard()),w=(null==T?void 0:T.getExtruderAxis())===e.printerRailDefault.axis&&(null==T?void 0:T.hasToolboard()),z=w?T.getToolboard():e.selectedBoard,[B,I]=(0,a.useState)(!!e.performanceMode),L=(0,v.Zl)((0,g.ew)(e.printerRail.axis)),O=(0,v.sJ)(g.q7),W=(null==z?void 0:z.integratedDrivers)&&z.integratedDrivers[e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis],[Y,U]=(0,a.useState)(null!=W&&null!==(k=(0,m.Df)(W))&&void 0!==k?k:e.printerRail.driver),[V,q]=(0,a.useState)(e.printerRail.stepper),[J,Q]=(0,a.useState)(B&&null!==(M=null===(r=e.printerRailDefault.performanceMode)||void 0===r?void 0:r.homingSpeed)&&void 0!==M?M:e.printerRailDefault.homingSpeed),[X,Z]=(0,a.useState)(e.printerRail.motorSlot&&(null===(S=e.selectedBoard)||void 0===S?void 0:null===(l=S.motorSlots)||void 0===l?void 0:l[e.printerRail.motorSlot])?e.printerRail.motorSlot:void 0),F=h.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,canUseExtruderlessConfigs:P,boardPath:null!==(N=null==z?void 0:z.path)&&void 0!==N?N:""},{enabled:!!z}),G=null==e.errors?0:Object.keys(e.errors).reduce((r,l)=>{var i;let t=null===(i=e.errors)||void 0===i?void 0:i[l];if(null==t)return r;let a=Array.isArray(t)?t.length:t._errors.length;return r+a},0),H=(0,a.useCallback)(r=>null!=r&&O.some(l=>{let i=A.find(e=>e.getExtruderAxis()===l.axis);return!(l.axis===e.printerRail.axis||(null==i?void 0:i.hasToolboard()))&&l.motorSlot===r}),[O,e.printerRail.axis,A]);(0,a.useEffect)(()=>{var e;F.data&&null==X&&(null==z?void 0:null===(e=z.motorSlots)||void 0===e?void 0:e[F.data])!=null&&Z(F.data)},[z,F.data,X,e.printerRailDefault.axis]);let K=(0,f.Wx)(z,Y).map(e=>({...e,badge:null!=(0,n.a)(V,Y,e.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0})),[$,ee]=(0,a.useState)(null!==(E=null!==(C=K.find(r=>r.id===e.printerRail.voltage))&&void 0!==C?C:K.find(r=>{var l;return r.id===(B&&(null===(l=e.printerRailDefault.performanceMode)||void 0===l?void 0:l.voltage)?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage)}))&&void 0!==E?E:K[0]),[er,el]=(0,a.useState)(e.printerRail.current),ei=(0,a.useMemo)(()=>(0,n.a)(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),et=(0,a.useMemo)(()=>(0,n.a)(V,Y,$.id,void 0,B),[V,Y,$,B]),ea=(0,a.useMemo)(()=>(0,n.a)(V,Y,$.id,er,B),[V,Y,$,B,er]),eo=o.N.filter(e=>"UART"===e.protocol||(null==z?void 0:z.stepperSPI)!=null).map(e=>({...e,badge:null!=(0,n.a)(V,e,$.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0})),en=n.B.map(e=>({...e,badge:null!=(0,n.a)(e,Y,$.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,a.useEffect)(()=>{if((0,f.R_)(e.printerRail,e.printerRailDefault,!e.performanceMode)){var r,l,i;e.performanceMode&&e.printerRailDefault.performanceMode?(Q(null!==(r=e.printerRailDefault.performanceMode.homingSpeed)&&void 0!==r?r:e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&ee(null!==(l=K.find(r=>{var l,i;return r.id===(null!==(i=null===(l=e.printerRailDefault.performanceMode)||void 0===l?void 0:l.voltage)&&void 0!==i?i:e.printerRailDefault.voltage)}))&&void 0!==l?l:K[0]),null!=e.printerRailDefault.performanceMode.current&&el(e.printerRailDefault.performanceMode.current)):(Q(e.printerRailDefault.homingSpeed),ee(null!==(i=K.find(r=>r.id===e.printerRailDefault.voltage))&&void 0!==i?i:K[0]),el(e.printerRailDefault.current))}I(!!e.performanceMode)},[e.performanceMode]),(0,a.useEffect)(()=>{let e=K.find(e=>e.id===$.id);if(!e){var r;ee(et&&null!==(r=K.find(e=>e.id===et.voltage))&&void 0!==r?r:K[0]),et&&el(et.run_current)}},[K,$,et]),(0,a.useEffect)(()=>{let r={axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,homingSpeed:J,motorSlot:X,driver:Y,voltage:$.id,stepper:V,current:er},l=(0,m.Yz)(r),i=(0,m.Yz)(e.printerRail),t=Object.keys(l).some(e=>l[e]!==i[e]);t&&L(l)},[er,Y,e.printerRail,J,L,V,$.id,X]);let ed=et&&et.run_current===er,es="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===f.po.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase(),eu=(null==z?void 0:z.motorSlots)!=null&&Object.keys(z.motorSlots).length>0?Object.keys(z.motorSlots).map(r=>{var l,i,t,a;if((null===(l=z.motorSlots)||void 0===l?void 0:l[r].title)==null)return null;let o=(null===(i=z.motorSlots)||void 0===i?void 0:i[r].diag_pin)!=null,n=(null===(t=z.motorSlots)||void 0===t?void 0:t[r].endstop_pin)!=null,d=H(r),s=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!o;return{id:r,title:null===(a=z.motorSlots)||void 0===a?void 0:a[r].title,disabled:s,badge:[o?void 0:{children:"No diag pin",color:s?"red":"gray"},n?void 0:{children:"No endstop pin",color:"gray"},!0===d?{children:"In use",color:"orange"}:void 0].filter(Boolean)}}).filter(Boolean):null,ep=(0,a.useMemo)(()=>{var r,l;if(null==X||(null==z?void 0:null===(r=z.motorSlots)||void 0===r?void 0:r[X].title)==null)return;let i=(null===(l=z.motorSlots)||void 0===l?void 0:l[X].diag_pin)!=null,t=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!i;return!i&&t?{children:"No diag pin",color:"red"}:void 0},[z,X,e.printerRailDefault.axis]);return(0,i.jsx)(_.M,{children:e.isVisible&&(0,i.jsxs)(D.Card,{exit:{opacity:0,scale:.9,y:-40},initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},className:(0,b.m6)("break-inside-avoid-column p-4",G>0&&(0,d.iA)({color:"red"}),G>0&&(0,d.xU)({color:"red"})),children:[(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)("h3",{className:(0,b.m6)("text-sm font-bold leading-6 text-zinc-700 dark:text-zinc-300",G>0&&"text-red-900/80 dark:text-red-100"),children:es}),(0,i.jsx)("p",{className:(0,b.m6)("text-sm text-zinc-500 dark:text-zinc-400",G>0&&"text-red-800/80 dark:text-red-100/60"),children:e.printerRail.axisDescription})]}),(0,i.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[eu&&(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Motor Slot",options:eu,error:null===(j=e.errors)||void 0===j?void 0:null===(y=j.motorSlot)||void 0===y?void 0:y._errors.join("\n"),onSelect:e=>{Z(e.id)},value:X?eu.find(e=>e.id===X):void 0,badge:ep})}),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Driver",options:eo,onSelect:U,value:Y,disabled:null!=W,badge:[null!=W?{children:"Integrated",color:"sky"}:void 0,w?{children:"Toolboard",color:"yellow"}:void 0].filter(Boolean)})}),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Stepper",options:en,onSelect:q,value:V})}),(0,i.jsx)("div",{className:"col-span-1",children:(0,i.jsx)(t.Lt,{label:"Voltage",options:K,onSelect:ee,value:$})}),(0,i.jsx)("div",{className:"col-span-1",children:(0,i.jsx)(s.o,{type:"number",label:"Current",value:er,onChange:el,inputMode:"decimal",step:"any",min:0,max:Y.maxCurrent})}),V.maxPeakCurrent/1.41<er&&(0,i.jsxs)(u.j,{Icon:x,color:"yellow",title:"Stepper overcurrent!",className:"col-span-2",children:["Your stepper motor is rated for ",Math.floor(100*V.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",er,"A."]}),null!=ea&&(0,i.jsx)(u.j,{Icon:p,color:"brand",title:"Driver tuning applied!",className:"col-span-2",children:"RatOS preset applied automatically."}),(null==ea?void 0:ea.run_current)!==(null==ei?void 0:ei.run_current)&&et&&!ed&&(0,i.jsxs)(u.j,{Icon:c,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-2",children:["RatOS has a recommended preset for your current settings at ",et.run_current,"A. You can"," ",(0,i.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>el(et.run_current),children:["change the current to ",et.run_current,"A"]})," ","to apply the preset automatically."]})]})]},e.printerRail.axis)})}}}]);
//# sourceMappingURL=9672-1bf901d04ab61287.js.map