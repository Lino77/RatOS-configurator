{"version":3,"file":"static/chunks/5670-5b10c61d7af5a0f0.js","mappings":"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","sources":["webpack://_N_E/ignored|/home/runner/work/RatOS-configurator/RatOS-configurator/src/node_modules/.pnpm/object-inspect@1.13.1/node_modules/object-inspect|./util.inspect","webpack://_N_E/./helpers/util.ts","webpack://_N_E/./moonraker/migrations.ts","webpack://_N_E/./moonraker/hooks.tsx","webpack://_N_E/./utils/trpc.ts","webpack://_N_E/<anon>"],"sourcesContent":["/* (ignored) */","'use client';\nexport const getHost = () => {\n\treturn process.env.NEXT_PUBLIC_KLIPPER_HOSTNAME != null && process.env.NEXT_PUBLIC_KLIPPER_HOSTNAME.trim() != ''\n\t\t? process.env.NEXT_PUBLIC_KLIPPER_HOSTNAME\n\t\t: typeof window !== 'undefined' && window.location?.hostname != null\n\t\t\t? window.location.hostname\n\t\t\t: null;\n};\n","import { getHost } from '@/helpers/util';\nimport { MoonrakerDBItemResponse } from '@/moonraker/types';\n\ninterface Migration {\n\tversion: number;\n\tdescription: string;\n\tup: () => Promise<{ result: string }>;\n\tdown: () => Promise<{ result: string }>;\n}\n\nexport const migrations: Migration[] = [\n\t{\n\t\tversion: 1,\n\t\tdescription: \"Undo double JSON encoding of RatOS's data\",\n\t\tup: async () => {\n\t\t\tconst res = await window.fetch(`http://${getHost()}/server/database/item?namespace=RatOS`);\n\t\t\tif (res.ok) {\n\t\t\t\tconst data = (await res.json()) as\n\t\t\t\t\t| { result: MoonrakerDBItemResponse<{ [key: string]: unknown }> }\n\t\t\t\t\t| { error: { message: string } };\n\t\t\t\tif ('error' in data) {\n\t\t\t\t\tthrow new Error(data.error.message);\n\t\t\t\t}\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tif (data.result.value == null) {\n\t\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t\t}\n\t\t\t\tfor await (const [key, value] of Object.entries(data.result.value)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst parsed = JSON.parse(value as any);\n\t\t\t\t\t\tconsole.log('Migrating', key, 'from', value, 'to', parsed);\n\t\t\t\t\t\tawait window.fetch(`http://${getHost()}/server/database/item`, {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\tnamespace: 'RatOS',\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\tvalue: parsed,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Error migrating', key, value, 'clearing key');\n\t\t\t\t\t\tawait window.fetch(\n\t\t\t\t\t\t\t`http://${getHost()}/server/database/item?namespace=RatOS&key=${encodeURIComponent(key)}`,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmethod: 'DELETE',\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\t\tnamespace: 'RatOS',\n\t\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn { result: `Succesfully decoded ${result.length} keys.\\n${result.join('\\n')}` };\n\t\t\t} else {\n\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t}\n\t\t},\n\t\tdown: async () => {\n\t\t\t// drop table\n\t\t\tconst res = await window.fetch(`http://${getHost()}/server/database/item?namespace=RatOS`);\n\t\t\tif (res.ok) {\n\t\t\t\tconst data = (await res.json()) as\n\t\t\t\t\t| { result: MoonrakerDBItemResponse<{ [key: string]: unknown }> }\n\t\t\t\t\t| { error: { message: string } };\n\t\t\t\tif ('error' in data) {\n\t\t\t\t\tthrow new Error(data.error.message);\n\t\t\t\t}\n\t\t\t\tif (data.result.value == null) {\n\t\t\t\t\treturn { result: 'Nothing to migrate' };\n\t\t\t\t}\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tfor await (const [key, value] of Object.entries(data.result.value)) {\n\t\t\t\t\tconst encoded = JSON.stringify(value as any);\n\t\t\t\t\tawait window.fetch(`http://${getHost()}/server/database/item`, {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\tnamespace: 'RatOS',\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tvalue: encoded,\n\t\t\t\t\t\t}),\n\t\t\t\t\t});\n\t\t\t\t\tresult.push(`Re-encoded ${key}`);\n\t\t\t\t}\n\t\t\t\treturn { result: `Succesfully re-encoded ${result.length} keys.\\n${result.join('\\n')}` };\n\t\t\t}\n\t\t\treturn { result: 'Nothing to migrate' };\n\t\t},\n\t},\n];\n\nexport const getCurrentVersion = async (): Promise<number> => {\n\tconst res = await window.fetch(`http://${getHost()}/server/database/item?namespace=RatOS&key=__db_version`);\n\tif (res.ok) {\n\t\tconst data = (await res.json()) as { result: MoonrakerDBItemResponse<number> } | { error: { message: string } };\n\t\tif ('error' in data) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn data.result.value as number;\n\t}\n\treturn 0;\n};\n\nexport const setCurrentVersion = async (version: number) => {\n\tawait window.fetch(`http://${getHost()}/server/database/item`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\tnamespace: 'RatOS',\n\t\t\tkey: '__db_version',\n\t\t\tvalue: version,\n\t\t}),\n\t});\n};\n\nlet isMigrating = false;\nexport const migrate = async (from: number, to: number) => {\n\tif (isMigrating) {\n\t\treturn console.log('Already migrating, ignoring..');\n\t}\n\tif (from === to) {\n\t\treturn console.log('Already at target version');\n\t}\n\tisMigrating = true;\n\ttry {\n\t\tconst migrationsToRun = migrations\n\t\t\t.filter((m) => m.version >= from && m.version <= to)\n\t\t\t.sort((a, b) => (from <= to ? a.version - b.version : b.version - a.version));\n\t\tfor await (const migration of migrationsToRun) {\n\t\t\tconst result = await (from < to ? migration.up() : migration.down());\n\t\t\tconsole.log(`Migrated to version ${migration.version}: ${result.result}`);\n\t\t}\n\t\tawait setCurrentVersion(to);\n\t} finally {\n\t\tisMigrating = false;\n\t}\n};\n\nlet isMigrated = false;\nexport const migrateToLatest = async () => {\n\tif (isMigrated) {\n\t\treturn console.log('Already migrated, ignoring..');\n\t}\n\tconst currentVersion = await getCurrentVersion();\n\tconst latestVersion = Math.max(...migrations.map((m) => m.version));\n\tif (currentVersion === latestVersion) {\n\t\tconsole.log('Already at latest version');\n\t\treturn;\n\t}\n\tif (isMigrating) {\n\t\tconsole.log('Already migrating, ignoring..');\n\t\treturn;\n\t}\n\tconsole.log('Migrating to latest version...', currentVersion, latestVersion);\n\tawait migrate(currentVersion, latestVersion);\n\tisMigrated = true;\n\tconsole.log('Migration complete.');\n};\n","'use client';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { UseMutationOptions, UseQueryOptions, useMutation, useQuery } from '@tanstack/react-query';\nimport useWebSocket from 'react-use-websocket';\nimport { migrateToLatest } from '@/moonraker/migrations';\nimport type {\n\tInFlightRequestCallbacks,\n\tInFlightRequestTimeouts,\n\tMoonrakerResponse,\n\tMoonrakerStatus,\n\tMoonrakerSaveItemFn,\n\tMoonrakerNamespaces,\n\tMoonrakerDBItemResponse,\n\tMoonrakerGetItemFn,\n\tMoonrakerNamespaceKeys,\n\tMoonrakerDBValue,\n\tMoonrakerQueryFn,\n\tMoonrakerQueryKeys,\n\tMoonrakerQueryParams,\n\tMoonrakerQueryResult,\n\tMoonrakerMutationKeys,\n\tMoonrakerMutationParams,\n\tMoonrakerMutationResult,\n\tMoonrakerMutationFn,\n\tPrinterObjectKeys,\n\tPrinterObjectsMoonrakerQueryParams,\n\tPrinterObjectResult,\n\tMoonrakerResponseSuccess,\n} from '@/moonraker/types';\nimport { getHost } from '@/helpers/util';\nimport { merge } from 'ts-deepmerge';\nimport deepEqual from 'deep-equal';\nimport { e } from 'vitest/dist/reporters-rzC174PQ';\n\nlet REQ_ID = 0;\n\nconst getWsURL = () => {\n\tconst host = getHost();\n\tif (host == null || host.trim() == '') {\n\t\treturn null;\n\t}\n\treturn `ws://${host}/websocket`;\n};\n\nconst subscriptions: { [key: number]: Partial<PrinterObjectsMoonrakerQueryParams> } = {};\n\ntype MoonrakerStatusUpdate = { [key in PrinterObjectKeys]: PrinterObjectResult<PrinterObjectKeys> };\n\ninterface MoonrakerHookOptions {\n\tonStatusUpdate?: (status: MoonrakerStatusUpdate) => void;\n\tpassThroughUpdateMethods?: string[];\n}\n\nexport const useMoonraker = (options?: MoonrakerHookOptions) => {\n\tconst inFlightRequests = useRef<InFlightRequestCallbacks>({});\n\tconst inFlightRequestTimeouts = useRef<InFlightRequestTimeouts>({});\n\tconst localSubscriptions = useRef<number[]>([]);\n\tconst onReadyCallbacks = useRef<{ resolve: () => void; reject: () => void }[]>([]);\n\tconst [wsUrl, setWsUrl] = useState(getWsURL());\n\tuseEffect(() => {\n\t\tsetWsUrl(getWsURL());\n\t}, []);\n\n\tconst containsSubscriptionUpdate = useCallback(\n\t\t(jsonMessage: MoonrakerResponse): jsonMessage is MoonrakerResponseSuccess => {\n\t\t\tif ('error' in jsonMessage) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (jsonMessage.method === 'notify_status_update' && jsonMessage.params != null) {\n\t\t\t\tconst res = jsonMessage.params[0] as MoonrakerStatusUpdate;\n\t\t\t\tif (res != null) {\n\t\t\t\t\tfor (const sub of localSubscriptions.current) {\n\t\t\t\t\t\tconst objects = subscriptions[sub];\n\t\t\t\t\t\tif (objects != null) {\n\t\t\t\t\t\t\tfor (const key in objects) {\n\t\t\t\t\t\t\t\tif (res[key as PrinterObjectKeys] != null) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t[],\n\t);\n\n\tconst { lastJsonMessage, sendJsonMessage, readyState } = useWebSocket<MoonrakerResponse>(wsUrl, {\n\t\tfilter: (message) => {\n\t\t\tif (moonrakerStatus !== 'connected') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst parsed = JSON.parse(message.data) as MoonrakerResponse;\n\t\t\t\tif (inFlightRequests.current[parsed.id] != null) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\toptions?.passThroughUpdateMethods?.length &&\n\t\t\t\t\t'method' in parsed &&\n\t\t\t\t\toptions.passThroughUpdateMethods.includes(parsed.method)\n\t\t\t\t) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Filter: Failed to parse message', e, message.data);\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tonMessage: (message) => {\n\t\t\tif (options?.onStatusUpdate) {\n\t\t\t\ttry {\n\t\t\t\t\tconst parsed = JSON.parse(message.data) as MoonrakerResponse;\n\t\t\t\t\tif (containsSubscriptionUpdate(parsed)) {\n\t\t\t\t\t\tconst res = parsed.params[0] as MoonrakerStatusUpdate;\n\t\t\t\t\t\toptions.onStatusUpdate?.(res);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('OnMessage: Failed to parse message', e, message.data);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tshouldReconnect: (closeEvent) => {\n\t\t\treturn true;\n\t\t},\n\t\treconnectAttempts: Infinity,\n\t\treconnectInterval: 3000,\n\t\tshare: true,\n\t});\n\tconst readyStateRef = useRef(readyState);\n\treadyStateRef.current = readyState;\n\tconst [moonrakerStatus, setMoonrakerStatus] = useState<null | MoonrakerStatus>(\n\t\treadyState === 1 ? 'connected' : 'connecting',\n\t);\n\n\tconst whenReady = useCallback((resolve: () => void, reject: () => void) => {\n\t\tif (readyStateRef.current === 1) {\n\t\t\tresolve();\n\t\t} else {\n\t\t\tonReadyCallbacks.current.push({ resolve, reject });\n\t\t}\n\t}, []);\n\n\tconst isReady = useCallback(\n\t\t() =>\n\t\t\tnew Promise<void>((resolve, reject) => {\n\t\t\t\twhenReady(resolve, reject);\n\t\t\t}),\n\t\t[whenReady],\n\t);\n\tconst moonrakerQuery: MoonrakerQueryFn & MoonrakerMutationFn = useCallback(\n\t\tasync <Response = any,>(method: string, params: any = {}) => {\n\t\t\tconst id = ++REQ_ID;\n\t\t\tawait isReady();\n\t\t\treturn new Promise<Response>((resolve, reject) => {\n\t\t\t\tinFlightRequests.current[id] = (err, result) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn reject(err);\n\t\t\t\t\t}\n\t\t\t\t\tif (result?.error) {\n\t\t\t\t\t\treturn reject(result.error);\n\t\t\t\t\t}\n\t\t\t\t\tresolve(result);\n\t\t\t\t};\n\t\t\t\tlet timeout = 10 * 1000;\n\t\t\t\tif (method === 'printer.gcode.script') {\n\t\t\t\t\t// Allow 10 minutes for gcode macros.\n\t\t\t\t\ttimeout = 10 * 60 * 1000;\n\t\t\t\t}\n\t\t\t\tinFlightRequestTimeouts.current[id] = window.setTimeout(() => {\n\t\t\t\t\tinFlightRequests.current[id]?.(new Error('Request timed out'), null);\n\t\t\t\t\tdelete inFlightRequests.current[id];\n\t\t\t\t\tdelete inFlightRequestTimeouts.current[id];\n\t\t\t\t}, timeout); // 10 second timeout.\n\t\t\t\tsendJsonMessage({\n\t\t\t\t\tjsonrpc: '2.0',\n\t\t\t\t\tmethod,\n\t\t\t\t\tparams,\n\t\t\t\t\tid: id,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t[isReady, sendJsonMessage],\n\t);\n\n\tconst subscribeToObject = useCallback(\n\t\tasync <TArgs extends [PrinterObjectKeys, ...PrinterObjectKeys[]]>(...args: TArgs) => {\n\t\t\tconst objects = Object.fromEntries(args.map((key) => [key, null])) as PrinterObjectsMoonrakerQueryParams;\n\t\t\tconst allSubscribedObjects = Object.assign(\n\t\t\t\t{},\n\t\t\t\tobjects,\n\t\t\t\t...Object.values(subscriptions).filter((v) => v != null),\n\t\t\t) as PrinterObjectsMoonrakerQueryParams;\n\t\t\tconst q = moonrakerQuery('printer.objects.subscribe' as 'printer.objects.query', {\n\t\t\t\tobjects: allSubscribedObjects,\n\t\t\t});\n\t\t\t// Capture request id we just generated;\n\t\t\tconst reqId = REQ_ID;\n\t\t\tsubscriptions[reqId] = objects;\n\t\t\tlocalSubscriptions.current.push(reqId);\n\n\t\t\tconst res = (await q).status as {\n\t\t\t\t[K in TArgs[number]]: PrinterObjectResult<K>;\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tres,\n\t\t\t\tunsuscribe: async () => {\n\t\t\t\t\tlocalSubscriptions.current = localSubscriptions.current.filter((v) => v !== reqId);\n\t\t\t\t\tif (subscriptions[reqId] == null) {\n\t\t\t\t\t\tdelete subscriptions[reqId];\n\t\t\t\t\t\tconst allSubscribedObjects = Object.assign(\n\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t...Object.values(subscriptions).filter((v) => v != null),\n\t\t\t\t\t\t) as PrinterObjectsMoonrakerQueryParams;\n\t\t\t\t\t\tawait moonrakerQuery('printer.objects.subscribe' as 'printer.objects.query', {\n\t\t\t\t\t\t\tobjects: allSubscribedObjects,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\t[moonrakerQuery],\n\t);\n\n\tconst saveItem = useCallback<MoonrakerSaveItemFn>(\n\t\tasync <Data,>(namespace: MoonrakerNamespaces, key: unknown, value: unknown) => {\n\t\t\tawait isReady();\n\t\t\treturn (await moonrakerQuery('server.database.post_item', {\n\t\t\t\tnamespace: namespace,\n\t\t\t\tkey,\n\t\t\t\tvalue: value,\n\t\t\t})) as Data;\n\t\t},\n\t\t[moonrakerQuery, isReady],\n\t);\n\n\tconst getItem = useCallback<MoonrakerGetItemFn>(\n\t\tasync <Data,>(namespace: MoonrakerNamespaces, key: unknown): Promise<Data | null> => {\n\t\t\tawait isReady();\n\t\t\ttry {\n\t\t\t\tconst result = await moonrakerQuery('server.database.get_item', {\n\t\t\t\t\tnamespace: namespace,\n\t\t\t\t\tkey,\n\t\t\t\t});\n\t\t\t\treturn (result?.value ?? null) as Data;\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\t[moonrakerQuery, isReady],\n\t);\n\n\tuseEffect(() => {\n\t\tif (readyState === 1) {\n\t\t\t(async () => {\n\t\t\t\tawait migrateToLatest();\n\t\t\t\tonReadyCallbacks.current.forEach((cb) => cb.resolve());\n\t\t\t\tonReadyCallbacks.current = [];\n\t\t\t\tsetMoonrakerStatus('connected');\n\t\t\t})();\n\t\t} else {\n\t\t\tsetMoonrakerStatus('connecting');\n\t\t}\n\t}, [readyState]);\n\n\tuseEffect(() => {\n\t\tif (lastJsonMessage?.id && inFlightRequests.current[lastJsonMessage.id]) {\n\t\t\twindow.clearTimeout(inFlightRequestTimeouts.current[lastJsonMessage.id]);\n\t\t\tif ('error' in lastJsonMessage) {\n\t\t\t\tinFlightRequests.current[lastJsonMessage.id](new Error(lastJsonMessage.error.message), null);\n\t\t\t} else {\n\t\t\t\tinFlightRequests.current[lastJsonMessage.id](null, lastJsonMessage.result);\n\t\t\t}\n\t\t\tdelete inFlightRequestTimeouts.current[lastJsonMessage.id];\n\t\t\tdelete inFlightRequests.current[lastJsonMessage.id];\n\t\t}\n\t}, [lastJsonMessage]);\n\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tfor (const reqId in inFlightRequestTimeouts.current) {\n\t\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t\t\tdelete inFlightRequestTimeouts.current[reqId];\n\t\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t\t\tdelete inFlightRequests.current[reqId];\n\t\t\t}\n\t\t\tif (localSubscriptions.current.length > 0) {\n\t\t\t\tlocalSubscriptions.current.forEach((sub) => {\n\t\t\t\t\tdelete subscriptions[sub];\n\t\t\t\t});\n\t\t\t\tlocalSubscriptions.current = [];\n\t\t\t\tconst allSubscribedObjects = Object.assign(\n\t\t\t\t\t{},\n\t\t\t\t\t...Object.values(subscriptions).filter((v) => v != null),\n\t\t\t\t) as PrinterObjectsMoonrakerQueryParams;\n\t\t\t\tmoonrakerQuery('printer.objects.subscribe' as 'printer.objects.query', {\n\t\t\t\t\tobjects: Object.keys(allSubscribedObjects).length > 0 ? allSubscribedObjects : null,\n\t\t\t\t}).catch((e) => {\n\t\t\t\t\t// ignore\n\t\t\t\t});\n\t\t\t}\n\t\t\tonReadyCallbacks.current.forEach((cb) => cb.reject());\n\t\t\tonReadyCallbacks.current = [];\n\t\t};\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, []);\n\n\treturn {\n\t\tquery: moonrakerQuery,\n\t\tsaveItem,\n\t\tgetItem,\n\t\tsubscribeToObject,\n\t\tstatus: moonrakerStatus,\n\t\tlastMessage: lastJsonMessage,\n\t\tisReady: readyState === 1,\n\t};\n};\n\nexport const useNamespacedItemQuery = <\n\tN extends MoonrakerNamespaces,\n\tK extends MoonrakerNamespaceKeys<N>,\n\tV extends MoonrakerDBValue<N, K>,\n>(\n\tnamespace: N,\n\tkey: K,\n\toptions?: Omit<UseQueryOptions<V, unknown, V, N[]>, 'queryKey' | 'queryFn'>,\n) => {\n\tconst { getItem } = useMoonraker();\n\treturn useQuery({\n\t\t...options,\n\t\tqueryKey: [namespace, key],\n\t\tqueryFn: async () => {\n\t\t\treturn getItem(namespace, key) as Promise<V>;\n\t\t},\n\t});\n};\n\nexport const useMoonrakerQuery = <\n\tK extends MoonrakerQueryKeys = MoonrakerQueryKeys,\n\tP extends MoonrakerQueryParams<K> = MoonrakerQueryParams<K>,\n\tO extends Omit<\n\t\tUseQueryOptions<MoonrakerQueryResult<K>, unknown, MoonrakerQueryResult<K>, K[]>,\n\t\t'queryKey' | 'queryFn'\n\t> = Omit<UseQueryOptions<MoonrakerQueryResult<K>, unknown, MoonrakerQueryResult<K>, K[]>, 'queryKey' | 'queryFn'>,\n>(\n\t...args: P extends void ? [K, O?] : [K, P, O?]\n) => {\n\tconst { query } = useMoonraker();\n\tconst options = args.length === 3 ? (args[2] as O) : (args[1] as O);\n\tconst params = args.length === 3 ? args[1] : undefined;\n\tconst key = args[0];\n\tconst passed = (args.length === 3 ? [key, params] : [key]) as P extends void ? [K] : [K, P];\n\treturn useQuery({\n\t\t...(options ?? {}),\n\t\tqueryKey: [args[0]],\n\t\tqueryFn: async () => {\n\t\t\treturn query(...passed) as Promise<MoonrakerQueryResult<K>>;\n\t\t},\n\t});\n};\n\nexport const useMoonrakerMutation = <\n\tK extends MoonrakerMutationKeys = MoonrakerMutationKeys,\n\tP extends MoonrakerMutationParams<K> = MoonrakerMutationParams<K>,\n\tO extends Omit<UseMutationOptions<MoonrakerMutationResult<K>, unknown, P, K[]>, 'mutationKey' | 'mutationFn'> = Omit<\n\t\tUseMutationOptions<MoonrakerMutationResult<K>, unknown, P, K[]>,\n\t\t'mutationKey' | 'mutationFn'\n\t>,\n>(\n\t...args: [K, O?]\n) => {\n\tconst { query } = useMoonraker();\n\tconst options = args[1];\n\tconst key = args[0];\n\treturn useMutation({\n\t\t...options,\n\t\tmutationKey: [args[0]],\n\t\tmutationFn: async (params: P) => {\n\t\t\tconst passed = (params ? [key, params] : [key]) as P extends void ? [K] : [K, P];\n\t\t\treturn query(...passed) as Promise<MoonrakerMutationResult<K>>;\n\t\t},\n\t});\n};\n\nexport const usePrinterObjectQuery = <TArgs extends [PrinterObjectKeys, ...PrinterObjectKeys[]]>(...args: TArgs) => {\n\tconst { query } = useMoonraker();\n\treturn useQuery({\n\t\tqueryKey: args,\n\t\tqueryFn: async () => {\n\t\t\tconst objects = Object.fromEntries(args.map((key) => [key, null])) as PrinterObjectsMoonrakerQueryParams;\n\t\t\treturn (await query('printer.objects.query', { objects })).status as {\n\t\t\t\t[K in TArgs[number]]: PrinterObjectResult<K>;\n\t\t\t};\n\t\t},\n\t});\n};\n\nexport const usePrinterObjectSubscription = <\n\tTArgs extends [PrinterObjectKeys, ...PrinterObjectKeys[]],\n\tR extends object = { [K in TArgs[number]]: PrinterObjectResult<K> },\n>(\n\tselect: null | ((res: { [K in TArgs[number]]: PrinterObjectResult<K> }) => R),\n\t...args: TArgs\n) => {\n\tconst [state, setState] = useState<R | null>(null);\n\tconst stateRef = useRef(state);\n\tstateRef.current = state;\n\tconst selectRef = useRef(select);\n\tselectRef.current = select;\n\n\tconst _select = useCallback((res: { [K in TArgs[number]]: PrinterObjectResult<K> }) => {\n\t\tif (selectRef.current == null) {\n\t\t\treturn res as R;\n\t\t}\n\t\treturn selectRef.current?.(res);\n\t}, []);\n\n\tconst keys = useMemo(\n\t\t() => Object.fromEntries(args.map((key) => [key, null])) as PrinterObjectsMoonrakerQueryParams,\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t[JSON.stringify(args.sort())],\n\t);\n\n\tconst { subscribeToObject } = useMoonraker({\n\t\tonStatusUpdate: useCallback(\n\t\t\t(res: MoonrakerStatusUpdate) => {\n\t\t\t\tconst changed = {} as typeof res;\n\t\t\t\tfor (const key in keys) {\n\t\t\t\t\tif (res[key as keyof typeof res] != null) {\n\t\t\t\t\t\tchanged[key as keyof typeof res] = res[key as keyof typeof res];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst changeSelection = _select(changed);\n\t\t\t\tif (changeSelection == null || typeof changeSelection !== 'object') {\n\t\t\t\t\tthrow new Error('Invalid selection function, must return object, got ' + typeof changeSelection);\n\t\t\t\t}\n\t\t\t\tif (Object.keys(changed).length > 0 && deepEqual(changeSelection, stateRef.current) === false) {\n\t\t\t\t\tsetState((prev) => {\n\t\t\t\t\t\treturn merge(prev ?? {}, changeSelection) as R;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t[_select, keys],\n\t\t),\n\t});\n\n\tuseEffect(() => {\n\t\tconst subscription = subscribeToObject(...(Object.keys(keys) as TArgs));\n\t\tsubscription\n\t\t\t.then((sub) => {\n\t\t\t\tsetState(_select(sub.res));\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t});\n\t\treturn () => {\n\t\t\tsubscription\n\t\t\t\t.then((sub) => sub.unsuscribe())\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\t}, [_select, keys, subscribeToObject]);\n\n\treturn state;\n};\n\nexport const useNamespacedItemMutation = <\n\tN extends MoonrakerNamespaces,\n\tK extends MoonrakerNamespaceKeys<N>,\n\tV extends MoonrakerDBValue<N, K>,\n>(\n\tnamespace: N,\n\tkey: K,\n\toptions?: Omit<UseMutationOptions<MoonrakerDBItemResponse<V>, unknown, V>, 'mutationKey' | 'mutationFn'>,\n) => {\n\tconst { saveItem } = useMoonraker();\n\treturn useMutation<MoonrakerDBItemResponse<V>, unknown, V>({\n\t\t...options,\n\t\tmutationKey: [namespace, key],\n\t\tmutationFn: (value: V) => saveItem(namespace, key, value) as Promise<MoonrakerDBItemResponse<V>>,\n\t});\n};\n\nexport const useMoonrakerState = <\n\tN extends MoonrakerNamespaces,\n\tK extends MoonrakerNamespaceKeys<N>,\n\tV extends MoonrakerDBValue<N, K>,\n\tVal extends NonNullable<V> | null,\n>(\n\tnamespace: N,\n\tkey: K,\n\tinitialValue: Val = null as Val,\n) => {\n\tconst query = useNamespacedItemQuery(namespace, key, { initialData: initialValue });\n\tconst mutation = useNamespacedItemMutation<N, K, V>(namespace, key);\n\tconst mutate = useCallback(\n\t\tasync (value: V | ((prev: NonNullable<V> | Val) => NonNullable<V> | Val)) => {\n\t\t\tconst newValue =\n\t\t\t\ttypeof value === 'function' ? (value as (prev: NonNullable<V> | Val) => V)(query.data ?? initialValue) : value;\n\t\t\tawait mutation.mutateAsync(newValue, {\n\t\t\t\tonSuccess: () => {\n\t\t\t\t\t// Todo, implement optimistic updates\n\t\t\t\t\tquery.refetch();\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t[initialValue, mutation, query],\n\t);\n\treturn [query.data ?? initialValue, mutate, query, mutation] as const;\n};\n","'use client';\nimport { createTRPCProxyClient, httpBatchLink } from '@trpc/client';\nimport { createTRPCNext } from '@trpc/next';\nimport type { AppRouter } from '@/server/routers/index';\nexport type {\n\tPrinterRouterLike,\n\tDropdownQuery,\n\tDropdownQueryKeys,\n\tDropdownQueryInput,\n\tDropdownQueryOutput,\n} from '@/server/routers/printer';\n\nexport function getBaseUrl() {\n\tif (typeof window !== 'undefined')\n\t\t// browser should use relative path\n\t\treturn '/configure';\n\tif (process.env.RENDER_INTERNAL_HOSTNAME)\n\t\t// reference for render.com\n\t\treturn `http://${process.env.RENDER_INTERNAL_HOSTNAME}:${process.env.PORT}/configure`;\n\t// assume localhost\n\treturn `http://127.0.0.1:${process.env.PORT ?? 3000}/configure`;\n}\nexport const trpc = createTRPCNext<AppRouter>({\n\tconfig() {\n\t\treturn {\n\t\t\tlinks: [\n\t\t\t\thttpBatchLink({\n\t\t\t\t\t/**\n\t\t\t\t\t * @link https://trpc.io/docs/ssr\n\t\t\t\t\t **/\n\t\t\t\t\turl: `${getBaseUrl()}/api/trpc`,\n\t\t\t\t\tmaxURLLength: 2083, // a suitable size\n\t\t\t\t}),\n\t\t\t],\n\t\t};\n\t},\n\t/**\n\t * @link https://trpc.io/docs/ssr\n\t **/\n\tssr: false,\n});\nexport const proxyClient = createTRPCProxyClient<AppRouter>({\n\tlinks: [\n\t\thttpBatchLink({\n\t\t\t/**\n\t\t\t * @link https://trpc.io/docs/ssr\n\t\t\t **/\n\t\t\turl: `${getBaseUrl()}/api/trpc`,\n\t\t\tmaxURLLength: 2083, // a suitable size\n\t\t}),\n\t],\n});\n"],"names":["getHost","window","process","trim","location","hostname","migrations","version","description","up","res","fetch","concat","ok","result","data","json","error","message","value","key","Object","entries","parsed","JSON","parse","console","log","method","headers","body","stringify","namespace","e","encodeURIComponent","length","join","down","encoded","push","getCurrentVersion","setCurrentVersion","isMigrating","migrate","from","to","migrationsToRun","filter","m","sort","a","b","migration","isMigrated","migrateToLatest","currentVersion","latestVersion","Math","max","map","REQ_ID","getWsURL","host","subscriptions","useMoonraker","inFlightRequests","useRef","inFlightRequestTimeouts","localSubscriptions","onReadyCallbacks","wsUrl","setWsUrl","useState","useEffect","containsSubscriptionUpdate","useCallback","jsonMessage","params","sub","current","objects","lastJsonMessage","sendJsonMessage","readyState","useWebSocket","moonrakerStatus","options","id","passThroughUpdateMethods","includes","warn","onMessage","onStatusUpdate","shouldReconnect","reconnectAttempts","Infinity","reconnectInterval","share","readyStateRef","setMoonrakerStatus","whenReady","resolve","reject","isReady","Promise","moonrakerQuery","err","timeout","setTimeout","jsonrpc","subscribeToObject","args","fromEntries","allSubscribedObjects","assign","values","v","q","reqId","status","unsuscribe","saveItem","getItem","forEach","cb","clearTimeout","keys","catch","query","lastMessage","useNamespacedItemQuery","useQuery","queryKey","queryFn","useMoonrakerQuery","undefined","passed","useMoonrakerMutation","useMutation","mutationKey","mutationFn","usePrinterObjectQuery","usePrinterObjectSubscription","select","state","setState","stateRef","selectRef","_select","useMemo","changed","changeSelection","deepEqual","merge","prev","subscription","then","Error","useNamespacedItemMutation","useMoonrakerState","initialValue","initialData","mutation","mutate","newValue","mutateAsync","onSuccess","refetch","getBaseUrl","trpc","createTRPCNext","config","links","httpBatchLink","url","maxURLLength","ssr","proxyClient","createTRPCProxyClient"],"sourceRoot":""}