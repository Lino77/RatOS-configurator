"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3867],{3867:function(e,r,l){l.d(r,{l:function(){return PrinterRailSettings}});var i=l(26248),t=l(23709),a=l(49738),o=l(96099),n=l(39140),d=l(73323),s=l(48542),u=l(26418),c=l(16277),p=l(69460),v=l(55797),m=l(31239),f=l(78185),x=l(97370),R=l(48418),g=l(33334),h=l(64918),S=l(44838),b=l(94594),D=l(87044),y=l(21629);b.z.array(f.g6);let PrinterRailSettings=e=>{var r,l,b,j,k,M,N,_,E,C;let A=(0,g.YC)(),T=A.find(r=>r.getExtruderAxis()===e.printerRail.axis),P=A.every(e=>e.hasToolboard()),z=(null==T?void 0:T.getExtruderAxis())===e.printerRailDefault.axis&&(null==T?void 0:T.hasToolboard()),w=z?T.getToolboard():e.selectedBoard,[B,I]=(0,a.useState)(!!e.performanceMode),L=(0,v.Zl)((0,R.ew)(e.printerRail.axis)),O=(0,v.sJ)(R.q7),W=(null==w?void 0:w.integratedDrivers)&&w.integratedDrivers[e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis],[Y,U]=(0,a.useState)(null!=W&&null!==(M=(0,x.Df)(W))&&void 0!==M?M:e.printerRail.driver),[V,q]=(0,a.useState)(e.printerRail.stepper),[J,Q]=(0,a.useState)(B&&null!==(N=null===(r=e.printerRailDefault.performanceMode)||void 0===r?void 0:r.homingSpeed)&&void 0!==N?N:e.printerRailDefault.homingSpeed),[X,Z]=(0,a.useState)(e.printerRail.motorSlot&&(null===(b=e.selectedBoard)||void 0===b?void 0:null===(l=b.motorSlots)||void 0===l?void 0:l[e.printerRail.motorSlot])?e.printerRail.motorSlot:void 0),F=h.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,canUseExtruderlessConfigs:P,boardPath:null!==(_=null==w?void 0:w.path)&&void 0!==_?_:""},{enabled:!!w}),G=null==e.errors?0:Object.keys(e.errors).reduce((r,l)=>{var i;let t=null===(i=e.errors)||void 0===i?void 0:i[l];if(null==t)return r;let a=Array.isArray(t)?t.length:t._errors.length;return r+a},0),H=(0,a.useCallback)(r=>null!=r&&O.some(l=>{let i=A.find(e=>e.getExtruderAxis()===l.axis);return!(l.axis===e.printerRail.axis||(null==i?void 0:i.hasToolboard()))&&l.motorSlot===r}),[O,e.printerRail.axis,A]);(0,a.useEffect)(()=>{var e;F.data&&null==X&&(null==w?void 0:null===(e=w.motorSlots)||void 0===e?void 0:e[F.data])!=null&&Z(F.data)},[w,F.data,X,e.printerRailDefault.axis]);let K=(0,f.Wx)(w,Y).map(e=>({...e,badge:null!=(0,n.a)(V,Y,e.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0})),[$,ee]=(0,a.useState)(null!==(C=null!==(E=K.find(r=>r.id===e.printerRail.voltage))&&void 0!==E?E:K.find(r=>{var l;return r.id===(B&&(null===(l=e.printerRailDefault.performanceMode)||void 0===l?void 0:l.voltage)?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage)}))&&void 0!==C?C:K[0]),[er,el]=(0,a.useState)(e.printerRail.current),ei=(0,a.useMemo)(()=>(0,n.a)(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),et=(0,a.useMemo)(()=>(0,n.a)(V,Y,$.id,void 0,B),[V,Y,$,B]),ea=(0,a.useMemo)(()=>(0,n.a)(V,Y,$.id,er,B),[V,Y,$,B,er]),eo=o.N.filter(e=>"UART"===e.protocol||(null==w?void 0:w.stepperSPI)!=null).map(e=>({...e,badge:null!=(0,n.a)(V,e,$.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0})),en=n.B.map(e=>({...e,badge:null!=(0,n.a)(e,Y,$.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,a.useEffect)(()=>{if((0,f.R_)(e.printerRail,e.printerRailDefault,!e.performanceMode)){var r,l,i;e.performanceMode&&e.printerRailDefault.performanceMode?(Q(null!==(r=e.printerRailDefault.performanceMode.homingSpeed)&&void 0!==r?r:e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&ee(null!==(l=K.find(r=>{var l,i;return r.id===(null!==(i=null===(l=e.printerRailDefault.performanceMode)||void 0===l?void 0:l.voltage)&&void 0!==i?i:e.printerRailDefault.voltage)}))&&void 0!==l?l:K[0]),null!=e.printerRailDefault.performanceMode.current&&el(e.printerRailDefault.performanceMode.current)):(Q(e.printerRailDefault.homingSpeed),ee(null!==(i=K.find(r=>r.id===e.printerRailDefault.voltage))&&void 0!==i?i:K[0]),el(e.printerRailDefault.current))}I(!!e.performanceMode)},[e.performanceMode]),(0,a.useEffect)(()=>{let e=K.find(e=>e.id===$.id);if(!e){var r;ee(et&&null!==(r=K.find(e=>e.id===et.voltage))&&void 0!==r?r:K[0]),et&&el(et.run_current)}},[K,$,et]),(0,a.useEffect)(()=>{let r={axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,homingSpeed:J,motorSlot:X,driver:Y,voltage:$.id,stepper:V,current:er},l=(0,x.Yz)(r),i=(0,x.Yz)(e.printerRail),t=Object.keys(l).some(e=>l[e]!==i[e]);t&&L(l)},[er,Y,e.printerRail,J,L,V,$.id,X]);let ed=et&&et.run_current===er,es="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===f.po.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase(),eu=(null==w?void 0:w.motorSlots)!=null&&Object.keys(w.motorSlots).length>0?Object.keys(w.motorSlots).map(r=>{var l,i,t,a;if((null===(l=w.motorSlots)||void 0===l?void 0:l[r].title)==null)return null;let o=(null===(i=w.motorSlots)||void 0===i?void 0:i[r].diag_pin)!=null,n=(null===(t=w.motorSlots)||void 0===t?void 0:t[r].endstop_pin)!=null,d=H(r),s=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!o;return{id:r,title:null===(a=w.motorSlots)||void 0===a?void 0:a[r].title,disabled:s,badge:[o?void 0:{children:"No diag pin",color:s?"red":"gray"},n?void 0:{children:"No endstop pin",color:"gray"},!0===d?{children:"In use",color:"orange"}:void 0].filter(Boolean)}}).filter(Boolean):null,ec=(0,a.useMemo)(()=>{var r,l;if(null==X||(null==w?void 0:null===(r=w.motorSlots)||void 0===r?void 0:r[X].title)==null)return;let i=(null===(l=w.motorSlots)||void 0===l?void 0:l[X].diag_pin)!=null,t=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!i;return!i&&t?{children:"No diag pin",color:"red"}:void 0},[w,X,e.printerRailDefault.axis]);return(0,i.jsx)(D.M,{children:e.isVisible&&(0,i.jsxs)(y.E.div,{exit:{opacity:0,scale:.9,y:-40},initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},className:(0,S.m)("break-inside-avoid-column rounded-md border border-zinc-300 p-4 shadow-lg dark:border-zinc-700",G>0&&(0,d.iA)({color:"red"}),G>0&&(0,d.xU)({color:"red"})),children:[(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)("h3",{className:(0,S.m)("text-sm font-bold leading-6 text-zinc-700 dark:text-zinc-300",G>0&&"text-red-900/80 dark:text-red-100"),children:es}),(0,i.jsx)("p",{className:(0,S.m)("text-sm text-zinc-500 dark:text-zinc-400",G>0&&"text-red-800/80 dark:text-red-100/60"),children:e.printerRail.axisDescription})]}),(0,i.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[eu&&(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Motor Slot",options:eu,error:null===(k=e.errors)||void 0===k?void 0:null===(j=k.motorSlot)||void 0===j?void 0:j._errors.join("\n"),onSelect:e=>{Z(e.id)},value:X?eu.find(e=>e.id===X):void 0,badge:ec})}),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Driver",options:eo,onSelect:U,value:Y,disabled:null!=W,badge:[null!=W?{children:"Integrated",color:"sky"}:void 0,z?{children:"Toolboard",color:"yellow"}:void 0].filter(Boolean)})}),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Stepper",options:en,onSelect:q,value:V})}),(0,i.jsx)("div",{className:"col-span-1",children:(0,i.jsx)(t.Lt,{label:"Voltage",options:K,onSelect:ee,value:$})}),(0,i.jsx)("div",{className:"col-span-1",children:(0,i.jsx)(s.o,{type:"number",label:"Current",value:er,onChange:el,inputMode:"decimal",step:"any",min:0,max:Y.maxCurrent})}),V.maxPeakCurrent/1.41<er&&(0,i.jsxs)(u.j,{Icon:m,color:"yellow",title:"Stepper overcurrent!",className:"col-span-2",children:["Your stepper motor is rated for ",Math.floor(100*V.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",er,"A."]}),null!=ea&&(0,i.jsx)(u.j,{Icon:c,color:"brand",title:"Driver tuning applied!",className:"col-span-2",children:"RatOS preset applied automatically."}),(null==ea?void 0:ea.run_current)!==(null==ei?void 0:ei.run_current)&&et&&!ed&&(0,i.jsxs)(u.j,{Icon:p,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-2",children:["RatOS has a recommended preset for your current settings at ",et.run_current,"A. You can"," ",(0,i.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>el(et.run_current),children:["change the current to ",et.run_current,"A"]})," ","to apply the preset automatically."]})]})]},e.printerRail.axis)})}}}]);
//# sourceMappingURL=3867-ba1755fe1491a9d0.js.map