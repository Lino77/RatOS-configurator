(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7668,2745],{65660:function(){},98948:function(e,r,t){"use strict";t.d(r,{j:function(){return getLogger}});var a=t(74958),n=t.n(a),o=t(75061),s=t(10187),i=t(31354);let send=async function(e,r){s.u.clientLog.mutate({level:e,logEvent:i.s.parse(r)})},l=null,getLogger=()=>null!=l?l:l=n()({...o.N,browser:{transmit:{send}}})},97060:function(e,r,t){"use strict";t.d(r,{N:function(){return useDebounce}});var a=t(39164);let useDebounce=function(e,r){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(0,a.useRef)(),o=(0,a.useRef)([]);return(0,a.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]),(0,a.useCallback)(function(){for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];if(o.current=s,n.current){if(!t)return;clearTimeout(n.current),n.current=void 0}n.current=setTimeout(()=>{e(...o.current),n.current=void 0},r)},[r,t,e])}},9186:function(e,r,t){"use strict";t.d(r,{v:function(){return MacroForm}});var a=t(72612),n=t(16195),o=t(65523),s=t(8058),i=t(31517),l=t(95106),c=t(84481),d=t(93760),u=t(94809),f=t(69047),p=t(41573),x=t(39164),m=t(64929);let h=x.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("textarea",{className:(0,m.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground","focus:border-brand-400/70 focus:outline-none focus:ring-1 focus:ring-transparent disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n})});(0,m.h)(h,"Textarea");var g=t(73918);let b=(0,g.j)(["relative rounded-lg p-4 bg-white dark:bg-zinc-900/60","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-xl dark:before:-mt-2.5","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_rgba(0,_0,_0,_0.20),_0px_1px_0px_0px_rgba(255,_255,_255,_0.09)_inset]"]),Fieldset=e=>(0,a.jsx)("fieldset",{...e,className:b({className:e.className}),children:e.children});var v=t(39634),_=t(88192),w=t(43955),y=t(5506);let k=x.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(y.fC,{className:(0,m.cn)("peer relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-all data-[state=checked]:bg-brand-400/80 data-[state=unchecked]:bg-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50","dark:before:pointer-events-none dark:before:absolute dark:before:-inset-[2px] dark:before:rounded-full dark:before:transition-all","dark:before:shadow-[0px_-1px_0px_0px_hsl(var(--zinc-400)_/_15%)_inset,_inset_0px_1px_2px_0px_rgba(0,0,0,0.55)]","data-[state=checked]:dark:before:shadow-[inset_0px_-1px_0px_0px_hsl(var(--brand-200)_/_50%),_inset_0px_1px_2px_0px_rgba(0,0,0,0.55)]",t),...n,ref:r,children:(0,a.jsx)(y.bU,{className:(0,m.cn)("pointer-events-none block h-4 w-4 rounded-full bg-zinc-800 shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.03)]","dark:before:inset-px dark:before:rounded-full","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--zinc-900)),_0px_1px_0px_0px_hsl(var(--zinc-400)_/_20%)_inset]")})})});(0,m.h)(k,y.fC.displayName);var j=t(50091),N=t(4480),z=t(71576),S=t(34709),C=t(43310),R=t(72302),M=t(39762),O=t(73790),F=t(90077),E=t(20324);let ResizablePanelGroup=e=>{let{className:r,...t}=e;return(0,a.jsx)(E.eh,{className:(0,m.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",r),...t})},P=E.s_,ResizableHandle=e=>{let{withHandle:r,className:t,...n}=e;return(0,a.jsx)(E.OT,{className:(0,m.cn)("relative flex w-px items-center justify-center bg-zinc-400/20 after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...n,children:r&&(0,a.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:(0,a.jsx)(F.W1P,{className:"h-2.5 w-2.5"})})})};var T=t(29817),A=t(30742),D=t(68995),I=t(77579),q=t(86736),L=t.n(q);D.SciChartSurface.configure({wasmUrl:"/configure/scichart2d.wasm",dataUrl:"/configure/scichart2d.data"});let MacroChartPreview=e=>{var r;let{sequences:t}=e,n=null!==(r=null==t?void 0:t.map(e=>{var r;return(null===(r=e.recording)||void 0===r?void 0:r.capturePSD)?{accel:e.recording.accelerometer,color:e.recording.color,name:e.name}:null}).filter(Boolean))&&void 0!==r?r:[],o=(0,x.useRef)(n),s=(0,x.useCallback)(e=>{if(2===n.length){var r,t,a,o,s,i;let l=10*Math.random()*50+184,c=10*Math.random()*400+900,d=10*Math.random()*50+184,u=10*Math.random()*400+900,f=2+3*Math.random(),p=2+3*Math.random(),x=new D.FastBandRenderableSeries(e.webAssemblyContext2D,{dataSeries:new D.XyyDataSeries(e.webAssemblyContext2D,{containsNaN:!1,isSorted:!0,xValues:Array(130).fill(0).map((e,r)=>200/130*r),yValues:Array(130).fill(0).map((e,r)=>Math.max(0,r<50&&r>25||r>70?(140-r)*5*(Math.cos(r/f)*l+c):30*r*(Math.sin(r/f)*l+c))),y1Values:Array(130).fill(0).map((e,r)=>Math.max(0,r<50&&r>25||r>70?(140-r)*5*(Math.cos(r/p)*d+u):10*r*(Math.sin(r/p)*d*3+u)))}),fill:w.DN[null!==(r=n[1].color)&&void 0!==r?r:"sky"][600]+22,fillY1:w.DN[null!==(t=n[0].color)&&void 0!==t?t:"rose"][600]+22,stroke:w.DN[null!==(a=n[0].color)&&void 0!==a?a:"rose"][400],strokeY1:w.DN[null!==(o=n[1].color)&&void 0!==o?o:"sky"][400],strokeThickness:3,yAxisId:T.ck});x.rolloverModifierProps.tooltipColor=null!==(s=n[0].color)&&void 0!==s?s:"zinc",x.rolloverModifierProps.tooltipTitle=n[0].name+" Power",x.rolloverModifierProps1.tooltipColor=null!==(i=n[1].color)&&void 0!==i?i:"zinc",x.rolloverModifierProps1.tooltipTitle=n[1].name+" Power",x.animation=new D.WaveAnimation({duration:500}),e.renderableSeries.add(x)}else n.forEach(r=>{var t,a;let n=1e3*Math.random()*50+184,o=1e3*Math.random()*400+900,s=2+3*Math.random(),i=new D.FastLineRenderableSeries(e.webAssemblyContext2D,{dataSeries:new D.XyDataSeries(e.webAssemblyContext2D,{containsNaN:!1,isSorted:!0,xValues:Array(130).fill(0).map((e,r)=>200/130*r),yValues:Array(130).fill(0).map((e,r)=>Math.max(0,r<50&&r>25||r>70?(140-r)*5*(Math.cos(r/s)*n+o):30*r*(Math.sin(r/s)*n+o)))}),stroke:w.DN[null!==(t=r.color)&&void 0!==t?t:"brand"][400],strokeThickness:3,yAxisId:T.ck});i.rolloverModifierProps.tooltipColor=null!==(a=r.color)&&void 0!==a?a:"zinc",i.rolloverModifierProps.tooltipTitle=r.name+" Power",i.animation=new D.WaveAnimation({duration:500}),e.renderableSeries.add(i)});let l=e.yAxes.getById(T.ck);if(l){let r=new D.NumberRange(0,0);e.renderableSeries.asArray().forEach(e=>{r=r.union(e.getYRange(e.getXRange(),!1))}),r=r.growBy(new D.NumberRange(0,.1)),l.visibleRange=r}e.chartModifiers.add(new D.RolloverModifier({showRolloverLine:!0,showTooltip:!1,yAxisId:T.ck})),e.chartModifiers.add(new D.CursorModifier({crosshairStroke:w.DN.sky[400],crosshairStrokeThickness:1,showXLine:!0,showYLine:!0,tooltipLegendTemplate:T.to,tooltipLegendOffsetX:16,tooltipLegendOffsetY:16,yAxisId:T.ck,showTooltip:!1,axisLabelFill:w.DN.zinc[900],axisLabelStroke:w.DN.zinc[100]}))},[n]),i=(0,A.Q8)(T.OH,s);return(0,x.useEffect)(()=>{if(0!=n.length&&!1===L()(n,o.current)){if(i.surface.current){var e,r;null===(e=i.surface.current)||void 0===e||e.renderableSeries.clear(),null===(r=i.surface.current)||void 0===r||r.chartModifiers.clear(),s(i.surface.current),i.surface.current.invalidateElement()}o.current=n}},[i.surface,n,s]),(0,a.jsx)(I.iB,{...i.forwardProps,className:"flex-1"})};var X=t(48789);let V=Object.keys(w.DN).map(e=>({label:e,value:e,color:w.DN[e][500]})),MacroSequence=e=>{let{value:r,children:t}=e,n=(0,C.o)(),o=(0,x.useCallback)(e=>{var r,t;["input","textarea"].includes(null===(t=e.target)||void 0===t?void 0:null===(r=t.tagName)||void 0===r?void 0:r.toLowerCase())||(e.stopPropagation(),e.preventDefault(),n.start(e))},[n]);return(0,a.jsx)(R.t.Item,{as:"div",className:"grid w-full items-start gap-6",dragListener:!1,dragControls:n,value:r,exit:{opacity:0,scale:1,y:-10,transition:{duration:.2}},initial:{opacity:0,scale:1,y:-10},animate:{opacity:1,scale:1,y:0,transition:{delay:.2,staggerChildren:.2}},children:(0,a.jsx)(Fieldset,{className:"grid gap-6 p-4",onPointerDown:o,children:t})})},useFormValues=()=>{let{getValues:e}=(0,N.Gc)();return{...(0,N.qo)(),...e()}},MacroForm=e=>{var r;let{form:t,submit:m,isNew:g}=e,b=(0,x.useMemo)(()=>[{label:"Control Board",value:"controlboard",description:"Record data with an ADXL345 connected to the main control board",icon:n.Z},{label:"Host",value:"rpi",description:"Record data with an ADXL345 connected to the Raspberry Pi or other host computer",icon:o.Z},{label:"Tool Board T0",value:"toolboard_t0",description:"Record data with an ADXL345 on the toolboard on toolhead T0",icon:s.Z},{label:"Tool Board T1",value:"toolboard_t1",description:"Record data with an ADXL345 on the toolboard on toolhead T1",icon:s.Z},{label:"Beacon",value:"beacon",description:"Record data with the Beacon accelerometer",icon:i.Z}],[]),w=(0,N.Dq)({control:t.control,name:"sequences",keyName:"key",shouldUnregister:!0}),y=(0,x.useCallback)(e=>{e.forEach((e,r)=>w.update(r,e))},[w]),C=useFormValues();if(null!=w.fields)return(0,a.jsxs)("div",{className:"flex max-h-[calc(100vh_-_56px)] min-h-full w-full flex-col",children:[(0,a.jsxs)("header",{className:"sticky top-14 z-10 flex flex-grow-0 items-center gap-1 border-b border-zinc-100/10 bg-zinc-700/25 px-4 py-4 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(j.Wi,{control:t.control,name:"name",render:e=>{let{field:r}=e;return(0,a.jsxs)(j.xJ,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(j.NI,{className:"flex flex-1",children:(0,a.jsx)(f.I,{className:"dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-xl font-medium focus:ring-0 focus:ring-offset-0",type:"text",autoComplete:"off","aria-autocomplete":"none",autoCapitalize:"on",placeholder:"Enter macro name...",...r})}),(0,a.jsx)(j.zG,{})]})}}),(0,a.jsx)(j.Wi,{control:t.control,name:"description",render:e=>{let{field:r}=e;return(0,a.jsxs)(j.xJ,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(j.NI,{className:"flex flex-1",children:(0,a.jsx)(f.I,{placeholder:"Enter a description...",autoComplete:"off","aria-autocomplete":"none",autoCapitalize:"off",className:"font-regular dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-base text-muted-foreground focus:ring-0 focus:ring-offset-0 dark:text-muted-foreground",...r})}),(0,a.jsx)(j.zG,{})]})}})]}),(0,a.jsx)("div",{className:"ml-auto flex flex-row flex-nowrap items-center gap-2",children:(0,a.jsxs)(u.z,{variant:"primary",size:"sm",className:"ml-auto text-sm",onClick:m,disabled:!t.formState.isDirty,children:[(0,a.jsx)(l.Z,{className:"size-3.5"}),g?"Create":"Save"]})})]}),(0,a.jsxs)(ResizablePanelGroup,{direction:"horizontal",className:"flex max-h-full flex-1",children:[(0,a.jsx)(P,{defaultSize:35,className:"flex",minSize:20,children:(0,a.jsxs)(X.l,{className:"flex-1 overflow-y-scroll p-4",children:[(0,a.jsx)(R.t.Group,{axis:"y",as:"div",className:"relative flex flex-col items-start gap-4",values:null!==(r=w.fields)&&void 0!==r?r:[],onReorder:y,children:w.fields.map((e,r)=>{var n,o,s,i,l;return(0,a.jsx)(MacroSequence,{value:e,children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("legend",{className:"-ml-1 px-1 text-sm font-medium",children:null!==(i=null!==(s=null===(n=C.sequences[r])||void 0===n?void 0:n.name)&&void 0!==s?s:e.name)&&void 0!==i?i:"Sequence ".concat(r+1)}),(0,a.jsx)("div",{className:"absolute -right-2 -top-5",children:(0,a.jsx)(u.z,{variant:"danger",size:"icon-xs",onClick:()=>w.remove(r),children:(0,a.jsx)(c.Z,{className:"size-3"})})}),(0,a.jsx)("input",{type:"hidden",...t.register("sequences.".concat(r,".id"))}),(0,a.jsx)("div",{className:"grid gap-3",children:(0,a.jsx)(j.Wi,{control:t.control,name:"sequences.".concat(r,".name"),render:e=>{let{field:r}=e;return(0,a.jsxs)(j.xJ,{children:[(0,a.jsx)(j.lX,{className:"text-base",children:"Sequence name"}),(0,a.jsx)(j.NI,{children:(0,a.jsx)(f.I,{type:"text",...r})}),(0,a.jsx)(j.zG,{})]})}})}),(0,a.jsx)("div",{className:"grid gap-3",children:(0,a.jsx)(j.Wi,{control:t.control,name:"sequences.".concat(r,".gcode"),render:e=>{let{field:r}=e;return(0,a.jsxs)(j.xJ,{children:[(0,a.jsx)(j.lX,{className:"text-base",children:"G-code"}),(0,a.jsx)(j.NI,{children:(0,a.jsx)(h,{id:"temperature",placeholder:"; Example \nOSCILLATE FREQ=60 TIME=1",...r})}),(0,a.jsx)(j.zG,{})]})}})}),(0,a.jsxs)("div",{className:"grid gap-3 rounded-lg border p-4 @container",children:[(0,a.jsx)(j.Wi,{control:t.control,name:"sequences.".concat(r,".recording.capturePSD"),render:e=>{let{field:r}=e;return(0,a.jsxs)(j.xJ,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(j.lX,{className:"text-base",children:"Record resonances"}),(0,a.jsx)(j.pf,{className:"font-medium",children:"Enable the calculation and persistence of power spectral density."})]}),(0,a.jsx)(j.NI,{children:(0,a.jsx)(k,{checked:r.value,onCheckedChange:r.onChange})}),(0,a.jsx)(j.zG,{})]})}}),(0,a.jsx)(S.i,{children:(0,a.jsx)(M.M,{children:(null===(o=e.recording)||void 0===o?void 0:o.capturePSD)&&(0,a.jsxs)(O.E.div,{exit:{opacity:0,scale:1,y:-10,transition:{duration:.2}},initial:{opacity:0,scale:1,y:-10},animate:{opacity:1,scale:1,y:0,transition:{delay:.2,staggerChildren:.2}},className:"grid gap-3 @xs:grid-cols-2",children:[(0,a.jsx)(j.Wi,{control:t.control,name:"sequences.".concat(r,".recording.accelerometer"),render:e=>{let{field:r}=e;return(0,a.jsxs)(j.xJ,{children:[(0,a.jsx)(j.lX,{children:"Accelerometer"}),(0,a.jsx)(j.NI,{children:(0,a.jsxs)(p.Ph,{onValueChange:r.onChange,value:r.value,children:[(0,a.jsx)(p.i4,{id:"model",className:"items-start [&_[data-description]]:hidden",children:(0,a.jsx)(p.ki,{placeholder:"Select an accelerometer..."})}),(0,a.jsx)(p.Bw,{children:b.map(e=>{let{label:r,value:t,icon:n,description:o}=e;return(0,a.jsx)(p.Ql,{value:t,children:(0,a.jsxs)("div",{className:"flex items-start gap-1 text-muted-foreground",children:[(0,a.jsx)(n,{className:"size-5 shrink-0"}),(0,a.jsxs)("div",{className:"grid gap-0.5",children:[(0,a.jsx)("p",{children:(0,a.jsx)("span",{className:"font-medium text-foreground",children:r})}),(0,a.jsx)("p",{className:"text-sm","data-description":!0,children:o})]})]})},r)})})]})}),(0,a.jsx)(j.zG,{})]})}}),(0,a.jsx)(j.Wi,{control:t.control,name:"sequences.".concat(r,".recording.color"),render:e=>{let{field:r}=e;return(0,a.jsxs)(j.xJ,{children:[(0,a.jsx)(j.lX,{children:"Sequence Color"}),(0,a.jsx)(j.NI,{children:(0,a.jsxs)(p.Ph,{onValueChange:r.onChange,value:r.value,children:[(0,a.jsx)(p.i4,{id:"sequence-color",className:"items-start",children:(0,a.jsx)(p.ki,{placeholder:"Select a color..."})}),(0,a.jsx)(p.Bw,{children:V.map(e=>{let{label:r,color:t,value:n}=e;return(0,a.jsx)(p.Ql,{value:n,children:(0,a.jsxs)("div",{className:"flex items-start gap-2 text-muted-foreground",children:[(0,a.jsx)("div",{className:"size-5 rounded",style:{backgroundColor:t}}),(0,a.jsx)("div",{className:"grid gap-0.5",children:(0,a.jsx)("p",{children:(0,a.jsx)("span",{className:"font-medium capitalize text-foreground",children:r})})})]})},n)})})]})}),(0,a.jsx)(j.zG,{})]})}})]})})})]})]})},null!==(l=e.id)&&void 0!==l?l:e.key)})}),(0,a.jsxs)(u.z,{variant:"outline",className:"mt-4 w-full justify-center text-center",onClick:()=>{let e={gcode:"",name:"Sequence ".concat(w.fields.length),recording:{capturePSD:!1},id:z.Z()};w.append(e)},children:[(0,a.jsx)(d.Z,{className:"flex size-4"}),(0,a.jsx)("span",{children:"Add new sequence"})]})]})}),(0,a.jsx)(ResizableHandle,{withHandle:!0}),(0,a.jsx)(P,{className:"mt-[9px] flex p-4",defaultSize:65,minSize:20,children:(0,a.jsxs)(_.Card,{className:"sticky top-0 flex min-h-72 w-full flex-1",children:[(0,a.jsx)(v.Ct,{color:"sky",className:"absolute right-3 top-3",children:"Graph Example Preview"}),(0,a.jsx)("div",{className:"flex flex-1",children:(0,a.jsx)(MacroChartPreview,{sequences:C.sequences})})]})})]})]})}},34709:function(e,r,t){"use strict";t.d(r,{i:function(){return AnimatedContainer}});var a=t(72612),n=t(97060),o=t(99699),s=t(73790),i=t(39164),l=t(63278);let AnimatedContainer=e=>{let[r,t]=(0,i.useState)(0),c=(0,i.useRef)(r);c.current=r;let[d,u]=(0,i.useState)(!1),f=(0,i.useRef)(d);f.current=d;let p=(0,i.useRef)(null);(0,o.Z)(p,e=>{e.contentRect.height!==c.current&&t(e.contentRect.height)});let x=(0,n.N)((0,i.useCallback)(()=>{u(!0)},[]),200,!0),m=(0,n.N)((0,i.useCallback)(()=>{u(!1)},[]),200,!0);return(0,a.jsx)(s.E.div,{className:(0,l.m6)(d?"overflow-visible":"overflow-hidden",e.containerClassName),style:{height:r},onAnimationComplete:x,onAnimationStart:m,animate:{height:r},children:(0,a.jsx)("div",{ref:p,className:e.className,children:e.children})})}},94809:function(e,r,t){"use strict";t.d(r,{d:function(){return f},z:function(){return p}});var a=t(72612),n=t(82157),o=t.n(n),s=t(63278),i=t(39164),l=t(73918),c=t(3496),d=t(44649),u=t(35088);let f=(0,l.j)("inline-flex items-center justify-center border font-semibold rounded-md shadow-sm focus:outline-none focus:ring-2 capitalize relative active:translate-y-px active:scale-[99%] active:outline-none transition-all",{variants:{variant:{danger:(0,s.dV)("text-red-50 bg-red-500/70 hover:bg-red-600 border-transparent focus:ring-offset-2 focus:ring-red-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--red-900)),_0px_1px_0px_0px_hsl(var(--red-400)_/_50%)_inset]"),warning:(0,s.dV)("text-yellow-50 bg-yellow-400/70 hover:bg-yellow-600 border-transparent focus:ring-offset-2 focus:ring-yellow-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--yellow-900)),_0px_1px_0px_0px_hsl(var(--yellow-400)_/_50%)_inset]"),info:(0,s.dV)("text-blue-50 bg-sky-400/70 hover:bg-sky-600 border-transparent focus:ring-offset-2 focus:ring-sky-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--sky-900)),_0px_1px_0px_0px_hsl(var(--sky-400)_/_50%)_inset]"),primary:(0,s.dV)("text-white bg-brand-400/50 hover:bg-brand-700 border-transparent focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--brand-900)),_0px_1px_0px_0px_hsl(var(--brand-400)_/_50%)_inset]"),success:"text-green-100 bg-green-500 hover:bg-green-600 border-transparent focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900",indeterminate:(0,s.dV)("border-transparent bg-zinc-100 hover:bg-zinc-200 text-black dark:text-zinc-300 dark:bg-zinc-800 dark:transparent dark:hover:bg-zinc-700 dark:hover:text-zinc-100 dark:hover:transparent focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-lg","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_hsl(var(--zinc-900)),_0px_1px_0px_0px_hsl(var(--zinc-400)_/_20%)_inset]"),outline:"border-zinc-700 shadow-none bg-transparent text-zinc-700 dark:text-zinc-300 hover:bg-zinc-500/30 hover:border-zinc-500/50 hover:text-zinc-800 dark:hover:text-zinc-200 focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900",plain:"border-transparent shadow-none bg-transparent text-zinc-700 dark:text-zinc-300 hover:underline hover:text-zinc-800 dark:hover:text-zinc-200 focus:ring-offset-2 focus:ring-brand-400 dark:focus:ring-offset-zinc-900"},disabled:{true:"opacity-60 cursor-not-allowed"},size:{sm:"px-2 py-1 text-xs gap-2",lg:"px-6 py-3 text-lg gap-4",default:"px-3 py-2 text-sm gap-2",icon:"h-9 w-9","icon-sm":"h-6 w-6","icon-xs":"h-4 w-4"}},compoundVariants:[{variant:"primary",disabled:!0,class:"hover:bg-brand-400/50"},{variant:"danger",disabled:!0,class:"hover:bg-red-500/70"},{variant:"warning",disabled:!0,class:"hover:bg-yellow-500"},{variant:"indeterminate",disabled:!0,class:"hover:bg-zinc-100 dark:hover:bg-zinc-800"},{variant:"info",disabled:!0,class:"hover:bg-sky-400/70"}],defaultVariants:{variant:"primary",size:"default",disabled:!1}}),p=(0,i.forwardRef)(function(e,r){let{variant:t,disabled:n,size:l,href:p,target:x,onClick:m,title:h,rel:g,dropdownItems:b,className:v,children:_,...w}=e,y=(0,s.m6)(f({variant:t,disabled:n,size:l}),v);return p?(0,a.jsx)(o(),{href:p,ref:r,className:y,target:x,onClick:m,title:h,rel:g,children:_}):b&&b.length&&null==m?(0,a.jsxs)(c.v,{as:"span",className:"relative inline-block text-left",children:[(0,a.jsxs)(c.v.Button,{className:y,title:h,disabled:!!n,children:[_,(0,a.jsx)(u,{className:"-mr-2 h-5 w-5","aria-hidden":"true"})]}),(0,a.jsx)(d.u,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsx)(c.v.Items,{className:"absolute right-0 z-10 mt-2 w-56 origin-top-right divide-y divide-zinc-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:divide-zinc-800 dark:bg-zinc-900 dark:shadow-black dark:ring-zinc-800",children:b.map(e=>(0,a.jsx)("div",{className:"py-1",children:(0,a.jsx)(c.v.Item,{children:r=>{let{active:t}=r;return(0,a.jsx)("span",{onClick:e.onClick,className:(0,s.dV)(t?"bg-zinc-100 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-100":"text-zinc-700 dark:text-zinc-300","block cursor-pointer break-words px-4 py-2 text-sm"),children:e.title})}})},e.title))})})]}):(0,a.jsx)("button",{ref:r,className:y,onClick:n?void 0:m,title:h,...w,children:_})})},88192:function(e,r,t){"use strict";t.r(r),t.d(r,{Card:function(){return Card}});var a=t(72612),n=t(73918);t(39164);var o=t(73790);let s=(0,n.j)(["relative rounded-lg  bg-white dark:bg-zinc-900/60","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-xl","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_rgba(0,_0,_0,_0.20),_0px_1px_0px_0px_rgba(255,_255,_255,_0.07)_inset]"]),Card=e=>(0,a.jsx)(o.E.div,{...e,className:s({className:e.className}),children:e.children})},48789:function(e,r,t){"use strict";t.d(r,{Z:function(){return o},l:function(){return ScrollContainer}});var a=t(72612),n=t(63278);let o="scroll-smooth scrollbar-thin scrollbar-track-zinc-800/15 scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",ScrollContainer=e=>(0,a.jsx)("div",{...e,className:(0,n.m6)(o,e.className)})},50091:function(e,r,t){"use strict";t.d(r,{NI:function(){return h},Wi:function(){return FormField},l0:function(){return u},lX:function(){return m},pf:function(){return g},xJ:function(){return x},zG:function(){return b}});var a=t(72612),n=t(39164),o=t(21137),s=t(4480),i=t(64929),l=t(89610),c=t(39762),d=t(73790);let u=s.RV,f=n.createContext({}),FormField=e=>{let{...r}=e;return(0,a.jsx)(f.Provider,{value:{name:r.name},children:(0,a.jsx)(s.Qr,{...r})})},useFormField=()=>{let e=n.useContext(f),r=n.useContext(p),{getFieldState:t,formState:a}=(0,s.Gc)(),o=t(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=r;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...o}},p=n.createContext({}),x=n.forwardRef((e,r)=>{let{className:t,...o}=e,s=n.useId();return(0,a.jsx)(p.Provider,{value:{id:s},children:(0,a.jsx)("div",{ref:r,className:(0,i.cn)("space-y-2",t),...o})})});(0,i.h)(x,"FormItem");let m=n.forwardRef((e,r)=>{let{className:t,...n}=e,{error:o,formItemId:s}=useFormField();return(0,a.jsx)(l._,{ref:r,className:(0,i.cn)(o&&"text-destructive",t),htmlFor:s,...n})});(0,i.h)(m,"FormLabel");let h=n.forwardRef((e,r)=>{let{...t}=e,{error:n,formItemId:s,formDescriptionId:i,formMessageId:l}=useFormField();return(0,a.jsx)(o.g7,{ref:r,id:s,"aria-describedby":n?"".concat(i," ").concat(l):"".concat(i),"aria-invalid":!!n,...t})});(0,i.h)(h,"FormControl");let g=n.forwardRef((e,r)=>{let{className:t,...n}=e,{formDescriptionId:o}=useFormField();return(0,a.jsx)("p",{ref:r,id:o,className:(0,i.cn)("text-[0.8rem] font-medium text-muted-foreground",t),...n})});(0,i.h)(g,"FormDescription");let b=n.forwardRef((e,r)=>{let{className:t,children:n,...o}=e,{error:s,formMessageId:l}=useFormField(),u=s?String(null==s?void 0:s.message):n;return u?(0,a.jsx)(c.M,{children:(0,a.jsx)(d.E.p,{exit:{opacity:0,scale:1,y:-10,transition:{duration:.2}},initial:{opacity:0,scale:1,y:-10},animate:{opacity:1,scale:1,y:0,transition:{delay:.2,staggerChildren:.2}},ref:r,id:l,...o,className:(0,i.cn)("text-[0.8rem] font-medium text-destructive",t),children:u})}):null});(0,i.h)(b,"FormMessage")},69047:function(e,r,t){"use strict";t.d(r,{I:function(){return c}});var a=t(72612),n=t(39164),o=t(64929),s=t(73918),i=t(63278);let l=(0,s.j)((0,i.dV)("flex w-full rounded-md border bg-transparent px-3 py-1.5 text-sm shadow-sm transition-colors","file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground","border-zinc-300 text-zinc-900 placeholder-zinc-300 ring-brand-600 dark:border-zinc-100/20 dark:text-zinc-100 dark:placeholder-zinc-100/30 dark:focus:ring-brand-400 ","focus:ring-offset-zinc-900 block w-full rounded-md border text-left shadow-sm ring-inset ring-offset-zinc-900 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2","active:translate-y-px active:scale-[99%] active:outline-none active:ring-2 active:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50"),{variants:{variant:{plain:"shadow-none bg-transparent text-zinc-700 dark:text-zinc-300 dark:bg-transparent",default:"dark:bg-zinc-800 bg-white",error:"border-red-300 text-red-900 placeholder-red-300 ring-red-500 dark:ring-red-500 dark:text-red-400 dark:placeholder-red-700"}},defaultVariants:{variant:"plain"}}),c=n.forwardRef((e,r)=>{let{className:t,type:n,...s}=e;return(0,a.jsx)("input",{type:n,className:(0,o.cn)(l(s),t),ref:r,...s})});(0,o.h)(c,"Input")},89610:function(e,r,t){"use strict";t.d(r,{_:function(){return c}});var a=t(72612),n=t(39164),o=t(53093),s=t(73918),i=t(64929);let l=(0,s.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(o.f,{ref:r,className:(0,i.cn)(l(),t),...n})});(0,i.h)(c,o.f.displayName)},41573:function(e,r,t){"use strict";t.d(r,{Bw:function(){return p},Ph:function(){return l},Ql:function(){return m},i4:function(){return d},ki:function(){return c}});var a=t(72612),n=t(39164),o=t(90077),s=t(18633),i=t(64929);let l=s.fC;s.ZA;let c=s.B4,d=n.forwardRef((e,r)=>{let{className:t,children:n,...l}=e;return(0,a.jsxs)(s.xz,{ref:r,className:(0,i.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-brand-400/80 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1","[&[data-placeholder]]:text-muted-foreground",t),...l,children:[n,(0,a.jsx)(s.JO,{asChild:!0,children:(0,a.jsx)(o.jnn,{className:"h-4 w-4 opacity-50"})})]})});(0,i.h)(d,s.xz.displayName);let u=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(s.u_,{ref:r,className:(0,i.cn)("absolute left-0 right-0 top-0 z-[60] flex h-9 cursor-default items-center justify-center bg-popover py-1",t),...n,children:(0,a.jsx)(o.g8U,{className:"size-6"})})});(0,i.h)(u,s.u_.displayName);let f=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(s.$G,{ref:r,className:(0,i.cn)("absolute bottom-0 left-0 right-0 z-[60] flex h-9 cursor-default items-center justify-center bg-popover py-1",t),...n,children:(0,a.jsx)(o.v4q,{className:"size-6"})})});(0,i.h)(f,s.$G.displayName);let p=n.forwardRef((e,r)=>{let{className:t,children:n,position:o="popper",...l}=e;return(0,a.jsx)(s.h_,{children:(0,a.jsxs)(s.VY,{ref:r,className:(0,i.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===o&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:o,...l,children:[(0,a.jsx)(u,{}),(0,a.jsx)(s.l_,{className:(0,i.cn)("p-1","popper"===o&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,a.jsx)(f,{})]})})});(0,i.h)(p,s.VY.displayName);let x=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(s.__,{ref:r,className:(0,i.cn)("px-2 py-1.5 text-sm font-semibold",t),...n})});(0,i.h)(x,s.__.displayName);let m=n.forwardRef((e,r)=>{let{className:t,children:n,...l}=e;return(0,a.jsxs)(s.ck,{ref:r,className:(0,i.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...l,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(s.wU,{children:(0,a.jsx)(o.nQG,{className:"h-4 w-4"})})}),(0,a.jsx)(s.eT,{children:n})]})});(0,i.h)(m,s.ck.displayName);let h=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(s.Z0,{ref:r,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",t),...n})});(0,i.h)(h,s.Z0.displayName)},75061:function(e,r,t){"use strict";t.d(r,{N:function(){return a}});let a={timestamp:!0,level:"info"}},10187:function(e,r,t){"use strict";t.d(r,{S:function(){return a.SX},u:function(){return a.uF}});var a=t(79293)},81446:function(e,r,t){"use strict";t.d(r,{X:function(){return getHost}});let getHost=()=>{var e;return""!="".trim()?"":(null===(e=window.location)||void 0===e?void 0:e.hostname)!=null?window.location.hostname:null}},96886:function(e,r,t){"use strict";t.d(r,{oK:function(){return useMoonraker},xH:function(){return useMoonrakerMutation},DS:function(){return useMoonrakerQuery},Fu:function(){return useMoonrakerState},A4:function(){return useNamespacedItemQuery},hS:function(){return usePrinterObjectQuery},Q:function(){return usePrinterObjectSubscription}});var a=t(39164),n=t(9948),o=t(65339),s=t(84634),i=t(81446);let l=[{version:1,description:"Undo double JSON encoding of RatOS's data",up:async()=>{let e=await window.fetch("http://".concat((0,i.X)(),"/server/database/item?namespace=RatOS"));if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,t]of Object.entries(r.result.value))try{let r=JSON.parse(t);console.log("Migrating",e,"from",t,"to",r),await window.fetch("http://".concat((0,i.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e,value:r})})}catch(r){console.error("Error migrating",e,t,"clearing key"),await window.fetch("http://".concat((0,i.X)(),"/server/database/item?namespace=RatOS&key=").concat(encodeURIComponent(e)),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e})});continue}return{result:"Succesfully decoded ".concat(t.length," keys.\n").concat(t.join("\n"))}}},down:async()=>{let e=await window.fetch("http://".concat((0,i.X)(),"/server/database/item?namespace=RatOS"));if(e.ok){let r=await e.json();if("error"in r)throw Error(r.error.message);if(null==r.result.value)return{result:"Nothing to migrate"};let t=[];for await(let[e,a]of Object.entries(r.result.value)){let r=JSON.stringify(a);await window.fetch("http://".concat((0,i.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:e,value:r})}),t.push("Re-encoded ".concat(e))}return{result:"Succesfully re-encoded ".concat(t.length," keys.\n").concat(t.join("\n"))}}return{result:"Nothing to migrate"}}},{version:2,description:"Change caramba printers to v-core-4 / v-chonk",up:async()=>{let e=await window.fetch("http://".concat((0,i.X)(),"/server/database/item?namespace=RatOS"));if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,a]of Object.entries(r.result.value))if("Printer"===e&&"string"==typeof a){let e=a.replace(/caramba-chonk/g,"v-chonk").replace(/caramba/g,"v-core-4");if(e===a)continue;await window.fetch("http://".concat((0,i.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"Printer",value:e})}),t.push("Migrated ".concat(a," to ").concat(e))}return{result:"Succesfully migrated ".concat(t.length," keys.\n").concat(t.join("\n"))}}},down:async()=>{let e=await window.fetch("http://".concat((0,i.X)(),"/server/database/item?namespace=RatOS"));if(!e.ok)return{result:"Nothing to migrate"};{let r=await e.json();if("error"in r)throw Error(r.error.message);let t=[];if(null==r.result.value)return{result:"Nothing to migrate"};for await(let[e,a]of Object.entries(r.result.value))if("Printer"===e&&"string"==typeof a){let e=a.replace(/v-chonk/g,"caramba-chonk").replace(/v-core-4/g,"caramba");if(e===a)continue;await window.fetch("http://".concat((0,i.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"Printer",value:e})}),t.push("Migrated ".concat(a," to ").concat(e))}return{result:"Succesfully migrated ".concat(t.length," keys.\n").concat(t.join("\n"))}}}}],getCurrentVersion=async()=>{let e=await window.fetch("http://".concat((0,i.X)(),"/server/database/item?namespace=RatOS&key=__db_version"));if(e.ok){let r=await e.json();return"error"in r?0:r.result.value}return 0},setCurrentVersion=async e=>{await window.fetch("http://".concat((0,i.X)(),"/server/database/item"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:"RatOS",key:"__db_version",value:e})})},c=!1,migrate=async(e,r)=>{if(c)return console.log("Already migrating, ignoring..");if(e===r)return console.log("Already at target version");c=!0;try{let t=l.filter(t=>t.version>e&&t.version<=r).sort((t,a)=>e<=r?t.version-a.version:a.version-t.version);for await(let a of t){let t=await (e<r?a.up():a.down());console.log("Migrated to version ".concat(a.version,": ").concat(t.result))}await setCurrentVersion(r)}finally{c=!1}},d=!1,migrateToLatest=async()=>{if(d)return console.log("Already migrated, ignoring..");let e=await getCurrentVersion(),r=Math.max(...l.map(e=>e.version));if(e===r){console.log("Already at latest version");return}if(c){console.log("Already migrating, ignoring..");return}console.log("Migrating to latest version...",e,r),await migrate(e,r),d=!0,console.log("Migration complete.")};var u=t(52540),f=t(86736),p=t.n(f),x=t(98948);let m=0,getWsURL=()=>{let e=(0,i.X)();return null==e||""==e.trim()?null:"ws://".concat(e,"/websocket")},h={},useMoonraker=e=>{let r=(0,a.useRef)({}),t=(0,a.useRef)({}),n=(0,a.useRef)([]),o=(0,a.useRef)([]),[i,l]=(0,a.useState)(getWsURL());(0,a.useEffect)(()=>{l(getWsURL())},[]);let c=(0,a.useCallback)(e=>{if("error"in e)return!1;if("notify_status_update"===e.method&&null!=e.params){let r=e.params[0];if(null!=r)for(let e of n.current){let t=h[e];if(null!=t){for(let e in t)if(null!=r[e])return!0}}}return!1},[]),{lastJsonMessage:d,sendJsonMessage:u,readyState:f}=(0,s.ZP)(i,{filter:t=>{if("connected"!==g)return!0;try{var a;let n=JSON.parse(t.data);if(null!=r.current[n.id]||(null==e?void 0:null===(a=e.passThroughUpdateMethods)||void 0===a?void 0:a.length)&&"method"in n&&e.passThroughUpdateMethods.includes(n.method))return!0}catch(e){(0,x.j)().warn({e,messageData:t.data},"Filter: Failed to parse message")}return!1},onMessage:r=>{if(null==e?void 0:e.onStatusUpdate)try{let a=JSON.parse(r.data);if(c(a)){var t;let r=a.params[0];null===(t=e.onStatusUpdate)||void 0===t||t.call(e,r)}}catch(e){(0,x.j)().warn({e,messageData:r.data},"OnMessage: Failed to parse message")}},shouldReconnect:e=>!0,reconnectAttempts:1/0,reconnectInterval:3e3,share:!0}),p=(0,a.useRef)(f);p.current=f;let[g,b]=(0,a.useState)(1===f?"connected":"connecting"),v=(0,a.useCallback)((e,r)=>{1===p.current?e():o.current.push({resolve:e,reject:r})},[]),_=(0,a.useCallback)(()=>new Promise((e,r)=>{v(e,r)}),[v]),w=(0,a.useCallback)(async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=++m;return await _(),new Promise((o,s)=>{r.current[n]=(e,r)=>e?s(e):r&&"object"==typeof r&&"error"in r&&r.error?s(r.error):null==r?s(Error("No result. Unknown response format.")):void o(r);let i=1e4;"printer.gcode.script"===e&&(i=6e5),t.current[n]=window.setTimeout(()=>{var e,a;null===(e=(a=r.current)[n])||void 0===e||e.call(a,Error("Request timed out"),null),delete r.current[n],delete t.current[n]},i),u({jsonrpc:"2.0",method:e,params:a,id:n})})},[_,u]),y=(0,a.useCallback)(async function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let a=Object.fromEntries(r.map(e=>[e,null])),o=Object.assign({},a,...Object.values(h).filter(e=>null!=e)),s=w("printer.objects.subscribe",{objects:o}),i=m;h[i]=a,n.current.push(i);let l=(await s).status;return{res:l,unsuscribe:async()=>{if(n.current=n.current.filter(e=>e!==i),null==h[i]){delete h[i];let e=Object.assign({},...Object.values(h).filter(e=>null!=e));await w("printer.objects.subscribe",{objects:e})}}}},[w]),k=(0,a.useCallback)(async(e,r,t)=>(await _(),await w("server.database.post_item",{namespace:e,key:r,value:t})),[w,_]),j=(0,a.useCallback)(async(e,r)=>{await _();try{var t;let a=await w("server.database.get_item",{namespace:e,key:r});return null!==(t=null==a?void 0:a.value)&&void 0!==t?t:null}catch(e){return(0,x.j)().warn(e),null}},[w,_]);return(0,a.useEffect)(()=>{1===f?(async()=>{await migrateToLatest(),o.current.forEach(e=>e.resolve()),o.current=[],b("connected")})():b("connecting")},[f]),(0,a.useEffect)(()=>{(null==d?void 0:d.id)&&r.current[d.id]&&(window.clearTimeout(t.current[d.id]),"error"in d?r.current[d.id](Error(d.error.message),null):r.current[d.id](null,d.result),delete t.current[d.id],delete r.current[d.id])},[d]),(0,a.useEffect)(()=>()=>{for(let e in t.current)delete t.current[e],delete r.current[e];if(n.current.length>0){n.current.forEach(e=>{delete h[e]}),n.current=[];let e=Object.assign({},...Object.values(h).filter(e=>null!=e));w("printer.objects.subscribe",{objects:Object.keys(e).length>0?e:null}).catch(e=>{})}o.current.forEach(e=>e.reject()),o.current=[]},[]),{query:w,saveItem:k,getItem:j,subscribeToObject:y,status:g,lastMessage:d,isReady:1===f}},useNamespacedItemQuery=(e,r,t)=>{let{getItem:a}=useMoonraker();return(0,n.a)({...t,queryKey:[e,r],queryFn:async()=>a(e,r)})},useMoonrakerQuery=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let{query:a}=useMoonraker(),o=3===r.length?r[2]:r[1],s=3===r.length?r[1]:void 0,i=r[0],l=3===r.length?[i,s]:[i];return(0,n.a)({...null!=o?o:{},queryKey:[r[0]],queryFn:async()=>a(...l)})},useMoonrakerMutation=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let{query:a}=useMoonraker(),n=r[1],s=r[0];return(0,o.D)({...n,mutationKey:[r[0]],mutationFn:async e=>{let r=e?[s,e]:[s];return a(...r)}})},usePrinterObjectQuery=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let{query:a}=useMoonraker();return(0,n.a)({queryKey:r,queryFn:async()=>{let e=Object.fromEntries(r.map(e=>[e,null]));return(await a("printer.objects.query",{objects:e})).status}})},usePrinterObjectSubscription=function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];let[o,s]=(0,a.useState)(null),i=(0,a.useRef)(o);i.current=o;let l=(0,a.useRef)(e);l.current=e;let c=(0,a.useCallback)(e=>{var r;return null==l.current?e:null===(r=l.current)||void 0===r?void 0:r.call(l,e)},[]),d=(0,a.useMemo)(()=>Object.fromEntries(t.map(e=>[e,null])),[JSON.stringify(t.sort())]),{subscribeToObject:f}=useMoonraker({onStatusUpdate:(0,a.useCallback)(e=>{let r={};for(let t in d)null!=e[t]&&(r[t]=e[t]);let t=c(r);if(null==t||"object"!=typeof t)throw Error("Invalid selection function, must return object, got "+typeof t);Object.keys(r).length>0&&!1===p()(t,i.current)&&s(e=>(0,u.T)(null!=e?e:{},t))},[c,d])});return(0,a.useEffect)(()=>{let e=f(...Object.keys(d));return e.then(e=>{s(c(e.res))}).catch(e=>{e instanceof Error&&(0,x.j)().error(e)}),()=>{e.then(e=>e.unsuscribe()).catch(e=>{e instanceof Error&&(0,x.j)().error(e)})}},[c,d,f]),o},useNamespacedItemMutation=(e,r,t)=>{let{saveItem:a}=useMoonraker();return(0,o.D)({...t,mutationKey:[e,r],mutationFn:t=>a(e,r,t)})},useMoonrakerState=function(e,r){var t;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=useNamespacedItemQuery(e,r,{initialData:n}),s=useNamespacedItemMutation(e,r),i=(0,a.useCallback)(async e=>{var r;let t="function"==typeof e?e(null!==(r=o.data)&&void 0!==r?r:n):e;await s.mutateAsync(t,{onSuccess:()=>{o.refetch()}})},[n,s,o]);return[null!==(t=o.data)&&void 0!==t?t:n,i,o,s]}},79293:function(e,r,t){"use strict";t.d(r,{SX:function(){return o},uF:function(){return s}});var a=t(67763),n=t(61863);function getBaseUrl(){return"/configure"}t(28070);let o=(0,n.t)({config:()=>({links:[(0,a.N8)({url:"".concat(getBaseUrl(),"/api/trpc"),maxURLLength:2083})]}),overrides:{useMutation:{async onSuccess(e){await e.originalFn(),await e.queryClient.invalidateQueries()}}},ssr:!1}),s=(0,a.K5)({links:[(0,a.N8)({url:"".concat(getBaseUrl(),"/api/trpc"),maxURLLength:2083})]})},31354:function(e,r,t){"use strict";t.d(r,{s:function(){return o}});var a=t(94594);let n=a.z.enum(["trace","debug","info","warn","error","fatal"]),o=a.z.object({ts:a.z.number(),messages:a.z.array(a.z.any()),bindings:a.z.array(a.z.record(a.z.string(),a.z.any())),level:a.z.object({label:n,value:a.z.number()})})}}]);
//# sourceMappingURL=7668-77378e57e76ba19a.js.map