"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5826],{45483:function(e,t,r){r.d(t,{B:function(){return ErrorMessage}});var a=r(72612),i=r(65826);r(39164);var n=r(63278),l=r(34471);let ErrorMessage=e=>(0,a.jsx)(l.j,{color:"red",Icon:i,title:e.title?"Error: "+e.title:"Error",className:(0,n.m6)(e.className,"whitespace-pre-wrap"),children:e.children})},8832:function(e,t,r){r.d(t,{I:function(){return FullLoadScreen}});var a=r(72612),i=r(98130),n=r(63278);let FullLoadScreen=e=>(0,a.jsx)("div",{className:(0,n.dV)("flex h-full w-full flex-1 items-center justify-center",e.className),children:(0,a.jsx)(i.$,{className:"h-8 w-8"})})},56445:function(e,t,r){r.r(t),r.d(t,{NoSSR:function(){return NoSSR}});var a=r(72612),i=r(91302),n=r(39164),l=r(8832);let NoSSR=e=>{var t;let r=(0,i.O)();return r?(0,a.jsx)(s,{children:e.children}):null!==(t=e.fallback)&&void 0!==t?t:(0,a.jsx)(l.I,{})},s=(0,n.lazy)(()=>Promise.resolve({default:e=>(0,a.jsx)(a.Fragment,{children:e.children})}))},3050:function(e,t,r){r.d(t,{wq:function(){return PrinterConnectionHeader},Ch:function(){return PrinterStateHeader}});var a=r(72612),i=r(63278),n=r(91302),l=r(39634),s=r(2750),o=r(96886),d=r(39164);let useKlippyStateHandler=()=>{let{query:e,lastMessage:t}=(0,o.oK)({passThroughUpdateMethods:["notify_klippy_ready","notify_klippy_shutdown","notify_klippy_disconnected"]}),[r,a]=(0,d.useState)("unknown"),i=(0,d.useCallback)(async()=>{if(null!=e)try{let t=await e("server.info");if((null==t?void 0:t.klippy_state)==null)return;let r=t.klippy_state;a(r),"startup"===r&&setTimeout(()=>{i()},2e3)}catch(e){a("unknown")}},[e,a]);return(0,d.useEffect)(()=>{null!=e&&i()},[e,i]),(0,d.useEffect)(()=>{t&&"method"in t&&"notify_klippy_ready"===t.method&&a("ready"),t&&"method"in t&&"notify_klippy_shutdown"===t.method&&a("shutdown"),t&&"method"in t&&"notify_klippy_disconnected"===t.method&&(a("unknown"),i())},[t,i,a]),r},klipperStateToText=e=>{switch(e){case"error":return"Klipper State: Error";case"ready":return"Klipper State: Ready";case"shutdown":return"Klipper State: Shutdown";case"startup":return"Klipper State: Startup";default:return"Klipper State: Unknown"}},KlippyStateBadge=e=>{let t=useKlippyStateHandler(),r="orange";switch(t){case"error":r="red";break;case"ready":r="brand";break;case"shutdown":case"unknown":default:r="orange";break;case"startup":r="yellow"}return(0,a.jsxs)(l.Ct,{color:r,title:klipperStateToText(t),children:[(0,a.jsx)("svg",{className:(0,i.dV)((0,l._1)({color:r}),"h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:(0,a.jsx)("circle",{cx:4,cy:4,r:3})}),"Klipper"]})},moonrakerStatusToText=e=>{switch(e){case"not-running":return"Moonraker State: Not Running";case"connected":return"Moonraker State: Connected";case"connecting":return"Moonraker State: Connecting";default:return"Moonraker State: Unknown"}},MoonrakerStateBadge=e=>{let{status:t}=(0,o.oK)(),r="orange";switch(t){case"not-running":r="red";break;case"connected":r="brand";break;case"connecting":r="yellow";break;default:r="orange"}return(0,a.jsxs)(l.Ct,{color:r,title:moonrakerStatusToText(t),children:[(0,a.jsx)("svg",{className:(0,i.dV)((0,l._1)({color:r}),"h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:(0,a.jsx)("circle",{cx:4,cy:4,r:3})}),"Moonraker"]})};var c=r(32342),u=r(96588);let PrinterHeader=e=>{var t;return(0,a.jsxs)("div",{className:"mt-6 @container",children:[(0,a.jsx)("div",{className:"border-t border-white/10 bg-zinc-700/15 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-7xl flex-row items-center justify-between gap-x-8 gap-y-4 px-4 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,a.jsx)("div",{className:(0,i.m6)("flex-none rounded-full bg-green-400/10 p-1 text-zinc-400",e.stateColorClass),children:(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-current"})}),(0,a.jsx)("h1",{className:"flex gap-x-3 text-base leading-7",children:null===(t=e.breadcrumb)||void 0===t?void 0:t.map((t,r)=>{var i,n;return(0,a.jsxs)(d.Fragment,{children:[(0,a.jsx)("span",{className:"font-semibold text-white",children:t}),r<(null!==(n=null===(i=e.breadcrumb)||void 0===i?void 0:i.length)&&void 0!==n?n:0)-1&&(0,a.jsx)("span",{className:"text-zinc-400",children:"/"})]},r)})})]}),(0,a.jsx)("div",{className:"capitalize",children:e.badges})]})}),(0,a.jsx)("header",{className:"sticky top-14 z-10 flex flex-grow-0 items-center gap-1 border-y border-b-white/10 border-t-white/5 bg-zinc-700/10 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"mx-auto w-full max-w-7xl gap-x-8 px-4 py-4",children:[(0,a.jsx)("h3",{className:"dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-xl font-medium focus:ring-0 focus:ring-offset-0",children:e.title}),(0,a.jsx)("p",{className:"dark:focus-ring-0 flex h-auto flex-1 border-none p-0 text-base font-medium text-muted-foreground focus:ring-0 focus:ring-offset-0 dark:text-muted-foreground",children:e.description})]})})]})},PrinterStateHeader=e=>{var t,r,p,m,x;let f=(0,s.PF)("general.printername",{initialData:"Loading..."}),v=(0,u.sJ)(c.Xu),g=(0,o.DS)("server.info"),h=(0,o.hS)("print_stats"),b=null===(t=h.data)||void 0===t?void 0:t.print_stats.state,y=(0,d.useMemo)(()=>{var e;let t=[null!==(e=f.data)&&void 0!==e?e:"RatOS"];return g.isLoading?t.push("Loading..."):(null==v?void 0:v.name)&&t.push(v.name),t},[g.isLoading,f.data,null==v?void 0:v.name]),k=(0,n.O)();return k?(0,a.jsx)(PrinterHeader,{stateColorClass:(0,i.dV)((null===(r=g.data)||void 0===r?void 0:r.klippy_state)==="error"&&"bg-red-400/10 text-red-400",(null===(p=g.data)||void 0===p?void 0:p.klippy_state)==="startup"&&"bg-amber-400/10 text-amber-400",(null===(m=g.data)||void 0===m?void 0:m.klippy_state)==="ready"&&"bg-green-400/10 text-green-400",(null===(x=g.data)||void 0===x?void 0:x.klippy_state)==="shutdown"&&"bg-red-400/10 text-red-400"),breadcrumb:y,badges:(0,a.jsx)(l.Ct,{className:"order-first capitalize @screen-sm:order-none",color:void 0===b?"gray":"canceled"==b?"pink":"complete"==b?"green":"error"==b?"red":"paused"===b?"sky":"printing"===b?"yellow":"standby"===b?"brand":"gray",children:void 0===b?"Offline":null!=b?b:"Loading..."}),title:e.title,description:e.description}):(0,a.jsx)(PrinterStateLoadingHeader,{})},PrinterConnectionHeader=e=>{var t,r,l,p;let m=(0,s.PF)("general.printername",{initialData:"Loading..."}),x=(0,u.sJ)(c.Xu),f=(0,o.DS)("server.info"),v=(0,n.O)(),g=(0,d.useMemo)(()=>{var e;let t=[null!==(e=m.data)&&void 0!==e?e:"RatOS"];return f.isLoading?t.push("Loading..."):(null==x?void 0:x.name)&&t.push(x.name),t},[f.isLoading,m.data,null==x?void 0:x.name]);return v?(0,a.jsx)(PrinterHeader,{stateColorClass:(0,i.dV)((null===(t=f.data)||void 0===t?void 0:t.klippy_state)==="error"&&"bg-red-400/10 text-red-400",(null===(r=f.data)||void 0===r?void 0:r.klippy_state)==="startup"&&"bg-amber-400/10 text-amber-400",(null===(l=f.data)||void 0===l?void 0:l.klippy_state)==="ready"&&"bg-green-400/10 text-green-400",(null===(p=f.data)||void 0===p?void 0:p.klippy_state)==="shutdown"&&"bg-red-400/10 text-red-400"),breadcrumb:g,badges:(0,a.jsxs)("div",{className:"inline-flex space-x-1 sm:flex-row-reverse sm:justify-end sm:space-x-2 sm:space-y-0 md:flex-row",children:[(0,a.jsx)(KlippyStateBadge,{}),(0,a.jsx)(MoonrakerStateBadge,{})]}),title:e.title,description:e.description}):(0,a.jsx)(PrinterStateLoadingHeader,{})},PrinterStateLoadingHeader=()=>(0,a.jsx)(PrinterHeader,{stateColorClass:"bg-gray-400/10 text-gray-400",breadcrumb:["RatOS","Loading..."],title:"Loading printer state...",description:"Please wait while RatOS loads your printer state",badges:(0,a.jsxs)("div",{className:"flex space-x-1 sm:flex-row-reverse sm:justify-end sm:space-x-2 sm:space-y-0 md:flex-row",children:[(0,a.jsx)(KlippyStateBadge,{}),(0,a.jsx)(MoonrakerStateBadge,{})]})})},26751:function(e,t,r){r.d(t,{o:function(){return QueryStatus}});var a=r(72612),i=r(45483),n=r(98130),l=r(34709);let QueryStatus=e=>{let t=null;if(e.isError){var r;t=(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(i.B,{children:null===(r=e.error)||void 0===r?void 0:r.message})})}return e.isLoading&&(t=(0,a.jsx)("div",{className:"mb-4 flex items-center justify-center",children:(0,a.jsx)(n.$,{})})),(0,a.jsx)(l.i,{children:t})}},12178:function(e,t,r){r.d(t,{o:function(){return FileChanges}});var a=r(72612),i=r(39164),n=r(79293),l=r(9948),s=r(44649),o=r(56538),d=r(80849);r(85626);var c=r(17934),u=r(94809),p=r(63278);let TwoColumns=e=>(0,a.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"1.5",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:(0,p.m6)("h-6 w-6",e.className),children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M 12 4.5 L 12 19.5 M 4.125 19.5 L 19.875 19.5 C 20.496 19.5 21 18.996 21 18.375 L 21 5.625 C 21 5.004 20.496 4.5 19.875 4.5 L 4.125 4.5 C 3.504 4.5 3 5.004 3 5.625 L 3 18.375 C 3 18.996 3.504 19.5 4.125 19.5 Z"})}),SingleColumn=e=>(0,a.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"1.5",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:(0,p.m6)("h-6 w-6",e.className),children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M 4.125 19.5 L 19.875 19.5 C 20.496 19.5 21 18.996 21 18.375 L 21 5.625 C 21 5.004 20.496 4.5 19.875 4.5 L 4.125 4.5 C 3.504 4.5 3 5.004 3 5.625 L 3 18.375 C 3 18.996 3.504 19.5 4.125 19.5 Z"})}),proccessTokens=e=>{if(!e)return;let t={highlight:!1,enhancers:[(0,d.BF)(e,{type:"block"})]};try{return(0,d.wS)(e,t)}catch(e){return}},DiffModal=e=>{var t;let{isOpen:r,setIsOpen:n}=e,[l,m]=(0,i.useState)("unified"),x=(0,i.useCallback)(()=>{n(!1)},[n]),f=(0,i.useMemo)(()=>(0,d.z2)(e.diff),[e.diff]),v="changed"===e.state?"modify":"created"===e.state?"add":"delete";return(0,a.jsx)(s.u.Root,{show:r,as:i.Fragment,appear:!0,children:(0,a.jsx)(o.V,{as:"div",className:"git-diff fixed inset-0 z-50 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",onClose:x,children:(0,a.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,a.jsx)(s.u.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)(o.V.Overlay,{className:"fixed inset-0 bg-zinc-500 bg-opacity-75 transition-opacity dark:bg-zinc-950 dark:bg-opacity-75"})}),(0,a.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,a.jsx)(s.u.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsxs)("div",{className:"relative inline-flex max-h-[80vh] max-w-screen-2xl transform flex-col overflow-hidden rounded-lg bg-white py-4 text-left align-bottom shadow-xl transition-all dark:bg-zinc-800 sm:my-8 sm:w-full sm:py-6 sm:align-middle",children:[(0,a.jsxs)(o.V.Title,{as:"h3",className:"flex items-center justify-between border-b border-zinc-200 px-4 pb-4 text-lg font-semibold leading-6 text-zinc-900 dark:border-zinc-700 dark:text-zinc-100 sm:px-6",children:[(0,a.jsx)("div",{children:e.title}),(0,a.jsxs)("div",{className:"relative flex flex-nowrap items-center space-x-2 text-zinc-500 dark:text-zinc-400",children:[(0,a.jsx)("button",{className:(0,p.dV)("unified"===l?"cursor-default text-sky-600 dark:text-sky-400":"hover:text-zinc-800 dark:hover:text-zinc-100"),onClick:()=>m("unified"),title:"Unified View",children:(0,a.jsx)(SingleColumn,{className:"h-6 w-6"})}),(0,a.jsx)("button",{className:(0,p.dV)("split"===l?"cursor-default text-sky-600 dark:text-sky-400":"hover:text-zinc-800 dark:hover:text-zinc-100"),onClick:()=>m("split"),title:"Split View",children:(0,a.jsx)(TwoColumns,{className:"h-6 w-6"})}),(0,a.jsx)("div",{className:"!ml-4 !mr-1 h-6 border-l border-l-zinc-200 dark:border-l-zinc-800"}),(0,a.jsx)("button",{className:"hover:text-zinc-800 dark:hover:text-zinc-100",onClick:x,children:(0,a.jsx)(c,{className:"h-6 w-6"})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",children:f.map((e,t)=>{let{hunks:r}=e;return(0,a.jsx)(d.zI,{hunks:r,viewType:l,diffType:v,tokens:proccessTokens(r)},t)})}),(0,a.jsxs)("div",{className:"flex-end flex flex-row items-center justify-end space-x-2 border-t border-zinc-200 px-4 pt-4 dark:border-zinc-700 sm:px-6 sm:pt-6",children:[null!==(t=e.buttons)&&void 0!==t?t:null,(0,a.jsx)(u.z,{variant:"plain",onClick:x,children:"Close"})]})]})})]})})})};var m=r(3496),x=r(96722),f=r(73918);let v=(0,f.j)("flex-none rounded-full p-1 relative flex",{variants:{state:{success:"dark:text-green-400 text-green-500 bg-green-400/20",info:"dark:text-sky-400 text-sky-500 bg-sky-400/20",warning:"dark:text-yellow-400 text-yellow-500 bg-yellow-400/20",danger:"dark:text-rose-400 text-rose-500 bg-rose-400/20",indeterminate:"dark:text-zinc-400 text-zinc-500 bg-zinc-500/20",plain:"dark:text-zinc-400 text-zinc-500 bg-zinc-500/20",primary:"dark:text-brand-400 text-brand-500 bg-brand-500/20"}}}),StateCircle=e=>{var t;return(0,a.jsxs)("div",{className:v(e),children:[(0,a.jsx)("div",{title:e.title,className:(0,p.m6)("absolute inset-0 transition-all duration-700",e.ping?"opacity-100":"opacity-0",null!==(t=e.pingClassName)&&void 0!==t?t:"z-2"),children:(0,a.jsx)("div",{className:(0,p.m6)("absolute inset-0 inline-flex animate-ping rounded-full bg-current opacity-0 ease-out")})}),(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-current"})]})};var g=r(39634),h=r(66477),b=r(30461),y=r(26751);let ChangedFile=e=>{let{addFileToIgnore:t,addFileToOverwrite:r,file:n,removeFileToIgnore:l,removeFileToOverwrite:o,isMarkedIgnored:d,isMarkedOverwritten:c}=e,[f,v]=(0,i.useState)(!1),y=(0,i.useCallback)(e=>{v(!0)},[]),k="changed"===n.state&&(n.overwrite||c)||"created"===n.state||"removed"===n.state,j="changed"===n.state,w="created"===n.state||"removed"===n.state||"changed"===n.state,S=c||n.overwrite&&n.exists,N=w&&!d&&!S&&!k&&!0===n.changedFromConfig;n.state,n.state,n.state;let C=(0,i.useMemo)(()=>{if("RatOS.cfg"===n.fileName)return[];let e=null,a=null,i=null,s=null,u=null;return S&&!d?e={title:"Skip",intent:"indeterminate",action:c?o:t}:j&&(i={title:"Overwrite",intent:"warning",action:d?l:r}),w&&!d?a={title:"Ignore",intent:N?"danger":"indeterminate",action:t}:d&&("removed"===n.state?u={title:"Delete",intent:"danger",action:l}:w&&(s={title:"Write",intent:"success",action:l})),[e,a,i,s,u].filter(Boolean)},[t,r,n.fileName,n.state,w,d,d,c,j,S,N,l,o]),R=(0,i.useMemo)(()=>N?"danger":"changed"===n.state?d&&n.overwrite||S&&!n.overwrite?"warning":S?"success":"indeterminate":"created"===n.state?d?"danger":"success":"removed"!==n.state||d?"indeterminate":"warning",[n.overwrite,n.state,d,S,N]),[z]=(0,h.S)([R],4e3);return(0,a.jsxs)("li",{className:"flex items-center justify-between gap-x-6 py-5",children:[(null==n?void 0:n.diff)!=null&&(0,a.jsx)(DiffModal,{diff:n.diff,title:"Changes to ".concat(n.fileName),state:n.state,setIsOpen:v,buttons:C.map(e=>(0,a.jsx)(u.z,{onClick:()=>{e.action(n.fileName),v(!1)},variant:e.intent,children:e.title},e.title)),isOpen:f}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,a.jsx)(StateCircle,{state:R,ping:z}),(0,a.jsx)("p",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:n.fileName}),(0,a.jsx)(g.Ct,{size:"sm",color:"changed"===n.state?n.changedFromConfig?"yellow":"sky":"created"===n.state?"green":"removed"===n.state?"rose":"gray",children:"changed"===n.state?n.changedFromConfig?"Pending changes":"Changed on disk":"created"===n.state?"New file":"removed"===n.state?"Deleted":"No updates"}),n.changedOnDisk&&(0,a.jsx)(g.Ct,{size:"sm",color:"sky",children:"Changed on disk"})]}),(0,a.jsx)("div",{className:"mt-1 flex items-center gap-x-2 text-xs leading-5 text-zinc-500 dark:text-zinc-400",children:(0,a.jsxs)("p",{className:"",children:["changed"===n.state&&(S&&!d?"File will be backed up and overwritten."+("RatOS.cfg"!=n.fileName?" Any changes you've made can be recovered from the backup.":""):N?"Please review the changes and make a decision.":"File will be skipped."),"created"===n.state&&(d?"File will be skipped.":"File will be created."),"removed"===n.state&&(d?"File will remain untouched.":"File will be deleted."),"unchanged"===n.state&&(n.changedOnDisk?"File has user modifications.":"File remains untouched.")]})})]}),(0,a.jsxs)("div",{className:"flex flex-none items-center gap-x-4",children:[(0,a.jsx)("div",{className:"flex flex-none items-center",children:N?(0,a.jsx)(u.z,{variant:"info",onClick:()=>y(n),children:"Review changes"}):(0,a.jsx)(b,{className:"h-5 w-5 text-green-500 dark:text-brand-500","aria-hidden":"true"})}),(0,a.jsxs)(m.v,{as:"div",className:"relative flex-none",children:[(0,a.jsxs)(m.v.Button,{className:"-m-2.5 block p-2.5 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100",children:[(0,a.jsx)("span",{className:"sr-only",children:"Open options"}),(0,a.jsx)(x,{className:"h-5 w-5","aria-hidden":"true"})]}),(0,a.jsx)(s.u,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsxs)(m.v.Items,{className:"absolute right-0 z-10 mt-2 w-32 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-zinc-900/5 focus:outline-none dark:bg-zinc-900 dark:ring-zinc-100/5",children:[C.map(e=>(0,a.jsx)(m.v.Item,{children:t=>{let{active:r,disabled:i}=t;return(0,a.jsx)("span",{onClick:()=>e.action(n.fileName),className:(0,p.dV)(r?"bg-zinc-50 dark:bg-zinc-800":"",i?"cursor-not-allowed opacity-50":"cursor-pointer","block px-3 py-1 text-sm leading-6 text-zinc-800 dark:text-zinc-200"),children:e.title})}},e.title)),(0,a.jsx)(m.v.Item,{disabled:null==n.diff,children:e=>{let{active:t,disabled:r}=e;return(0,a.jsx)("span",{onClick:()=>y(n),className:(0,p.dV)(t?"bg-zinc-50 dark:bg-zinc-800":"",r?"cursor-not-allowed opacity-50":"cursor-pointer","block px-3 py-1 text-sm leading-6 text-zinc-800 dark:text-zinc-200"),children:"View diff"})}})]})})]})]})]},n.fileName)},FileChanges=e=>{var t;let{serializedConfig:r,onFilesToIgnoreChange:s,onFilesToOverwriteChange:o}=e,[d,c]=(0,i.useState)([]),u=(0,i.useCallback)(e=>{c(t=>t.includes(e)?t:[...t,e])},[]),p=(0,i.useCallback)(e=>{c(t=>t.includes(e)?t.filter(t=>t!==e):t)},[]),[m,x]=(0,i.useState)([]),f=(0,i.useCallback)(e=>{x(t=>t.includes(e)?t:[...t,e])},[]),v=(0,i.useCallback)(e=>{x(t=>t.includes(e)?t.filter(t=>t!==e):t)},[]);(0,i.useEffect)(()=>{o(d)},[d,o]),(0,i.useEffect)(()=>{s(m)},[m,s]);let g=n.SX.useUtils().client,h=(0,l.a)({queryKey:["printer.filesToWrite",r],queryFn:async()=>{let e=await g.printer.getFilesToWrite.mutate({config:null!=r?r:{}});return e},enabled:null!=r});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("ul",{role:"list",className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:null===(t=h.data)||void 0===t?void 0:t.map(e=>(0,a.jsx)(ChangedFile,{file:e,isMarkedIgnored:m.includes(e.fileName),isMarkedOverwritten:d.includes(e.fileName),addFileToIgnore:f,addFileToOverwrite:u,removeFileToIgnore:v,removeFileToOverwrite:p},e.fileName))}),(0,a.jsx)(y.o,{...h})]})}},59672:function(e,t,r){r.d(t,{l:function(){return PrinterRailSettings}});var a=r(72612),i=r(34640),n=r(39164),l=r(37231),s=r(18311),o=r(39634),d=r(57137),c=r(34471),u=r(39662),p=r(69460),m=r(96588),x=r(31239),f=r(1314),v=r(21264),g=r(32342),h=r(80461),b=r(79293),y=r(63278),k=r(94594),j=r(39762),w=r(88192),S=r(73371);k.z.array(f.g6);let PrinterRailSettings=e=>{var t,r,k,N,C,R,z,D,M,T,_;let F=(0,h.YC)(),L=F.find(t=>t.getExtruderAxis()===e.printerRail.axis),E=F.every(e=>e.hasToolboard()),P=(null==L?void 0:L.getExtruderAxis())===e.printerRailDefault.axis&&(null==L?void 0:L.hasToolboard()),O=P?L.getToolboard():e.selectedBoard,[B,I]=(0,n.useState)(!!e.performanceMode),V=(0,m.Zl)((0,g.ew)(e.printerRail.axis)),K=(0,m.sJ)(g.q7),[A,H]=(0,n.useState)(e.printerRail.motorSlot&&(null===(r=e.selectedBoard)||void 0===r?void 0:null===(t=r.motorSlots)||void 0===t?void 0:t[e.printerRail.motorSlot])?e.printerRail.motorSlot:void 0),W=(null==O?void 0:O.integratedDrivers)?null!==(R=O.integratedDrivers[null!=A?A:e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis])&&void 0!==R?R:O.integratedDrivers[e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis]:null,[U,Y]=(0,n.useState)(null!=W&&null!==(z=(0,v.Df)(W))&&void 0!==z?z:e.printerRail.driver),[Q,q]=(0,n.useState)(e.printerRail.stepper),[X,Z]=(0,n.useState)(B&&null!==(D=null===(k=e.printerRailDefault.performanceMode)||void 0===k?void 0:k.homingSpeed)&&void 0!==D?D:e.printerRailDefault.homingSpeed),J=null==e.errors?0:Object.keys(e.errors).reduce((t,r)=>{var a;let i=null===(a=e.errors)||void 0===a?void 0:a[r];if(null==i)return t;let n=Array.isArray(i)?i.length:i._errors.length;return t+n},0),$=(0,n.useCallback)(t=>null!=t&&K.some(r=>{let a=F.find(e=>e.getExtruderAxis()===r.axis);return!(r.axis===e.printerRail.axis||(null==a?void 0:a.hasToolboard()))&&r.motorSlot===t}),[K,e.printerRail.axis,F]),G=b.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,canUseExtruderlessConfigs:E,boardPath:null!==(M=null==O?void 0:O.path)&&void 0!==M?M:""},{enabled:!!O});(0,n.useEffect)(()=>{var e;G.data&&null==A&&(null==O?void 0:null===(e=O.motorSlots)||void 0===e?void 0:e[G.data])!=null&&(0,n.startTransition)(()=>{H(G.data?G.data:void 0)})},[O,G.data,A,e.printerRailDefault.axis]);let ee=(0,f.Wx)(O,U).map(e=>({...e,badge:null!=(0,s.a)(Q,U,e.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0})),[et,er]=(0,n.useState)(null!==(_=null!==(T=ee.find(t=>t.id===e.printerRail.voltage))&&void 0!==T?T:ee.find(t=>{var r;return t.id===(B&&(null===(r=e.printerRailDefault.performanceMode)||void 0===r?void 0:r.voltage)?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage)}))&&void 0!==_?_:ee[0]),[ea,ei]=(0,n.useState)(e.printerRail.current),en=(0,n.useMemo)(()=>(0,s.a)(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),el=(0,n.useMemo)(()=>(0,s.a)(Q,U,et.id,void 0,B),[Q,U,et,B]),es=(0,n.useMemo)(()=>(0,s.a)(Q,U,et.id,ea,B),[Q,U,et,B,ea]),eo=l.N.filter(e=>"UART"===e.protocol||(null==O?void 0:O.stepperSPI)!=null).map(e=>({...e,badge:null!=(0,s.a)(Q,e,et.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0})),ed=s.B.map(e=>({...e,badge:null!=(0,s.a)(e,U,et.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,n.useEffect)(()=>{if((0,f.R_)(e.printerRail,e.printerRailDefault,!e.performanceMode)){var t,r,a;e.performanceMode&&e.printerRailDefault.performanceMode?(Z(null!==(t=e.printerRailDefault.performanceMode.homingSpeed)&&void 0!==t?t:e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&er(null!==(r=ee.find(t=>{var r,a;return t.id===(null!==(a=null===(r=e.printerRailDefault.performanceMode)||void 0===r?void 0:r.voltage)&&void 0!==a?a:e.printerRailDefault.voltage)}))&&void 0!==r?r:ee[0]),null!=e.printerRailDefault.performanceMode.current&&ei(e.printerRailDefault.performanceMode.current)):(Z(e.printerRailDefault.homingSpeed),er(null!==(a=ee.find(t=>t.id===e.printerRailDefault.voltage))&&void 0!==a?a:ee[0]),ei(e.printerRailDefault.current))}I(!!e.performanceMode)},[e.performanceMode]),(0,n.useEffect)(()=>{let e=ee.find(e=>e.id===et.id);if(!e){var t;er(el&&null!==(t=ee.find(e=>e.id===el.voltage))&&void 0!==t?t:ee[0]),el&&ei(el.run_current)}},[ee,et,el]),(0,n.useEffect)(()=>{let t={axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,homingSpeed:X,motorSlot:A,driver:U,voltage:et.id,stepper:Q,current:ea},r=(0,v.Yz)(t),a=(0,v.Yz)(e.printerRail),i=Object.keys(r).some(e=>r[e]!==a[e]);i&&(0,n.startTransition)(()=>{V(r)})},[ea,U,e.printerRail,X,V,Q,et.id,A]);let ec=el&&el.run_current===ea,eu="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===f.po.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase(),ep=(null==O?void 0:O.motorSlots)!=null&&Object.keys(O.motorSlots).length>0?Object.keys(O.motorSlots).map(t=>{var r,a,i,n;if((null===(r=O.motorSlots)||void 0===r?void 0:r[t].title)==null)return null;let l=(null===(a=O.motorSlots)||void 0===a?void 0:a[t].diag_pin)!=null,s=(null===(i=O.motorSlots)||void 0===i?void 0:i[t].endstop_pin)!=null,o=$(t),d=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!l;return{id:t,title:null===(n=O.motorSlots)||void 0===n?void 0:n[t].title,disabled:d,badge:[l?void 0:{children:"No diag pin",color:d?"red":"gray"},s?void 0:{children:"No endstop pin",color:"gray"},!0===o?{children:"In use",color:"orange"}:void 0].filter(Boolean)}}).filter(Boolean):null,em=(0,n.useMemo)(()=>{var t,r;if(null==A||(null==O?void 0:null===(t=O.motorSlots)||void 0===t?void 0:t[A].title)==null)return;let a=(null===(r=O.motorSlots)||void 0===r?void 0:r[A].diag_pin)!=null,i=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!a;return!a&&i?{children:"No diag pin",color:"red"}:void 0},[O,A,e.printerRailDefault.axis]);return(0,a.jsx)(j.M,{children:e.isVisible&&(0,a.jsxs)(w.Card,{exit:{opacity:0,scale:.9,y:-40},initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},className:(0,y.m6)("break-inside-avoid-column",J>0&&(0,o.iA)({color:"red"}),J>0&&(0,o.xU)({color:"red"}),J>0&&"ring-1"),children:[(0,a.jsxs)(S.Ol,{className:"",children:[(0,a.jsx)(S.ll,{className:(0,y.m6)(J>0&&"text-red-900/80 dark:text-red-100"),children:eu}),(0,a.jsx)(S.SZ,{className:(0,y.m6)(J>0&&"text-red-800/80 dark:text-red-100/60"),children:e.printerRail.axisDescription})]}),(0,a.jsxs)(S.aY,{className:"@2xs:grid-cols-2 grid grid-cols-1 gap-4",children:[ep&&(0,a.jsx)("div",{className:"col-span-full",children:(0,a.jsx)(i.Lt,{label:"Motor Slot",options:ep,error:null===(C=e.errors)||void 0===C?void 0:null===(N=C.motorSlot)||void 0===N?void 0:N._errors.join("\n"),onSelect:e=>{var t,r;H(e.id),(null==O?void 0:null===(t=O.integratedDrivers)||void 0===t?void 0:t[e.id])!=null&&Y(null!==(r=(0,v.Df)(O.integratedDrivers[e.id]))&&void 0!==r?r:U)},value:A?ep.find(e=>e.id===A):void 0,badge:em})}),(0,a.jsx)("div",{className:"col-span-full",children:(0,a.jsx)(i.Lt,{label:"Driver",options:eo,onSelect:Y,value:U,disabled:null!=W,badge:[null!=W?{children:"Integrated",color:"sky"}:void 0,P?{children:"Toolboard",color:"yellow"}:void 0].filter(Boolean)})}),(0,a.jsx)("div",{className:"col-span-full",children:(0,a.jsx)(i.Lt,{label:"Stepper",options:ed,onSelect:q,value:Q})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)(i.Lt,{label:"Voltage",options:ee,onSelect:er,value:et})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)(d.o,{type:"number",label:"Current",value:ea,onChange:ei,inputMode:"decimal",step:"any",min:0,max:U.maxCurrent})}),Q.maxPeakCurrent/1.41<ea&&(0,a.jsxs)(c.j,{Icon:x,color:"yellow",title:"Stepper overcurrent!",className:"col-span-full",children:["Your stepper motor is rated for ",Math.floor(100*Q.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",ea,"A."]}),null!=es&&(0,a.jsx)(c.j,{Icon:u,color:"brand",title:"Driver tuning applied!",className:"col-span-full",children:"RatOS preset applied automatically."}),(null==es?void 0:es.run_current)!==(null==en?void 0:en.run_current)&&el&&!ec&&(0,a.jsxs)(c.j,{Icon:p,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-full",children:["RatOS has a recommended preset for your current settings at ",el.run_current,"A. You can"," ",(0,a.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>ei(el.run_current),children:["change the current to ",el.run_current,"A"]})," ","to apply the preset automatically."]})]})]},e.printerRail.axis)})}},66477:function(e,t,r){r.d(t,{I:function(){return useDelayedChangeEffect},S:function(){return useChangeEffect}});var a=r(39164);let useChangeEffect=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],[i,n]=(0,a.useState)(0),l=(0,a.useRef)([...e]);(0,a.useEffect)(()=>{let t=!1;l.current.forEach((r,a)=>{r!==e[a]&&(t=!0)}),t&&n(e=>r?e+1:1),l.current=[...e]},[...e]);let s=(0,a.useCallback)(()=>{n(0)},[]);return(0,a.useEffect)(()=>{if(null!=t&&i>0){let e=setTimeout(()=>{n(0)},t);return()=>{clearTimeout(e)}}},[t,i]),[i>0,s]},useDelayedChangeEffect=function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],[n,l]=(0,a.useState)(0),s=(0,a.useRef)([...e]),o=(0,a.useRef)(null);(0,a.useEffect)(()=>{let r=!1;if(s.current.forEach((t,a)=>{t!==e[a]&&(r=!0)}),r){let trigger=()=>l(e=>i?e+1:1);o.current=window.setTimeout(()=>{trigger(),o.current=null},t)}s.current=[...e]},[...e]),(0,a.useEffect)(()=>()=>{o.current&&clearTimeout(o.current)},[]);let[d,c]=useChangeEffect([n],r,i);return[d,c]}},2750:function(e,t,r){r.d(t,{PF:function(){return useMainsailQuery}}),r(39164);var a=r(96886);let useMainsailQuery=(e,t)=>(0,a.A4)("mainsail",e,t)}}]);
//# sourceMappingURL=5826-8534877b9ef7e1a9.js.map