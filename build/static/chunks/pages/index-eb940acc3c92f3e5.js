(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{106:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(1447)}])},1447:function(e,r,t){"use strict";t.r(r),t.d(r,{__N_SSP:function(){return tL},default:function(){return tD}});var n,i,a,l,s,o=t(9508),d=t(3286),c=t.n(d),u=t(6223),p=t(4630),m=t(5144),x=t(1548);let h=0,g=e=>{let r=null!=e&&""!=e.trim()?e:""!="".trim()?"":window.location.hostname;return null==r||""==r.trim()?null:"ws://".concat(r,"/websocket")},b=e=>{let r=(0,u.useRef)({}),t=(0,u.useRef)({}),n=(0,u.useRef)([]),[i,a]=(0,u.useState)(g(e));(0,u.useEffect)(()=>{a(g(e))},[e]);let{lastJsonMessage:l,sendJsonMessage:s,readyState:o}=(0,x.ZP)(i,{shouldReconnect:e=>!0,reconnectAttempts:1/0,reconnectInterval:3e3,share:!0}),d=(0,u.useRef)(o);d.current=o;let[c,p]=(0,u.useState)(1===o?"connected":"connecting"),[m,b]=(0,u.useState)(l),v=(0,u.useCallback)(e=>{1===d.current?e():n.current.push(e)},[]),f=(0,u.useCallback)(()=>new Promise((e,r)=>{v(()=>{e()})}),[v]),z=(0,u.useCallback)(async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await f(),new Promise((i,a)=>{s({jsonrpc:"2.0",method:e,params:n,id:++h}),r.current[h]=(e,r)=>e?a(e):(null==r?void 0:r.error)?a(r.error):void i(r),t.current[h]=window.setTimeout(()=>{var e,n;null===(n=(e=r.current)[h])||void 0===n||n.call(e,Error("Request timed out"),null),delete r.current[h],delete t.current[h]},1e4)})},[f,s]),j=(0,u.useCallback)(async(e,r)=>(await f(),await z("server.database.post_item",{namespace:"RatOS",key:e,value:JSON.stringify(r)})),[z,f]),y=(0,u.useCallback)(async e=>{await f();try{let r=await z("server.database.get_item",{namespace:"RatOS",key:e});if("{}"===r.value)return null;return"string"==typeof r.value?JSON.parse(r.value):r.value}catch(e){return null}},[z,f]);return(0,u.useEffect)(()=>{1===o?(n.current.forEach(e=>e()),n.current=[],p("connected")):p("connecting")},[o]),(0,u.useEffect)(()=>{(null==l?void 0:l.id)&&r.current[l.id]?(window.clearTimeout(t.current[l.id]),r.current[l.id](null,l.result),delete t.current[l.id],delete r.current[l.id]):b(l)},[l]),(0,u.useEffect)(()=>()=>{for(let e in t.current)delete t.current[e],delete r.current[e];n.current=[]},[]),{query:z,saveItem:j,getItem:y,status:c,lastMessage:m,isReady:1===o}},v=(0,p.cn)({key:"KlippyReadyState",default:"unknown"}),f=()=>{let{query:e,lastMessage:r}=b(),t=(0,p.Zl)(v),n=(0,u.useCallback)(async()=>{if(null!=e)try{let r=await e("server.info");if((null==r?void 0:r.klippy_state)==null)return;let i=r.klippy_state;t(i),"startup"===i&&setTimeout(()=>{n()},2e3)}catch(e){t("unknown")}},[e,t]);(0,u.useEffect)(()=>{null!=e&&n()},[e,n]),(0,u.useEffect)(()=>{(null==r?void 0:r.method)==="notify_klippy_ready"&&t("ready"),(null==r?void 0:r.method)==="notify_klippy_shutdown"&&t("shutdown"),(null==r?void 0:r.method)==="notify_klippy_disconnected"&&(t("unknown"),n())},[r,n,t])};var z=t(2808),j=t(9133);let y=(0,z.j)("",{variants:{color:{red:"text-red-700 dark:text-red-400",yellow:"text-yellow-800 dark:text-yellow-500",orange:"text-orange-800 dark:text-orange-500",green:"text-green-700 dark:text-green-400",lime:"text-lime-700 dark:text-lime-400",blue:"text-blue-700 dark:text-blue-400",sky:"text-sky-700 dark:text-sky-400",indigo:"text-indigo-700 dark:text-indigo-400",purple:"text-purple-700 dark:text-purple-400",pink:"text-pink-700 dark:text-pink-400",brand:"text-brand-700 dark:text-brand-400",gray:"text-zinc-600 dark:text-zinc-400",plain:"text-zinc-900 dark:text-zinc-100"}}}),k=(0,z.j)("",{variants:{color:{red:"bg-red-50 dark:bg-red-400/10",yellow:"bg-yellow-50 dark:bg-yellow-400/10",orange:"bg-orange-50 dark:bg-orange-400/10",green:"bg-green-50 dark:bg-green-500/10",lime:"bg-lime-50 dark:bg-lime-500/10",blue:"bg-blue-50 dark:bg-blue-400/10",sky:"bg-sky-50 dark:bg-sky-400/10",indigo:"bg-indigo-50 dark:bg-indigo-400/10",purple:"bg-purple-50 dark:bg-purple-400/10",pink:"bg-pink-50 dark:bg-pink-400/10",brand:"bg-brand-100 dark:bg-brand-400/10",gray:"bg-zinc-50 dark:bg-zinc-400/10",plain:"bg-zinc-900/10 dark:bg-zinc-100/10"}}}),_=(0,z.j)("",{variants:{color:{red:"border-red-600/10 dark:border-red-400/20 ring-red-600/10 dark:ring-red-400/20",yellow:"border-yellow-600/20 dark:border-yellow-400/20 ring-yellow-600/20 dark:ring-yellow-400/20",orange:"border-orange-600/20 dark:border-orange-400/20 ring-orange-600/20 dark:ring-orange-400/20",green:"border-green-600/20 dark:border-green-500/20 ring-green-600/20 dark:ring-green-500/20",lime:"border-lime-600/20 dark:border-lime-500/20 ring-lime-600/20 dark:ring-lime-500/20",blue:"border-blue-700/10 dark:border-blue-400/30 ring-blue-700/10 dark:ring-blue-400/30",sky:"border-sky-700/10 dark:border-sky-400/30 ring-sky-700/10 dark:ring-sky-400/30",indigo:"border-indigo-700/10 dark:border-indigo-400/30 ring-indigo-700/10 dark:ring-indigo-400/30",purple:"border-purple-700/10 dark:border-purple-400/30 ring-purple-700/10 dark:ring-purple-400/30",pink:"border-pink-700/10 dark:border-pink-400/20 ring-pink-700/10 dark:ring-pink-400/20",brand:"border-brand-600/40 dark:border-brand-400/30 ring-brand-600/40 dark:ring-brand-400/30",gray:"border-zinc-500/10 dark:border-zinc-400/20 ring-zinc-500/10 dark:ring-zinc-400/20",plain:"border-zinc-900 dark:border-zinc-100 ring-zinc-900 dark:ring-zinc-100"}}}),N=(0,z.j)("flex-0 inline-flex w-auto items-center rounded-md font-medium ring-1 ring-inset",{variants:{size:{sm:"px-1 py-0 text-2xs",md:"px-2 py-1 text-xs"},color:{red:[k({color:"red"}),_({color:"red"}),y({color:"red"})],yellow:[k({color:"yellow"}),_({color:"yellow"}),y({color:"yellow"})],orange:[k({color:"orange"}),_({color:"orange"}),y({color:"orange"})],green:[k({color:"green"}),_({color:"green"}),y({color:"green"})],lime:[k({color:"lime"}),_({color:"lime"}),y({color:"lime"})],blue:[k({color:"blue"}),_({color:"blue"}),y({color:"blue"})],sky:[k({color:"sky"}),_({color:"sky"}),y({color:"sky"})],indigo:[k({color:"indigo"}),_({color:"indigo"}),y({color:"indigo"})],purple:[k({color:"purple"}),_({color:"purple"}),y({color:"purple"})],pink:[k({color:"pink"}),_({color:"pink"}),y({color:"pink"})],brand:[k({color:"brand"}),_({color:"brand"}),y({color:"brand"})],gray:[k({color:"gray"}),_({color:"gray"}),y({color:"gray"})],plain:[k({color:"plain"}),_({color:"plain"}),y({color:"plain"})]}},defaultVariants:{size:"md",color:"gray"}}),w=e=>{let{size:r,color:t,className:n,children:i,...a}=e;return(0,o.jsx)("span",{className:(0,j.m)(N({size:r,color:t}),n),...a,children:i})},S=e=>{switch(e){case"error":return"Klipper State: Error";case"ready":return"Klipper State: Ready";case"shutdown":return"Klipper State: Shutdown";case"startup":return"Klipper State: Startup";default:return"Klipper State: Unknown"}},T=e=>{f();let r=(0,p.sJ)(v),t="orange";switch(r){case"error":t="red";break;case"ready":t="brand";break;case"shutdown":case"unknown":default:t="orange";break;case"startup":t="yellow"}return(0,o.jsxs)(w,{color:t,title:S(r),children:[(0,o.jsx)("svg",{className:(0,m.d)(y({color:t}),"mr-1.5 h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:(0,o.jsx)("circle",{cx:4,cy:4,r:3})}),"Klipper"]})},C=e=>{switch(e){case"not-running":return"Moonraker State: Not Running";case"connected":return"Moonraker State: Connected";case"connecting":return"Moonraker State: Connecting";default:return"Moonraker State: Unknown"}},R=e=>{let{status:r}=b(),t="orange";switch(r){case"not-running":t="red";break;case"connected":t="brand";break;case"connecting":t="yellow";break;default:t="orange"}return(0,o.jsxs)(w,{color:t,title:C(r),children:[(0,o.jsx)("svg",{className:(0,m.d)(y({color:t}),"mr-1.5 h-2 w-2"),fill:"currentColor",viewBox:"0 0 8 8",children:(0,o.jsx)("circle",{cx:4,cy:4,r:3})}),"Moonraker"]})};var E=t(9017),P=t(2029),F=t(960),M=t(5401),A=t(6536),O=t(6347),L=t(416),D=t(5110),I=t(7772);let H=e=>{let{open:r,setOpen:t}=e,n=e.isFailed?(0,o.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-800",children:(0,o.jsx)(L,{className:"h-6 w-6 text-red-600 dark:text-red-300","aria-hidden":"true"})}):(0,o.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100 dark:bg-green-700",children:(0,o.jsx)(D,{className:"h-6 w-6 text-green-600 dark:text-green-100","aria-hidden":"true"})}),i=(0,I.Z)("inline-flex w-full justify-center rounded-md border border-transparent px-4 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 focus:ring-offset-zinc-900 sm:text-sm",e.isLoading?"bg-brand-600 text-base font-medium text-white opacity-50 cursor-not-allowed":"bg-brand-600 text-base font-medium text-white hover:bg-brand-700");return(0,o.jsx)(M.u.Root,{show:r,as:u.Fragment,appear:!0,children:(0,o.jsxs)(O.V,{as:"div",className:"relative z-10",onClose:t,children:[(0,o.jsx)(M.u.Child,{as:u.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,o.jsx)("div",{className:"fixed inset-0 bg-zinc-500 bg-opacity-75 transition-opacity dark:bg-zinc-800 dark:bg-opacity-75"})}),(0,o.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",children:(0,o.jsx)("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:(0,o.jsx)(M.u.Child,{as:u.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,o.jsxs)(O.V.Panel,{className:"dark relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all dark:bg-zinc-900 sm:my-8 sm:w-full sm:max-w-sm sm:p-6 md:max-w-lg lg:max-w-xl xl:max-w-3xl",children:[(0,o.jsxs)("div",{children:[e.isLoading?(0,o.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-800",children:(0,o.jsxs)("svg",{className:(0,I.Z)("h-6 w-6 animate-spin text-zinc-800 dark:text-zinc-200"),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):n,(0,o.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,o.jsx)(O.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:e.title}),(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsx)("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:e.children})})]})]}),(0,o.jsx)("div",{className:"mt-5 sm:mt-6",children:(0,o.jsx)("button",{type:"button",className:i,onClick:e.isLoading?void 0:()=>t(!1),disabled:e.isLoading,children:e.dismissText})})]})})})})]})})};var V=t(6211),B=t(6594),U=t(6003);(n=a||(a={}))[n["24V"]=24]="24V",n[n["36V"]=36]="36V",n[n["48V"]=48]="48V",n[n["56V"]=56]="56V",n[n["60V"]=60]="60V";let W=[{id:a["24V"],title:"24V"},{id:a["36V"],title:"36V"},{id:a["48V"],title:"48V"},{id:a["56V"],title:"56V"},{id:a["60V"],title:"60V"}],X=(e,r)=>(null==r?void 0:r.external)?W.filter(e=>{var t;return(null==r?void 0:null===(t=r.voltages)||void 0===t?void 0:t.includes(e.id))||e.id===a["24V"]}):W.filter(r=>{var t;return(null==e?void 0:null===(t=e.driverVoltages)||void 0===t?void 0:t.includes(r.id))||r.id===a["24V"]}).filter(e=>{var t;return(null==r?void 0:null===(t=r.voltages)||void 0===t?void 0:t.includes(e.id))||e.id===a["24V"]}),Z=(e,r,t)=>{var n,i;return e.axis===r.axis&&e.driver.id===r.driver.id&&e.stepper.id===r.stepper.id&&(t&&r.performanceMode&&e.voltage===(null===(n=r.performanceMode)||void 0===n?void 0:n.voltage)&&e.current===(null===(i=r.performanceMode)||void 0===i?void 0:i.current)||!t&&e.voltage===r.voltage&&e.current===r.current)},q=B.jb(a),Y=B.Ry({id:B.Z_(),title:B.Z_(),type:B.Km(["TMC2209","TMC2226","TMC5160","TMC2130","TMC2240"]),protocol:B.Km(["SPI","UART"]),senseResistor:B.Rx().min(0),coolingCurrentThreshold:B.Rx(),voltages:q.array(),maxCurrent:B.Rx().min(0),external:B.O7().optional()}),G=B.Ry({voltage:q,run_current:B.Rx(),driver:Y.shape.id,sense_resistor:B.Rx()}),K=B.Ry({id:B.Z_(),title:B.Z_(),fullStepsPerRotation:B.Rx().default(200),maxPeakCurrent:B.Rx().min(0),presets:B.IX(B.VK("driver",[G.extend({driver:B.Km(["TMC2130","TMC5160","TMC2240"]),driver_MSLUT0:B.Rx().optional(),driver_MSLUT1:B.Rx().optional(),driver_MSLUT2:B.Rx().optional(),driver_MSLUT3:B.Rx().optional(),driver_MSLUT4:B.Rx().optional(),driver_MSLUT5:B.Rx().optional(),driver_MSLUT6:B.Rx().optional(),driver_MSLUT7:B.Rx().optional(),driver_W0:B.Rx().optional(),driver_W1:B.Rx().optional(),driver_W2:B.Rx().optional(),driver_W3:B.Rx().optional(),driver_X1:B.Rx().optional(),driver_X2:B.Rx().optional(),driver_X3:B.Rx().optional(),driver_START_SIN:B.Rx().optional(),driver_START_SIN90:B.Rx().optional(),driver_IHOLDDELAY:B.Rx().optional(),driver_TPOWERDOWN:B.Rx().optional(),driver_TBL:B.Rx().optional(),driver_TOFF:B.Rx().optional(),driver_HEND:B.Rx().optional(),driver_HSTRT:B.Rx().optional(),driver_PWM_AUTOSCALE:B.O7().optional(),driver_PWM_FREQ:B.Rx().optional(),driver_PWM_GRAD:B.Rx().optional(),driver_PWM_AMPL:B.Rx().optional(),driver_SGT:B.Rx().optional()}),G.extend({driver:B.Km(["TMC2209"]),driver_TBL:B.Rx().optional(),driver_TOFF:B.Rx().optional(),driver_HEND:B.Rx().optional(),driver_HSTRT:B.Rx().optional()})])).optional().describe("Stepper presets are tightly coupled to the driver type, sense_resistor, stepper, voltage and current.")});(i=l||(l={})).x="x",i.dual_carriage="dual_carriage",i.x1="x1",i.y="y",i.y1="y1",i.y2="y2",i.z="z",i.z1="z1",i.z2="z2",i.z3="z3",i.extruder="extruder",i.extruder1="extruder1";let Q=B.Ry({axis:B.jb(l).describe("Axis of the rail"),axisDescription:B.Z_().optional().describe("Description of the axis"),driver:Y.describe("Stepper driver used on this axis"),voltage:q.default(a["24V"]).describe("Voltage of the stepper driver"),stepper:K.describe("Stepper motor connected to this axis"),motorSlot:B.Z_().optional().describe("Optional board motor slot of the stepper driver"),current:B.Rx().min(0),rotationDistance:B.Rx().min(0).describe("Distance in mm the axis travels per stepper rotation"),gearRatio:B.Z_().regex(/^\d+:\d+$/).optional().describe("Optional gear ratio of the axis"),homingSpeed:B.Rx().min(0).default(10).describe("Axis speed during homing in mm/s"),microstepping:B.Rx().min(16).max(256).default(64).describe("Microstepping of the stepper driver, higher values increase resolution and lower noise but increases load on the MCU")}),J=Q.extend({performanceMode:B.Ry({current:B.Rx().min(0),voltage:q.default(a["24V"]).describe("Voltage of the stepper driver in performance mode"),homingSpeed:B.Rx().min(0).optional().describe("Axis speed during homing in mm/s in performance mode")}).optional()}),$=J.extend({driver:Y.shape.id,stepper:K.shape.id}),ee=Q.refine(e=>e.current<=e.driver.maxCurrent,"Current must be less than max current of the driver"),er=Q.extend({driver:Y.shape.id,stepper:K.shape.id}),et=B.z.object({x_step_pin:B.z.string().optional(),x_dir_pin:B.z.string().optional(),x_enable_pin:B.z.string().optional(),x_uart_pin:B.z.string().optional(),x_diag_pin:B.z.string().optional(),x_endstop_pin:B.z.string().optional(),x1_step_pin:B.z.string().optional(),x1_dir_pin:B.z.string().optional(),x1_enable_pin:B.z.string().optional(),x1_uart_pin:B.z.string().optional(),x1_diag_pin:B.z.string().optional(),x1_endstop_pin:B.z.string().optional(),dual_carriage_step_pin:B.z.string().optional(),dual_carriage_dir_pin:B.z.string().optional(),dual_carriage_enable_pin:B.z.string().optional(),dual_carriage_uart_pin:B.z.string().optional(),dual_carriage_diag_pin:B.z.string().optional(),dual_carriage_endstop_pin:B.z.string().optional(),y_step_pin:B.z.string().optional(),y_dir_pin:B.z.string().optional(),y_enable_pin:B.z.string().optional(),y_uart_pin:B.z.string().optional(),y_diag_pin:B.z.string().optional(),y_endstop_pin:B.z.string().optional(),y1_step_pin:B.z.string().optional(),y1_dir_pin:B.z.string().optional(),y1_enable_pin:B.z.string().optional(),y1_uart_pin:B.z.string().optional(),y1_diag_pin:B.z.string().optional(),y1_endstop_pin:B.z.string().optional(),y2_step_pin:B.z.string().optional(),y2_dir_pin:B.z.string().optional(),y2_enable_pin:B.z.string().optional(),y2_uart_pin:B.z.string().optional(),y2_diag_pin:B.z.string().optional(),y2_endstop_pin:B.z.string().optional(),z0_step_pin:B.z.string().optional(),z0_dir_pin:B.z.string().optional(),z0_enable_pin:B.z.string().optional(),z0_uart_pin:B.z.string().optional(),z0_diag_pin:B.z.string().optional(),z1_step_pin:B.z.string().optional(),z1_dir_pin:B.z.string().optional(),z1_enable_pin:B.z.string().optional(),z1_uart_pin:B.z.string().optional(),z1_diag_pin:B.z.string().optional(),z2_step_pin:B.z.string().optional(),z2_dir_pin:B.z.string().optional(),z2_enable_pin:B.z.string().optional(),z2_uart_pin:B.z.string().optional(),z2_diag_pin:B.z.string().optional(),z3_step_pin:B.z.string().optional(),z3_dir_pin:B.z.string().optional(),z3_enable_pin:B.z.string().optional(),z3_uart_pin:B.z.string().optional(),z3_diag_pin:B.z.string().optional(),e_step_pin:B.z.string().optional(),e_dir_pin:B.z.string().optional(),e_enable_pin:B.z.string().optional(),e_uart_pin:B.z.string().optional(),e_diag_pin:B.z.string().optional(),e_heater_pin:B.z.string().optional(),e_sensor_pin:B.z.string().optional(),stepper_spi_mosi_pin:B.z.string().optional(),stepper_spi_miso_pin:B.z.string().optional(),stepper_spi_sclk_pin:B.z.string().optional(),adxl345_cs_pin:B.z.string().optional(),bltouch_sensor_pin:B.z.string().optional(),bltouch_control_pin:B.z.string().optional(),probe_pin:B.z.string().optional(),fan_part_cooling_pin:B.z.string().optional(),fan_toolhead_cooling_pin:B.z.string().optional(),fan_controller_board_pin:B.z.string().optional(),heater_bed_heating_pin:B.z.string().optional(),heater_bed_sensor_pin:B.z.string().optional(),"4p_fan_part_cooling_pin":B.z.string().optional(),"4p_fan_part_cooling_tach_pin":B.z.string().optional(),"4p_toolhead_cooling_pin":B.z.string().optional(),"4p_toolhead_cooling_tach_pin":B.z.string().optional(),"4p_controller_board_pin":B.z.string().optional(),"4p_controller_board_tach_pin":B.z.string().optional()});et.extend({x_step_pin:B.z.string(),x_dir_pin:B.z.string(),x_enable_pin:B.z.string(),x_uart_pin:B.z.string(),x_endstop_pin:B.z.string(),y_step_pin:B.z.string(),y_dir_pin:B.z.string(),y_enable_pin:B.z.string(),y_uart_pin:B.z.string(),y_endstop_pin:B.z.string(),z0_step_pin:B.z.string(),z0_dir_pin:B.z.string(),z0_enable_pin:B.z.string(),z0_uart_pin:B.z.string(),e_step_pin:B.z.string(),e_dir_pin:B.z.string(),e_enable_pin:B.z.string(),e_uart_pin:B.z.string(),e_heater_pin:B.z.string(),e_sensor_pin:B.z.string(),probe_pin:B.z.string(),heater_bed_heating_pin:B.z.string(),heater_bed_sensor_pin:B.z.string()}).and(B.z.object({fan_part_cooling_pin:B.z.string(),fan_toolhead_cooling_pin:B.z.string()}).or(B.z.object({"4p_fan_part_cooling_pin":B.z.string(),"4p_fan_part_cooling_tach_pin":B.z.string(),"4p_toolhead_cooling_pin":B.z.string(),"4p_toolhead_cooling_tach_pin":B.z.string()}))),et.extend({x_step_pin:B.z.string(),x_dir_pin:B.z.string(),x_enable_pin:B.z.string(),x_uart_pin:B.z.string(),x_endstop_pin:B.z.string(),y_step_pin:B.z.string(),y_dir_pin:B.z.string(),y_enable_pin:B.z.string(),y_uart_pin:B.z.string(),y_endstop_pin:B.z.string(),z0_step_pin:B.z.string(),z0_dir_pin:B.z.string(),z0_enable_pin:B.z.string(),z0_uart_pin:B.z.string(),z1_step_pin:B.z.string(),z1_dir_pin:B.z.string(),z1_enable_pin:B.z.string(),z1_uart_pin:B.z.string(),z2_step_pin:B.z.string(),z2_dir_pin:B.z.string(),z2_enable_pin:B.z.string(),z2_uart_pin:B.z.string(),probe_pin:B.z.string(),heater_bed_heating_pin:B.z.string(),heater_bed_sensor_pin:B.z.string()}).and(B.z.object({fan_part_cooling_pin:B.z.string(),fan_toolhead_cooling_pin:B.z.string()}).or(B.z.object({"4p_fan_part_cooling_pin":B.z.string(),"4p_fan_part_cooling_tach_pin":B.z.string(),"4p_toolhead_cooling_pin":B.z.string(),"4p_toolhead_cooling_tach_pin":B.z.string()}))),et.extend({e_step_pin:B.z.string(),e_dir_pin:B.z.string(),e_enable_pin:B.z.string(),e_uart_pin:B.z.string(),e_heater_pin:B.z.string(),e_sensor_pin:B.z.string(),adxl345_cs_pin:B.z.string(),probe_pin:B.z.string()}).and(B.z.object({fan_part_cooling_pin:B.z.string(),fan_toolhead_cooling_pin:B.z.string()}).or(B.z.object({"4p_fan_part_cooling_pin":B.z.string(),"4p_fan_part_cooling_tach_pin":B.z.string(),"4p_toolhead_cooling_pin":B.z.string(),"4p_toolhead_cooling_tach_pin":B.z.string()})));let en=B.z.object({uart_pin:B.z.string(),uart_address:B.z.string().optional(),rx_pin:B.z.string().optional(),tx_pin:B.z.string().optional()}),ei=B.z.object({cs_pin:B.z.string()}).and(B.z.object({spi_bus:B.z.string()}).or(B.z.object({spi_software_mosi_pin:B.z.string().optional(),spi_software_miso_pin:B.z.string().optional(),spi_software_sclk_pin:B.z.string().optional()}))),ea=e=>ei.safeParse(e).success,el=e=>en.safeParse(e).success,es=B.z.object({title:B.z.string(),step_pin:B.z.string(),dir_pin:B.z.string(),enable_pin:B.z.string(),diag_pin:B.z.string(),endstop_pin:B.z.string(),uart_pin:B.z.string().optional(),uart_address:B.z.string().optional(),rx_pin:B.z.string().optional(),tx_pin:B.z.string().optional(),cs_pin:B.z.string().optional(),spi_bus:B.z.string().optional(),spi_software_mosi_pin:B.z.string().optional(),spi_software_miso_pin:B.z.string().optional(),spi_software_sclk_pin:B.z.string().optional()}).refine(e=>ea(e)||el(e),{message:"Motor slot must have either SPI or UART pins"});es.innerType().omit({title:!0}).partial();let eo=B.z.string(),ed=B.z.object({id:B.z.string(),isToolboard:B.z.boolean().optional(),isHost:B.z.boolean().optional(),serialPath:B.z.string().optional(),name:B.z.string(),manufacturer:B.z.string(),firmwareBinaryName:B.z.string(),compileScript:B.z.string(),flashScript:B.z.string().optional(),flashInstructions:B.z.string().optional(),disableAutoFlash:B.z.boolean().optional(),documentationLink:B.z.string().optional(),hasQuirksFiles:B.z.boolean().optional(),driverCount:B.z.number(),integratedDrivers:B.z.record(B.z.nativeEnum(l),B.z.string()).optional(),extruderlessConfig:B.z.string().optional(),fourPinFanConnectorCount:B.z.number().optional(),driverVoltages:q.array().default([24]),hasMcuTempSensor:B.z.boolean().default(!0),alternativePT1000Resistor:B.z.number().optional(),motorSlots:B.z.record(eo,es).optional(),outputPins:B.z.array(B.z.object({pin:B.z.string(),name:B.z.string(),value:B.z.number().min(0).max(1)})).optional(),dfu:B.z.object({dfuBootImage:B.z.string(),flashDevice:B.z.string(),instructions:B.z.array(B.z.string()),reminder:B.z.string().optional(),hasBoot0Jumper:B.z.boolean()}).optional(),stepperSPI:B.z.object({software:B.z.object({sclk:B.z.string(),mosi:B.z.string(),miso:B.z.string()})}).or(B.z.object({hardware:B.z.object({bus:B.z.string()})})).optional(),ADXL345SPI:B.z.object({cs_pin:B.z.string()}).and(B.z.object({software:B.z.object({sclk:B.z.string(),mosi:B.z.string(),miso:B.z.string()})}).or(B.z.object({hardware:B.z.object({bus:B.z.string()})}))).optional(),path:B.z.string()});ed.extend({detected:B.z.boolean()}),B.z.object({id:B.z.string(),disableAutoFlash:B.z.literal(!1).optional(),isToolboard:B.z.boolean().optional(),compileScript:B.z.string(),flashScript:B.z.string(),path:B.z.string()});let ec=ed.extend({isToolboard:B.z.literal(!0),isHost:B.z.literal(!1).optional(),integratedDrivers:ed.shape.integratedDrivers.and(B.z.object({[l.extruder]:B.z.string()}))});ec.extend({detected:B.z.boolean()});let eu=B.z.object({NODE_ENV:B.z.enum(["development","test","production"]),RATOS_CONFIGURATION_PATH:B.z.string(),RATOS_SCRIPT_DIR:B.z.string(),KLIPPER_CONFIG_PATH:B.z.string(),KLIPPER_DIR:B.z.string(),KLIPPER_ENV:B.z.string(),MOONRAKER_DIR:B.z.string(),LOG_FILE:B.z.string(),RATOS_DATA_DIR:B.z.string()});B.z.object({NEXT_PUBLIC_KLIPPER_HOSTNAME:B.z.string().optional()});var ep=t(4224);let em=["EPCOS 100K B57560G104F","ATC Semitec 104GT-2","ATC Semitec 104NT-4-R025H42G","Generic 3950","Honeywell 100K 135-104LAG-J01","NTC 100K MGB18-104F39050L32","SliceEngineering 450","TDK NTCG104LH104JT1","PT1000"],ex="";if(ep.env.RATOS_CONFIGURATION_PATH){let e=eu.parse(ep.env);ex=e.RATOS_CONFIGURATION_PATH}let eh=B.z.object({path:B.z.string().startsWith(ex).endsWith(".cfg"),id:B.z.string()}),eg=B.z.enum(em),eb=eh.extend({type:B.z.literal("hotend"),title:B.z.string(),thermistor:B.z.enum(em)}),ev=eh.extend({type:B.z.literal("extruder"),stepper:K.shape.id.optional(),current:J.shape.current.optional(),title:B.z.string()}),ef=eh.extend({type:B.z.literal("static-probe").or(B.z.literal("stowable-probe")),title:B.z.string()}),ez=B.z.object({id:B.z.enum(["endstop","endstop-toolboard","sensorless"]),title:B.z.string()}),ej=B.z.object({id:B.z.enum(["toolboard","controlboard","sbc","none"]),title:B.z.string()}),ey=B.z.object({id:B.z.enum(["2pin","4pin","4pin-dedicated","2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard"]),title:B.z.string()}),ek=B.z.object({hotend:eb,thermistor:eg,extruder:ev,xEndstop:ez,yEndstop:ez,hotendFan:ey,partFan:ey,xAccelerometer:ej.optional().nullable(),yAccelerometer:ej.optional().nullable(),toolboard:ec.nullable(),probe:ef.optional(),axis:B.z.literal(l.x).or(B.z.literal(l.dual_carriage)),description:B.z.string().optional(),toolNumber:B.z.number().optional()}).strict(),e_=B.z.union([B.z.literal(0),B.z.literal(1)]),eN=B.z.union([B.z.literal(l.x),B.z.literal(l.dual_carriage),B.z.literal(l.extruder),B.z.literal(l.extruder1)]);B.z.union([eN,e_]);let ew=ek.refine(e=>null!==e.toolboard||"endstop-toolboard"!==e.xEndstop.id,"Cannot use toolboard endstop without a toolboard").refine(e=>null!==e.toolboard||!["2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard"].includes(e.hotendFan.id),"Cannot use toolboard hotend fan without a toolboard").refine(e=>null!==e.toolboard||!["2pin-toolboard","4pin-toolboard","4pin-dedicated-toolboard"].includes(e.partFan.id),"Cannot use toolboard part cooling fan without a toolboard"),eS=ek.partial().optional(),eT=ek.extend({hotend:eb.shape.id,extruder:ev.shape.id,thermistor:eg,xEndstop:ez.shape.id,yEndstop:ez.shape.id,hotendFan:ey.shape.id,partFan:ey.shape.id,xAccelerometer:ej.shape.id.optional().nullable(),yAccelerometer:ej.shape.id.optional().nullable(),toolboard:ec.shape.serialPath.optional().nullable(),probe:ef.shape.id.optional().nullable()}).strict(),eC=eT.partial().optional();var eR=t(6308),eE=t.n(eR),eP=t(4224);let eF="";if(eP.env.RATOS_CONFIGURATION_PATH){let e=eu.parse(eP.env);eF=eE().join(e.RATOS_CONFIGURATION_PATH,"printers")}let eM=B.z.object({velocity:B.z.number().min(0).describe("Maximum velocity for this printer"),accel:B.z.number().min(0).describe("Maximum acceleration for this printer"),z_velocity:B.z.number().min(0).describe("Maximum z velocity for this printer"),z_accel:B.z.number().min(0).describe("Maximum z acceleration for this printer"),square_corner_velocity:B.z.number().min(0).default(5).describe("Maximum square corner velocity for this printer")}).strict(),eA=B.z.object({id:B.z.string(),name:B.z.string().describe("The name of the printer"),description:B.z.string().describe("A description of the printer"),manufacturer:B.z.string().describe("The name of the manufacturer of this printer"),documentationLink:B.z.string().describe("Link to the RatOS documentation for this printer"),image:B.z.string().describe("Link to an image of the printer"),sizes:B.z.array(B.z.number()).describe("Size options for this printer").optional(),template:B.z.string().describe("Printer.cfg template for this printer"),path:B.z.string().startsWith(eF),driverCountRequired:B.z.number().describe("Number of drivers required for this printer"),speedLimits:B.z.object({basic:eM,performance:eM.optional()}).strict().describe("Speed limits for this printer"),defaults:B.z.object({toolheads:B.z.array(eT).describe("Default toolheads for this printer"),board:B.z.string().describe("Default board for this printer. Should be the name of the board directory."),rails:B.z.array($).describe("Default rails for this printer")}).strict().describe("Default hardware for this printer")}).describe("A RatOS supported 3d printer"),eO=eA.extend({defaults:eA.shape.defaults.extend({toolheads:B.z.array(ew)}).strict()}),eL=B.z.array(Y).parse([{id:"BTT-TMC2209-13",title:"BTT TMC2209 v1.3",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"BTT-TMC2226-10",title:"BTT TMC2226 v1.0",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"BTT-TMC5160-PRO-11",title:"BTT TMC5160 Pro v1.1",type:"TMC5160",protocol:"SPI",senseResistor:.075,voltages:[24,36,48,56],maxCurrent:3,coolingCurrentThreshold:1.5},{id:"BTT-TMC5160T-PLUS-10",title:"BTT TMC5160T Plus v1.0",type:"TMC5160",protocol:"SPI",senseResistor:.022,voltages:[24,36,48,56,60],maxCurrent:10.6,coolingCurrentThreshold:3,external:!0},{id:"BTT-EZ2209",title:"BTT EZ2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.3,voltages:[24],maxCurrent:2},{id:"BTT-EZ2226",title:"BTT EZ2226",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.3,voltages:[24],maxCurrent:2},{id:"BTT-EZ2130",title:"BTT EZ2130",type:"TMC2130",protocol:"SPI",senseResistor:.11,coolingCurrentThreshold:.9,voltages:[24],maxCurrent:2},{id:"BTT-EZ5160-PRO",title:"BTT EZ5160 Pro",type:"TMC5160",protocol:"SPI",senseResistor:.075,coolingCurrentThreshold:1.6,voltages:[24,36,48],maxCurrent:2.5},{id:"BTT-EZ5160-RGB",title:"BTT EZ5160 RGB",type:"TMC5160",protocol:"SPI",senseResistor:.05,coolingCurrentThreshold:3,voltages:[24,48,36,56],maxCurrent:4.7},{id:"MELLOW-FLY-HV-TMC5160-PRO-12",title:"Mellow FLY HV TMC5160 Pro v1.2",type:"TMC5160",protocol:"SPI",senseResistor:.033,coolingCurrentThreshold:3,voltages:[24,36,48],maxCurrent:4.25,external:!0},{id:"MELLOW-FLY-TMC2209",title:"Mellow FLY TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2},{id:"PRUSA-EINSY-RAMBO-TMC2130",title:"Prusa Einsy Rambo TMC2130",type:"TMC2130",protocol:"SPI",senseResistor:.22,coolingCurrentThreshold:.9,voltages:[24],maxCurrent:2},{id:"PRUSA-BUDDY-TMC2209",title:"Prusa Buddy TMC2209",type:"TMC2209",protocol:"UART",senseResistor:.11,coolingCurrentThreshold:1.1,voltages:[24],maxCurrent:2}]),eD=(e,r,t,n,i)=>{var a;return null===(a=e.presets)||void 0===a?void 0:a.slice().sort((e,r)=>i?r.run_current-e.run_current:e.run_current-r.run_current).find(e=>e.driver===r.type&&e.voltage===t&&e.sense_resistor===r.senseResistor&&(null==n||e.run_current===n))},eI=B.z.array(K).parse([{id:"generic",title:"Generic Stepper",maxPeakCurrent:2.8},{id:"BONDTECH-42H025H-0704-002",title:"Bondtech LGX Stepper",maxPeakCurrent:.7},{id:"LDO-42STH48-2504AC",title:"LDO-42STH48-2504AC",maxPeakCurrent:2.5,presets:[{run_current:1.1,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:1,driver_TOFF:3,driver_HEND:0,driver_HSTRT:0},{run_current:1.6,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:2,driver_TOFF:3,driver_HEND:0,driver_HSTRT:6},{run_current:1.6,voltage:24,driver:"TMC5160",sense_resistor:.075,driver_TBL:2,driver_TOFF:3,driver_HEND:0,driver_HSTRT:6},{run_current:1.768,voltage:48,driver:"TMC5160",sense_resistor:.075,driver_TBL:0,driver_TOFF:4,driver_HEND:0,driver_HSTRT:4}]},{id:"LDO-42STH40-1684AC",title:"LDO-42STH40-1684AC",maxPeakCurrent:1.68,presets:[{run_current:.4,voltage:24,driver:"TMC2130",sense_resistor:.22,driver_IHOLDDELAY:8,driver_TPOWERDOWN:0,driver_TBL:2,driver_TOFF:3,driver_HEND:1,driver_HSTRT:5,driver_PWM_FREQ:2,driver_PWM_GRAD:2,driver_PWM_AMPL:230,driver_PWM_AUTOSCALE:!0,driver_SGT:5},{run_current:.52,voltage:24,driver:"TMC2130",sense_resistor:.22,driver_IHOLDDELAY:8,driver_TPOWERDOWN:0,driver_TBL:2,driver_TOFF:3,driver_HEND:1,driver_HSTRT:5,driver_PWM_FREQ:2,driver_PWM_GRAD:4,driver_PWM_AMPL:240,driver_PWM_AUTOSCALE:!0,driver_SGT:3},{run_current:.8,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:1,driver_TOFF:3,driver_HEND:3,driver_HSTRT:0},{run_current:1.188,voltage:24,driver:"TMC2209",sense_resistor:.11,driver_TBL:0,driver_TOFF:3,driver_HEND:0,driver_HSTRT:0}]},{id:"LDO-42STH48-2004MAH",title:"LDO-42STH48-2004MAH",maxPeakCurrent:2,fullStepsPerRotation:400},{id:"LDO-42STH48-2004AC",title:"LDO-42STH48-2004AC",maxPeakCurrent:2},{id:"LDO-42STH25-1404MAC",title:"LDO-42STH25-1404MAC",maxPeakCurrent:1.4,fullStepsPerRotation:400,presets:[{voltage:24,driver:"TMC2209",sense_resistor:.11,run_current:.85,driver_TBL:1,driver_TOFF:3,driver_HEND:2,driver_HSTRT:0}]},{id:"LDO-42STH25-1004CL200E",title:"LDO-42STH25-1004CL200E",maxPeakCurrent:1},{id:"LDO-36STH20-1004AHG",title:"LDO-36STH20-1004AHG",maxPeakCurrent:1,presets:[{voltage:24,driver:"TMC2209",sense_resistor:.11,run_current:.707,driver_TBL:0,driver_HEND:6,driver_HSTRT:7,driver_TOFF:4}]},{id:"LDO-36STH17-1004AHG",title:"LDO-36STH17-1004AHG",maxPeakCurrent:1},{id:"LDO-35STH48-1684AH",title:"LDO-35STH48-1684AH",maxPeakCurrent:1.68}]);class eH{hasToolboard(){return null!=this.config.toolboard}getToolboard(){return this.config.toolboard}getMotionStepperName(){return"stepper_".concat(this.getMotionAxis())}getToolboardName(){if(null==this.config.toolboard)throw Error("Toolhead T".concat(this.getTool()," does not have a toolboard"));return"toolboard_".concat(this.getShortToolName())}getShortToolName(){return"t".concat(this.getTool())}getDescription(){var e;return null!==(e=this.config.description)&&void 0!==e?e:"the printer's toolhead"}getMotionAxis(){return this.config.axis===l.dual_carriage?l.dual_carriage:l.x}getExtruderAxis(){return this.config.axis===l.dual_carriage?l.extruder1:l.extruder}getToolCommand(){return"T".concat(this.getTool())}getTool(){return this.config.axis===l.dual_carriage?1:0}getSerialSuffix(){return"t".concat(this.getTool())}getExtruder(){return this.config.extruder}getHotend(){return this.config.hotend}getThermistor(){return this.config.thermistor}getXEndstop(){return this.config.xEndstop}getYEndstop(){return this.config.yEndstop}getXAccelerometer(){return this.config.xAccelerometer}getYAccelerometer(){return this.config.yAccelerometer}getXAccelerometerName(){var e;switch(null===(e=this.getXAccelerometer())||void 0===e?void 0:e.id){case"controlboard":return"controlboard";case"toolboard":if(this.hasToolboard())return this.getToolboardName();case"sbc":return"rpi";default:return"controlboard"}}getYAccelerometerName(){var e;switch(null===(e=this.getYAccelerometer())||void 0===e?void 0:e.id){case"controlboard":return"controlboard";case"toolboard":if(this.hasToolboard())return this.getToolboardName();case"sbc":return"rpi";default:return"controlboard"}}getChangeSet(e){if(null==e)return null;let r={};return Object.keys(e).forEach(t=>{let n=this.getConfig()[t],i=e[t];if(null!=n&&null==i||null==n&&null!=i){r[t]=i;return}n&&i&&("object"==typeof n&&"id"in n&&"object"==typeof i&&"id"in i?n.id!==i.id&&(r[t]=i):n!==i&&(r[t]=i))}),eS.parse(r)}getProbe(){return this.config.probe}getPartFan(){return this.config.partFan}getHotendFan(){return this.config.hotendFan}serialize(){return eq(this.config)}getConfig(){return{...this.config}}constructor(e){this.config=e}}let eV=e=>{var r;return null!==(r=eL.find(r=>r.id===e))&&void 0!==r?r:null},eB=e=>{var r;return null!==(r=eI.find(r=>r.id===e))&&void 0!==r?r:null},eU=e=>{let r=eB(e.stepper),t=eV(e.driver);if(null==r)throw Error("Stepper ".concat(e.stepper," not found in database"));if(null==t)throw Error("Driver ".concat(e.driver," not found in database"));return Q.parse({...e,stepper:r,driver:t})},eW=e=>{let r=eB(e.stepper),t=eV(e.driver);if(null==r)throw Error("Stepper ".concat(e.stepper," not found in database"));if(null==t)throw Error("Driver ".concat(e.driver," not found in database"));return J.parse({...e,stepper:r,driver:t})},eX=e=>({id:e,title:e}),eZ=e=>er.parse({...e,driver:e.driver.id,stepper:e.stepper.id}),eq=e=>{var r,t,n,i;return{...e,toolboard:null===(r=e.toolboard)||void 0===r?void 0:r.id,hotend:e.hotend.id,thermistor:e.thermistor,extruder:e.extruder.id,probe:null===(t=e.probe)||void 0===t?void 0:t.id,xEndstop:e.xEndstop.id,yEndstop:e.yEndstop.id,partFan:e.partFan.id,hotendFan:e.hotendFan.id,xAccelerometer:null===(n=e.xAccelerometer)||void 0===n?void 0:n.id,yAccelerometer:null===(i=e.yAccelerometer)||void 0===i?void 0:i.id}},eY=e=>{var r,t,n,i,a,l,s,o,d,c;return null==e?void 0:{...e,toolboard:null===(r=e.toolboard)||void 0===r?void 0:r.id,hotend:null===(t=e.hotend)||void 0===t?void 0:t.id,thermistor:e.thermistor,extruder:null===(n=e.extruder)||void 0===n?void 0:n.id,probe:null===(i=e.probe)||void 0===i?void 0:i.id,xEndstop:null===(a=e.xEndstop)||void 0===a?void 0:a.id,yEndstop:null===(l=e.yEndstop)||void 0===l?void 0:l.id,partFan:null===(s=e.partFan)||void 0===s?void 0:s.id,hotendFan:null===(o=e.hotendFan)||void 0===o?void 0:o.id,xAccelerometer:null===(d=e.xAccelerometer)||void 0===d?void 0:d.id,yAccelerometer:null===(c=e.yAccelerometer)||void 0===c?void 0:c.id}},eG=new EventTarget,eK=(e,r)=>{eG.dispatchEvent(new CustomEvent("saveAtom",{detail:{itemKey:e,value:r}}))},eQ=()=>e=>{e.onSet(r=>{console.debug('RatOS Atom Sync Effect: new value was saved to moonraker "'.concat(e.trigger,'"'),e.node.key,r),eK(e.node.key,r)})},eJ=e=>{let{children:r}=e,t=b(),n=(0,u.useCallback)(async e=>{let r=await t.getItem(e);return null!=r?r:new p.nY},[t]),i=(0,u.useCallback)(async e=>{let{diff:r}=e;console.debug("Currently sidestepping recoil sync writes because of major bug: https://github.com/facebookexperimental/Recoil/issues/2059")},[]),a=(0,u.useCallback)(async e=>{let{itemKey:r,value:n}=e.detail;await t.saveItem(r,n)},[t]);return(0,u.useEffect)(()=>(eG.addEventListener("saveAtom",a),()=>{eG.removeEventListener("saveAtom",a)}),[a]),(0,o.jsx)(V.J1,{read:n,write:i,children:r})},e$={},e0=async e=>{let{read:r}=e,t=await r(e2.key);if(null!=t){let e=B.z.object({id:eO.shape.id}).safeParse(t);if(e.success){let r=e$[e.data.id];return null==r&&(r=await P.uF.printer.printer.query(e.data.id,{}))&&(e$[e.data.id]=r),null!=r?r:null}}return null},e1=e=>async r=>{let{read:t}=r,n=await t(e3(e).key);if(null!=n){let r=er.safeParse(n);if(r.success)return r.data;let i=await e0({read:t}),a=null==i?void 0:i.defaults.rails.find(r=>r.axis===e);if(null!=a){let e=er.safeParse({...a,...n});if(e.success)return e.data}}return null},e2=(0,p.cn)({key:"Printer",default:null,effects:[eQ(),(0,V.ok)({read:e0,write:async(e,r)=>{let{write:t}=e;await new Promise(e=>{r instanceof p.nY?t(e2.key,null):t(e2.key,null!=r?r:null),setTimeout(()=>{},500)})},refine:(0,U.getRefineCheckerForZodSchema)(eO.nullable())})]}),e4=(0,p.nZ)({key:"LoadablePrinterState",get:async e=>{let{get:r}=e,t=r((0,p.Qv)(e2));return({hasValue:()=>t.contents,hasError:()=>[],loading:()=>[]})[t.state]()}}),e5=(0,p.cn)({key:"PrinterOption",default:null,effects:[eQ(),(0,V.ok)({refine:(0,U.getRefineCheckerForZodSchema)(eA.shape.sizes.unwrap().element.nullable())})]}),e6=(0,p.cn)({key:"Controlboard",default:null,effects:[eQ(),(0,V.ok)({read:async e=>{let{read:r}=e,t=await r(e6.key);if(null!=t){let e=B.z.object({path:ed.shape.path}).safeParse(t);if(e.success){let r=await P.uF.mcu.boards.query({boardFilters:{toolboard:!1}}),t=r.find(r=>r.path===e.data.path);return null!=t?t:null}}return null},refine:(0,U.getRefineCheckerForZodSchema)(ed.nullable())})]}),e3=(0,p.xu)({key:"PrinterRail",default:null,effects:e=>[eQ(),(0,V.ok)({read:e1(e),refine:(0,U.getRefineCheckerForZodSchema)(er.nullable())})]}),e7=(0,p.nZ)({key:"PrinterRails",get:e=>{let{get:r}=e,t=r(e2),n=null==t?void 0:t.defaults.rails.map(e=>{let t=r(e3(e.axis));return eU(null!=t?t:e)});return null!=n?n:[]},set:(e,r)=>{let{set:t}=e;if(r instanceof p.nY){Object.values(l).forEach(e=>{t(e3(e),null)});return}r.forEach(e=>{t(e3(e.axis),eZ(e))})}}),e9=(0,p.nZ)({key:"LoadablePrinterRailsState",get:async e=>{let{get:r}=e,t=r((0,p.Qv)(e7));return({hasValue:()=>t.contents,hasError:()=>[],loading:()=>[]})[t.state]()}}),e8=(0,p.xu)({key:"PrinterToolhead",default:null,effects:e=>[eQ(),(0,V.ok)({read:async r=>{let{read:t}=r,n=await t(e8(e).key);if("object"!=typeof n||null==n)return null;let{toolNumber:i,...a}=n;if(null!=a){let r=ew.safeParse(a);if(r.success){let t=r.data.toolboard;if(t&&null!=t){let e=B.z.object({path:ec.shape.path}).safeParse(t);if(e.success){let r=await P.uF.mcu.boards.query({boardFilters:{toolboard:!0}}),n=r.find(r=>r.path===e.data.path);n&&(t=ec.parse(n))}}return{...r.data,toolboard:t,toolNumber:e}}console.debug("RecoilSync: failed to read toolhead!",e8(e).key,r.error,a)}return null},refine:(0,U.getRefineCheckerForZodSchema)(ek.extend({toolNumber:e_}).nullable())})]});(0,p.CG)({key:"DeserializeToolheadQuery",get:e=>async r=>{let{get:t}=r,n=ew.safeParse(await P.uF.printer.deserializeToolheadConfiguration.query({config:e.th,printerConfig:{controlboard:e.boardId}}));return n.success?{...n.data,toolNumber:e.toolNumber}:null}});let re=(0,p.nZ)({key:"PrinterToolheadsState",get:e=>{let{get:r}=e,t=r(e2);return null==t?[]:r((0,p.k9)(t.defaults.toolheads.map((e,r)=>e8(r)))).filter(Boolean)},set:(e,r)=>{let{set:t,reset:n}=e;if(r instanceof p.nY)throw Error("ToolheadsState cannot be reset, please reset the individual ToolheadState instead");r.forEach(e=>{t(e8(e.toolNumber),{...e,toolNumber:e.toolNumber})})}}),rr=(0,p.nZ)({key:"LoadablePrinterToolheadsState",get:async e=>{let{get:r}=e,t=r((0,p.Qv)(re));return({hasValue:()=>t.contents,hasError:()=>[],loading:()=>[]})[t.state]()}});function rt(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter(Boolean).join(" ")}let rn=()=>{let[e,r]=(0,u.useState)(!1),[t,n]=(0,u.useState)(!1),[i,a]=(0,u.useState)({title:"",children:null,dismissText:"OK"}),[l,s]=(0,u.useState)({title:"",children:null,dismissText:"OK"}),d=P.SX["klippy-extensions"].symlink.useMutation(),c=P.SX.mcu.flashAllConnected.useMutation(),m=e?(0,o.jsx)(H,{...l,setOpen:r,open:e,isFailed:d.isError,isLoading:d.isLoading}):null,x=t?(0,o.jsx)(H,{...i,setOpen:n,open:t,isFailed:c.isError,isLoading:c.isLoading}):null,h=(0,u.useCallback)(()=>{a({title:"Flash Firmware",children:(0,o.jsx)("p",{children:"Please wait while RatOS is flashing your connected boards..."}),dismissText:"Please wait..."}),n(!0),c.mutateAsync().then(e=>{a({title:"Flashing Complete",children:(0,o.jsx)("p",{dangerouslySetInnerHTML:{__html:e.report.replace(/\n/g,"<br />")}}),dismissText:"OK"})},e=>{a({title:"Flashing Failed",children:"string"==typeof e||e instanceof String?(0,o.jsx)("p",{dangerouslySetInnerHTML:{__html:e.replace(/\n/g,"<br />")}}):(0,o.jsx)("p",{children:"Something wen't wrong while flashing the connected boards, please try again."}),dismissText:"OK"})})},[c]),g=(0,u.useCallback)(()=>{s({title:"Symlink Extensions",children:(0,o.jsx)("p",{children:"Please wait while RatOS is symlinking klippy extensions..."}),dismissText:"Please wait..."}),r(!0),d.mutateAsync({}).then(e=>{s({title:"Symlink Complete",children:(0,o.jsx)("p",{dangerouslySetInnerHTML:{__html:e.report.replace(/\n/g,"<br />")}}),dismissText:"OK"})},e=>{s({title:"Symlink Failed",children:"string"==typeof e||e instanceof String?(0,o.jsx)("p",{dangerouslySetInnerHTML:{__html:e.replace(/\n/g,"<br />")}}):(0,o.jsx)("p",{children:"Something wen't wrong while symlinking the extensions, please try again."}),dismissText:"OK"})})},[d]),b=(0,p._8)(e=>{let{set:r}=e;return()=>{r(e8(0),null)}});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(F.v,{as:"div",className:"relative inline-block text-left",children:[(0,o.jsx)("div",{children:(0,o.jsxs)(F.v.Button,{className:"inline-flex w-full justify-center rounded-md border border-zinc-300 bg-white px-4 py-2 text-sm font-medium text-zinc-700 shadow-sm hover:bg-zinc-50 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 focus:ring-offset-zinc-100 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-400 dark:hover:border-zinc-600 dark:hover:bg-zinc-700 dark:focus:ring-offset-zinc-600 ",children:["Actions",(0,o.jsx)(A,{className:"-mr-1 ml-2 h-5 w-5","aria-hidden":"true"})]})}),(0,o.jsx)(M.u,{as:u.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,o.jsxs)(F.v.Items,{className:"absolute right-0 z-10 mt-2 w-56 origin-top-right divide-y divide-zinc-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:divide-zinc-800 dark:bg-zinc-900 dark:shadow-black dark:ring-zinc-800",children:[(0,o.jsx)("div",{className:"py-1",children:(0,o.jsx)(F.v.Item,{children:e=>{let{active:r}=e;return(0,o.jsx)("span",{onClick:g,className:rt(r?"bg-zinc-100 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-100":"text-zinc-700 dark:text-zinc-300","block cursor-pointer px-4 py-2 text-sm"),children:"Symlink klippy extensions"})}})}),(0,o.jsx)("div",{className:"py-1",children:(0,o.jsx)(F.v.Item,{children:e=>{let{active:r}=e;return(0,o.jsx)("span",{onClick:h,className:rt(r?"bg-zinc-100 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-100":"text-zinc-700 dark:text-zinc-300","block cursor-pointer px-4 py-2 text-sm"),children:"Flash all connected MCU's"})}})}),(0,o.jsx)("div",{className:"py-1",children:(0,o.jsx)(F.v.Item,{children:e=>{let{active:r}=e;return(0,o.jsx)("span",{onClick:b,className:rt(r?"bg-zinc-100 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-100":"text-zinc-700 dark:text-zinc-300","block cursor-pointer px-4 py-2 text-sm"),children:"Test toolhead state"})}})})]})})]}),m,x]})},ri=()=>{let[e,r]=(0,u.useState)(!1);return(0,u.useEffect)(()=>{r(!0)},[]),e},ra=e=>(0,o.jsxs)("svg",{className:(0,j.m)("h-5 w-5 animate-spin text-black dark:text-white",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});var rl=t(2726);let rs=e=>{var r,t,n,i,a,l;let{onStepChange:s}=e,[o,d]=(0,u.useState)(null==e.step||isNaN(e.step)||null==e.steps[e.step]?0:e.step),c=e.steps[o],p=(0,u.useRef)(o);p.current=o;let m=(0,u.useCallback)(e=>{null==s||s(e,"set"),d(e)},[s]);(0,u.useEffect)(()=>{e.step&&!isNaN(e.step)&&e.step!==p.current&&null!=e.steps[e.step]&&d(e.step)},[e.step,e.steps]);let x=o<e.steps.length-1,h=o>0,g=(0,u.useCallback)(()=>{d(e=>(null==s||s(e+1,"increment"),e+1))},[s]),b=(0,u.useCallback)(()=>{d(e=>(null==s||s(e-1,"decrement"),e-1))},[s]),v={..."extraScreenProps"in e?e.extraScreenProps:{},key:"step-"+o,hasNextScreen:x||null!==(a=null===(r=e.parentScreenProps)||void 0===r?void 0:r.hasNextScreen)&&void 0!==a&&a,hasPreviousScreen:h||null!==(l=null===(t=e.parentScreenProps)||void 0===t?void 0:t.hasNextScreen)&&void 0!==l&&l,nextScreen:x?g:(null===(n=e.parentScreenProps)||void 0===n?void 0:n.hasNextScreen)?e.parentScreenProps.nextScreen:void 0,previousScreen:h?b:(null===(i=e.parentScreenProps)||void 0===i?void 0:i.hasPreviousScreen)?e.parentScreenProps.previousScreen:void 0,skipSteps:e.parentScreenProps&&e.parentScreenProps.hasNextScreen?e.parentScreenProps.nextScreen:void 0},f="function"==typeof c.name?c.name(v):c.name,z="function"==typeof c.description?c.description(v):c.description,j={...v,name:f,description:z};return{screenProps:j,currentStepIndex:o,setCurrentStepIndex:m,currentStep:e.steps[o]}};var ro=t(8489);let rd=e=>(0,o.jsx)("nav",{"aria-label":"Progress",children:(0,o.jsx)("ol",{role:"list",className:"overflow-hidden",children:e.steps.map((r,t)=>{let n="function"==typeof r.name?r.name(e.screenProps):r.name,i="function"==typeof r.description?r.description(e.screenProps):r.description;return(0,o.jsx)("li",{className:(0,m.d)(t!==e.steps.length-1?"pb-10":"","relative"),children:e.currentStepIndex>t?(0,o.jsxs)(o.Fragment,{children:[t!==e.steps.length-1?(0,o.jsx)("div",{className:"absolute left-4 top-4 -ml-px mt-0.5 h-full w-0.5 bg-brand-600 dark:bg-brand-500","aria-hidden":"true"}):null,(0,o.jsxs)("span",{className:"group relative flex cursor-pointer items-start",onClick:()=>e.setCurrentStepIndex(t),children:[(0,o.jsx)("span",{className:"flex h-9 items-center",children:(0,o.jsx)("span",{className:"relative z-10 flex h-8 w-8 items-center justify-center rounded-full bg-brand-600 dark:bg-brand-500",children:(0,o.jsx)(ro,{className:"h-5 w-5 text-brand-100 dark:text-brand-900","aria-hidden":"true"})})}),(0,o.jsxs)("span",{className:"ml-4 flex min-w-0 flex-col",children:[(0,o.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide dark:text-zinc-200",children:n}),(0,o.jsx)("span",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:i})]})]})]}):e.currentStepIndex===t?(0,o.jsxs)(o.Fragment,{children:[t!==e.steps.length-1?(0,o.jsx)("div",{className:"absolute left-4 top-4 -ml-px mt-0.5 h-full w-0.5 bg-zinc-300 dark:bg-zinc-700","aria-hidden":"true"}):null,(0,o.jsxs)("span",{className:"group relative flex items-start","aria-current":"step",children:[(0,o.jsx)("span",{className:"flex h-9 items-center","aria-hidden":"true",children:(0,o.jsx)("span",{className:"relative z-10 flex h-8 w-8 items-center justify-center rounded-full border-2 border-brand-600 bg-white dark:border-brand-500 dark:bg-zinc-800",children:(0,o.jsx)("span",{className:"h-2.5 w-2.5 rounded-full bg-brand-600 dark:bg-brand-500"})})}),(0,o.jsxs)("span",{className:"ml-4 flex min-w-0 flex-col",children:[(0,o.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-brand-600 dark:text-brand-500",children:n}),(0,o.jsx)("span",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:i})]})]})]}):(0,o.jsxs)(o.Fragment,{children:[t!==e.steps.length-1?(0,o.jsx)("div",{className:"absolute left-4 top-4 -ml-px mt-0.5 h-full w-0.5 bg-zinc-300 dark:bg-zinc-700","aria-hidden":"true"}):null,(0,o.jsxs)("span",{className:"group relative flex items-start",children:[(0,o.jsx)("span",{className:"flex h-9 items-center","aria-hidden":"true",children:(0,o.jsx)("span",{className:"relative z-10 flex h-8 w-8 items-center justify-center rounded-full border-2 border-zinc-300 bg-white dark:border-zinc-700 dark:bg-zinc-800",children:(0,o.jsx)("span",{className:"h-2.5 w-2.5 rounded-full bg-transparent"})})}),(0,o.jsxs)("span",{className:"ml-4 flex min-w-0 flex-col",children:[(0,o.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-zinc-500 dark:text-zinc-200",children:n}),(0,o.jsx)("span",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:i})]})]})]})},n)})})});var rc=t(6167),ru=t(7487),rp=t(6890),rm=t.n(rp);let rx=(0,z.j)("inline-flex space-x-2 items-center px-4 py-2 border text-sm font-semibold rounded-md shadow-sm focus:outline-none focus:ring-2 capitalize",{variants:{color:{danger:"text-red-50 bg-red-500 hover:bg-red-600 border-transparent focus:ring-offset-2 focus:ring-red-600 dark:focus:ring-offset-zinc-900",warning:"text-yellow-900 bg-yellow-500 hover:bg-yellow-600 border-transparent focus:ring-offset-2 focus:ring-yellow-600 dark:focus:ring-offset-zinc-900",info:"text-blue-50 bg-blue-500 hover:bg-blue-600 border-transparent focus:ring-offset-2 focus:ring-blue-600 dark:focus:ring-offset-zinc-900",brand:"text-brand-900 bg-brand-500 hover:bg-brand-600 border-transparent focus:ring-offset-2 focus:ring-brand-600 dark:focus:ring-offset-zinc-900",gray:"border-zinc-300 bg-zinc-100 hover:bg-zinc-200 text-black dark:text-zinc-300 dark:bg-zinc-900 dark:border-zinc-700 dark:hover:bg-zinc-800 dark:hover:border-zinc-600 focus:ring-offset-2 focus:ring-brand-600 dark:focus:ring-offset-zinc-900",plain:"border-transparent bg-transparent text-zinc-700 dark:text-zinc-300 hover:underline hover:text-zinc-800 dark:hover:text-zinc-200 focus:ring-offset-2 focus:ring-zinc-900 dark:focus:ring-offset-zinc-100"},disabled:{true:"opacity-60 cursor-not-allowed"}},compoundVariants:[{color:"brand",disabled:!0,class:"hover:bg-brand-500"},{color:"danger",disabled:!0,class:"hover:bg-red-500"},{color:"warning",disabled:!0,class:"hover:bg-yellow-500"},{color:"gray",disabled:!0,class:"hover:bg-zinc-100 dark:hover:bg-zinc-900"},{color:"info",disabled:!0,class:"hover:bg-blue-500"}],defaultVariants:{color:"brand",disabled:!1}}),rh=e=>{let r=(0,j.m)(rx({color:e.color,disabled:e.disabled}),e.className);return e.href?(0,o.jsx)(rm(),{href:e.href,className:r,onClick:e.onClick,title:e.title,children:e.children}):e.dropdownItems&&null==e.onClick?(0,o.jsxs)(F.v,{as:"span",className:"relative inline-block text-left",children:[(0,o.jsxs)(F.v.Button,{className:r,title:e.title,disabled:!!e.disabled,children:[e.children,(0,o.jsx)(A,{className:"-mr-1 ml-2 h-5 w-5","aria-hidden":"true"})]}),(0,o.jsx)(M.u,{as:u.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,o.jsx)(F.v.Items,{className:"absolute right-0 z-10 mt-2 w-56 origin-top-right divide-y divide-zinc-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:divide-zinc-800 dark:bg-zinc-900 dark:shadow-black dark:ring-zinc-800",children:e.dropdownItems.map(e=>(0,o.jsx)("div",{className:"py-1",children:(0,o.jsx)(F.v.Item,{children:r=>{let{active:t}=r;return(0,o.jsx)("span",{onClick:e.onClick,className:(0,m.d)(t?"bg-zinc-100 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-100":"text-zinc-700 dark:text-zinc-300","block cursor-pointer break-words px-4 py-2 text-sm"),children:e.title})}})},e.title))})})]}):(0,o.jsx)("button",{className:r,onClick:e.disabled?void 0:e.onClick,title:e.title,children:e.children})},rg=e=>{var r,t,n;let i=e.left.isLoading?(0,o.jsx)(ra,{noMargin:!0,className:"mr-3 dark:text-black"}):(0,o.jsx)(rc,{className:"mr-3 h-5 w-5 rotate-180","aria-hidden":"true"}),a=e.left.onClick?(0,o.jsx)("div",{className:"flex flex-1 justify-start",children:(0,o.jsxs)(rh,{color:"gray",disabled:e.left.disabled,onClick:e.left.isLoading?void 0:e.left.onClick,title:e.left.title,className:e.left.isLoading?"cursor-wait":"cursor-pointer",children:[i,null!==(r=e.left.label)&&void 0!==r?r:"Back"]})}):null,l=e.right.isLoading?(0,o.jsx)(ra,{noMargin:!0,className:"ml-3 dark:text-black"}):(0,o.jsx)(rc,{className:"ml-3 h-5 w-5","aria-hidden":"true"}),s=e.right.onClick?(0,o.jsxs)("div",{className:"flex flex-1 justify-end space-x-4",children:[e.skip&&(0,o.jsxs)(rh,{color:"gray",onClick:e.skip.onClick,disabled:e.skip.disabled,title:e.skip.title,children:[null!==(t=e.skip.label)&&void 0!==t?t:"Skip",(0,o.jsx)(ru,{className:"ml-3 h-5 w-5","aria-hidden":"true"})]}),(0,o.jsxs)(rh,{color:"brand",disabled:e.right.disabled,onClick:e.right.isLoading?void 0:e.right.onClick,title:e.right.title,className:e.right.isLoading?"cursor-wait":"cursor-pointer",children:[null!==(n=e.right.label)&&void 0!==n?n:"Next",l]})]}):null;return(0,o.jsx)("div",{className:"px-8 pb-5",children:(0,o.jsxs)("nav",{className:"flex items-center justify-between border-t border-zinc-200    bg-white py-3 dark:border-zinc-700 dark:bg-zinc-800","aria-label":"Pagination",children:[a,s]})})};var rb=t(8582),rv=t(1395),rf=t(1108);let rz=B.z.object({printer:eA,controlboard:ed,toolheads:B.z.array(ew).min(1).max(2),size:B.z.number().optional().nullable(),controllerFan:ey,performanceMode:B.z.boolean().default(!1),stealthchop:B.z.boolean().default(!1),standstillStealth:B.z.boolean().default(!1),rails:B.z.array(ee)}).strict(),rj=rz.refine(e=>{var r;return null==e.size||(null!==(s=null===(r=e.printer.sizes)||void 0===r?void 0:r.length)&&void 0!==s?s:0)>0&&null!=e.size},"Printer size must be provided if printer has size options, otherwise it must be omitted").refine(e=>e.toolheads.map(e=>e.toolboard).filter(Boolean).length+e.controlboard.driverCount>=e.printer.driverCountRequired,"Your combination of controlboard and toolboards do not have enough stepper drivers for this printer"),ry=rz.extend({printer:eA.shape.id,controlboard:ed.shape.id,toolheads:B.z.array(eT).min(1).max(2),controllerFan:ey.shape.id,rails:B.z.array(er)}).strict(),rk=rj.innerType().innerType().extend({toolheads:B.z.array(eS).min(1).max(2)}).strict().partial().optional(),r_=ry.extend({toolheads:B.z.array(eC).min(1).max(2)}).strict().partial(),rN=(0,p.cn)({key:"PerformanceMode",default:!1,effects:[eQ(),(0,V.ok)({refine:(0,U.getRefineCheckerForZodSchema)(B.z.boolean().optional().nullable())})]}),rw=(0,p.cn)({key:"Stealchop",default:!1,effects:[eQ(),(0,V.ok)({refine:(0,U.getRefineCheckerForZodSchema)(B.z.boolean().optional().nullable())})]}),rS=(0,p.cn)({key:"StandstillStealth",default:!1,effects:[eQ(),(0,V.ok)({refine:(0,U.getRefineCheckerForZodSchema)(B.z.boolean().optional().nullable())})]}),rT=(0,p.cn)({key:"ControllerFan",default:{id:"2pin",title:"2-pin fan"},effects:[eQ(),(0,V.ok)({refine:(0,U.getRefineCheckerForZodSchema)(ey.nullable())})]}),rC=(0,p.nZ)({key:"PrinterConfiguration",get:async e=>{let{get:r}=e,{printer:t,printerSize:n,performanceMode:i,stealthchop:a,standstillStealth:l,rails:s,controlboard:o,controllerFan:d,toolheads:c}=r((0,p.k9)({printer:e2,printerSize:e5,performanceMode:rN,stealthchop:rw,standstillStealth:rS,rails:e7,controlboard:e6,controllerFan:rT,toolheads:re})),u=rk.safeParse({printer:null==t?null:{...t,defaults:{...t.defaults,toolheads:null==t?void 0:t.defaults.toolheads.map(e=>eq(e))}},size:n,performanceMode:i,stealthchop:a,standstillStealth:l,rails:s,controlboard:o,controllerFan:d,toolheads:c});return!1===u.success&&console.error(u.error.flatten().fieldErrors),u.success?u.data:null}}),rR=(0,p.nZ)({key:"LoadablePrinterConfigurationState",get:async e=>{let{get:r}=e,t=r((0,p.Qv)(rC));return({hasValue:()=>t.contents,hasError:()=>null,loading:()=>null})[t.state]()}}),rE=e=>{let r={printer:e.printer.id,toolheads:e.toolheads.map(e=>eq(e)),size:e.size,controlboard:e.controlboard.id,controllerFan:e.controllerFan.id,performanceMode:e.performanceMode,stealthchop:e.stealthchop,standstillStealth:e.standstillStealth,rails:e.rails.map(e=>eZ(e))};return ry.parse(r)},rP=e=>{var r,t,n,i;let a=null==e?void 0:null===(r=e.toolheads)||void 0===r?void 0:r.map(e=>eY(e)),l={printer:null==e?void 0:null===(t=e.printer)||void 0===t?void 0:t.id,toolheads:a,size:null==e?void 0:e.size,controlboard:null==e?void 0:null===(n=e.controlboard)||void 0===n?void 0:n.id,controllerFan:null==e?void 0:null===(i=e.controllerFan)||void 0===i?void 0:i.id,performanceMode:null==e?void 0:e.performanceMode,stealthchop:null==e?void 0:e.stealthchop,standstillStealth:null==e?void 0:e.standstillStealth};return r_.parse(l)},rF=()=>{let e=(0,p.sJ)(rR),r=(0,u.useMemo)(()=>rP(null!=e?e:{}),[e]);return r},rM=()=>{let[e,r]=(0,p.FV)(e2),[t,n]=(0,p.FV)(e5),[i,a]=(0,p.FV)(e6),[l,s]=(0,p.FV)(rN),[o,d]=(0,p.FV)(rw),[c,u]=(0,p.FV)(rS),[m,x]=(0,p.FV)(rT),h=(0,p.sJ)(e9),g=(0,p.sJ)(rR),b=rF(),v=rj.safeParse(g);return{selectedPrinter:e,setSelectedPrinter:r,selectedPrinterOption:t,setSelectedPrinterOption:n,selectedBoard:i,setSelectedBoard:a,performanceMode:l,setPerformanceMode:s,stealthchop:o,setStealthchop:d,standstillStealth:c,setStandstillStealth:u,selectedPrinterRails:h,selectedControllerFan:m,setSelectedControllerFan:x,partialPrinterConfiguration:g,serializedPrinterConfiguration:b,parsedPrinterConfiguration:v}},rA=e=>{let{open:r,onShown:t}=e;return(0,u.useEffect)(()=>{r&&t()},[r,t]),null},rO=(e,r,t)=>{var n;let[i,a]=(0,u.useState)(!1),l=rF(),s=null!=r?r:t?{}:void 0;s&&null!=t&&(s[t]=l);let o=P.SX.printer[e].useQuery(s,{enabled:i});return{options:null!==(n=o.data)&&void 0!==n?n:[],onShown:()=>a(!0),isFetching:o.isFetching}},rL=e=>{let{query:r,vars:t,serializedPrinterConfiguration:n,...i}=e,a=rO(r,t,n);return(0,o.jsx)(u.Suspense,{children:(0,o.jsx)(rD,{...i,...a})})},rD=e=>{var r;let{onSelect:t,value:n}=e,i=(0,u.useCallback)(r=>{let n=e.options.find(e=>e.id===r);n&&(null==t||t(n))},[t,e.options]),a=!1==e.sort?e.options:e.options.slice(0).sort((e,r)=>e.title.localeCompare(r.title));return(0,o.jsx)(rb.R,{value:(null!==(r=null==n?void 0:n.id)&&void 0!==r?r:null===n)?null:void 0,onChange:i,disabled:e.disabled,children:r=>{var t,i;let{open:l}=r;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(rb.R.Label,{className:"block text-sm font-semibold leading-6 text-zinc-700 dark:text-zinc-300",children:e.label}),e.onShown&&(0,o.jsx)(rA,{open:l,onShown:e.onShown}),(0,o.jsxs)("div",{className:"relative mt-1",children:[(0,o.jsxs)(rb.R.Button,{className:"relative flex w-full cursor-default items-center justify-between rounded-md bg-white py-1.5 pl-3 pr-3 text-left text-zinc-900 shadow-sm ring-1 ring-inset ring-zinc-300 focus:outline-none focus:ring-2 focus:ring-brand-600 dark:bg-zinc-900 dark:text-zinc-300 dark:ring-zinc-700 dark:focus:ring-brand-400 sm:text-sm sm:leading-6",disabled:e.disabled,title:null==n?void 0:n.title,children:[(0,o.jsx)("span",{className:"flex-1 truncate",children:null!==(t=null==n?void 0:n.title)&&void 0!==t?t:"Pick from the list..."}),e.badge&&(0,o.jsx)(w,{...e.badge,color:null!==(i=e.badge.color)&&void 0!==i?i:e.disabled?"plain":e.badge.color,size:"sm",className:"-mr-1.5"}),!e.disabled&&(0,o.jsx)("span",{className:"pointer-events-none -mr-4 flex items-center pr-2",children:(0,o.jsx)(rv,{className:"h-5 w-5 text-zinc-400","aria-hidden":"true"})})]}),(0,o.jsx)(M.u,{show:l,as:u.Fragment,enter:"transition duration-150 ease-out",enterFrom:"transform translate-y-1 opacity-0",enterTo:"transform translate-y-0 opacity-100",leave:"transition duration-200 ease-out",leaveFrom:"transform translate-y-0 opacity-100",leaveTo:"transform translate-y-1 opacity-0",children:(0,o.jsxs)(rb.R.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md focus:outline-none dark:bg-zinc-900 dark:scrollbar-thumb-zinc-600 sm:text-sm",children:[e.isFetching&&(0,o.jsx)("div",{className:"px-3 py-2 text-sm text-zinc-400 dark:text-zinc-500",children:(0,o.jsx)(ra,{})}),!e.isFetching&&0===a.length&&(0,o.jsx)("div",{className:"px-3 py-2 text-sm text-zinc-400 dark:text-zinc-500",children:"No options available"}),a.map(e=>(0,o.jsx)(rb.R.Option,{className:e=>{let{active:r}=e;return(0,m.d)(r?"dark bg-brand-600 text-white":"text-zinc-900 dark:text-zinc-300","relative cursor-default select-none py-2 pl-3 pr-9")},value:e.id,children:r=>{let{selected:t,active:n}=r;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:(0,m.d)(t?"font-semibold":"font-normal","flex items-center space-x-2 truncate"),children:[(0,o.jsx)("span",{children:e.title})," ",e.badge&&(0,o.jsx)(w,{...e.badge,color:n?"plain":e.badge.color,size:"sm"})]}),t?(0,o.jsx)("span",{className:(0,m.d)(n?"text-white":"text-brand-600","absolute inset-y-0 right-0 flex items-center pr-4"),children:(0,o.jsx)(rf,{className:"h-5 w-5","aria-hidden":"true"})}):null]})}},e.id))]})})]})]})}})};var rI=t(5741);let rH=(0,z.j)("rounded-md p-4 border",{variants:{color:{red:[k({color:"red"}),_({color:"red"}),y({color:"red"})],yellow:[k({color:"yellow"}),_({color:"yellow"}),y({color:"yellow"})],orange:[k({color:"orange"}),_({color:"orange"}),y({color:"orange"})],green:[k({color:"green"}),_({color:"green"}),y({color:"green"})],lime:[k({color:"lime"}),_({color:"lime"}),y({color:"lime"})],blue:[k({color:"blue"}),_({color:"blue"}),y({color:"blue"})],sky:[k({color:"sky"}),_({color:"sky"}),y({color:"sky"})],indigo:[k({color:"indigo"}),_({color:"indigo"}),y({color:"indigo"})],purple:[k({color:"purple"}),_({color:"purple"}),y({color:"purple"})],pink:[k({color:"pink"}),_({color:"pink"}),y({color:"pink"})],brand:[k({color:"brand"}),_({color:"brand"}),y({color:"brand"})],gray:[k({color:"gray"}),_({color:"gray"}),y({color:"gray"})]}},defaultVariants:{color:"gray"}}),rV=e=>{let{Icon:r,className:t,title:n}=e;return(0,o.jsx)("div",{className:(0,j.m)(rH({color:e.color}),e.className),children:(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)(r,{className:(0,m.d)("h-5 w-5"),"aria-hidden":"true"})}),(0,o.jsxs)("div",{className:"ml-3 flex-1",children:[(0,o.jsx)("h3",{className:(0,m.d)("text-sm font-bold"),children:e.title}),(0,o.jsx)("div",{className:"mt-2 text-sm",children:(0,o.jsx)("div",{children:e.children})})]})]})})},rB=e=>(0,o.jsx)(rV,{color:"red",Icon:rI,title:e.title?"Error: "+e.title:"Error",className:(0,j.m)(e.className,"whitespace-pre-wrap"),children:e.children});var rU=t(3241);let rW=e=>(0,o.jsxs)(rU.r.Group,{as:"div",className:"flex items-center justify-between gap-x-2",children:[(0,o.jsxs)("span",{className:"flex flex-grow flex-col",children:[(0,o.jsx)(rU.r.Label,{as:"span",className:(0,j.m)("text-sm font-medium leading-6 text-zinc-700 dark:text-zinc-300",e.onLabel&&e.value&&"opacity-70",e.onLabel&&!e.value&&"text-brand-700 dark:text-brand-500"),passive:!0,children:e.label}),e.description&&(0,o.jsx)(rU.r.Description,{as:"span",className:"text-sm text-zinc-500 dark:text-zinc-400",children:e.description})]}),(0,o.jsx)(rU.r,{checked:e.value,onChange:e.onChange,className:(0,m.d)(e.value&&null==e.onLabel?"bg-brand-600":"bg-zinc-200 dark:bg-zinc-900","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none"),children:(0,o.jsx)("span",{"aria-hidden":"true",className:(0,m.d)(e.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-md shadow-black/20 ring-0 transition duration-200 ease-in-out dark:border-t dark:border-zinc-600 dark:bg-zinc-700 dark:shadow-black/100 ")})}),e.onLabel&&(0,o.jsx)("span",{className:"flex flex-grow flex-col",children:(0,o.jsx)(rU.r.Label,{as:"span",className:(0,j.m)("text-sm font-medium leading-6 text-zinc-700 dark:text-zinc-300",e.onLabel&&!e.value&&"opacity-70",e.onLabel&&e.value&&"text-brand-700 dark:text-brand-500"),passive:!0,children:e.onLabel})})]});var rX=t(1318),rZ=t(4740),rq=t(5747);let rY=0,rG=e=>{let r=(0,u.useRef)(rY++),{onChange:t}=e,[n,i]=(0,u.useState)(!1);(0,m.d)("h-5 w-5",(e.error,"text-red-500"));let a=e.error?(0,o.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:(0,o.jsx)(rq,{className:"h-5 w-5 text-red-500","aria-hidden":"true"})}):null,l=(0,m.d)(e.error?"ring-red-300 text-red-900 placeholder-red-300 focus:ring-red-500 dark:ring-red-500 dark:text-red-400 dark:placeholder-red-700":"ring-zinc-300 text-zinc-900 placeholder-zinc-300 focus:ring-brand-600 dark:ring-zinc-700 dark:text-zinc-100 dark:placeholder-zinc-700 dark:focus:ring-brand-400 ","block w-full rounded-md bg-white py-1.5 pl-3 pr-3 text-leftshadow-sm ring-1 ring-inset focus:outline-none dark:bg-zinc-900 sm:text-sm sm:leading-6 border-0"),s=e.error?(0,o.jsx)("p",{className:"mt-2 text-sm text-red-600",id:r.current+"-error",children:e.error}):null,d=e.help?(0,o.jsx)("p",{className:"mt-2 text-sm text-zinc-500",id:"email-description",children:e.help}):null,c=(0,u.useCallback)(r=>{null==t||t("number"===e.type?parseFloat(r.currentTarget.value):r.currentTarget.value)},[t,e.type]),p=(0,u.useCallback)(()=>{i(e=>!e)},[]),x="password"===e.type?(0,o.jsx)("div",{onClick:p,className:"absolute inset-y-0 ".concat(null!=a?"right-6":"right-0"," flex cursor-pointer items-center pr-3"),children:n?(0,o.jsx)(rX,{className:"h-5 w-5 text-zinc-400"}):(0,o.jsx)(rZ,{className:"h-5 w-5 text-zinc-400"})}):null;return(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-semibold leading-6 text-zinc-700 dark:text-zinc-300",children:e.label}),(0,o.jsxs)("div",{className:"relative mt-1 rounded-md shadow-sm",children:[(0,o.jsx)("input",{...e,type:n?"text":e.type,className:l,placeholder:e.placeholder,defaultValue:e.defaultValue,value:e.value,onChange:c,"aria-invalid":!!e.error,"aria-describedby":e.error?r.current+"-error":void 0}),a,x]}),null!=s?s:d]})};var rK=t(3114),rQ=t(9721),rJ=t(2255);let r$=(e,r)=>{let t=[];return(null==r?void 0:r.toolboard)!=null&&t.push({id:"endstop-toolboard",title:"Physical Endstop (toolboard)"}),(null==r?void 0:r.axis)===l.x&&(t.push({id:"endstop",title:"Physical Endstop"}),t.push({id:"sensorless",title:"Sensorless Homing"})),t},r0={id:"endstop",title:"Physical Endstop"},r1=e=>{let r=(0,p.sJ)(re),t=(0,u.useMemo)(()=>{if(null==e)return null;let t=null==r?void 0:r.filter(Boolean).map(e=>new eH(e)),n=null==t?void 0:t.find(r=>r.getTool()===e||r.getMotionAxis()===e||r.getExtruderAxis()===e);return n},[e,r]);return t},r2=function(e){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],t=(0,p.sJ)(rr),n=(0,u.useRef)(t);n.current!==t&&t.length>0&&(n.current=t.slice());let i=(0,u.useMemo)(()=>{var t;let i=null===(t=n.current)||void 0===t?void 0:t.filter(Boolean).map(e=>new eH(e)),a=null==i?void 0:i.find(r=>r.getTool()===e||r.getMotionAxis()===e||r.getExtruderAxis()===e);if(null==a&&r)throw Error("Toolhead with number or axis ".concat(e," not found"));return null!=a?a:null},[r,e,n.current]),[a,l]=(0,u.useState)(!1),s=(0,p._8)(e=>{let{set:r,snapshot:t}=e;return async e=>{var n,i;let s=new eH(e),o=await t.getPromise(e8(s.getTool()));if(null==o)throw Error("Toolhead ".concat(s.getToolCommand()," not found"));let d=new eH(o);if(e.extruder.id!=d.getExtruder().id&&null!=e.extruder.stepper){let t=eB(e.extruder.stepper);null!=t&&r(e3(s.getExtruderAxis()),r=>{var n;return null==r?null:{...r,stepper:t.id,current:null!==(n=e.extruder.current)&&void 0!==n?n:.71*t.maxPeakCurrent}})}(null===(n=e.toolboard)||void 0===n?void 0:n.id)!=(null===(i=d.getToolboard())||void 0===i?void 0:i.id)&&null==e.toolboard&&"endstop-toolboard"===e.xEndstop.id&&(e.xEndstop=r0),e.thermistor!=d.getThermistor()?l(!0):e.hotend.id==d.getHotend().id||a||(e.thermistor=e.hotend.thermistor);let c=ek.extend({toolNumber:e_}).nullable().parse({...e,toolNumber:d.getTool()});r(e8(d.getTool()),c)}},[a]);return{toolhead:i,setToolhead:s}},r4=e=>{var r,t,n,i,a,s,d;let c=r1(e.printerRailDefault.axis),m=(null==c?void 0:c.getExtruderAxis())===e.printerRailDefault.axis&&(null==c?void 0:c.hasToolboard())?c.getToolboard():e.selectedBoard,x=(0,p.Zl)(e3(e.printerRail.axis)),h=(null==m?void 0:m.integratedDrivers)&&m.integratedDrivers[e.printerRail.axis.startsWith("extruder")?l.extruder:e.printerRail.axis],[g,b]=(0,u.useState)(null!=h&&null!==(n=eV(h))&&void 0!==n?n:e.printerRail.driver),[v,f]=(0,u.useState)(e.printerRail.stepper),[z,j]=(0,u.useState)(e.performanceMode&&null!==(i=null===(r=e.printerRailDefault.performanceMode)||void 0===r?void 0:r.homingSpeed)&&void 0!==i?i:e.printerRailDefault.homingSpeed),[y,k]=(0,u.useState)(e.printerRail.motorSlot),_=P.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,hasToolboard:null!==(a=null==c?void 0:c.hasToolboard())&&void 0!==a&&a,boardPath:null!==(s=null==m?void 0:m.path)&&void 0!==s?s:""},{enabled:!!m});(0,u.useEffect)(()=>{_.data&&null==y&&k(_.data)},[_.data,y]);let N=X(m,g).map(r=>({...r,badge:null!=eD(v,g,r.id,void 0,e.performanceMode)?{children:"Tuned Preset",color:"sky"}:void 0})),[w,S]=(0,u.useState)(null!==(d=N.find(r=>{var t;return r.id===(e.performanceMode&&(null===(t=e.printerRailDefault.performanceMode)||void 0===t?void 0:t.voltage)?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage)}))&&void 0!==d?d:N[0]),[T,C]=(0,u.useState)(e.performanceMode&&e.printerRailDefault.performanceMode?e.printerRailDefault.performanceMode.current:e.printerRail.current),R=(0,u.useMemo)(()=>eD(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),E=(0,u.useMemo)(()=>eD(v,g,w.id,void 0,e.performanceMode),[v,g,w,e.performanceMode]),F=(0,u.useMemo)(()=>eD(v,g,w.id,T,e.performanceMode),[v,g,w,e.performanceMode,T]),M=eL.filter(e=>"UART"===e.protocol||(null==m?void 0:m.stepperSPI)!=null).map(r=>({...r,badge:null!=eD(v,r,w.id,void 0,e.performanceMode)?{children:"Tuned Preset",color:"sky"}:void 0})),A=eI.map(r=>({...r,badge:null!=eD(r,g,w.id,void 0,e.performanceMode)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,u.useEffect)(()=>{if(Z(e.printerRail,e.printerRailDefault,!e.performanceMode)){var r,t,n,i;e.performanceMode&&e.printerRailDefault.performanceMode?(j(null!==(r=e.printerRailDefault.performanceMode.homingSpeed)&&void 0!==r?r:e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&S(null!==(n=N.find(r=>{var n;return r.id===(null!==(t=null===(n=e.printerRailDefault.performanceMode)||void 0===n?void 0:n.voltage)&&void 0!==t?t:e.printerRailDefault.voltage)}))&&void 0!==n?n:N[0]),null!=e.printerRailDefault.performanceMode.current&&C(e.printerRailDefault.performanceMode.current)):(j(e.printerRailDefault.homingSpeed),S(null!==(i=N.find(r=>r.id===e.printerRailDefault.voltage))&&void 0!==i?i:N[0]),C(e.printerRailDefault.current))}},[e.performanceMode]),(0,u.useEffect)(()=>{let e=N.find(e=>e.id===w.id);if(!e){var r;S(E&&null!==(r=N.find(e=>e.id===E.voltage))&&void 0!==r?r:N[0]),E&&C(E.run_current)}},[N,w,E]),(0,u.useEffect)(()=>{x(eZ({axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,homingSpeed:z,motorSlot:y,driver:g,voltage:w.id,stepper:v,current:T}))},[T,g,e.printerRail.axis,e.printerRail.axisDescription,z,e.printerRail.rotationDistance,x,v,w.id,y]);let O=E&&E.run_current===T,L="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===l.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase();return e.isVisible?(0,o.jsxs)("div",{className:"break-inside-avoid-column rounded-md border border-zinc-300 p-4 shadow-lg dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"",children:[(0,o.jsx)("h3",{className:"text-sm font-medium leading-6 text-zinc-700 dark:text-zinc-300",children:L}),(0,o.jsx)("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:e.printerRail.axisDescription})]}),(0,o.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(null==m?void 0:m.motorSlots)!=null&&null!=y&&Object.keys(m.motorSlots).length>0&&(0,o.jsx)("div",{className:"col-span-2",children:(0,o.jsx)(rD,{label:"Motor Slot",options:Object.keys(m.motorSlots).map(e=>{var r,t;return(null===(r=m.motorSlots)||void 0===r?void 0:r[e].title)==null?null:{id:e,title:null===(t=m.motorSlots)||void 0===t?void 0:t[e].title}}).filter(Boolean),onSelect:e=>{k(e.id)},value:y?{id:y,title:null===(t=m.motorSlots)||void 0===t?void 0:t[y].title}:void 0})}),(0,o.jsx)("div",{className:"col-span-2",children:(0,o.jsx)(rD,{label:"Driver",options:M,onSelect:b,value:g,disabled:null!=h,badge:null!=h?{children:"Integrated",color:"sky"}:void 0})}),(0,o.jsx)("div",{className:"col-span-2",children:(0,o.jsx)(rD,{label:"Stepper",options:A,onSelect:f,value:v})}),(0,o.jsx)("div",{className:"col-span-1",children:(0,o.jsx)(rD,{label:"Voltage",options:N,onSelect:S,value:w})}),(0,o.jsx)("div",{className:"col-span-1",children:(0,o.jsx)(rG,{type:"number",label:"Current",value:T,onChange:C,inputMode:"decimal",step:"any",min:0,max:g.maxCurrent})}),v.maxPeakCurrent/1.41<T&&(0,o.jsxs)(rV,{Icon:rJ,color:"yellow",title:"Stepper overcurrent!",className:"col-span-2",children:["Your stepper motor is rated for ",Math.floor(100*v.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",T,"A."]}),null!=F&&(0,o.jsx)(rV,{Icon:rK,color:"brand",title:"Driver tuning applied!",className:"col-span-2",children:"RatOS preset applied automatically."}),(null==F?void 0:F.run_current)!==(null==R?void 0:R.run_current)&&E&&!O&&(0,o.jsxs)(rV,{Icon:rQ,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-2",children:["RatOS has a recommended preset for your current settings at ",E.run_current,"A. You can"," ",(0,o.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>C(E.run_current),children:["change the current to ",E.run_current,"A"]})," ","to apply the preset automatically."]})]})]}):null};var r5=t(6187);let r6=e=>(0,o.jsx)(rV,{color:"yellow",Icon:rq,title:e.title?"Warning: "+e.title:"Warning",className:e.className,children:e.children}),r3=e=>{var r,t,n,i,a,l,s,d,c,p,m;let{toolhead:x,setToolhead:h}=r2(e.toolOrAxis),[g,b]=(0,u.useState)(null!==(t=x.getHotend())&&void 0!==t?t:null),[v,f]=(0,u.useState)(null!==(n=x.getExtruder())&&void 0!==n?n:null),[z,N]=(0,u.useState)(null!==(i=x.getThermistor())&&void 0!==i?i:null),[w,S]=(0,u.useState)(null!==(a=x.getProbe())&&void 0!==a?a:null),[T,C]=(0,u.useState)(null!==(l=x.getXEndstop())&&void 0!==l?l:null),[R,E]=(0,u.useState)(null!==(s=x.getYEndstop())&&void 0!==s?s:null),[P,F]=(0,u.useState)(null!==(d=x.getPartFan())&&void 0!==d?d:null),[M,A]=(0,u.useState)(null!==(c=x.getHotendFan())&&void 0!==c?c:null),[O,L]=(0,u.useState)(null!==(p=x.getXAccelerometer())&&void 0!==p?p:null),[D,I]=(0,u.useState)(null!==(m=x.getYAccelerometer())&&void 0!==m?m:null);return((0,u.useEffect)(()=>{let e=x.getChangeSet({hotend:g,extruder:v,thermistor:z,probe:null!=w?w:void 0,xEndstop:T,yEndstop:R,partFan:P,hotendFan:M,xAccelerometer:O,yAccelerometer:D});e&&Object.keys(e).length>0&&h({...x.getConfig(),...e})},[v,g,M,P,w,z,O,T,D,R,h,x]),null==x)?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"mt-4",children:[(0,o.jsx)("h3",{className:"text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:"Toolhead..."}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:"Configure the hardware installed on your toolhead..."})]}),(0,o.jsx)("div",{className:"mt-4 border-t border-zinc-100 pt-4 sm:grid-cols-2 dark:border-zinc-700",children:(0,o.jsx)("div",{className:"mb-4 flex h-96 items-center justify-center",children:(0,o.jsx)(ra,{})})})]}):(0,o.jsxs)("div",{className:(0,j.m)(_({color:"gray"}),"col-span-1 rounded-md border p-4 shadow-lg"),children:[(0,o.jsxs)("div",{className:(0,j.m)(k({color:"gray"}),y({color:"gray"}),_({color:"gray"}),"-m-4 mb-0 rounded-t-md border-b p-4"),children:[(0,o.jsxs)("h3",{className:"text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:["Toolhead ",x.getToolCommand()," Hardware"]}),(0,o.jsxs)("p",{className:"mt-2 max-w-4xl text-sm",children:["Configure the hardware installed on ",x.getDescription().toLocaleLowerCase()]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 gap-4 pt-4 sm:grid-cols-2",children:[(0,o.jsx)("div",{children:(0,o.jsx)(rL,{query:"hotends",value:g,label:"Hotend",onSelect:b})}),(0,o.jsx)("div",{children:(0,o.jsx)(rL,{label:"Hotend Thermistor",query:"thermistors",onSelect:e=>{N(e.id)},value:eX(z)})}),(null===(r=x.getToolboard())||void 0===r?void 0:r.alternativePT1000Resistor)&&"PT1000"===x.getThermistor()&&(0,o.jsx)("div",{className:"col-span-2",children:(0,o.jsx)(r6,{title:"RatOS uses your toolboards alternate pullup resistor setting",children:"Your toolboard has an option to use a separate pullup resistor for PT1000 sensors. This is usually done by inserting a jumper. Make sure you read the documentation for your board on how to enable the alternative resistor or you'll get ADC temperature errors in klipper."})}),(0,o.jsx)("div",{children:(0,o.jsx)(rL,{label:"Extruder",query:"extruders",onSelect:f,value:v})}),(0,o.jsx)("div",{children:(0,o.jsx)(rL,{label:"Probe",query:"probes",onSelect:S,value:w})})]}),(0,o.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsx)("div",{children:(0,o.jsx)(rL,{vars:{toolOrAxis:x.getTool(),config:{}},serializedPrinterConfiguration:"config",label:"X Endstop",query:"xEndstops",onSelect:C,value:T})}),(0,o.jsx)("div",{children:(0,o.jsx)(rL,{vars:{toolOrAxis:x.getTool(),config:{}},serializedPrinterConfiguration:"config",label:"Y Endstop",query:"yEndstops",onSelect:E,value:R})})]}),(0,o.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsx)("div",{children:(0,o.jsx)(rL,{vars:{toolOrAxis:x.getTool(),config:{}},serializedPrinterConfiguration:"config",label:"Part cooling fan",query:"partFanOptions",onSelect:F,value:P})}),(0,o.jsx)("div",{children:(0,o.jsx)(rL,{vars:{toolOrAxis:x.getTool(),config:{}},serializedPrinterConfiguration:"config",label:"Hotend fan",query:"hotendFanOptions",onSelect:A,value:M})})]}),(0,o.jsxs)("div",{className:"mt-4 border-t border-zinc-100 pt-4 dark:border-zinc-700",children:[(0,o.jsx)("h3",{className:"text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:"Accelerometers"}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:"You can use the same accelerometer for both axes. If you don't plan on using an accelerometer, you can skip this and come back later if you change your mind."})]}),(0,o.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsx)("div",{children:(0,o.jsx)(rL,{vars:{toolOrAxis:x.getTool(),config:{}},serializedPrinterConfiguration:"config",label:"X axis accelerometer",query:"xAccelerometerOptions",onSelect:L,value:O,sort:!1})}),(0,o.jsx)("div",{children:(0,o.jsx)(rL,{vars:{toolOrAxis:x.getTool(),config:{}},serializedPrinterConfiguration:"config",label:"Y axis accelerometer",query:"yAccelerometerOptions",onSelect:I,value:D,sort:!1})})]})]})},r7=e=>{var r;let[t]=(0,r5.u)(),[n]=(0,r5.u)(),[i,a]=(0,u.useState)(!1),{selectedControllerFan:l,selectedBoard:s,selectedPrinter:d,performanceMode:c,setPerformanceMode:p,stealthchop:m,setStealthchop:x,standstillStealth:h,setStandstillStealth:g,selectedPrinterRails:b,setSelectedControllerFan:v,serializedPrinterConfiguration:f,parsedPrinterConfiguration:z,partialPrinterConfiguration:j}=rM(),y=[];return null!=j&&!1===z.success&&z.error.flatten().formErrors.forEach(e=>{y.push(e)}),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"p-8",children:[(0,o.jsxs)("div",{className:"mb-5 border-b border-zinc-200 pb-5 dark:border-zinc-700",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Select your printer hardware"}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:"If your hardware isn't listed, pick the one closest to it and override as necessary in printer.cfg later"})]}),(0,o.jsxs)("div",{ref:t,className:"flex flex-col",children:[y.length>0&&(0,o.jsx)(rB,{className:"mb-4",children:y.map(e=>(0,o.jsx)("div",{className:"mt-2",children:e},e))}),(0,o.jsx)("div",{className:"space-y-4",children:null==f?void 0:null===(r=f.toolheads)||void 0===r?void 0:r.map((e,r)=>null==e||null==e.axis?null:(0,o.jsx)(u.Suspense,{fallback:(0,o.jsx)(ra,{}),children:(0,o.jsx)(r3,{toolOrAxis:e.axis})},r))}),(0,o.jsxs)("div",{className:"mt-4 border-t border-zinc-100 pt-8 dark:border-zinc-700",children:[(0,o.jsx)("div",{className:"flex",children:(0,o.jsx)("h3",{className:"flex-1 text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:"Electronics"})}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:"Configure miscellaneous electronics settings"})]}),(0,o.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 sm:grid-cols-2 dark:border-zinc-700",children:(0,o.jsx)("div",{children:(0,o.jsx)(rL,{label:"Controller fan",query:"controllerFanOptions",vars:{config:f},onSelect:v,value:l})})}),(0,o.jsxs)("div",{className:"mt-4 border-t border-zinc-100 pt-8 dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsx)("h3",{className:"flex-1 text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:"Motion"}),(0,o.jsx)("div",{children:(0,o.jsx)(rW,{label:"Simple",onLabel:"Advanced",onChange:a,value:!!i})})]}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:"Configure your stepper motor and driver settings"})]}),(0,o.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 sm:grid-cols-2 dark:border-zinc-700",children:[(null==d?void 0:d.speedLimits.performance)&&(0,o.jsx)("div",{className:"col-span-2",children:(0,o.jsx)(rW,{label:"Performance mode",description:"Increases the stepper power, max acceleration and velocity. Not recommended for initial setup. Requires actively cooled drivers (controller fan).",onChange:p,value:!!c})}),(0,o.jsx)("div",{className:"col-span-2",children:(0,o.jsx)(rW,{label:"Stealtchop",description:"Silent operation at the cost of a 135 mm/s velocity limit and less positional accuracy. Not recommended unless quiteness is absolutely necessary.",onChange:x,value:!!m})}),(0,o.jsx)("div",{className:"col-span-2",children:(0,o.jsx)(rW,{label:"Standstill Stealth",description:"Makes steppers stilent when idling, but can cause unpredictable behavior on some drivers. Can result in skipped steps and positional errors, use with caution.",onChange:g,value:!!h})})]})]}),(0,o.jsx)("div",{children:d&&(0,o.jsx)("div",{className:"grid gap-4 py-4 sm:grid-cols-2",ref:n,children:b.map(e=>{let r=d.defaults.rails.find(r=>r.axis===e.axis);if(null==r)throw Error("No printer default for axis "+e.axis);return(0,o.jsx)(r4,{selectedBoard:s,printerRail:e,printerRailDefault:eW(r),performanceMode:c,isVisible:i},e.axis+(c?"performance":""))})})})]}),(0,o.jsx)(rg,{left:{onClick:e.previousScreen},right:{onClick:e.nextScreen,disabled:!z.success,title:!1===z.success?"Invalid printer configuration selected":void 0}})]})};var r9=t(5933);let r8=e=>{let[r]=(0,r5.u)(),t=null;if(e.isError){var n;t=(0,o.jsx)("div",{className:"mb-4",children:(0,o.jsx)(rB,{children:null===(n=e.error)||void 0===n?void 0:n.message})})}return e.isLoading&&(t=(0,o.jsx)("div",{className:"mb-4 flex items-center justify-center bg-zinc-800",children:(0,o.jsx)(ra,{})})),(0,o.jsx)("div",{ref:r,children:t})};var te=t(5298),tr=t(384);let tt=e=>{if(e.isError){var r;return(0,o.jsx)("div",{className:"mb-4 h-48",children:(0,o.jsx)(rB,{children:null===(r=e.error)||void 0===r?void 0:r.message})})}return!e.isLoading||e.isIdle||e.isPaused?null:(0,o.jsx)("div",{className:"absolute right-5 top-9 mb-4 flex items-center",children:(0,o.jsx)(ra,{})})};var tn=t(537);let ti=e=>(0,o.jsx)(rV,{color:"blue",Icon:tn,title:e.title?e.title:"Info",className:e.className,children:e.children}),ta=e=>{var r,t,n;let{data:i,error:a}=P.SX.mcu.dfuDetect.useQuery({boardPath:e.board.path,toolhead:null===(r=e.toolhead)||void 0===r?void 0:r.serialize()},{refetchInterval:1e3}),l=P.SX.mcu.dfuFlash.useMutation({onSuccess:e.onSuccess}),[s,d]=(0,u.useState)(!1),c=(0,u.useCallback)(async()=>{var r;d(!0),l.mutate({boardPath:e.board.path,toolhead:null===(r=e.toolhead)||void 0===r?void 0:r.serialize()},{onSettled:()=>d(!1)})},[l,e.board.path,e.toolhead]),p=a?(0,o.jsx)(rB,{children:a.message}):null,m="boardPath="+encodeURIComponent(e.board.path),x=null===(t=e.board.dfu)||void 0===t?void 0:t.instructions.map((e,r)=>(0,o.jsx)("li",{children:e},r)),h=i&&(null===(n=e.board.dfu)||void 0===n?void 0:n.hasBoot0Jumper)?(0,o.jsx)(ti,{title:"Reminder",children:"Make sure to remove the BOOT0 jumper from the board before flashing."}):null;return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("h3",{className:"text-xl font-medium text-zinc-900 dark:text-zinc-100",children:["Flashing ",e.board.name," via DFU"]}),p,(0,o.jsxs)("p",{className:"mt-4 text-zinc-500 dark:text-zinc-400",children:["Status: ",i?"DFU device detected":"DFU not detected"]}),h,(0,o.jsx)(rh,{color:"brand",disabled:!i||s,onClick:c,children:s?"Flashing...":i?"Flash":"Waiting for DFU..."}),(0,o.jsx)("h4",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:"DFU Boot Instructions"}),(0,o.jsxs)("div",{className:"prose mt-4 text-base text-zinc-500 dark:text-zinc-400",children:[(0,o.jsx)("ol",{className:"mb-4 list-decimal pl-4",children:x}),(0,o.jsx)("img",{src:"/configure/api/dfu-image?"+m,alt:"DFU boot buttons and/or jumper visualization"})]})]})};var tl=t(3967),ts=t(7110);let to=e=>{let{onClick:r,onClose:t}=e,[n,i]=(0,u.useState)(!0),a=(0,u.useCallback)(()=>{null==r||r(),i(!1)},[r]),l=(0,u.useCallback)(()=>{null==t||t(),i(!1)},[t]),s=e.success?(0,o.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full  bg-green-100 dark:bg-green-700",children:(0,o.jsx)(D,{className:"h-6 w-6 text-green-600 dark:text-green-100","aria-hidden":"true"})}):null;return(0,o.jsx)(M.u.Root,{show:n,as:u.Fragment,appear:!0,children:(0,o.jsx)(O.V,{as:"div",className:"fixed inset-0 z-10 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",onClose:l,children:(0,o.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,o.jsx)(M.u.Child,{as:u.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,o.jsx)(O.V.Overlay,{className:"fixed inset-0 bg-zinc-500 bg-opacity-75 transition-opacity dark:bg-zinc-800 dark:bg-opacity-75"})}),(0,o.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,o.jsx)(M.u.Child,{as:u.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,o.jsxs)("div",{className:"relative inline-block transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all dark:bg-zinc-900 sm:my-8 sm:w-full sm:max-w-sm sm:p-6 sm:align-middle",children:[(0,o.jsxs)("div",{children:[s,(0,o.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,o.jsx)(O.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:e.title}),(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsx)("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:e.body})})]})]}),(0,o.jsx)("div",{className:"mt-5 sm:mt-6",children:(0,o.jsx)("button",{type:"button",className:"inline-flex w-full justify-center rounded-md border border-transparent bg-brand-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 sm:text-sm",onClick:a,children:e.buttonLabel})})]})})]})})})},td=e=>{let[r,t]=(0,u.useState)(!1),{query:n,isReady:i}=b(),[a,l]=(0,u.useState)(!1),s=P.SX.mcu.compile.useMutation({onSuccess:()=>l(!0),onError:()=>l(!1)}),d=(0,E.useMutation)(()=>i?n("machine.shutdown"):Promise.reject("Cannot reboot raspberry pi: No connection to moonraker")),c=()=>{d.mutate()},p=()=>{t(!0)},m=s.isLoading?(0,o.jsxs)("span",{children:["Compiling... ",(0,o.jsx)(ra,{className:"ml-1 inline",noMargin:!0})]}):(0,o.jsxs)("span",{children:["Compile firmware ",(0,o.jsx)(tl,{className:"inline h-5 w-5"})]});return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("h3",{className:"text-xl font-medium text-zinc-900 dark:text-zinc-100",children:[e.board.manufacturer," ",e.board.name," was not detected"]}),(0,o.jsx)(rh,{color:"brand",onClick:a?void 0:()=>{var r;return s.mutate({boardPath:e.board.path,toolhead:null===(r=e.toolhead)||void 0===r?void 0:r.serialize()})},className:"w-52 justify-center",disabled:s.isLoading&&!a,href:a?"/api/download-firmware?boardPath="+encodeURIComponent(e.board.path):void 0,children:a?(0,o.jsxs)("span",{children:["Download firmware ",(0,o.jsx)(ts,{className:"inline h-5 w-5"})]}):m}),(0,o.jsxs)("div",{className:"prose mt-4 text-base text-zinc-500 dark:text-zinc-400",children:[(0,o.jsxs)("ol",{className:"mb-4 list-decimal pl-4",children:[(0,o.jsx)("li",{children:"Disconnect all wires except Power and USB, and make sure your jumpers are set correctly."}),(0,o.jsx)("li",{children:"Format the sd card for your board to FAT16 (sometimes just called FAT), or FAT32 with a clustersize of 8kb or 4kb."}),(0,o.jsx)("li",{children:"If you're reusing a card you've used for flashing before, be sure to delete ALL files on the card (or reformat it)."}),(0,o.jsx)("li",{children:"Copy the firmware binary onto the sd card for your board"}),(0,o.jsx)("li",{children:'Make sure the firmware file is called firmware.bin on the sd card (enable "display file extensions" in your file explorer). The file you downloaded will already have the correct name.'}),(0,o.jsx)("li",{children:"Safely eject the SD card through your operating system."}),(0,o.jsx)("li",{children:"Physically take out the sd card and insert it into your control board."}),(0,o.jsx)("li",{children:"Click the reset button on the board, or turn it off and back on again. NOTE: if the Raspberry Pi running RatOS is currently powered by your control board or the same power source, please shut it down safely first by using the button below. When the green light stops blinking and is turned off, you can cut the power."}),(0,o.jsx)("li",{children:'Click "Check board status" below.'})]}),(0,o.jsxs)("div",{className:"flex gap-x-4",children:[(0,o.jsx)(rh,{color:"gray",onClick:p,children:"Shutdown RatOS"}),(0,o.jsx)(rh,{color:"brand",onClick:e.onSuccess,children:"Check board status"})]})]}),r?(0,o.jsx)(to,{title:"Shutdown RatOS?",body:"You raspberry pi will shutdown and this page will become unresponsive until it's powered back on. Do not remove power before the green light on the Rasperry Pi has stopped blinking.",buttonLabel:"Shutdown",onClick:c,onClose:()=>setTimeout(()=>t(!1),500)}):null]})},tc=e=>{var r,t,n,i,a,l;let[s,d]=(0,u.useState)(!1),[c,p]=(0,u.useState)(null),[m,x]=(0,u.useState)(null),{selectedControlboard:h,selectedToolboard:g,toolhead:b}=e,v=b?g:h,f=null==v?void 0:v.board,z=P.SX.mcu.detect.useQuery({boardPath:null!==(r=null==v?void 0:v.board.path)&&void 0!==r?r:"",toolhead:null==b?void 0:b.serialize()},{refetchInterval:e=>!0!==e&&1e3,enabled:null!==v}),j=P.SX.mcu.unidentifiedDevices.useQuery(),y=P.SX.mcu.boardVersion.useQuery({boardPath:null!==(t=null==v?void 0:v.board.path)&&void 0!==t?t:"",toolhead:null==b?void 0:b.serialize()},{enabled:null!==v&&!!z.data&&!1===s,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),{data:k}=P.SX.klipperVersion.useQuery(void 0,{refetchInterval:6e4}),_=P.SX.mcu.flashViaPath.useMutation({onSuccess:()=>d(!1)}),N=(0,u.useCallback)(()=>{p(null),d(!0),x(null),z.remove(),y.remove()},[y,z]),w={onClick:e.nextScreen,label:"Next",disabled:!z.data||s},S={onClick:e.previousScreen},T=(0,u.useCallback)(()=>{null!=f&&(p("path"),_.mutate({boardPath:f.path,toolhead:null==b?void 0:b.serialize()}))},[_,f,b]),C=null;if(y.error&&!s)C=(0,o.jsxs)(u.Fragment,{children:[(0,o.jsxs)("h3",{className:"text-xl font-medium text-zinc-900 dark:text-zinc-100",children:[null==f?void 0:f.name," detected but is unresponsive."]}),(0,o.jsx)("p",{children:"Klipper doesn't seem to be running on your board, which may indicate faulty firmware or a faulty board. Please check your board and try flashing it again."}),(0,o.jsx)("p",{children:(0,o.jsxs)(rh,{color:"gray",onClick:N,children:[(0,o.jsx)("span",{children:"Flash again"})," ",(0,o.jsx)(te,{className:"inline h-5 w-5"})]})})]});else if(y.isFetching)C=(0,o.jsxs)(u.Fragment,{children:[(0,o.jsxs)("h3",{className:"text-xl font-medium text-zinc-900 dark:text-zinc-100",children:[(0,o.jsx)(ra,{className:"relative -top-0.5 mr-2 inline",noMargin:!0})," ",null==f?void 0:f.name," detected, checking version..."]}),(0,o.jsx)("p",{children:"Please wait while RatOS queries your board.."})]});else if(y.data||z.data&&!s){let e="dfu"===c&&(null==f?void 0:null===(n=f.dfu)||void 0===n?void 0:n.reminder)?(0,o.jsx)(ti,{title:"Reminder",children:null==f?void 0:null===(i=f.dfu)||void 0===i?void 0:i.reminder}):null,r=null!=y.data&&null!=k&&y.data!==k?(0,o.jsxs)(r6,{title:"Version mismatch",children:["The board is running version ",y.data," but you your pi is on version ",k,". If you want to update your board click 'flash again' below."]}):null;C=(0,o.jsxs)(u.Fragment,{children:[(0,o.jsxs)("h3",{className:"text-xl font-medium text-zinc-900 dark:text-zinc-100",children:[(0,o.jsx)(tr,{className:"relative -top-0.5 inline h-7 w-7 text-brand-700 dark:text-brand-500"})," ",null==f?void 0:f.name," detected"]}),e,r,(0,o.jsxs)("p",{children:["Proceed to the next step or"," ",(0,o.jsxs)(rh,{color:"gray",onClick:N,children:[(0,o.jsx)("span",{children:"Flash again"})," ",(0,o.jsx)(te,{className:"inline h-5 w-5"})]})]})]})}else if(null==c){let e=(null==f?void 0:f.dfu)!=null,r=!(null==f?void 0:f.isToolboard),t=z.data&&(null==f?void 0:f.flashScript)!=null,n=null===(a=j.data)||void 0===a?void 0:a.length,i=(0,o.jsx)(rh,{color:"gray",onClick:()=>p("dfu"),disabled:!e,className:"justify-center",title:e?void 0:"This board does not support DFU flashing.",children:"Flash manually via DFU"}),s=(0,o.jsx)(rh,{color:"gray",onClick:()=>p("sdcard"),disabled:!r,className:"justify-center",title:r?void 0:"This board does not support SD card flashing.",children:"Flash manually via SD card"}),d=(0,o.jsx)(rh,{color:"gray",onClick:T,disabled:!t,className:"justify-center",title:t?void 0:"Board was not detected.",children:"Flash automatically"}),c=(0,o.jsx)(rh,{color:"gray",className:"justify-center",disabled:!n,title:n?void 0:"No unidentified boards detected.",dropdownItems:null===(l=j.data)||void 0===l?void 0:l.map(e=>({onClick:()=>{null!=f&&(p("path"),x(e),_.mutate({boardPath:f.path,flashPath:e,toolhead:null==b?void 0:b.serialize()}))},title:e})),children:"Flash unidentified board"});C=(0,o.jsxs)(u.Fragment,{children:[(0,o.jsxs)("h3",{className:"text-xl font-medium text-zinc-900 dark:text-zinc-100",children:["How do you want to flash your ",null==f?void 0:f.name,"?"]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3",children:[d,i,s,c]})]})}else if(null==f)C=(0,o.jsx)("div",{children:(0,o.jsx)("div",{className:"prose mt-4 text-base text-red-700",children:"You have to select a board before navigating to this screen."})});else switch(c){case"dfu":C=(0,o.jsx)(ta,{board:f,onSuccess:()=>d(!1),toolhead:b});break;case"sdcard":C=(0,o.jsx)(td,{board:f,onSuccess:()=>d(!1),toolhead:b});break;case"path":C=(0,o.jsxs)("div",{children:[(0,o.jsxs)("h3",{className:"text-xl font-medium text-zinc-900 dark:text-zinc-100",children:["Flashing ",f.name,m?" at ".concat(m):"","..."]}),(0,o.jsx)("div",{className:"prose mt-4 text-base text-zinc-500",children:"Please wait while RatOS flashes your board."}),(0,o.jsx)(tt,{..._})]})}return(0,o.jsxs)(u.Fragment,{children:[(0,o.jsxs)("div",{className:"p-8",children:[" ",(0,o.jsxs)("div",{className:"mb-5 border-b border-zinc-200 pb-5 dark:border-zinc-700",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:e.name}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:e.description})]}),(0,o.jsxs)("div",{className:"space-y-4 text-zinc-700 dark:text-zinc-300",children:[e.children,C]})]}),(0,o.jsx)(rg,{right:w,left:S})]})};var tu=t(464);let tp=e=>{let[r,t]=(0,u.useState)(null),{onSelect:n}=e,[i]=(0,r5.u)(),a=(0,u.useCallback)(r=>{void 0===e.value&&t(r),null==n||n(r)},[n,e.value]);return(0,u.useEffect)(()=>{void 0!==e.value&&t(e.value)},[e.value]),(0,o.jsxs)(tu.E,{value:r,onChange:a,children:[(0,o.jsx)(tu.E.Label,{className:"sr-only",children:"Selector"}),(0,o.jsx)("div",{className:"space-y-4",ref:i,children:e.cards.map((r,t)=>(0,o.jsx)(tu.E.Option,{value:r,className:e=>{let{checked:r,active:t}=e;return(0,m.d)(r?"border-transparent":"border-zinc-300 dark:border-zinc-700",t?"ring-2 ring-brand-600":"","relative flex cursor-pointer justify-between items-center rounded-lg border bg-white px-4 py-4 shadow-sm focus:outline-none dark:bg-zinc-900")},children:t=>{let{active:n,checked:i}=t;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)(tu.E.Label,{as:"p",className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 flex items-center space-x-2 mb-1",children:e.title?e.title(r):r.name}),(0,o.jsx)(tu.E.Description,{as:"div",className:"text-xs text-zinc-500 dark:text-zinc-400",children:(0,o.jsx)("p",{className:"sm:inline",children:r.details})})]}),(0,o.jsx)(tu.E.Description,{as:"div",className:"mt-2 flex text-sm ml-4 sm:mt-0 sm:block sm:text-right",children:r.right}),(0,o.jsx)("div",{className:(0,m.d)(n?"border":"border-2",i?"border-brand-600":"border-transparent","pointer-events-none absolute -inset-px rounded-lg"),"aria-hidden":"true"})]})}},r.id))})]})},tm=e=>{let{toolhead:r,skipSteps:t,setSelectedBoard:n,selectedControlboard:i,selectedToolboard:a,selectedPrinter:l,cards:s}=e,d=(0,u.useCallback)(function(){var e;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return null!=l&&(null!==(e=null==r?void 0:r.board.driverCount)&&void 0!==e?e:0)<l.driverCountRequired},[i,l]),c=(0,o.jsx)(tp,{cards:s,value:r?a:i,onSelect:n,title:e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{children:e.name}),e.board.detected&&(0,o.jsx)(w,{color:"green",size:"sm",children:"Detected"}),!r&&d(e)&&(0,o.jsx)(w,{color:"yellow",size:"sm",children:"Toolboard required"})]})}),p={onClick:e.nextScreen,label:"Next",disabled:!0},m={onClick:e.previousScreen},x=(0,u.useCallback)(()=>{r&&t&&(n(null),null==t||t())},[r,t,n]),h=r&&!d()&&e.skipSteps?{onClick:x,label:"Skip"}:void 0;return(r&&null!=a||!r&&null!=i)&&(p={onClick:e.nextScreen,label:"Next"}),(0,o.jsxs)(u.Fragment,{children:[(0,o.jsxs)("div",{className:"p-8",children:[" ",(0,o.jsxs)("div",{className:"mb-5 flex border-b border-zinc-200 pb-5 dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:e.name}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:e.description})]}),r&&null!=a&&(0,o.jsx)("div",{children:(0,o.jsx)(rh,{onClick:()=>n(null),color:"danger",children:"Clear selection"})})]}),e.children,c]}),(0,o.jsx)(rg,{right:p,left:m,skip:h})]})},tx=[{id:"01",name:e=>"Pick ".concat(e.toolhead?"".concat(e.toolhead.getToolCommand()," Toolboard"):"Control board"),description:e=>"Pick the ".concat(e.toolhead?"toolboard for ".concat(e.toolhead.getDescription(),"."):"control board. Toolboard(s) can be added in a later step."),href:"#",renderScreen:e=>(0,u.createElement)(tm,{...e,key:e.key})},{id:"02",name:e=>"".concat(e.toolhead?"".concat(e.toolhead.getToolCommand()," Toolboard"):"Control board"," flashing"),description:e=>"Make sure your ".concat(e.toolhead?"toolboard for ".concat(e.toolhead.getDescription()):"control board"," is flashed and up to date."),href:"#",renderScreen:e=>(0,u.createElement)(tc,{...e,key:e.key})}],th=e=>{var r,t,n,i;let{selectedPrinter:a,selectedBoard:l,setSelectedBoard:s}=rM(),{toolhead:d,setToolhead:c}=r2(e.toolOrAxis,!1),p=P.SX.mcu.boards.useQuery({boardFilters:{toolboard:null!=d,driverCountRequired:null!=d?void 0:(null!==(r=null==a?void 0:a.driverCountRequired)&&void 0!==r?r:0)-(null!==(t=null==a?void 0:a.defaults.toolheads.length)&&void 0!==t?t:1)},toolhead:null==d?void 0:d.serialize()}),m=(0,u.useMemo)(()=>p.isError||null==p.data?[]:p.data.map(e=>({id:e.id,board:e,name:"".concat(e.manufacturer," ").concat(e.name),details:(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"Automatic flashing:"})," ",e.flashScript&&!e.disableAutoFlash?"Yes":"No"]}),right:(0,o.jsx)(r9,{className:"h-8 w-8 text-zinc-500"})})),[p.isError,p.data]),x=null!==(n=m.find(e=>e.board.id==(null==l?void 0:l.id)))&&void 0!==n?n:null,h=null!==(i=m.find(e=>{var r;return e.board.id==(null===(r=null==d?void 0:d.getToolboard())||void 0===r?void 0:r.id)}))&&void 0!==i?i:null,g=(0,u.useCallback)(e=>{d?c({...d.getConfig(),toolboard:null==e?null:ec.parse(e.board)}):null!=e&&s(ed.parse(e.board))},[s,c,d]),b={selectedControlboard:x,selectedToolboard:h,cards:m,setSelectedBoard:g,selectedPrinter:a,toolhead:d},{currentStep:v,screenProps:f}=rs({steps:tx,parentScreenProps:e,extraScreenProps:b});return v.renderScreen({...f,...b,children:(0,o.jsx)(r8,{...p})})};var tg=t(2805),tb=t.n(tg);let tv=e=>{let[r,t]=(0,u.useState)(null),[n,i]=(0,u.useState)(null),a=(0,u.useRef)({selected:r,selectedOption:n}),{onSelect:l}=e,[s]=(0,r5.u)(),d=(0,u.useCallback)(r=>{if(a.current.selected!==r){var n,s,o,d,c,u;void 0===e.value&&(t(r),void 0===e.optionValue&&i(null!==(d=null===(o=r.options)||void 0===o?void 0:o[0])&&void 0!==d?d:null)),a.current.selected=r,a.current.selectedOption=null!==(c=null===(n=r.options)||void 0===n?void 0:n[0])&&void 0!==c?c:null,null==l||l(r,null!==(u=null===(s=r.options)||void 0===s?void 0:s[0])&&void 0!==u?u:null)}},[l,e.value,e.optionValue]),c=(0,u.useCallback)((r,n)=>{void 0===e.value&&(t(r),i(n)),a.current.selected=r,a.current.selectedOption=n,null==l||l(r,n)},[l,e.value]);return(0,u.useEffect)(()=>{void 0!==e.value&&e.value!==a.current.selected&&t(e.value),void 0!==e.optionValue&&e.optionValue!==a.current.selectedOption&&i(e.optionValue)},[e.value,e.optionValue]),(0,o.jsxs)(tu.E,{value:r,onChange:d,children:[(0,o.jsx)(tu.E.Label,{className:"sr-only",children:"Selector"}),(0,o.jsx)("div",{className:"space-y-4",ref:s,children:e.cards.map((e,t)=>(0,o.jsx)(tu.E.Option,{value:e,className:e=>{let{checked:r,active:t}=e;return(0,m.d)(r?"border-transparent":"border-zinc-300 dark:border-zinc-700",t?"ring-2 ring-brand-600 dark:ring-brand-500":"","relative cursor-pointer rounded-lg border bg-white px-4 py-4 shadow-sm focus:outline-none dark:bg-zinc-800")},children:t=>{let{active:i,checked:a}=t;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)(tu.E.Label,{as:"p",className:"text-sm font-bold text-zinc-900 dark:text-zinc-100",children:e.name}),(0,o.jsx)(tu.E.Description,{as:"div",className:"text-xs text-zinc-500 dark:text-zinc-400",children:(0,o.jsx)("p",{className:"sm:inline",children:e.details})})]}),(0,o.jsx)(tu.E.Description,{as:"div",className:"mb-2 flex text-sm ml-4 sm:block sm:text-right",children:e.right})]}),null!=e.options&&(0,o.jsxs)(tu.E,{value:(null==r?void 0:r.id)===e.id?n:null,onChange:r=>c(e,r),className:"mt-2",children:[(0,o.jsx)(tu.E.Label,{className:"sr-only",children:" Choose a memory option "}),(0,o.jsx)("div",{className:"grid grid-cols-3 gap-3 sm:grid-cols-6",children:e.options.map(e=>(0,o.jsx)(tu.E.Option,{value:e,className:e=>{let{active:r,checked:t}=e;return(0,j.m)(r||t?"ring-2":"ring-1","ring-inset flex items-center justify-center rounded-md px-3 py-3 text-sm font-semibold uppercase sm:flex-1",k({color:t?"brand":"gray"}),_({color:r||t?"brand":"gray"}),y({color:r||t?"brand":"gray"}))},children:(0,o.jsx)(tu.E.Label,{as:"span",children:e.name})},e.name))})]}),(0,o.jsx)("div",{className:(0,m.d)(i?"border":"border-2",a?"border-brand-600":"border-transparent","pointer-events-none absolute -inset-px rounded-lg"),"aria-hidden":"true"})]})}},e.id))})]})},tf=e=>e.queryErrors.length>0&&e.showErrors?(0,o.jsx)(rB,{className:"mb-4",children:e.queryErrors.map(e=>(0,o.jsx)("div",{className:"mt-2",children:e},e))}):e.isReady||0!==e.queryErrors.length?e.children:(0,o.jsx)("div",{className:"flex h-12 items-center justify-center",children:(0,o.jsx)(ra,{})}),tz=e=>{var r,t;let n=P.SX.printer.printers.useQuery(),i=(0,p.sJ)(e4),a=(0,p.sJ)(e5),l=n.data?n.data.slice().sort((e,r)=>"Rat Rig"===e.manufacturer&&("Rat Rig"!==r.manufacturer||r.description.indexOf("Discontinued")>-1)?-1:e.name.localeCompare(r.name)).map(e=>{let r="printerId="+encodeURIComponent(e.id);return{id:e.id,name:"".concat(e.manufacturer," ").concat(e.name),details:e.description,printer:e,right:(0,o.jsx)(tb(),{src:"/configure/api/printer-image?"+r,width:50,className:"rounded-lg bg-white p-1 shadow-md dark:shadow-zinc-900",height:50,alt:"".concat(e.manufacturer," ").concat(e.name)}),options:e.sizes?e.sizes.map(e=>({id:e,name:e+""})):void 0}}):[],s=l.find(e=>e.id===(null==i?void 0:i.id)),d=null==s?void 0:null===(r=s.options)||void 0===r?void 0:r.find(e=>e.id===a),c=(0,p._8)(e=>{let{set:r,reset:t,snapshot:n}=e;return async(e,i)=>{var a,l;let s=e.printer;if(null==s){console.error("No printer found matching the criteria");return}let o=await n.getPromise(re);if(o.forEach(e=>{t(e8(e.toolNumber))}),r(e2,s),(null!==(l=null===(a=s.sizes)||void 0===a?void 0:a.length)&&void 0!==l?l:0)>0){if(null==i||"number"!=typeof i.id)throw Error("An option must be selected for printers that come in different size configurations");r(e5,i.id)}else r(e5,null);r(re,s.defaults.toolheads.map(e=>({...e,toolNumber:new eH(e).getTool()}))),t(rN),t(rw),t(rS),t(rT),t(e7)}},[n.data]),[u]=(0,r5.u)(),m=n.error?[null===(t=n.error)||void 0===t?void 0:t.message]:[];return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"p-8",ref:u,children:[" ",(0,o.jsxs)("div",{className:"mb-5 border-b border-zinc-200 pb-5 dark:border-zinc-700",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Select your printer"}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:"This will determine the template used for printer.cfg"})]}),(0,o.jsx)(tf,{isReady:n.isFetched,queryErrors:m,children:(0,o.jsx)(tv,{cards:l,onSelect:c,value:s,optionValue:d})})]}),(0,o.jsx)(rg,{left:{onClick:e.previousScreen},right:{onClick:e.nextScreen,disabled:null==i,title:null==i?"You have to select a printer":void 0}})]})};var tj=t(2998);let ty=e=>e>=-40?(0,o.jsx)("span",{className:"font-semibold text-green-700",children:"Excellent"}):e>=-67?(0,o.jsx)("span",{className:"font-semibold text-lime-600",children:"Very good"}):e>=-70?(0,o.jsx)("span",{className:"font-semibold text-yellow-600",children:"Okay"}):e>=-80?(0,o.jsx)("span",{className:"font-semibold text-orange-500",children:"Not good"}):e>=-100?(0,o.jsx)("span",{className:"font-semibold text-red-600",children:"Unusable"}):void 0,tk=B.z.object({hostname:B.z.string().min(2).regex(/^([a-zA-Z0-9]|-)+$/,"Hostname can only include a-Z, 0-9 and dashes.")}),t_=B.z.object({ssid:B.z.string(),passphrase:B.z.string().min(8).max(63),country:B.z.string().optional()}),tN=e=>{var r;let[t,n]=(0,u.useState)({}),[i,a]=(0,u.useState)(null),[l,s]=(0,u.useState)(""),[d,c]=(0,u.useState)("ratos"),[p,m]=(0,u.useState)(!1),{isError:x,error:h,data:g}=P.SX.wifi.scan.useQuery(void 0,{refetchInterval:(e,r)=>!r.state.error&&1e3,retry:!1}),b=P.SX.wifi.hostname.useMutation(),v=P.SX.wifi.join.useMutation();(0,u.useEffect)(()=>{n(e=>{let r={...e};return null==g||g.forEach(e=>{r[e.address]=e}),r})},[g]);let f=tk.safeParse({hostname:d}),z=t_.safeParse({passphrase:l,ssid:null==i?void 0:i.ssid}),j=(0,u.useMemo)(()=>{var e;return x?[]:Object.keys(t).map(r=>({name:null!==(e=t[r].ssid)&&void 0!==e?e:"Unknown Network",id:r,details:(0,o.jsxs)("div",{className:"gap-4 md:grid md:grid-cols-2",children:[(0,o.jsxs)("div",{className:"md:col-span-1",children:[(0,o.jsx)("span",{className:"font-semibold",children:"Signal Strength:"})," ",ty(t[r].signal)]}),(0,o.jsxs)("div",{className:"md:col-span-1",children:[(0,o.jsx)("span",{className:"font-semibold",children:"Frequency:"})," ",Math.round(t[r].frequency/100)/10,"GHz"]})]}),right:(0,o.jsx)(tj,{className:"h-8 w-8 text-zinc-500 dark:text-zinc-400"})}))},[x,t]),y=(0,u.useCallback)(e=>{a(t[e.id])},[t]),k=(0,u.useCallback)(()=>{if(null==i||null==i.ssid)throw Error("Cannot join wifi without selecting a network");v.mutate({passphrase:l,ssid:i.ssid,country:i.country})},[l,i,v]),_=P.SX.reboot.useMutation(),N=(0,u.useCallback)(async()=>{await _.mutateAsync(),window.close()},[_]),w=(0,u.useCallback)(async()=>{await b.mutateAsync({hostname:d}),m(!0)},[b,d]),S=i&&v.isSuccess&&p&&!_.isSuccess&&!_.isError?(0,o.jsx)(to,{title:"Settings saved!",body:"RatOS is now setup to connect to ".concat(i.ssid,"! Your raspberry pi will now reboot, and join your local wifi network. Click the button below to reboot the pi and close this window. You can then reconnect to your local network where http://").concat(d,".local/ should be available in a few minutes. If RatOS fails to join ").concat(i.ssid,', it will recreate the "ratos" hotspot and you\'ll have to try again.'),buttonLabel:"Got it!",onClick:N}):_.isError?(0,o.jsx)("div",{className:"mb-4 h-48",children:(0,o.jsx)(rB,{children:_.error.message})}):_.isLoading||_.isSuccess?(0,o.jsxs)("div",{className:"mb-4 h-48",children:[(0,o.jsx)("div",{className:"mb-4 flex items-center justify-center font-bold text-zinc-900 dark:text-zinc-100",children:"Rebooting..."}),(0,o.jsx)("div",{className:"mb-4 flex items-center justify-center  text-zinc-600 dark:text-zinc-400",children:(0,o.jsxs)("div",{children:["Please reconnect to ",null!==(r=null==i?void 0:i.ssid)&&void 0!==r?r:"your local network"," and visit"," ",(0,o.jsxs)("a",{href:"http://".concat(d,".local/configure?step=1"),className:"text-brand-600 dark:text-brand-400",children:["http://",d,".local/configure?step=1"]})," ","in a few minutes."]})})]}):i&&v.isSuccess?(0,o.jsx)(rG,{label:"Printer hostname",type:"text",defaultValue:"RatOS",error:b.isError?b.error.message:f.success?void 0:f.error.issues[0].message,onChange:e=>c(e),help:'Only use characters from a-Z and dashes. For example, entering "RatOS" will make your printer available at http://RatOS.local/'},"hostname"):i?(0,o.jsx)(rG,{label:i.security.toLocaleUpperCase()+" Password",type:"password",error:v.isError?v.error.message:z.success?void 0:z.error.issues[0].message,onChange:e=>s(e+"")},"password"):x?(0,o.jsx)("div",{className:"mb-4 h-48",children:(0,o.jsx)(rB,{title:"Unable to scan for wifi access points",children:null==h?void 0:h.message})}):0===Object.keys(t).length?(0,o.jsx)("div",{className:"mb-4 flex h-48 items-center justify-center",children:(0,o.jsx)(ra,{})}):(0,o.jsx)(tp,{cards:j,onSelect:y}),T={onClick:e.nextScreen,label:"Skip"},C={onClick:e.previousScreen},R="Pick an access point to join";return i&&(T={label:"Save Wifi Credentials",disabled:!z.success||v.isLoading,isLoading:v.isLoading,onClick:k},C={onClick:()=>a(null),label:"Back",disabled:v.isLoading},R="Enter password for "+i.ssid,v.isSuccess&&(T={label:"Save and Connect",disabled:!f.success||b.isLoading,onClick:w},C={onClick:()=>v.reset(),label:"Back",disabled:v.isLoading},R="Enter the hostname you want to use for the printer",p&&(T={onClick:e.nextScreen},C={},R="Proceed to next step"))),(0,o.jsxs)(u.Fragment,{children:[(0,o.jsxs)("div",{className:"p-8",children:[" ",(0,o.jsxs)("div",{className:"mb-5 border-b border-zinc-200 pb-5 dark:border-zinc-700",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Configure Wifi Setup"}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:R})]}),S]}),(0,o.jsx)(rg,{right:T,left:C})]})},tw=[{id:"01",name:"Confirm configuration",description:"Confirm your printer configuration",href:"#",renderScreen:e=>(0,u.createElement)(tT,{...e,key:e.key})},{id:"02",name:"Setup complete",description:"You've completed the initial setup, congratulations!",href:"#",renderScreen:e=>(0,u.createElement)(tC,{...e,key:e.key})}],tS=e=>{var r,t,n,i,a,l,s,d,c,m,x,h,g,b,v,f,z,j,y,k,_,N,S,T,C;let{toolhead:R,setToolhead:E}=r2(e.toolOrAxis),F=P.SX.mcu.detect.useQuery({boardPath:null!==(v=null===(r=R.getToolboard())||void 0===r?void 0:r.path)&&void 0!==v?v:"",toolhead:R.serialize()},{enabled:null!=R.getToolboard()}),[M,A]=(0,u.useState)(!1),O=(0,p._8)(e=>{let{snapshot:r,set:t}=e;return async()=>{let e=await r.getPromise(rC);if(null==e)return;let t=r$(rP(e),R.serialize()).find(e=>"endstop-toolboard"===e.id);null!=t&&null!=R&&E({...R.getConfig(),xEndstop:t})}},[]);return null==R?(0,o.jsx)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:(0,o.jsx)("div",{className:"sm:col-span-2",children:(0,o.jsx)("div",{className:"space-x-2 text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:(0,o.jsx)(ra,{})})})}):(0,o.jsxs)("div",{className:"col-span-1 mt-8 py-4 sm:grid-cols-2 ",children:[(0,o.jsxs)("div",{className:"",children:[(0,o.jsxs)("h3",{className:"text-base font-bold leading-7 text-zinc-900 dark:text-zinc-100",children:["Toolhead ",R.getToolCommand()]}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm",children:R.getDescription()})]}),(0,o.jsxs)("dl",{className:"mt-4 grid grid-cols-1 gap-x-4 gap-y-4 border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsxs)("dt",{className:"space-x-2 text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:[(0,o.jsx)("span",{children:"Toolboard"})," ",R.getConfig().toolboard&&(0,o.jsx)(w,{color:!0===F.data?"green":"red",children:!0===F.data?"Detected":"Not detected"})]}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null==R.getConfig().toolboard?"None selected":"".concat(null===(t=R.getConfig().toolboard)||void 0===t?void 0:t.manufacturer," ").concat(null===(n=R.getConfig().toolboard)||void 0===n?void 0:n.name)})]}),null!=R.getToolboard()&&!F.data&&(0,o.jsx)("div",{className:"sm:col-span-2",children:(0,o.jsx)(r6,{children:(0,o.jsx)("div",{className:"space-y-2",children:(0,o.jsx)("div",{children:"The toolboard you have selected does not seem to be connected, you can still save the config and proceed to mainsail, but you will get an 'mcu' connection error."})})})}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Extruder"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(f=null===(i=R.getConfig().extruder)||void 0===i?void 0:i.title)&&void 0!==f?f:"None selected"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Hotend"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(z=null===(a=R.getConfig().hotend)||void 0===a?void 0:a.title)&&void 0!==z?z:"None selected"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Thermistor"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(j=R.getConfig().thermistor)&&void 0!==j?j:"None selected"})]}),(null===(l=R.getToolboard())||void 0===l?void 0:l.alternativePT1000Resistor)&&"PT1000"===R.getThermistor()&&(0,o.jsx)("div",{className:"col-span-2",children:(0,o.jsx)(r6,{title:"RatOS uses your toolboards alternate pullup resistor setting",children:"Your toolboard has an option to use a separate pullup resistor for PT1000 sensors. This is usually done by inserting a jumper. Make sure you read the documentation for your board on how to enable the alternative resistor or you'll get ADC temperature errors in klipper."})})]}),(0,o.jsxs)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4  border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"X Endstop"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(y=null===(s=R.getConfig().xEndstop)||void 0===s?void 0:s.title)&&void 0!==y?y:"None selected"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Y Endstop"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(k=null===(d=R.getConfig().yEndstop)||void 0===d?void 0:d.title)&&void 0!==k?k:"None selected"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Probe"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(_=null===(c=R.getConfig().probe)||void 0===c?void 0:c.title)&&void 0!==_?_:"None selected"})]}),null!=R.getConfig().toolboard&&(null===(m=R.getConfig().xEndstop)||void 0===m?void 0:m.id)==="endstop"&&!M&&(0,o.jsx)("div",{className:"sm:col-span-2",children:(0,o.jsxs)(r6,{children:["The current configuration assumes the X endstop is connected to your controlboard, do you want to use an endstop connected to the toolboard instead?",(0,o.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,o.jsx)(rh,{onClick:O,color:"warning",children:"Yes, use the toolboard connection"}),(0,o.jsx)(rh,{onClick:()=>A(!0),color:"plain",children:"No, use the controlboard connection"})]})]})})]}),(0,o.jsxs)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4  border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Part cooling fan"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(N=null===(x=R.getConfig().partFan)||void 0===x?void 0:x.title)&&void 0!==N?N:"None selected"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Hotend cooling fan"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(S=null===(h=R.getConfig().hotendFan)||void 0===h?void 0:h.title)&&void 0!==S?S:"None selected"})]})]}),(0,o.jsxs)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4  border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"X Accelerometer"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(T=null===(g=R.getConfig().xAccelerometer)||void 0===g?void 0:g.title)&&void 0!==T?T:"None"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Y Accelerometer"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(C=null===(b=R.getConfig().yAccelerometer)||void 0===b?void 0:b.title)&&void 0!==C?C:"None"})]})]})]})},tT=e=>{var r,t,n,i,a,s,d;let{parsedPrinterConfiguration:c,partialPrinterConfiguration:p}=rM(),m=(0,u.useMemo)(()=>!0===c.success?rE(c.data):null,[c]),x=[],[h,g]=(0,u.useState)([]),b=(0,u.useCallback)(e=>{g(r=>r.includes(e)?r:[...r,e])},[]),[v,f]=(0,u.useState)([]),z=(0,u.useCallback)(e=>{f(r=>r.includes(e)?r:[...r,e])},[]),j=P.SX.mcu.detect.useQuery({boardPath:null!=p&&null!==(a=null===(r=p.controlboard)||void 0===r?void 0:r.path)&&void 0!==a?a:""},{enabled:(null==p?void 0:p.controlboard)!=null}),y=P.SX.printer.saveConfiguration.useMutation(),k=(0,u.useCallback)(async()=>{c.success&&y.mutate({config:rE(c.data),overwriteFiles:h},{onSuccess:e.nextScreen,onError:e=>window.scrollTo(0,0)})},[c,y,h,e.nextScreen]),_=P.SX.useContext().client,N=(0,E.useQuery)({queryFn:async()=>{let e=await _.printer.getFilesToWrite.mutate({config:null!=m?m:{}});return e},enabled:c.success});if(y.error&&x.push(y.error.message),!1===c.success){let e=c.error.flatten().formErrors,r=c.error.flatten().fieldErrors;if(e.length)e.forEach(e=>{x.push(e)});else for(let e in r)x.push((0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"capitalize",children:e}),": ",null===(s=r[e])||void 0===s?void 0:s[0]]}))}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"p-8",children:[" ",(0,o.jsxs)("div",{className:"mb-5 border-b border-zinc-200 pb-5 dark:border-zinc-700",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:e.name}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:e.description})]}),(0,o.jsx)("div",{className:"space-y-4 text-zinc-700 dark:text-zinc-300",children:c.success&&(0,o.jsxs)("div",{children:[x.length>0&&(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsx)(rB,{children:x.map((e,r)=>(0,o.jsx)("div",{className:"mt-2",children:e},r))})}),(0,o.jsx)("div",{className:"",children:(0,o.jsx)("h3",{className:"text-base font-bold leading-7 text-zinc-900 dark:text-zinc-100",children:"General"})}),(0,o.jsxs)("div",{className:"mt-4",children:[(0,o.jsxs)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"sm:col-span-2",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Printer"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!=c.data.printer?"".concat(c.data.printer.manufacturer," ").concat(c.data.printer.name," ").concat(c.data.size):"None selected"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsxs)("dt",{className:"space-x-2 text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:[(0,o.jsx)("span",{children:"Controlboard"}),c.data.controlboard&&(0,o.jsx)(w,{color:!0===j.data?"green":"red",children:!0===j.data?"Detected":"Not detected"})]}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!=c.data.controlboard?"".concat(c.data.controlboard.manufacturer," ").concat(c.data.controlboard.name):"None selected"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Controller cooling fan"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:null!==(d=null===(t=c.data.controllerFan)||void 0===t?void 0:t.title)&&void 0!==d?d:"None selected"})]}),null!=c.data.controlboard&&!j.data&&(0,o.jsx)("div",{className:"sm:col-span-2",children:(0,o.jsx)(r6,{children:(0,o.jsx)("div",{className:"space-y-2",children:(0,o.jsx)("div",{children:"The controlboard you have selected does not seem to be connected, you can still save the config and proceed to mainsail, but you will get an 'mcu' connection error."})})})})]}),(0,o.jsx)("div",{className:"space-y-4",children:c.data.toolheads.map(e=>(0,o.jsx)(tS,{toolOrAxis:e.axis},e.axis))}),(0,o.jsx)("div",{className:"",children:(0,o.jsx)("h3",{className:"mt-4 text-base font-bold leading-7 text-zinc-900 dark:text-zinc-100",children:"Motion"})}),(0,o.jsxs)("dl",{className:"mt-4 grid grid-cols-1 gap-x-4 gap-y-4 border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:[(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Performance mode"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:c.data.performanceMode?"Enabled":"Disabled"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Stealtchop"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:c.data.stealthchop?"Enabled":"Disabled"})]}),(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsx)("dt",{className:"text-sm font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Standstill Stealth"}),(0,o.jsx)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:c.data.standstillStealth?"Enabled":"Disabled"})]})]}),(0,o.jsx)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4  border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:null===(n=c.data.rails)||void 0===n?void 0:n.map((e,r)=>(0,o.jsxs)("div",{className:"sm:col-span-1",children:[(0,o.jsxs)("dt",{className:"text-sm font-medium capitalize leading-6 text-zinc-900 dark:text-zinc-100",children:[e.axis===l.extruder?e.axis:e.axis.toLocaleUpperCase()," Motion Configuration"]}),(0,o.jsxs)("dd",{className:"mt-1 text-sm leading-6 text-zinc-600 sm:mt-2 dark:text-zinc-400",children:[(0,o.jsxs)("div",{className:"font-medium",children:[e.driver.title," @ ",e.voltage,"V"]}),(0,o.jsxs)("div",{className:"font-medium",children:[e.stepper.title," @ ",e.current,"A RMS"]}),(0,o.jsxs)("div",{className:"font-medium",children:[e.microstepping," microsteps"]})]})]},r))}),(0,o.jsx)("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 border-t border-zinc-100 py-4 sm:grid-cols-2 dark:border-zinc-700",children:(0,o.jsxs)("div",{className:" space-y-4 sm:col-span-2 dark:border-zinc-700",children:[null===(i=N.data)||void 0===i?void 0:i.map(e=>e.exists&&!e.overwrite&&!v.includes(e.fileName)&&!h.includes(e.fileName)&&(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsxs)(ti,{title:"The file ".concat(e.fileName," already exists, overwrite?"),children:["A backup will be created, so you can recover later.",(0,o.jsxs)("div",{className:"mt-2 flex justify-end",children:[(0,o.jsx)(rh,{color:"info",onClick:()=>b(e.fileName),children:(0,o.jsxs)("span",{className:"normal-case",children:["Overwrite ",e.fileName]})}),(0,o.jsx)(rh,{color:"plain",onClick:()=>z(e.fileName),children:"Ignore"})]})]})},e.fileName)),(0,o.jsx)(ti,{children:'If the above information is correct, go ahead and save the configuration. If not, go back and change the configuration by clicking the steps in the "Setup Progress" panel.'})]})})]})]})})]}),(0,o.jsx)(rg,{left:{onClick:e.previousScreen},right:{onClick:k,disabled:!c.success,isLoading:y.isLoading,label:"Confirm and save"}})]})},tC=e=>{let r=()=>{window.location.href="http://"+window.location.hostname};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"p-8",children:[" ",(0,o.jsxs)("div",{className:"mb-5 border-b border-zinc-200 pb-5 dark:border-zinc-700",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:e.name}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:e.description})]}),(0,o.jsxs)("div",{className:"space-y-4 text-zinc-700 dark:text-zinc-300",children:["Now that the base configuration has been saved, you can connect to your printer via Mainsail and start calibrating your printer.",(0,o.jsxs)("div",{className:"mt-5",children:["You can now continue to"," ",(0,o.jsx)("a",{href:"https://os.ratrig.com/docs/configuration#initial-configuration",target:"_blank",rel:"noreferrer",className:"cursor-pointer text-brand-700 hover:text-brand-600",children:"the next step in the documentation."})]})]})]}),(0,o.jsx)(rg,{left:{onClick:e.previousScreen},right:{onClick:r,label:"Open Mainsail"}})]})},tR=e=>{let{currentStep:r,screenProps:t}=rs({steps:tw,parentScreenProps:e});return r.renderScreen({...t})},tE=e=>{let r=0,t=()=>(++r+"").padStart(2,"0"),n=[{id:t(),name:"Network connectivity",description:"Setup Wifi or Ethernet",href:"#",renderScreen:e=>(0,u.createElement)(tN,{...e,key:e.key})},{id:t(),name:"Printer Selection",description:"Select your printer",href:"#",renderScreen:e=>(0,u.createElement)(tz,{...e,key:e.key})},{id:t(),name:"Control board preparation",description:"Firmware flashing and connectivity",href:"#",renderScreen:e=>(0,u.createElement)(th,{...e,key:e.key})}];return e.forEach(e=>{let r=new eH(e);n.push({id:t(),name:"".concat(r.getToolCommand()," Toolboard Preparation"),description:"Firmware flashing and connectivity for toolboard on ".concat(r.getDescription().toLocaleLowerCase()),href:"#",renderScreen:r=>(0,u.createElement)(th,{...r,key:r.key,toolOrAxis:e.axis})})}),n.push({id:t(),name:"Hardware Selection",description:"Select your printer",href:"#",renderScreen:e=>(0,u.createElement)(r7,{...e,key:e.key})}),n.push({id:t(),name:"Confirm your setup",description:"Confirm your setup and start printing",href:"#",renderScreen:e=>(0,u.createElement)(tR,{...e,key:e.key})}),n},tP=()=>(0,o.jsxs)("div",{className:"p-8",children:[(0,o.jsxs)("div",{className:"mb-5 border-b border-zinc-200 pb-5 dark:border-zinc-700",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Loading printer configuration..."}),(0,o.jsx)("p",{className:"mt-2 max-w-4xl text-sm text-zinc-500 dark:text-zinc-400",children:"Please wait while RatOS loads your printer configuration"})]}),(0,o.jsx)("div",{className:"mt-4 flex h-48 items-center justify-center",children:(0,o.jsx)(ra,{})})]}),tF=e=>{let r=(0,rl.useRouter)(),t=(0,p.sJ)(rr),n=(0,u.useMemo)(()=>tE(t),[t]),i=r.query.step?parseInt(r.query.step,10):null,a=e.hasWifiInterface&&!e.isConnectedToWifi?0:1,{currentStepIndex:l,setCurrentStepIndex:s,screenProps:d,currentStep:c}=rs({step:null!=i&&i<n.length?i:a,onStepChange:e=>{r.push("/?step="+e,void 0,{shallow:!0}),window.scrollTo(0,0)},steps:n});return(0,o.jsxs)("div",{className:"mx-auto mt-8 grid max-w-3xl grid-cols-1 gap-6 sm:px-6 lg:max-w-7xl lg:grid-flow-col-dense lg:grid-cols-3",children:[(0,o.jsx)("div",{className:"lg:col-span-2 lg:col-start-1",children:(0,o.jsx)("div",{className:"relative rounded-lg bg-white shadow dark:bg-zinc-800",children:(0,o.jsx)(u.Suspense,{fallback:(0,o.jsx)(tP,{}),children:null==i||i===l?c.renderScreen(d):(0,o.jsx)(tP,{})})})}),(0,o.jsx)("div",{className:"space-y-6 lg:col-span-1 lg:col-start-3",children:(0,o.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white p-8 shadow dark:bg-zinc-800",children:[(0,o.jsx)("div",{className:"mb-5 border-b border-zinc-200 pb-5 dark:border-zinc-800",children:(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-zinc-900 dark:text-zinc-100",children:"Setup Progress"})}),(0,o.jsx)(rd,{steps:n,screenProps:d,currentStepIndex:l,setCurrentStepIndex:s})]})})]})},tM=new E.QueryClient,tA=e=>{let{data:r}=P.SX.version.useQuery(),{data:t}=P.SX.ipAddress.useQuery(),n=ri();return n?(0,o.jsx)(E.QueryClientProvider,{client:tM,children:(0,o.jsx)(p.Wh,{children:(0,o.jsx)(eJ,{children:(0,o.jsxs)(u.Suspense,{fallback:(0,o.jsx)("div",{className:"mb-4 flex h-96 items-center justify-center",children:(0,o.jsx)(ra,{})}),children:[(0,o.jsxs)("div",{className:"mx-auto max-w-3xl px-4 sm:px-6 md:flex md:items-center md:justify-between md:space-x-5 lg:max-w-7xl lg:px-8",children:[(0,o.jsx)("div",{className:"flex items-center space-x-5",children:(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Printer Setup"}),(0,o.jsxs)("p",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400",children:["RatOS ",r," @ ",t]})]})}),(0,o.jsxs)("div",{className:"mt-6 md:mt-0",children:[(0,o.jsxs)("div",{className:"flex space-x-1 sm:flex-row-reverse sm:justify-end sm:space-x-3 sm:space-y-0 sm:space-x-reverse md:flex-row md:space-x-3",children:[(0,o.jsx)(T,{}),(0,o.jsx)(R,{})]}),(0,o.jsx)("div",{className:"mt-2 flex justify-end",children:(0,o.jsx)(rn,{})})]})]}),(0,o.jsx)(tF,{...e})]})})})}):null},tO=e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(c(),{children:[(0,o.jsx)("title",{children:"RatOS Configurator"}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,o.jsx)(tA,{isConnectedToWifi:e.isConnectedToWifi,hasWifiInterface:null!=e.wifiInterface&&""!=e.wifiInterface.trim()})]});var tL=!0,tD=tO}},function(e){e.O(0,[185,575,888,179],function(){return e(e.s=106)}),_N_E=e.O()}]);