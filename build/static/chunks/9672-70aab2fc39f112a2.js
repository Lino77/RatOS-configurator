"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9672],{88192:function(e,r,l){l.r(r),l.d(r,{Card:function(){return Card}});var i=l(72612),t=l(73918);l(39164);var a=l(73790);let o=(0,t.j)(["relative rounded-lg  bg-white dark:bg-zinc-900/60","shadow-[0px_0px_0px_1px_rgba(9,9,11,0.07),0px_2px_2px_0px_rgba(9,9,11,0.05)] dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.05)]","dark:before:-inset-px dark:before:rounded-xl","dark:before:pointer-events-none dark:before:absolute dark:before:shadow-[0px_2px_8px_0px_rgba(0,_0,_0,_0.20),_0px_1px_0px_0px_rgba(255,_255,_255,_0.07)_inset]"]),Card=e=>(0,i.jsx)(a.E.div,{...e,className:o({className:e.className}),children:e.children})},59672:function(e,r,l){l.d(r,{l:function(){return PrinterRailSettings}});var i=l(72612),t=l(34640),a=l(39164),o=l(37231),n=l(18311),d=l(39634),s=l(57137),u=l(34471),p=l(39662),c=l(69460),v=l(96588),x=l(31239),f=l(1314),m=l(21264),g=l(32342),R=l(80461),h=l(79293),b=l(63278),S=l(94594),_=l(39762),D=l(88192);S.z.array(f.g6);let PrinterRailSettings=e=>{var r,l,S,y,j,k,M,N,C,E,A;let T=(0,R.YC)(),P=T.find(r=>r.getExtruderAxis()===e.printerRail.axis),w=T.every(e=>e.hasToolboard()),z=(null==P?void 0:P.getExtruderAxis())===e.printerRailDefault.axis&&(null==P?void 0:P.hasToolboard()),W=z?P.getToolboard():e.selectedBoard,[B,I]=(0,a.useState)(!!e.performanceMode),L=(0,v.Zl)((0,g.ew)(e.printerRail.axis)),O=(0,v.sJ)(g.q7),[Y,U]=(0,a.useState)(e.printerRail.motorSlot&&(null===(l=e.selectedBoard)||void 0===l?void 0:null===(r=l.motorSlots)||void 0===r?void 0:r[e.printerRail.motorSlot])?e.printerRail.motorSlot:void 0),V=(null==W?void 0:W.integratedDrivers)&&(null!==(k=W.integratedDrivers[(null!=Y?Y:e.printerRail.axis.startsWith("extruder"))?f.po.extruder:e.printerRail.axis])&&void 0!==k?k:W.integratedDrivers[e.printerRail.axis.startsWith("extruder")?f.po.extruder:e.printerRail.axis]),[q,J]=(0,a.useState)(null!=V&&null!==(M=(0,m.Df)(V))&&void 0!==M?M:e.printerRail.driver),[Q,X]=(0,a.useState)(e.printerRail.stepper),[Z,F]=(0,a.useState)(B&&null!==(N=null===(S=e.printerRailDefault.performanceMode)||void 0===S?void 0:S.homingSpeed)&&void 0!==N?N:e.printerRailDefault.homingSpeed),G=null==e.errors?0:Object.keys(e.errors).reduce((r,l)=>{var i;let t=null===(i=e.errors)||void 0===i?void 0:i[l];if(null==t)return r;let a=Array.isArray(t)?t.length:t._errors.length;return r+a},0),H=(0,a.useCallback)(r=>null!=r&&O.some(l=>{let i=T.find(e=>e.getExtruderAxis()===l.axis);return!(l.axis===e.printerRail.axis||(null==i?void 0:i.hasToolboard()))&&l.motorSlot===r}),[O,e.printerRail.axis,T]),K=h.SX.mcu.reversePinLookup.useQuery({axis:e.printerRail.axis,canUseExtruderlessConfigs:w,boardPath:null!==(C=null==W?void 0:W.path)&&void 0!==C?C:""},{enabled:!!W});(0,a.useEffect)(()=>{var e;K.data&&null==Y&&(null==W?void 0:null===(e=W.motorSlots)||void 0===e?void 0:e[K.data])!=null&&U(K.data)},[W,K.data,Y,e.printerRailDefault.axis]);let $=(0,f.Wx)(W,q).map(e=>({...e,badge:null!=(0,n.a)(Q,q,e.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0})),[ee,er]=(0,a.useState)(null!==(A=null!==(E=$.find(r=>r.id===e.printerRail.voltage))&&void 0!==E?E:$.find(r=>{var l;return r.id===(B&&(null===(l=e.printerRailDefault.performanceMode)||void 0===l?void 0:l.voltage)?e.printerRailDefault.performanceMode.voltage:e.printerRailDefault.voltage)}))&&void 0!==A?A:$[0]),[el,ei]=(0,a.useState)(e.printerRail.current),et=(0,a.useMemo)(()=>(0,n.a)(e.printerRailDefault.stepper,e.printerRailDefault.driver,e.printerRailDefault.voltage,e.printerRailDefault.current),[e.printerRailDefault]),ea=(0,a.useMemo)(()=>(0,n.a)(Q,q,ee.id,void 0,B),[Q,q,ee,B]),eo=(0,a.useMemo)(()=>(0,n.a)(Q,q,ee.id,el,B),[Q,q,ee,B,el]),en=o.N.filter(e=>"UART"===e.protocol||(null==W?void 0:W.stepperSPI)!=null).map(e=>({...e,badge:null!=(0,n.a)(Q,e,ee.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0})),ed=n.B.map(e=>({...e,badge:null!=(0,n.a)(e,q,ee.id,void 0,B)?{children:"Tuned Preset",color:"sky"}:void 0}));(0,a.useEffect)(()=>{if((0,f.R_)(e.printerRail,e.printerRailDefault,!e.performanceMode)){var r,l,i;e.performanceMode&&e.printerRailDefault.performanceMode?(F(null!==(r=e.printerRailDefault.performanceMode.homingSpeed)&&void 0!==r?r:e.printerRail.homingSpeed),null!=e.printerRailDefault.performanceMode.voltage&&er(null!==(l=$.find(r=>{var l,i;return r.id===(null!==(i=null===(l=e.printerRailDefault.performanceMode)||void 0===l?void 0:l.voltage)&&void 0!==i?i:e.printerRailDefault.voltage)}))&&void 0!==l?l:$[0]),null!=e.printerRailDefault.performanceMode.current&&ei(e.printerRailDefault.performanceMode.current)):(F(e.printerRailDefault.homingSpeed),er(null!==(i=$.find(r=>r.id===e.printerRailDefault.voltage))&&void 0!==i?i:$[0]),ei(e.printerRailDefault.current))}I(!!e.performanceMode)},[e.performanceMode]),(0,a.useEffect)(()=>{let e=$.find(e=>e.id===ee.id);if(!e){var r;er(ea&&null!==(r=$.find(e=>e.id===ea.voltage))&&void 0!==r?r:$[0]),ea&&ei(ea.run_current)}},[$,ee,ea]),(0,a.useEffect)(()=>{let r={axis:e.printerRail.axis,axisDescription:e.printerRail.axisDescription,rotationDistance:e.printerRail.rotationDistance,homingSpeed:Z,motorSlot:Y,driver:q,voltage:ee.id,stepper:Q,current:el},l=(0,m.Yz)(r),i=(0,m.Yz)(e.printerRail),t=Object.keys(l).some(e=>l[e]!==i[e]);t&&L(l)},[el,q,e.printerRail,Z,L,Q,ee.id,Y]);let es=ea&&ea.run_current===el,eu="extruder"===e.printerRail.axis?"Extruder T0":e.printerRail.axis===f.po.extruder1?"Extruder T1":"Stepper "+e.printerRail.axis.toLocaleUpperCase(),ep=(null==W?void 0:W.motorSlots)!=null&&Object.keys(W.motorSlots).length>0?Object.keys(W.motorSlots).map(r=>{var l,i,t,a;if((null===(l=W.motorSlots)||void 0===l?void 0:l[r].title)==null)return null;let o=(null===(i=W.motorSlots)||void 0===i?void 0:i[r].diag_pin)!=null,n=(null===(t=W.motorSlots)||void 0===t?void 0:t[r].endstop_pin)!=null,d=H(r),s=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!o;return{id:r,title:null===(a=W.motorSlots)||void 0===a?void 0:a[r].title,disabled:s,badge:[o?void 0:{children:"No diag pin",color:s?"red":"gray"},n?void 0:{children:"No endstop pin",color:"gray"},!0===d?{children:"In use",color:"orange"}:void 0].filter(Boolean)}}).filter(Boolean):null,ec=(0,a.useMemo)(()=>{var r,l;if(null==Y||(null==W?void 0:null===(r=W.motorSlots)||void 0===r?void 0:r[Y].title)==null)return;let i=(null===(l=W.motorSlots)||void 0===l?void 0:l[Y].diag_pin)!=null,t=(e.printerRailDefault.axis.startsWith("x")||e.printerRailDefault.axis.startsWith("y"))&&!i;return!i&&t?{children:"No diag pin",color:"red"}:void 0},[W,Y,e.printerRailDefault.axis]);return(0,i.jsx)(_.M,{children:e.isVisible&&(0,i.jsxs)(D.Card,{exit:{opacity:0,scale:.9,y:-40},initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},className:(0,b.m6)("break-inside-avoid-column p-4",G>0&&(0,d.iA)({color:"red"}),G>0&&(0,d.xU)({color:"red"})),children:[(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)("h3",{className:(0,b.m6)("text-sm font-bold leading-6 text-zinc-700 dark:text-zinc-300",G>0&&"text-red-900/80 dark:text-red-100"),children:eu}),(0,i.jsx)("p",{className:(0,b.m6)("text-sm text-zinc-500 dark:text-zinc-400",G>0&&"text-red-800/80 dark:text-red-100/60"),children:e.printerRail.axisDescription})]}),(0,i.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[ep&&(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Motor Slot",options:ep,error:null===(j=e.errors)||void 0===j?void 0:null===(y=j.motorSlot)||void 0===y?void 0:y._errors.join("\n"),onSelect:e=>{U(e.id)},value:Y?ep.find(e=>e.id===Y):void 0,badge:ec})}),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Driver",options:en,onSelect:J,value:q,disabled:null!=V,badge:[null!=V?{children:"Integrated",color:"sky"}:void 0,z?{children:"Toolboard",color:"yellow"}:void 0].filter(Boolean)})}),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsx)(t.Lt,{label:"Stepper",options:ed,onSelect:X,value:Q})}),(0,i.jsx)("div",{className:"col-span-1",children:(0,i.jsx)(t.Lt,{label:"Voltage",options:$,onSelect:er,value:ee})}),(0,i.jsx)("div",{className:"col-span-1",children:(0,i.jsx)(s.o,{type:"number",label:"Current",value:el,onChange:ei,inputMode:"decimal",step:"any",min:0,max:q.maxCurrent})}),Q.maxPeakCurrent/1.41<el&&(0,i.jsxs)(u.j,{Icon:x,color:"yellow",title:"Stepper overcurrent!",className:"col-span-2",children:["Your stepper motor is rated for ",Math.floor(100*Q.maxPeakCurrent/1.41)/100,"A RMS, but you are using ",el,"A."]}),null!=eo&&(0,i.jsx)(u.j,{Icon:p,color:"brand",title:"Driver tuning applied!",className:"col-span-2",children:"RatOS preset applied automatically."}),(null==eo?void 0:eo.run_current)!==(null==et?void 0:et.run_current)&&ea&&!es&&(0,i.jsxs)(u.j,{Icon:c,color:"sky",title:"Recommended tuning preset available at different current",className:"col-span-2",children:["RatOS has a recommended preset for your current settings at ",ea.run_current,"A. You can"," ",(0,i.jsxs)("span",{className:"cursor-pointer font-bold underline hover:no-underline",onClick:()=>ei(ea.run_current),children:["change the current to ",ea.run_current,"A"]})," ","to apply the preset automatically."]})]})]},e.printerRail.axis)})}}}]);
//# sourceMappingURL=9672-70aab2fc39f112a2.js.map