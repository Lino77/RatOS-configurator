(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{48984:function(e,r,t){Promise.resolve().then(t.bind(t,30387))},30387:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Page}});var n=t(26248),l=t(44838),a=t(73323),i=t(49738),s=t(61352);let useMainsailQuery=(e,r)=>(0,s.A4)("mainsail",e,r);var o=t(64918),d=t(64791),c=t(83337),u=t(93778),m=t(41087),g=t(18685),x=t(26989),p=t(19731),h=t(30365),b=t(58422),f=t(81503),k=t(8930);let findThumbnail=(e,r)=>{let t=e.find(e=>e.size>=r);return null==t?null:t},thumbUrl=e=>"http://".concat((0,x.X)(),"/server/files/gcodes/").concat(e.relative_path,"?timestamp=").concat(e),getHistoryStateFillColor=e=>{switch(e){case"error":case"klippy_disconnect":case"klippy_shutdown":case"server_exit":return"bg-rose-500/10 text-rose-500 dark:bg-rose-400/10 dark:text-rose-400";case"interrupted":return"bg-amber-500/10 text-amber-500 dark:bg-amber-400/10 dark:text-amber-400";case"in_progress":return"bg-sky-500/10 text-sky-500 dark:bg-sky-400/10 dark:text-sky-400";default:return"bg-brand-500/10 text-brand-500 dark:bg-brand-400/10 dark:text-brand-400"}},getHistoryStateTextColor=e=>{switch(e){case"error":case"klippy_disconnect":case"klippy_shutdown":case"server_exit":return"text-rose-900/80 dark:text-rose-100/80";case"interrupted":return"text-amber-900/80 dark:text-amber-100/80";case"in_progress":return"text-sky-900/80 dark:text-sky-100/80";default:return"text-brand-900/80 dark:text-brand-100/80"}},y=[{header:()=>(0,n.jsx)("span",{children:"Filename"}),accessorKey:"filename",enableSorting:!1,size:280,cell:e=>{let r=findThumbnail(e.row.original.metadata.thumbnails,32);return(0,n.jsxs)("div",{className:"flex min-w-0 items-center gap-x-4",children:[null==r?null:(0,n.jsx)("img",{src:thumbUrl(r),alt:"",className:"h-8 w-8 rounded-full bg-zinc-800"}),(0,n.jsx)("div",{className:"truncate text-sm font-medium leading-6 text-white",children:e.getValue()})]})}},{header:()=>(0,n.jsx)("span",{children:"Started at"}),sortDescFirst:!0,enableSorting:!0,enableMultiSort:!1,accessorKey:"start_time",cell:e=>{let r=m.ou.fromSeconds(e.getValue()).setLocale("en-GB");return(0,n.jsx)("div",{className:"flex min-w-0 items-center gap-x-3",children:(0,n.jsx)("div",{className:"text-sm leading-6 text-zinc-400",title:r.toLocaleString({dateStyle:"full",timeStyle:"medium"}),children:r.toRelative()})})}},{header:()=>(0,n.jsx)("span",{children:"Status"}),size:200,enableSorting:!1,accessorKey:"status",cell:e=>{let r=e.getValue();return(0,n.jsxs)("div",{className:"flex min-w-0 items-center justify-end gap-x-2  @screen-sm:justify-start",children:[(0,n.jsx)("div",{className:(0,l.m)(getHistoryStateFillColor(r),"flex-none rounded-full p-1"),children:(0,n.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-current"})}),(0,n.jsx)("div",{className:(0,l.m)("truncate capitalize text-white",getHistoryStateTextColor(r),"completed"===r?"text-green-100/80":" text-rose-100/80"),children:r.replace("_"," ")})]})}},{header:()=>(0,n.jsx)("span",{children:"Duration"}),accessorKey:"print_duration",enableSorting:!1,cell:e=>(0,n.jsx)("div",{className:"flex min-w-0 items-center text-sm leading-6 text-zinc-400",children:m.nL.fromObject({hours:e.getValue()/60/60},{locale:"en-GB"}).normalize().shiftTo(...["minutes",e.getValue()/60/60>1?"hours":null].filter(Boolean)).toHuman({unitDisplay:"short",listStyle:"narrow",maximumFractionDigits:0})})},{header:()=>(0,n.jsx)("span",{children:"Slicer"}),accessorKey:"slicer",enableSorting:!1,cell:e=>(0,n.jsx)("span",{className:"inline-flex items-center rounded-md bg-zinc-400/10 px-2 py-1 text-xs font-medium text-zinc-400 ring-1 ring-inset ring-zinc-400/20",children:e.row.original.metadata.slicer})},{header:()=>(0,n.jsx)("span",{children:"Filament used"}),accessorKey:"filament_used",enableSorting:!1,cell:e=>{let r=e.getValue()/1e3;return(0,n.jsxs)("div",{className:"flex min-w-0 items-center text-sm leading-6 text-zinc-400",children:[(0,n.jsx)(k.ZP,{start:0,end:r,preserveValue:!0,decimals:2})," meters"]})}}],getColumnSizeClass=e=>{let r=["filament_used","slicer"].includes(e),t=["status","print_duration"].includes(e),n=[""].includes(e),a=["filename"].includes(e);return(0,l.m)(n&&"@screen-sm:flex hidden",t&&"@screen-md:flex hidden",r&&"@screen-xl:flex hidden",!n&&!t&&!r&&"flex",a&&"flex-shrink flex-grow-[5]")},HistoryTable=()=>{var e,r,t,a,o;let m=(0,s.oK)(),[x,k]=(0,i.useState)([{id:"start_time",desc:!0}]),v=(0,i.useRef)(null),{data:j,fetchNextPage:w,isFetching:N,isFetchingNextPage:z,hasNextPage:_,isLoading:S}=(0,g.N)({queryKey:["history",x],queryFn:async e=>{let{pageParam:r=0}=e,t=await m.query("server.history.list",{limit:25,start:25*r,order:x[0].desc?"desc":"asc"});return t},getNextPageParam:(e,r)=>e.count<=r.length?void 0:r.length,keepPreviousData:!0,refetchOnWindowFocus:!1}),C=(0,i.useMemo)(()=>{var e,r;return null!==(r=null==j?void 0:null===(e=j.pages)||void 0===e?void 0:e.flatMap(e=>e.jobs))&&void 0!==r?r:[]},[j]),T=C.length,B=(0,d.b7)({data:C,columns:y,state:{sorting:x},getCoreRowModel:(0,c.sC)(),getSortedRowModel:(0,c.tj)(),manualSorting:!0,debugTable:!0}),handleSortingChange=e=>{if(k(e),B.getRowModel().rows.length){var r;null===(r=P.scrollToIndex)||void 0===r||r.call(P,0)}};B.setOptions(e=>({...e,onSortingChange:handleSortingChange}));let{rows:L}=B.getRowModel(),P=(0,u.hO)({count:T,estimateSize:()=>64,measureElement:-1===navigator.userAgent.indexOf("Firefox")?e=>null==e?void 0:e.getBoundingClientRect().height:void 0,overscan:3,scrollMargin:null!==(a=null===(e=v.current)||void 0===e?void 0:e.offsetTop)&&void 0!==a?a:0,paddingEnd:null!==(o=null===(r=null===(t=v.current)||void 0===t?void 0:t.offsetParent)||void 0===r?void 0:r.offsetTop)&&void 0!==o?o:0});return((0,i.useEffect)(()=>{let[e]=[...P.getVirtualItems()].reverse();e&&e.index>=T-1&&_&&!z&&w()},[_,w,T,z,P]),S)?(0,n.jsxs)("div",{className:"mt-6 flex h-48 w-full flex-col items-center justify-center space-y-2",children:[(0,n.jsx)(f.$,{}),(0,n.jsx)("h3",{className:"animate-pulse font-normal text-zinc-100",children:"Loading print history..."})]}):(0,n.jsxs)("table",{className:"mt-6 w-full whitespace-nowrap text-left",style:{display:"grid",height:"".concat(P.getTotalSize(),"px"),width:"100%",position:"relative"},ref:v,children:[(0,n.jsx)("thead",{className:"border-b border-white/10 bg-[rgb(18,18,20)] text-sm leading-6 text-white",style:{display:"grid",position:"sticky",top:0,zIndex:1},children:B.getHeaderGroups().map(e=>(0,n.jsx)("tr",{style:{display:"flex",width:"100%"},children:e.headers.map(e=>{var r;return(0,n.jsx)("th",{scope:"col",className:(0,l.m)("flex flex-grow items-center truncate px-4 py-2 font-semibold @screen-sm:px-6 @screen-lg:px-8",getColumnSizeClass(e.column.id)),style:{width:e.getSize()},children:(0,n.jsxs)("div",{className:(0,l.m)(e.column.getCanSort()&&"cursor-pointer select-none","space-x-2 flex items-center"),onClick:e.column.getToggleSortingHandler(),children:[(0,d.ie)(e.column.columnDef.header,e.getContext()),null!==(r=({asc:(0,n.jsx)(p,{className:"h-4 w-4"}),desc:(0,n.jsx)(b,{className:"h-4 w-4"})})[e.column.getIsSorted()])&&void 0!==r?r:e.column.getCanSort()?(0,n.jsx)(h,{className:"h-4 w-4"}):null]})},e.id)})},e.id))}),(0,n.jsxs)("tbody",{className:"divide-y divide-white/5",style:{display:"grid",height:"".concat(P.getTotalSize(),"px"),position:"relative"},children:[P.getVirtualItems().map(e=>{let r=L[e.index];return(0,n.jsx)("tr",{"data-index":e.index,ref:e=>P.measureElement(e),style:{display:"flex",position:"absolute",height:"".concat(e.size,"px"),transform:"translateY(".concat(e.start-P.options.scrollMargin,"px)"),width:"100%"},children:r.getVisibleCells().map(e=>(0,n.jsx)("td",{className:(0,l.m)("flex-grow p-4 @screen-sm:px-6 @screen-lg:px-8",getColumnSizeClass(e.column.id)),style:{width:e.column.getSize()},children:(0,d.ie)(e.column.columnDef.cell,e.getContext())},e.id))},r.id)}),0===T&&(0,n.jsx)("tr",{children:(0,n.jsxs)("td",{colSpan:y.length,className:"flex h-96 flex-grow flex-col items-center justify-center p-4 text-center text-zinc-100 @screen-sm:px-6 @screen-lg:px-8",children:[(0,n.jsx)("h4",{className:"mb-4 text-4xl font-bold",children:"No print history found"}),(0,n.jsx)("div",{className:"text-xl text-zinc-400",children:"What are you waiting for? Go print something!"})]})})]})]})},v=[{name:"History",href:"#",current:!0},{name:"Console",href:"#",current:!1}];function Page(){var e,r,t,d,c;let u=useMainsailQuery("general.printername",{initialData:"Loading..."}),g=o.SX.printer.getSavedPrinterName.useQuery(void 0,{initialData:"Loading..."}),x=(0,s.DS)("server.history.totals"),p=(0,s.DS)("server.info"),h=(0,s.hS)("print_stats"),b=null===(e=h.data)||void 0===e?void 0:e.print_stats.state,f=(0,i.useMemo)(()=>{if(null==x.data)return[{name:"Total Print Time",value:0},{name:"Longest Print",value:0},{name:"Avg. Print",value:0},{name:"Total Filament Used",value:0,unit:"meters"}];let e=m.nL.fromObject({hours:0===x.data.job_totals.total_print_time?0:x.data.job_totals.total_print_time/60/60},{locale:"en-GB"}).shiftTo(...["seconds","minutes","hours","days"].filter(Boolean)).normalize().toObject(),r=m.nL.fromObject({hours:0===x.data.job_totals.longest_print?0:x.data.job_totals.longest_print/60/60},{locale:"en-GB"}).shiftTo(...["seconds","minutes","hours"].filter(Boolean)).normalize().toObject(),t=x.data.job_totals.total_print_time/x.data.job_totals.total_jobs,n=m.nL.fromObject({hours:isNaN(t)?0:t/60/60},{locale:"en-GB"}).shiftTo(...["seconds","minutes","hours"].filter(Boolean)).normalize().toObject();return[{name:"Total Print Time",value:[e.days&&{val:e.days,unit:"days"},e.hours&&{val:e.hours,unit:"hrs"},!e.days&&{val:e.minutes,unit:"mins"}].filter(Boolean)},{name:"Longest Print",value:[r.hours&&{val:r.hours,unit:"hrs"},{val:r.minutes,unit:"mins"}].filter(Boolean)},{name:"Avg. Print",value:[n.hours&&{val:n.hours,unit:"hrs"},{val:n.minutes,unit:"mins"}].filter(Boolean)},{name:"Total Filament Used",value:x.data.job_totals.total_filament_used/1e3,unit:"meters"}]},[x.data]);return(0,n.jsxs)("main",{className:"@container",children:[(0,n.jsxs)("header",{children:[(0,n.jsx)("div",{className:"border-b border-white/10",children:(0,n.jsx)("nav",{className:"mx-auto flex max-w-7xl overflow-x-auto py-4",children:(0,n.jsx)("ul",{role:"list",className:"flex min-w-full flex-none gap-x-6 px-4 text-sm font-semibold leading-6 text-zinc-400 @screen-sm:px-6 @screen-lg:px-8",children:v.map(e=>(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:e.href,className:e.current?"text-brand-400":"",children:e.name})},e.name))})})}),(0,n.jsx)("div",{className:"bg-zinc-700/15",children:(0,n.jsxs)("div",{className:"mx-auto flex max-w-7xl flex-col items-start justify-between gap-x-8 gap-y-4 px-4 py-4 @screen-sm:flex-row @screen-sm:items-center @screen-sm:px-6 @screen-lg:px-8",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,n.jsx)("div",{className:(0,l.m)("flex-none rounded-full bg-green-400/10 p-1 text-zinc-400",(null===(r=p.data)||void 0===r?void 0:r.klippy_state)==="error"&&"text-red-400",(null===(t=p.data)||void 0===t?void 0:t.klippy_state)==="startup"&&"text-amber-400",(null===(d=p.data)||void 0===d?void 0:d.klippy_state)==="ready"&&"text-green-400",(null===(c=p.data)||void 0===c?void 0:c.klippy_state)==="shutdown"&&"text-red-400"),children:(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-current"})}),(0,n.jsxs)("h1",{className:"flex gap-x-3 text-base leading-7",children:[(0,n.jsx)("span",{className:"font-semibold text-white",children:u.data}),(0,n.jsx)("span",{className:"text-zinc-600",children:"/"}),(0,n.jsx)("span",{className:"font-semibold text-white",children:g.data})]})]})}),(0,n.jsx)(a.Ct,{className:"order-first capitalize @screen-sm:order-none",color:"canceled"==b?"pink":"complete"==b?"green":"error"==b?"red":"paused"===b?"sky":"printing"===b?"yellow":"standby"===b?"brand":"gray",children:null!=b?b:"Loading..."})]})}),(0,n.jsx)("div",{className:"border-t border-white/5 bg-zinc-700/10",children:(0,n.jsx)("div",{className:"mx-auto grid max-w-7xl grid-cols-1 @screen-sm:grid-cols-2 @screen-lg:grid-cols-4",children:f.map((e,r)=>(0,n.jsxs)("div",{className:(0,l.m)(r%2==1?"@screen-sm:border-l":2===r?"lg:border-l":"","border-white/5 px-4 py-6 @screen-sm:px-6 @screen-lg:px-8"),children:[(0,n.jsx)("p",{className:"text-sm font-medium leading-6 text-zinc-400",children:e.name}),(0,n.jsx)("p",{className:"mt-2 flex items-baseline gap-x-2",children:Array.isArray(e.value)?e.value.map((e,r)=>{let{val:t,unit:l}=e;return(0,n.jsxs)("span",{className:"flex items-baseline gap-x-2",children:[(0,n.jsx)("span",{className:"text-4xl font-semibold tracking-tight text-white",children:(0,n.jsx)(k.ZP,{start:0,end:null!=t?t:0,decimals:0,preserveValue:!0})},r),l?(0,n.jsx)("span",{className:"truncate text-sm text-zinc-400",children:l}):null]},r)}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"text-4xl font-semibold tracking-tight text-white",children:(0,n.jsx)(k.ZP,{start:0,end:e.value,decimals:2,preserveValue:!0})}),e.unit?(0,n.jsx)("span",{className:"text-sm text-zinc-400",children:e.unit}):null]})})]},e.name))})})]}),(0,n.jsx)("div",{className:"border-t border-white/10 pt-11",children:(0,n.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,n.jsx)("h2",{className:"px-4 text-base font-semibold leading-7 text-white @screen-sm:px-6 @screen-lg:px-8",children:"Latest jobs"}),(0,n.jsx)(HistoryTable,{})]})})]})}},73323:function(e,r,t){"use strict";t.d(r,{Ct:function(){return Badge},_1:function(){return i},iA:function(){return o},xU:function(){return s}});var n=t(26248),l=t(73918),a=t(44838);let i=(0,l.j)("",{variants:{color:{rose:"text-rose-700 dark:text-rose-400",red:"text-red-700 dark:text-red-400",yellow:"text-yellow-800 dark:text-yellow-500",orange:"text-orange-800 dark:text-orange-500",green:"text-green-700 dark:text-green-400",lime:"text-lime-700 dark:text-lime-400",blue:"text-blue-700 dark:text-blue-400",sky:"text-sky-700 dark:text-sky-400",indigo:"text-indigo-700 dark:text-indigo-400",purple:"text-purple-700 dark:text-purple-400",pink:"text-pink-700 dark:text-pink-400",brand:"text-brand-700 dark:text-brand-400",gray:"text-zinc-600 dark:text-zinc-400",plain:"text-zinc-900 dark:text-zinc-100"}}}),s=(0,l.j)("",{variants:{color:{rose:"bg-rose-50 dark:bg-rose-400/10",red:"bg-red-50 dark:bg-red-400/10",yellow:"bg-yellow-50 dark:bg-yellow-400/10",orange:"bg-orange-50 dark:bg-orange-400/10",green:"bg-green-50 dark:bg-green-500/10",lime:"bg-lime-50 dark:bg-lime-500/10",blue:"bg-blue-50 dark:bg-blue-400/10",sky:"bg-sky-50 dark:bg-sky-400/10",indigo:"bg-indigo-50 dark:bg-indigo-400/10",purple:"bg-purple-50 dark:bg-purple-400/10",pink:"bg-pink-50 dark:bg-pink-400/10",brand:"bg-brand-100 dark:bg-brand-400/10",gray:"bg-zinc-50 dark:bg-zinc-400/10",plain:"bg-zinc-900/10 dark:bg-zinc-100/10"}}}),o=(0,l.j)("",{variants:{color:{rose:"border-rose-600/10 dark:border-rose-400/20 ring-rose-600/10 dark:ring-rose-400/20",red:"border-red-600/10 dark:border-red-400/20 ring-red-600/10 dark:ring-red-400/20",yellow:"border-yellow-600/20 dark:border-yellow-400/20 ring-yellow-600/20 dark:ring-yellow-400/20",orange:"border-orange-600/20 dark:border-orange-400/20 ring-orange-600/20 dark:ring-orange-400/20",green:"border-green-600/20 dark:border-green-500/20 ring-green-600/20 dark:ring-green-500/20",lime:"border-lime-600/20 dark:border-lime-500/20 ring-lime-600/20 dark:ring-lime-500/20",blue:"border-blue-700/10 dark:border-blue-400/30 ring-blue-700/10 dark:ring-blue-400/30",sky:"border-sky-700/10 dark:border-sky-400/30 ring-sky-700/10 dark:ring-sky-400/30",indigo:"border-indigo-700/10 dark:border-indigo-400/30 ring-indigo-700/10 dark:ring-indigo-400/30",purple:"border-purple-700/10 dark:border-purple-400/30 ring-purple-700/10 dark:ring-purple-400/30",pink:"border-pink-700/10 dark:border-pink-400/20 ring-pink-700/10 dark:ring-pink-400/20",brand:"border-brand-600/40 dark:border-brand-400/30 ring-brand-600/40 dark:ring-brand-400/30",gray:"border-zinc-500/10 dark:border-zinc-400/20 ring-zinc-500/10 dark:ring-zinc-400/20",plain:"border-zinc-900 dark:border-zinc-100 ring-zinc-900 dark:ring-zinc-100"}}}),d=(0,l.j)("flex-0 inline-flex w-auto items-center rounded-md font-medium ring-1 ring-inset",{variants:{size:{sm:"px-1.5 py-1 text-2xs leading-3",md:"px-2 py-1 text-xs leading-4",lg:"px-2 py-1 text-xs leading-6"},color:{rose:[s({color:"rose"}),o({color:"rose"}),i({color:"rose"})],red:[s({color:"red"}),o({color:"red"}),i({color:"red"})],yellow:[s({color:"yellow"}),o({color:"yellow"}),i({color:"yellow"})],orange:[s({color:"orange"}),o({color:"orange"}),i({color:"orange"})],green:[s({color:"green"}),o({color:"green"}),i({color:"green"})],lime:[s({color:"lime"}),o({color:"lime"}),i({color:"lime"})],blue:[s({color:"blue"}),o({color:"blue"}),i({color:"blue"})],sky:[s({color:"sky"}),o({color:"sky"}),i({color:"sky"})],indigo:[s({color:"indigo"}),o({color:"indigo"}),i({color:"indigo"})],purple:[s({color:"purple"}),o({color:"purple"}),i({color:"purple"})],pink:[s({color:"pink"}),o({color:"pink"}),i({color:"pink"})],brand:[s({color:"brand"}),o({color:"brand"}),i({color:"brand"})],gray:[s({color:"gray"}),o({color:"gray"}),i({color:"gray"})],plain:[s({color:"plain"}),o({color:"plain"}),i({color:"plain"})]}},defaultVariants:{size:"md",color:"gray"}}),Badge=e=>{let{size:r,color:t,className:l,children:i,...s}=e;return(0,n.jsx)("span",{className:(0,a.m)(d({size:r,color:t}),l),...s,children:i})}},81503:function(e,r,t){"use strict";t.d(r,{$:function(){return Spinner}});var n=t(26248),l=t(44838);let Spinner=e=>(0,n.jsxs)("svg",{className:(0,l.m)("h-5 w-5 animate-spin text-black dark:text-white",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},64918:function(e,r,t){"use strict";t.d(r,{SX:function(){return a},uF:function(){return i}});var n=t(67763),l=t(21067);function getBaseUrl(){return"/configure"}t(28070);let a=(0,l.t)({config:()=>({links:[(0,n.N8)({url:"".concat(getBaseUrl(),"/api/trpc"),maxURLLength:2083})]}),ssr:!1}),i=(0,n.K5)({links:[(0,n.N8)({url:"".concat(getBaseUrl(),"/api/trpc"),maxURLLength:2083})]})}},function(e){e.O(0,[393,67,838,346,769,955,399,625,744],function(){return e(e.s=48984)}),_N_E=e.O()}]);