(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[723],{10944:function(e,t,n){Promise.resolve().then(n.bind(n,57835))},57835:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Page}});var a=n(45489),l=n(26248),i=n(86418),r=n(49738),s=n(88116),o=n(50962),c=n(44838),d=n(81503);let u={duration:150},Button=e=>{let[t]=(0,s.u)();return(0,l.jsxs)("li",{className:(0,o.d)("flex"),children:["before"===e.subButtonPosition&&(0,l.jsx)("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),(0,l.jsx)("div",{className:(0,o.d)("flex items-center",e.isActive&&"dark:bg-zinc-800"),children:(0,l.jsxs)("button",{onClick:e.onClick,type:"button",title:e.title,className:(0,c.m)("flex items-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-800 dark:text-zinc-200 hover:text-zinc-900 dark:hover:text-zinc-100",e.isActive?"hover:text-brand:600 text-brand-600 dark:text-brand-500 dark:hover:text-brand-500":"",e.hidden?"hidden":"",e.className),children:[e.isLoading&&(0,l.jsx)(d.$,{noMargin:!0,className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.icon&&!e.isLoading&&(0,l.jsx)(e.icon,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.name&&(0,l.jsx)("span",{className:"inline",children:e.name})]})}),null!=e.subButtonPosition&&"before"!==e.subButtonPosition&&(0,l.jsx)("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),null==e.subButtonPosition&&e.children&&e.children]},e.id)};function Toolbar(e){let[t]=(0,s.u)(u);return(0,l.jsx)("nav",{className:(0,c.m)("flex overflow-hidden rounded-md border border-zinc-200 bg-white shadow dark:border-zinc-800 dark:bg-zinc-900/80",e.className),"aria-label":"Breadcrumb",children:(0,l.jsx)("ol",{role:"list",className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",ref:t,children:e.buttons.map(t=>{var n;let a=null===(n=e.subButtons)||void 0===n?void 0:n.filter(e=>e.parent===t.id);return t.hidden?null:(0,r.createElement)(Button,{...t,key:t.id},null!=a&&a.length>0&&t.isActive?a.map(e=>e.hidden?null:(0,r.createElement)(Button,{...e,key:e.id})):t.children)})})})}var m=n(18754),x=n(91403),h=n(16277),p=n(46251),f=n(75403),b=n(78926),v=n(26781),g=n(3487),j=n(51601),k=n(55282),y=n(94594);let useDebounce=(e,t)=>{let n=(0,r.useRef)(),a=(0,r.useRef)([]);return(0,r.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]),(0,r.useCallback)(function(){for(var l=arguments.length,i=Array(l),r=0;r<l;r++)i[r]=arguments[r];a.current=i,n.current||(n.current=setTimeout(()=>{e(...a.current),n.current=void 0},t))},[e,t])};var w=n(48542),N=n(63041),z=n(61352),C=n(65778);let _={pixelPrMm:160,outerNozzleDiameter:1,flipVertical:!1,flipHorizontal:!1},CameraSettingsDialog=e=>{var t,n;let a=(0,r.useRef)(!1),[i,s,o]=(0,z.Fu)("RatOS","camera-settings",_),[d,u]=(0,r.useState)(o.isFetched?i.pixelPrMm.toFixed(2):null),[m,x]=(0,r.useState)(o.isFetched?i.outerNozzleDiameter.toFixed(2):null),h=useDebounce(s,200);return(0,r.useEffect)(()=>{if(o.isFetched&&!1===a.current){var e,t;u(null!==(e=null==i?void 0:i.pixelPrMm.toFixed(2))&&void 0!==e?e:_.pixelPrMm.toFixed(2)),x(null!==(t=null==i?void 0:i.outerNozzleDiameter.toFixed(2))&&void 0!==t?t:_.outerNozzleDiameter.toFixed(2)),a.current=!0}},[i,o.isFetched]),(0,l.jsxs)("div",{className:(0,c.m)("scroll absolute left-5 top-1/2 max-h-[50%] w-80 -translate-y-1/2 transform-gpu overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 p-5 shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?"translate-x-0 opacity-100":"pointer-events-none -translate-x-8 opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:[(0,l.jsxs)("h3",{className:"flex flex-1 items-center justify-between text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:[(0,l.jsx)("span",{children:"Camera Settings"}),(0,l.jsx)(C,{className:"h-5 w-5 cursor-pointer",onClick:()=>e.toggle(!e.isVisible)})]}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 dark:border-zinc-800",children:[(0,l.jsx)(w.o,{label:"Pixel per mm",type:"number",value:null!=d?d:"",placeholder:o.isFetched?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);u(e),isNaN(t)||h(e=>({...e,pixelPrMm:t}))},error:isNaN(parseFloat(null!=d?d:""))?"Not a valid number":void 0}),(0,l.jsx)(w.o,{label:"Outer Nozzle Diameter",type:"number",step:.1,value:null!=m?m:"",placeholder:o.isFetched?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);console.log(e,t),x(e),isNaN(t)||h(e=>({...e,outerNozzleDiameter:t}))},error:isNaN(parseFloat(null!=m?m:""))?"Not a valid number":void 0}),(0,l.jsx)(N.Z,{label:"Flip vertical",onChange:e=>s({...null!=i?i:_,flipVertical:null!=e&&e}),description:"Whether to flip the camera vertically",value:null!==(t=null==i?void 0:i.flipVertical)&&void 0!==t?t:_.flipVertical}),(0,l.jsx)(N.Z,{label:"Flip hoprizontal",onChange:e=>s({...null!=i?i:_,flipHorizontal:null!=e&&e}),description:"Whether to flip the camera horizontally",value:null!==(n=null==i?void 0:i.flipHorizontal)&&void 0!==n?n:_.flipHorizontal})]})]})};var S=n(21863);let ExposureIcon=e=>(0,l.jsxs)("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",className:e.className,children:[(0,l.jsx)("path",{fill:"currentColor",d:"M456,40H56A16,16,0,0,0,40,56V456a16,16,0,0,0,16,16H456a16,16,0,0,0,16-16V56A16,16,0,0,0,456,40ZM72,72H417.373L72,417.373ZM440,440H94.627L440,94.627Z"}),(0,l.jsx)("polygon",{fill:"currentColor",points:"336 368 336 408 368 408 368 368 408 368 408 336 368 336 368 296 336 296 336 336 296 336 296 368 336 368"}),(0,l.jsx)("rect",{width:"112",height:"32",x:"112",y:"136",fill:"currentColor"})]});var O=n(74193),T=n(19731),E=n(20978),A=n(73838);let useGcodeCommand=()=>{let e=(0,z.xH)("printer.gcode.script");return(0,r.useCallback)(async function(t){for(var n=arguments.length,a=Array(n>1?n-1:0),l=1;l<n;l++)a[l-1]=arguments[l];let i=[t[0]];a.forEach((e,n)=>{i.push(e.toString(),t[n+1])});let r=i.join("");await e.mutateAsync({script:r}),console.log(r)},[e])};function _templateObject(){let e=(0,a._)(["G91\nG0 Z1"],["G91\\nG0 Z1"]);return _templateObject=function(){return e},e}function _templateObject1(){let e=(0,a._)(["G91\nG0 Z0.5"],["G91\\nG0 Z0.5"]);return _templateObject1=function(){return e},e}function _templateObject2(){let e=(0,a._)(["G91\nG0 Z0.1"],["G91\\nG0 Z0.1"]);return _templateObject2=function(){return e},e}function _templateObject3(){let e=(0,a._)(["G91\nG0 Z-0.1"],["G91\\nG0 Z-0.1"]);return _templateObject3=function(){return e},e}function _templateObject4(){let e=(0,a._)(["G91\nG0 Z-0.5"],["G91\\nG0 Z-0.5"]);return _templateObject4=function(){return e},e}function _templateObject5(){let e=(0,a._)(["G91\nG0 Z-1.0"],["G91\\nG0 Z-1.0"]);return _templateObject5=function(){return e},e}let FocusControls=e=>{let t=useGcodeCommand();return(0,l.jsx)("div",{className:(0,c.m)("scroll absolute transform-gpu overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?" -translate-y-full opacity-100":"pointer-events-none  -translate-y-2/3  opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:(0,l.jsxs)("ol",{className:"flex flex-col divide-y divide-zinc-200 dark:divide-zinc-800",children:[(0,l.jsx)("li",{className:(0,o.d)("flex"),children:(0,l.jsx)("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,l.jsxs)("button",{onClick:()=>t(_templateObject()),type:"button",className:(0,c.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,l.jsx)(O,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,l.jsx)("span",{className:"inline",children:"+1.0"})]})})}),(0,l.jsx)("li",{className:(0,o.d)("flex"),children:(0,l.jsx)("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,l.jsxs)("button",{onClick:()=>t(_templateObject1()),type:"button",className:(0,c.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,l.jsx)(T,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,l.jsx)("span",{className:"inline",children:"+0.5"})]})})}),(0,l.jsx)("li",{className:(0,o.d)("flex"),children:(0,l.jsx)("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,l.jsxs)("button",{onClick:()=>t(_templateObject2()),type:"button",className:(0,c.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,l.jsx)(T,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,l.jsx)("span",{className:"inline",children:"+0.1"})]})})}),(0,l.jsx)("li",{className:(0,o.d)("flex"),children:(0,l.jsx)("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,l.jsxs)("button",{onClick:()=>t(_templateObject3()),type:"button",className:(0,c.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,l.jsx)(E,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,l.jsx)("span",{className:"inline",children:"-0.1"})]})})}),(0,l.jsx)("li",{className:(0,o.d)("flex"),children:(0,l.jsx)("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,l.jsxs)("button",{onClick:()=>t(_templateObject4()),type:"button",className:(0,c.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,l.jsx)(E,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,l.jsx)("span",{className:"inline",children:"-0.5"})]})})}),(0,l.jsx)("li",{className:(0,o.d)("flex"),children:(0,l.jsx)("div",{className:(0,o.d)("flex flex-1 items-center justify-center text-center"),children:(0,l.jsxs)("button",{onClick:()=>t(_templateObject5()),type:"button",className:(0,c.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,l.jsx)(A,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,l.jsx)("span",{className:"inline",children:"-1.0"})]})})})]})})},useWindowSize=()=>{let[e,t]=(0,r.useState)({width:window.innerWidth,height:window.innerHeight});return(0,r.useEffect)(()=>{let handleResize=()=>{requestAnimationFrame(()=>{t({width:window.innerWidth,height:window.innerHeight})})};return window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[]),e};var L=n(8930),G=n(26989);function page_templateObject(){let e=(0,a._)(["_NOZZLE_CALIBRATION_MOVE X="," Y=",""]);return page_templateObject=function(){return e},e}function page_templateObject1(){let e=(0,a._)(["G28"]);return page_templateObject1=function(){return e},e}function page_templateObject2(){let e=(0,a._)(["_NOZZLE_CALIBRATION_LOAD_TOOL T=0"]);return page_templateObject2=function(){return e},e}function page_templateObject3(){let e=(0,a._)(["_NOZZLE_CALIBRATION_LOAD_TOOL T=1"]);return page_templateObject3=function(){return e},e}function page_templateObject4(){let e=(0,a._)(["_NOZZLE_CALIBRATION_SWITCH_LED STATE=",""]);return page_templateObject4=function(){return e},e}function page_templateObject5(){let e=(0,a._)(["_NOZZLE_CALIBRATION_SET_TOOL"]);return page_templateObject5=function(){return e},e}let parseOptions=e=>{let t=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\.\d+\])/g),n=[];for(let e of t){let[t,a]=e[2].slice(1,-1).split("..").map(e=>parseInt(e,10)),l=n.find(t=>t.key===e[1]);l&&"max"in l&&l.max&&l.max<=a||n.push({key:e[1],min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:a})}let a=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\d+\.\.\d+\.\d+\])/g);for(let e of a){let[t,a]=e[2].slice(1,-1).split("..").map(e=>parseFloat(e)),l=n.find(t=>t.key===e[1]);l&&"max"in l&&l.max&&l.max<=a||n.push({key:e[1],float:!0,min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:a})}let l=e.matchAll(/- available option:\s(\w+)\s.+(\[false\.\.true\])/g);for(let e of l)n.push({key:e[1],toggle:!0});return n},M=y.z.number().min(4).max(3522),R=y.z.number().min(254).max(4095),useCameraSettings=e=>{let[t,n]=(0,r.useState)([]),a=(0,r.useCallback)(async t=>{let n=M.parse(t);await fetch("".concat(e,"/option?exposure=").concat(n))},[e]),l=(0,r.useCallback)(async t=>{let n=R.parse(t);await fetch("".concat(e,"/option?digitalgain=").concat(n))},[e]),i=(0,r.useCallback)(async t=>{let a=await fetch("".concat(e,"/option?compressionquality=").concat(t));n(parseOptions(await a.text()))},[e]),s=(0,r.useCallback)(async(n,a)=>{let l=t.find(e=>e.key===n);if(null==l)throw Error("Invalid option ".concat(n));if(l&&"toggle"in l&&"boolean"!=typeof a)throw Error("Expect a boolean value for ".concat(n,", got ").concat(a));if(l&&"max"in l&&("number"!=typeof a||l.min>a||l.max<a))throw Error("Value ".concat(a," is out of range for ").concat(n));try{let t=await fetch("".concat(e,"/option?").concat(n,"=").concat(a));return t.ok}catch(e){return!1}},[t,e]);return(0,r.useEffect)(()=>{i(100)},[i]),{exposure:a,digitalGain:l,options:t,setOption:s}},Slider=e=>{let{onChange:t,min:n,max:a,initialValue:i,step:s}=e,[o,c]=(0,r.useState)(null!=i?i:n),d=useDebounce((0,r.useCallback)(e=>{null==t||t(e)},[t]),100),u=(0,r.useCallback)(e=>{let t=s?parseFloat(e.target.value):parseInt(e.target.value,10);c(t),d(t)},[d,s]);return(0,l.jsxs)("div",{className:"relative mb-6",children:[(0,l.jsx)("input",{type:"range",value:o,onChange:u,min:n,max:a,step:null!=s?s:1,className:"h-2 w-full cursor-pointer appearance-none rounded-lg bg-zinc-200 dark:bg-zinc-700"}),(0,l.jsxs)("span",{className:"absolute -bottom-6 start-0 text-sm text-zinc-500 dark:text-zinc-400",children:["Min (",n,")"]}),(0,l.jsx)("span",{className:"absolute -bottom-6 start-1/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(a/3).toFixed(2)}),(0,l.jsx)("span",{className:"absolute -bottom-6 start-2/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(a/3*2).toFixed(2)}),(0,l.jsxs)("span",{className:"absolute -bottom-6 end-0 text-sm text-zinc-500 dark:text-zinc-400",children:["Max (",a,")"]})]})},getCameraUrl=()=>{let e=(0,G.X)();return null==e||""==e.trim()?"/webcam":"http://".concat(e,"/webcam")};function Page(){var e,t;let[n,a]=(0,r.useState)(getCameraUrl());(0,r.useEffect)(()=>{a(getCameraUrl())},[]);let{videoRef:u,connectionState:y}=function(e){let t=(0,r.useRef)(null),n=(0,r.useRef)(null),a=(0,r.useRef)(null),l=(0,r.useRef)(e),i=(0,r.useRef)(!1),[s,o]=(0,r.useState)(null),c=(0,r.useRef)(null),d=(0,r.useCallback)(e=>{if(e.candidate)return fetch(l.current,{body:JSON.stringify({type:"remote_candidate",id:c.current,candidates:[e.candidate]}),headers:{"Content-Type":"application/json"},method:"POST"}).catch(function(e){window.console.error(e)})},[]),u=(0,r.useCallback)(async()=>{a.current&&(a.current.close(),a.current=null),i.current=!0;try{o("new");var l={sdpSemantics:"unified-plan"};document.getElementById("use-stun")&&document.getElementById("use-stun").checked&&(l.iceServers=[{urls:["stun:stun.l.google.com:19302"]}]);let i=new URLSearchParams(e),s=Object.fromEntries(i.entries()),u=await fetch(e,{body:JSON.stringify({type:"request",res:s.res}),headers:{"Content-Type":"application/json"},method:"POST"});if(u.ok){let i=await u.json();i.iceServers&&(l.iceServers=i.iceServers),a.current=new RTCPeerConnection(l),a.current.addTransceiver("video",{direction:"recvonly"}),a.current.addEventListener("track",function(e){if(console.log("track event "+e.track.kind,e.streams),"video"==e.track.kind){if(t.current)t.current.srcObject=e.streams[0];else throw Error("No video ref to set src on")}else n.current&&(n.current.srcObject=e.streams[0])}),a.current.addEventListener("connectionstatechange",()=>{var e;let t=null===(e=a.current)||void 0===e?void 0:e.connectionState;console.log(t),o(null!=t?t:null)}),c.current=i.id,await a.current.setRemoteDescription(i);let s=await a.current.createAnswer();await a.current.setLocalDescription(s),await new Promise(function(e){if(null==a.current)throw Error("peerConnection.current is null");"complete"===a.current.iceGatheringState?e(null):a.current.addEventListener("icegatheringstatechange",function checkState(){if(null==a.current)throw Error("peerConnection.current is null");"complete"===a.current.iceGatheringState&&(a.current.removeEventListener("icegatheringstatechange",checkState),e(null))})}),a.current.addEventListener("icecandidate",d);var r=a.current.localDescription;if(null==r)throw Error("No offer from peerConnection");await fetch(e,{body:JSON.stringify({type:r.type,id:c.current,sdp:r.sdp}),headers:{"Content-Type":"application/json"},method:"POST"})}else o("failed")}catch(e){console.error(e),o("failed")}finally{i.current=!1}},[d,e]);return(0,r.useEffect)(()=>{e&&!1===i.current?u():a.current&&!1===i.current&&a.current.close()},[u,e]),(0,r.useEffect)(()=>{if(["failed","disconnected"].includes(null!=s?s:"")){let e=setTimeout(()=>{u()},5e3);return()=>clearTimeout(e)}},[u,s]),{videoRef:t,audioRef:n,connectionState:s,close:(0,r.useCallback)(()=>{var e;null===(e=a.current)||void 0===e||e.close()},[])}}(n+"/webrtc"),[w]=(0,z.Fu)("RatOS","camera-settings"),N=(0,r.useRef)(null),C=(0,r.useRef)(null),[_,O]=(0,r.useState)(null),[T,E]=(0,r.useState)({x:!1,y:!1}),{exposure:A,digitalGain:G,options:M,setOption:R}=useCameraSettings(n),[F,P]=(0,r.useState)(!1),[B,Z]=(0,r.useState)(!1),[D,H]=(0,r.useState)(!1),[I,V]=(0,r.useState)(!1),[W,X]=(0,r.useState)(!1),[U,q]=(0,r.useState)(!1),[J,$]=(0,r.useState)(!1),[Q,Y]=(0,r.useState)(!1),[K,ee]=(0,r.useState)(!1),[et,en]=(0,r.useState)(1),[ea,el]=(0,r.useState)(!1),ei=useGcodeCommand(),[er]=(0,s.u)(),es=useWindowSize(),eo=(0,z.Q)("toolhead"),ec=(null==eo?void 0:eo.toolhead.extruder)==="extruder"?"T0":"T1",ed=(0,r.useCallback)(e=>{var t,n,a,l;let i=null!==(a=null===(t=u.current)||void 0===t?void 0:t.videoWidth)&&void 0!==a?a:1,r=null!==(l=null===(n=N.current)||void 0===n?void 0:n.getBoundingClientRect().width)&&void 0!==l?l:1;return e*et*(r>0&&i>0?r/i:1)},[u.current,et,es]),eu=(0,r.useCallback)(e=>{var t,n,a,l;let i=null!==(a=null===(t=u.current)||void 0===t?void 0:t.videoWidth)&&void 0!==a?a:1,r=null!==(l=null===(n=N.current)||void 0===n?void 0:n.getBoundingClientRect().width)&&void 0!==l?l:1;return e/et/(r>0&&i>0?r/i:1)},[u,et]),em=(0,r.useCallback)(e=>{var t;return ed(e)*(null!==(t=null==w?void 0:w.pixelPrMm)&&void 0!==t?t:0)},[ed,null==w?void 0:w.pixelPrMm,es]),ex=(0,r.useCallback)(e=>{var t;return eu(e)/(null!==(t=null==w?void 0:w.pixelPrMm)&&void 0!==t?t:0)},[null==w?void 0:w.pixelPrMm]),[eh,ep]=(0,S.S)([et],2e3,!0),ef=eh||I,eb=(0,r.useCallback)(()=>{V(e=>!e),ep()},[ep]);(0,m.useGesture)({onDrag:e=>{if(e.dragging)O([e.offset[0],e.offset[1]]),E({x:e._movementBound[0],y:e._movementBound[1]});else{var t,n;let e=ex(null!==(t=null==_?void 0:_[0])&&void 0!==t?t:0)*((null==w?void 0:w.flipHorizontal)?1:-1),a=ex(null!==(n=null==_?void 0:_[1])&&void 0!==n?n:0)*((null==w?void 0:w.flipVertical)?1:-1);ei(page_templateObject(),e,a),O(null),E({x:!1,y:!1})}},onDrop:()=>{console.log("drop")},onPinch:e=>{en(t=>Math.max(Math.min(t*e.offset[0],10),1))},onWheel:e=>{0!=e.delta[1]&&!1!=e.wheeling&&!1!=e.intentional&&(e.delta[1]<0?en(e=>Math.max(.85*e,1)):en(e=>Math.min(1.15*e,10)))}},{target:u,enabled:"connected"===y,drag:{enabled:F,from:()=>[0,0],bounds:{left:-em(1),right:em(1),top:-em(1),bottom:em(1)},rubberband:!0},wheel:{axis:"y",rubberband:!1},pinch:{scaleBounds:{min:1,max:10},pinchOnWheel:!1,rubberband:!0}});let ev=[{icon:i,id:"home",title:"Home the printer (G28)",isLoading:B,onClick:async()=>{Z(!0),await ei(page_templateObject1()),Z(!1)},isActive:(null==eo?void 0:eo.toolhead.homed_axes)==="xyz"},{name:"T0",id:"t0",title:"Switch to tool 0 (T0)",onClick:()=>{ei(page_templateObject2())},isActive:"T0"===ec},{name:"T1",id:"t1",title:"Switch to tool 1 (T1)",onClick:()=>{ei(page_templateObject3())},isActive:"T1"===ec}],eg=[{icon:x,id:"zoom",title:"".concat(ef?"Hide":"Show"," zoom controls"),subButtonPosition:"before",className:"font-mono",name:et>=10?"MAX!":(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(L.ZP,{preserveValue:!0,start:0,end:Math.round(100*et),duration:.15}),"%"]}),onClick:()=>{eb()},isActive:ef},{icon:h,id:"light",title:"".concat(K?"Turn off":"Turn on"," the LEDs"),onClick:()=>{let e=!K;ei(page_templateObject4(),e?1:0),ee(e)},isActive:K}],ej=(0,r.useMemo)(()=>[{name:"Settings",icon:p,id:"settings",title:"Show camera settings dialog",onClick:()=>{H(e=>!e)},isActive:D},{name:"T0"===ec?"Set reference":"Set offset",icon:f,id:"reference",title:"Set the ".concat("T0"===ec?"T0 reference point":"T1 offset"),onClick:()=>{ei(page_templateObject5())},isActive:!1},{name:"Move",icon:b,id:"move",title:"".concat(F?"Disable":"Enable"," drag and drop calibration"),onClick:()=>{P(e=>!e)},isActive:F}],[F,ei,D,ec]),ek=(0,r.useMemo)(()=>{let e=[{icon:v,id:"settings",subButtonPosition:"before",title:"".concat(ea?"Hide":"Show"," camera controls"),onClick:()=>{el(e=>!e)},isActive:ea}];return e},[ea]),ey=(0,r.useMemo)(()=>{let e=[{icon:g,id:"focus",parent:"settings",hidden:U||Q||W,name:"Focus",title:"".concat(J?"Hide":"Show"," focus controls"),children:(0,l.jsx)(FocusControls,{isVisible:J,toggle:$}),onClick:()=>{console.log("exposure controls"),$(e=>!e),X(!1),q(!1),Y(!1)},isActive:J},{icon:ExposureIcon,id:"exposure",parent:"settings",hidden:U||Q||J,title:"".concat(W?"Hide":"Show"," exposure controls"),name:"Exposure",onClick:()=>{console.log("exposure controls"),X(e=>!e),q(!1),Y(!1),$(!1)},isActive:W},{icon:j,id:"color",parent:"settings",title:"".concat(U?"Hide":"Show"," color controls"),hidden:W||Q||J,name:"Color",onClick:()=>{q(e=>!e),X(!1),Y(!1),$(!1)},isActive:U},{icon:k,id:"advanced-camera-controls",parent:"settings",title:"".concat(Q?"Hide":"Show"," advanced camera controls"),name:"Advanced",hidden:W||U||J,onClick:()=>{Y(e=>!e),X(!1),q(!1),$(!1)},isActive:Q}];return e.reverse()},[Q,W,J,U]),ew=null==_?0:_[0]/et,eN=null==_?0:_[1]/et,ez=(0,r.useMemo)(()=>em(w?w.outerNozzleDiameter/2:0),[w,em]),eC=(0,r.useMemo)(()=>null==N.current||"connected"!==y?0:ez/N.current.getBoundingClientRect().width*100,[y,ez]),e_=(0,r.useMemo)(()=>null==N.current||"connected"!==y?0:ez/N.current.getBoundingClientRect().height*100,[y,ez]);return(0,l.jsx)("div",{className:"flex h-[calc(100vh_-_64px)] w-full items-center",ref:C,children:(0,l.jsxs)("div",{className:"relative mx-auto flex max-h-full min-h-[50vh] min-w-[50vw] max-w-fit items-center overflow-hidden rounded-2xl object-contain shadow-lg",ref:N,children:[(0,l.jsx)("video",{ref:u,className:(0,c.m)("h-full max-h-full w-full min-w-full max-w-full transform-gpu touch-none",F&&"cursor-move",null==_&&"transition-transform ease-in-out"),style:{transform:"scale3d(".concat(et*((null==w?void 0:w.flipHorizontal)?-1:1),", ").concat(et*((null==w?void 0:w.flipVertical)?-1:1),", 1) translate3d(").concat(ew*((null==w?void 0:w.flipHorizontal)?-1:1),"px, ").concat(eN*((null==w?void 0:w.flipVertical)?-1:1),"px, 0)")},autoPlay:!0,muted:!0,playsInline:!0}),(0,l.jsx)(Toolbar,{className:"absolute left-5 top-5",buttons:ev}),(0,l.jsx)(Toolbar,{className:"absolute bottom-5 right-5 overflow-visible",buttons:ek,subButtons:ey}),(0,l.jsx)(Toolbar,{className:"absolute right-5 top-5",buttons:eg,subButtons:[{name:"1X",id:"1x",parent:"zoom",title:"Set zoom to 1X (100%)",className:"font-mono",onClick:()=>{en(1)},isActive:!1},{name:"2X",id:"2x",parent:"zoom",title:"Set zoom to 2X (200%)",className:"font-mono",onClick:()=>{en(2)},isActive:!1},{name:"4X",id:"4x",parent:"zoom",title:"Set zoom to 4X (400%)",className:"font-mono",onClick:()=>{en(4)},isActive:!1}]}),(0,l.jsx)(Toolbar,{className:"absolute bottom-5 left-5",buttons:ej}),(0,l.jsx)(CameraSettingsDialog,{isVisible:D,toggle:H}),(0,l.jsxs)("div",{className:(0,o.d)("pointer-events-none absolute inset-0 flex items-center justify-center"),children:[(0,l.jsx)("div",{className:(0,o.d)("absolute inset-0",T.x&&T.x>0?"left-0 right-2/3 bg-gradient-to-r from-red-500/70 to-red-500/0":"left-2/3 right-0 bg-gradient-to-l from-red-500/70 to-red-500/0"),style:{opacity:T.x?Math.abs(T.x-(null!==(e=null==_?void 0:_[0])&&void 0!==e?e:0))/200:0}}),(0,l.jsx)("div",{className:(0,o.d)("absolute inset-0",T.y&&T.y>0?"bottom-2/3 top-0 bg-gradient-to-b from-red-500/70 to-red-500/0":"bottom-0 top-2/3 bg-gradient-to-t from-red-500/70 to-red-500/0"),style:{opacity:T.y?Math.abs(T.y-(null!==(t=null==_?void 0:_[1])&&void 0!==t?t:0))/200:0}}),(0,l.jsxs)("svg",{width:"100%",height:"100%",children:[(0,l.jsx)("circle",{cx:"50%",cy:"50%",r:em(.2),fill:"none",className:(0,o.d)("stroke-brand-500 transition-all ease-in-out","connected"===y&&ez>0?"opacity-100":"opacity-0"),strokeWidth:"2"}),(0,l.jsx)("circle",{cx:"50%",cy:"50%",r:ez,fill:"none",className:(0,o.d)("stroke-brand-500 transition-all ease-in-out","connected"===y&&ez>0?"opacity-50":"opacity-0"),strokeWidth:"2"}),(0,l.jsx)("rect",{x:"50%",y:"".concat(50-e_,"%"),height:"".concat(2*e_,"%"),width:2,className:(0,o.d)("fill-brand-500/50 transition-all ease-in-out","connected"===y&&ez>0?"opacity-100":"opacity-0")}),(0,l.jsx)("rect",{x:"".concat(50-eC,"%"),y:"50%",width:"".concat(2*eC,"%"),height:2,className:(0,o.d)("fill-brand-500/50 transition-all ease-in-out","connected"===y&&ez>0?"opacity-100":"opacity-0")})]})]}),(0,l.jsx)("div",{className:"absolute bottom-24 left-1/4 right-1/4 max-h-[50%] overflow-y-scroll rounded-md bg-zinc-900/70 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",children:(0,l.jsxs)("div",{ref:er,children:[W&&M.filter(e=>e.key.toLowerCase().includes("gain")||e.key.toLowerCase().includes("exposure")||e.key.startsWith("Ae")||e.key.toLowerCase().includes("brightness")).filter(e=>"ColourGains"!==e.key).map(e=>(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),(0,l.jsx)(Slider,{min:"toggle"in e?0:"min"in e?e.min:0,max:"toggle"in e?0:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>R(e.key,"toggle"in e?!!t:t)})]},e.key)),U&&M.filter(e=>e.key.toLowerCase().includes("saturation")||e.key.toLowerCase().includes("contrast")||e.key.startsWith("Awb")).map(e=>(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),(0,l.jsx)(Slider,{min:"toggle"in e?0:"min"in e?e.min:0,max:"toggle"in e?0:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>R(e.key,"toggle"in e?!!t:t)})]},e.key)),Q&&M.map(e=>(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),(0,l.jsx)(Slider,{min:"toggle"in e?0:"min"in e?e.min:0,max:"toggle"in e?0:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>R(e.key,"toggle"in e?!!t:t)})]},e.key))]})}),(0,l.jsxs)("div",{className:(0,c.m)("pointer-events-none absolute inset-0 flex items-center justify-center"),children:[(0,l.jsx)("h3",{className:(0,c.m)("absolute inset-0 flex items-center justify-center text-xl font-semibold text-rose-500 transition-all dark:text-rose-500","failed"===y?"animate-pulse opacity-100":"opacity-0"),children:"Webcam stream not found"}),(0,l.jsx)(d.$,{noMargin:!0,className:(0,c.m)("h-1/3 w-1/3 animate-spin text-inherit transition-all","text-green-500 dark:text-green-500",("connected"===y||"failed"===y)&&"opacity-0","failed"===y&&"text-rose-500 dark:text-rose-500","connecting"===y&&"text-brand-500 dark:text-brand-500","closed"===y&&"text-yellow-500 dark:text-yellow-500","disconnected"===y&&"text-amber-500 dark:text-amber-500","new"===y&&"text-sky-500 dark:text-sky-500")})]})]})})}},81503:function(e,t,n){"use strict";n.d(t,{$:function(){return Spinner}});var a=n(26248),l=n(44838);let Spinner=e=>(0,a.jsxs)("svg",{className:(0,l.m)("h-5 w-5 animate-spin text-black dark:text-white",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},48542:function(e,t,n){"use strict";n.d(t,{o:function(){return TextInput}});var a=n(26248),l=n(96148),i=n(6181),r=n(33964),s=n(32836),o=n.n(s),c=n(49738),d=n(50962);let TextInput=e=>{let t=(0,c.useRef)(o()(e)),{onChange:n}=e,[s,u]=(0,c.useState)(!1);(0,d.d)("h-5 w-5",(e.error,"text-red-500"));let m=e.error?(0,a.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:(0,a.jsx)(r,{className:"h-5 w-5 text-red-500","aria-hidden":"true"})}):null,x=(0,d.d)(e.error?"ring-red-300 text-red-900 placeholder-red-300 focus:ring-red-500 dark:ring-red-500 dark:text-red-400 dark:placeholder-red-700":"ring-zinc-300 text-zinc-900 placeholder-zinc-300 focus:ring-brand-600 dark:ring-zinc-700 dark:text-zinc-100 dark:placeholder-zinc-700 dark:focus:ring-brand-400 ","block w-full rounded-md bg-white py-1.5 pl-3 pr-3 text-leftshadow-sm ring-1 ring-inset focus:outline-none dark:bg-zinc-800 sm:text-sm sm:leading-6 border-0"),h=e.error?(0,a.jsx)("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",id:t.current+"-error",children:e.error}):null,p=e.help?(0,a.jsx)("p",{className:"mt-2 text-sm text-zinc-500",id:"email-description",children:e.help}):null,f=(0,c.useCallback)(t=>{null==n||n("number"===e.type?parseFloat(t.currentTarget.value):t.currentTarget.value)},[n,e.type]),b=(0,c.useCallback)(()=>{u(e=>!e)},[]),v="password"===e.type?(0,a.jsx)("div",{onClick:b,className:"absolute inset-y-0 ".concat(null!=m?"right-6":"right-0"," flex cursor-pointer items-center pr-3"),children:s?(0,a.jsx)(l,{className:"h-5 w-5 text-zinc-400"}):(0,a.jsx)(i,{className:"h-5 w-5 text-zinc-400"})}):null;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold leading-6 text-zinc-700 dark:text-zinc-300",children:e.label}),(0,a.jsxs)("div",{className:"relative mt-1 rounded-md shadow-sm",children:[(0,a.jsx)("input",{...e,type:s?"text":e.type,className:x,placeholder:e.placeholder,defaultValue:e.defaultValue,value:e.value,onChange:f,"aria-invalid":!!e.error,"aria-describedby":e.error?t.current+"-error":void 0}),m,v]}),null!=h?h:p]})}},63041:function(e,t,n){"use strict";n.d(t,{Z:function(){return Toggle}});var a=n(26248),l=n(40818);n(49738);var i=n(44838),r=n(50962);let Toggle=e=>(0,a.jsxs)(l.r.Group,{as:"div",className:"flex items-center justify-between gap-x-2",children:[(0,a.jsxs)("span",{className:"flex flex-grow flex-col",children:[(0,a.jsx)(l.r.Label,{as:"span",className:(0,i.m)("text-sm font-medium leading-6 text-zinc-700 dark:text-zinc-300",e.onLabel&&e.value&&"opacity-70",e.onLabel&&!e.value&&"text-brand-700 dark:text-brand-500"),passive:!0,children:e.label}),e.description&&(0,a.jsx)(l.r.Description,{as:"span",className:"text-sm text-zinc-500 dark:text-zinc-400",children:e.description})]}),(0,a.jsx)(l.r,{checked:e.value,onChange:e.onChange,className:(0,r.d)(e.value&&null==e.onLabel?"bg-brand-600":"bg-zinc-200 dark:bg-zinc-950/50","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none"),children:(0,a.jsx)("span",{"aria-hidden":"true",className:(0,r.d)(e.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-md shadow-black/20 ring-0 transition duration-200 ease-in-out dark:border-t dark:border-zinc-600 dark:bg-zinc-700 dark:shadow-black/100 ")})}),e.onLabel&&(0,a.jsx)("span",{className:"flex flex-grow flex-col",children:(0,a.jsx)(l.r.Label,{as:"span",className:(0,i.m)("text-sm font-medium leading-6 text-zinc-700 dark:text-zinc-300",e.onLabel&&!e.value&&"opacity-70",e.onLabel&&e.value&&"text-brand-700 dark:text-brand-500"),passive:!0,children:e.onLabel})})]})},21863:function(e,t,n){"use strict";n.d(t,{S:function(){return useChangeEffect}});var a=n(49738);let useChangeEffect=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],[l,i]=(0,a.useState)(0),r=(0,a.useRef)([...e]);(0,a.useEffect)(()=>{let t=!1;r.current.forEach((n,a)=>{n!==e[a]&&(t=!0)}),t&&i(e=>n?e+1:1),r.current=[...e]},[...e]);let s=(0,a.useCallback)(()=>{i(0)},[]);return(0,a.useEffect)(()=>{if(null!=t&&l>0){let e=setTimeout(()=>{i(0)},t);return()=>{clearTimeout(e)}}},[t,l]),[l>0,s]}}},function(e){e.O(0,[976,838,594,531,346,365,352,399,625,744],function(){return e(e.s=10944)}),_N_E=e.O()}]);