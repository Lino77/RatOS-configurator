(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[723],{10944:function(e,t,n){Promise.resolve().then(n.bind(n,46687))},46687:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Page}});var a=n(26248),i=n(49738),l=n(50962),r=n(44838),o=n(48542),s=n(63041);let useDebounce=(e,t)=>{let n=(0,i.useRef)(),a=(0,i.useRef)([]);return(0,i.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]),(0,i.useCallback)(function(){for(var i=arguments.length,l=Array(i),r=0;r<i;r++)l[r]=arguments[r];a.current=l,n.current||(n.current=setTimeout(()=>{e(...a.current),n.current=void 0},t))},[e,t])};var c=n(65778);let ScrollContainer=e=>(0,a.jsx)("div",{...e,className:(0,r.m)("scroll-smooth scrollbar-thin scrollbar-track-transparent scrollbar-thumb-zinc-400 scrollbar-thumb-rounded-md dark:scrollbar-thumb-zinc-600",e.className)}),d={pixelPrMm:160,outerNozzleDiameter:1,flipVertical:!1,flipHorizontal:!1},VaocSettingsDialog=e=>{var t,n;let{settings:l,setSettings:u,isSettingsFetched:m}=e,x=(0,i.useRef)(!1),[f,h]=(0,i.useState)(m?l.pixelPrMm.toFixed(2):null),[p,b]=(0,i.useState)(m?l.outerNozzleDiameter.toFixed(2):null),g=useDebounce(u,200);return(0,i.useEffect)(()=>{if(m&&!1===x.current){var e,t;h(null!==(e=null==l?void 0:l.pixelPrMm.toFixed(2))&&void 0!==e?e:d.pixelPrMm.toFixed(2)),b(null!==(t=null==l?void 0:l.outerNozzleDiameter.toFixed(2))&&void 0!==t?t:d.outerNozzleDiameter.toFixed(2)),x.current=!0}},[l,m]),(0,a.jsxs)(ScrollContainer,{className:(0,r.m)("absolute left-5 top-1/2 max-h-[50%] w-80 -translate-y-1/2 scale-100 overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 p-5 shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?"translate-x-0 opacity-100":"pointer-events-none -translate-x-8 opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:[(0,a.jsxs)("h3",{className:"flex flex-1 items-center justify-between text-base font-medium leading-7 text-zinc-900 dark:text-zinc-100",children:[(0,a.jsx)("span",{children:"Camera Settings"}),(0,a.jsx)(c,{className:"h-5 w-5 cursor-pointer",onClick:()=>e.toggle(!e.isVisible)})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 border-t border-zinc-100 pt-4 dark:border-zinc-800",children:[(0,a.jsx)(o.o,{label:"Pixel per mm",type:"number",value:null!=f?f:"",placeholder:m?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);h(e),isNaN(t)||g(e=>({...null!=e?e:{},pixelPrMm:t}))},error:isNaN(parseFloat(null!=f?f:""))?"Not a valid number":void 0}),(0,a.jsx)(o.o,{label:"Outer Nozzle Diameter",type:"number",step:.1,value:null!=p?p:"",placeholder:m?void 0:"Loading...",onChange:e=>{let t=parseFloat(e);console.log(e,t),b(e),isNaN(t)||g(e=>({...null!=e?e:{},outerNozzleDiameter:t}))},error:isNaN(parseFloat(null!=p?p:""))?"Not a valid number":void 0}),(0,a.jsx)(s.Z,{label:"Flip vertical",onChange:e=>u({...null!=l?l:d,flipVertical:null!=e&&e}),description:"Whether to flip the camera vertically",value:null!==(t=null==l?void 0:l.flipVertical)&&void 0!==t?t:d.flipVertical}),(0,a.jsx)(s.Z,{label:"Flip horizontal",onChange:e=>u({...null!=l?l:d,flipHorizontal:null!=e&&e}),description:"Whether to flip the camera horizontally",value:null!==(n=null==l?void 0:l.flipHorizontal)&&void 0!==n?n:d.flipHorizontal})]})]})};var u=n(61352),m=n(81503),x=n(45489);let parseOptions=e=>{let t=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\.\d+\])/g),n=[];for(let e of t){let[t,a]=e[2].slice(1,-1).split("..").map(e=>parseInt(e,10)),i=n.find(t=>t.key===e[1]);i&&"max"in i&&i.max&&i.max<=a||n.push({key:e[1],min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:a})}let a=e.matchAll(/- available option:\s(\w+)\s.+(\[-?\d+\.\d+\.\.\d+\.\d+\])/g);for(let e of a){let[t,a]=e[2].slice(1,-1).split("..").map(e=>parseFloat(e)),i=n.find(t=>t.key===e[1]);i&&"max"in i&&i.max&&i.max<=a||n.push({key:e[1],float:!0,min:t,max:["redbalance","bluebalance","greenbalance"].includes(e[1])?2e3:a})}let i=e.matchAll(/- available option:\s(\w+)\s.+(\[false\.\.true\])/g);for(let e of i)n.push({key:e[1],toggle:!0});return n};var f=n(52540),h=n(26989),p=n(5037);let useWindowSize=()=>{let[e,t]=(0,i.useState)({width:window.innerWidth,height:window.innerHeight});return(0,i.useEffect)(()=>{let handleResize=()=>{requestAnimationFrame(()=>{t({width:window.innerWidth,height:window.innerHeight})})};return window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[]),e};var b=n(21863),g=n(18754);let useGcodeCommand=()=>{let e=(0,u.xH)("printer.gcode.script");return(0,i.useCallback)(async function(t){for(var n=arguments.length,a=Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];let l=[t[0]];a.forEach((e,n)=>{l.push(e.toString(),t[n+1])});let r=l.join("");await e.mutateAsync({script:r}),console.log(r)},[e])};var v=n(99699),j=n(34594);function _templateObject(){let e=(0,x._)(["_VAOC_MOVE X="," Y=",""]);return _templateObject=function(){return e},e}let getCameraUrl=()=>{let e=(0,h.X)();return null==e||""==e.trim()?"/webcam":"http://".concat(e,"/webcam")},useUIState=()=>{let[e,t]=(0,i.useState)(.1),n=useWindowSize(),a=(0,p.W)(null,(e,n)=>{null!=e&&t(e.getBoundingClientRect().width/e.getBoundingClientRect().height)}),l=(0,i.useRef)(null);(0,v.Z)(a,e=>{t(e.contentRect.width/e.contentRect.height)}),(0,i.useEffect)(()=>{if(null!=a.current){var e,n,i;t((null===(e=a.current)||void 0===e?void 0:e.getBoundingClientRect().width)/(null===(n=a.current)||void 0===n?void 0:n.getBoundingClientRect().height))}},[n,a]);let[r,o]=(0,i.useState)(!1),s=(0,i.useCallback)(async e=>{j.Z.isEnabled&&l.current&&(null!=e&&(e?await j.Z.request(l.current):await j.Z.exit(),o(e)),(j.Z.isFullscreen||!1===e)&&(await j.Z.exit(),o(!1)),j.Z.isFullscreen&&!0!==e||(await j.Z.request(l.current),o(!0)))},[l]);(0,i.useEffect)(()=>{if(j.Z.isEnabled){let onChange=()=>{o(j.Z.isFullscreen)};return j.Z.on("change",onChange),()=>{j.Z.off("change",onChange)}}},[]);let[c,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!1),[x,f]=(0,i.useState)(1);return{containerAspectRatio:e,setContainerAspectRatio:t,canMove:c,setCanMove:d,rootRef:l,isLockingCoordinates:u,setIsLockingCoordinates:m,zoom:x,setZoom:f,containerRef:a,windowSize:n,isFullscreened:r,toggleFullscreen:s}},useSpatialMapping=e=>{let{videoRef:t,containerRef:n,zoom:a,windowSize:l,settings:r}=e,[o,s]=(0,i.useState)([0,0]),c=(0,i.useCallback)(e=>{var n,i;let l=null!==(i=null===(n=t.current)||void 0===n?void 0:n.videoWidth)&&void 0!==i?i:1,r=o[0];return e*a*(r>0&&l>0?r/l:1)},[t,o,a]),d=(0,i.useCallback)(e=>{var n,i;let l=null!==(i=null===(n=t.current)||void 0===n?void 0:n.videoWidth)&&void 0!==i?i:1,r=o[0];return e/a/(r>0&&l>0?r/l:1)},[o,t,a]),u=(0,i.useCallback)(e=>{var t;return c(e)*(null!==(t=null==r?void 0:r.pixelPrMm)&&void 0!==t?t:0)},[c,null==r?void 0:r.pixelPrMm,l]),m=(0,i.useCallback)(e=>{var t;return d(e)/(null!==(t=null==r?void 0:r.pixelPrMm)&&void 0!==t?t:0)},[d,null==r?void 0:r.pixelPrMm]);return(0,v.Z)(n,e=>{s([e.contentRect.width,e.contentRect.height])}),{toScreen:u,toMillimeters:m}},useGestures=e=>{let{gestureRef:t,setZoom:n,isConnected:a,canMove:l,toScreen:r,toMillimeters:o,zoom:s}=e,[c,d]=(0,i.useState)(null),[u,m]=(0,i.useState)({x:!1,y:!1}),x=useGcodeCommand();return(0,g.useGesture)({onDrag:e=>{if(e.dragging)d([e.offset[0],e.offset[1]]),m({x:e._movementBound[0],y:e._movementBound[1]});else{var t,n;let e=o(null!==(t=null==c?void 0:c[0])&&void 0!==t?t:0),a=-1*o(null!==(n=null==c?void 0:c[1])&&void 0!==n?n:0);x(_templateObject(),e,a),d(null),m({x:!1,y:!1})}},onPinch:e=>{n(t=>Math.max(Math.min(t*e.offset[0],10),1))},onWheel:e=>{0!=e.delta[1]&&!1!=e.wheeling&&!1!=e.intentional&&(e.delta[1]<0?n(e=>Math.max(.85*e,1)):n(e=>Math.min(1.15*e,10)))}},{target:t,enabled:a,drag:{enabled:l,from:()=>[0,0],bounds:{left:-r(1),right:r(1),top:-r(1),bottom:r(1)},rubberband:!0},wheel:{axis:"y",rubberband:!1},pinch:{scaleBounds:{min:1,max:10},pinchOnWheel:!1,rubberband:!0}}),{scaledDragOffset:{x:null==c?0:c[0]/s,y:null==c?0:c[1]/s},dragOffset:{x:null==c?0:c[0],y:null==c?0:c[1]},isDragging:null!=c,dragOutside:u}},useCrossHairState=e=>{var t;let{toScreen:n,settings:a}=e,l=null!==(t=e.snapshotDuration)&&void 0!==t?t:200,[r]=(0,b.S)([e.isLockingCoordinates],l,!0),[o,s]=(0,i.useState)([0,0]),[c]=(0,b.I)([e.isLockingCoordinates],l-10,10,!0),d=(0,i.useMemo)(()=>n(.2),[n]),u=(0,i.useMemo)(()=>r?d:n(a?a.outerNozzleDiameter/2:0),[n,r,d,a]),m=(0,i.useMemo)(()=>e.isConnected?u/o[0]*100:0,[e.isConnected,u,o]),x=(0,i.useMemo)(()=>e.isConnected?u/o[1]*100:0,[e.isConnected,u,o]),f=(0,i.useMemo)(()=>n(.01),[n]);return(0,v.Z)(e.containerRef,e=>{s([e.contentRect.width,e.contentRect.height])}),{nozzleRadius:d,outerNozzleRadius:u,outerNozzleRadiusPercentWidth:m,outerNozzleRadiusPercentHeight:x,crosshairStrokeWidth:f,delayedIsLockingCoordinates:c}},useVideoState=()=>{let[e,t]=(0,i.useState)(getCameraUrl());(0,i.useEffect)(()=>{e!==getCameraUrl()&&t(getCameraUrl())},[e]);let[n,a]=(0,i.useState)(null),[l,r]=(0,i.useState)(null),o=(0,i.useCallback)(e=>{e.framesPerSecond&&a(e.framesPerSecond),e.frameHeight&&e.frameWidth&&r(e.frameWidth/e.frameHeight)},[]);return{url:e,setUrl:t,fps:n,aspectRatio:l,onStreamStats:o}},useStreamSettings=e=>{let{url:t,isConnected:n,settings:a,saveSettings:l,isInitialLoading:r,isFetched:o}=e,[s,c]=(0,i.useState)([]),d=(0,i.useRef)(a);d.current=a;let u=(0,i.useMemo)(()=>s.map(e=>{var t,n,a;return e.value=null!==(a=null===(n=d.current)||void 0===n?void 0:null===(t=n[e.key])||void 0===t?void 0:t.value)&&void 0!==a?a:e.value,"max"in e&&"ExposureTime"===e.key&&(e.min=0,e.max=6e4),e}),[s]),m=(0,i.useCallback)(async e=>{let n=await fetch("".concat(t,"/option?compressionquality=").concat(e));c(parseOptions(await n.text()))},[t]),x=(0,i.useCallback)(async(e,n)=>{let a=s.find(t=>t.key===e);if(null==a)throw Error("Invalid option ".concat(e));if(a&&"toggle"in a&&"boolean"!=typeof n)throw Error("Expect a boolean value for ".concat(e,", got ").concat(n));if(a&&"max"in a&&("number"!=typeof n||a.min>n||a.max<n))throw Error("Value ".concat(n," is out of range for ").concat(e));try{let a="boolean"==typeof n?n?1:0:n,s=await fetch("".concat(t,"/option?").concat(e,"=").concat(a.toString()));if(s.ok&&!1===r){var i,o;console.log("saving",e,n,d.current,(0,f.T)(null!==(i=d.current)&&void 0!==i?i:{},{[e]:{value:n}})),await l((0,f.T)(null!==(o=d.current)&&void 0!==o?o:{},{[e]:{value:n}}))}return s.ok}catch(e){return!1}},[s,t,r,l]);return(0,i.useEffect)(()=>{if(n&&m(100),n&&o&&null!=d.current)for(let n in d.current){var e;let a=null===(e=d.current[n])||void 0===e?void 0:e.value,i="boolean"==typeof a?a?1:0:a;null!=i&&fetch("".concat(t,"/option?").concat(n,"=").concat(i.toString()))}},[o,t,n,m]),{options:u,setOption:x}};var w=n(91403),y=n(16277),k=n(46251),C=n(75403),N=n(78926),z=n(67419),S=n(26781),_=n(3487),O=n(51601),E=n(55282);let ExposureIcon=e=>(0,a.jsxs)("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",className:e.className,children:[(0,a.jsx)("path",{fill:"currentColor",d:"M456,40H56A16,16,0,0,0,40,56V456a16,16,0,0,0,16,16H456a16,16,0,0,0,16-16V56A16,16,0,0,0,456,40ZM72,72H417.373L72,417.373ZM440,440H94.627L440,94.627Z"}),(0,a.jsx)("polygon",{fill:"currentColor",points:"336 368 336 408 368 408 368 368 408 368 408 336 368 336 368 296 336 296 336 336 296 336 296 368 336 368"}),(0,a.jsx)("rect",{width:"112",height:"32",x:"112",y:"136",fill:"currentColor"})]});var R=n(74193),T=n(19731),V=n(20978),F=n(73838);function focus_controls_templateObject(){let e=(0,x._)(["G91\nG0 Z1"],["G91\\nG0 Z1"]);return focus_controls_templateObject=function(){return e},e}function _templateObject1(){let e=(0,x._)(["G91\nG0 Z0.5"],["G91\\nG0 Z0.5"]);return _templateObject1=function(){return e},e}function _templateObject2(){let e=(0,x._)(["G91\nG0 Z0.1"],["G91\\nG0 Z0.1"]);return _templateObject2=function(){return e},e}function _templateObject3(){let e=(0,x._)(["G91\nG0 Z0.05"],["G91\\nG0 Z0.05"]);return _templateObject3=function(){return e},e}function _templateObject4(){let e=(0,x._)(["G91\nG0 Z-0.05"],["G91\\nG0 Z-0.05"]);return _templateObject4=function(){return e},e}function _templateObject5(){let e=(0,x._)(["G91\nG0 Z-0.1"],["G91\\nG0 Z-0.1"]);return _templateObject5=function(){return e},e}function _templateObject6(){let e=(0,x._)(["G91\nG0 Z-0.5"],["G91\\nG0 Z-0.5"]);return _templateObject6=function(){return e},e}function _templateObject7(){let e=(0,x._)(["G91\nG0 Z-1.0"],["G91\\nG0 Z-1.0"]);return _templateObject7=function(){return e},e}let FocusControls=e=>{let t=useGcodeCommand();return(0,a.jsx)("div",{className:(0,r.m)("scroll absolute transform-gpu overflow-y-auto rounded-md border-y border-r border-zinc-800 bg-zinc-100 font-mono shadow-lg transition-all dark:bg-zinc-900/70",e.isVisible?" -translate-y-full opacity-100":"pointer-events-none  -translate-y-2/3  opacity-0",e.className),onWheel:e=>{e.stopPropagation()},children:(0,a.jsxs)("ol",{className:"flex flex-col divide-y divide-zinc-200 dark:divide-zinc-800",children:[(0,a.jsx)("li",{className:(0,l.d)("flex"),children:(0,a.jsx)("div",{className:(0,l.d)("flex flex-1 items-center justify-center text-center"),children:(0,a.jsxs)("button",{onClick:()=>t(focus_controls_templateObject()),type:"button",className:(0,r.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,a.jsx)(R,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"inline",children:"+1.00"})]})})}),(0,a.jsx)("li",{className:(0,l.d)("flex"),children:(0,a.jsx)("div",{className:(0,l.d)("flex flex-1 items-center justify-center text-center"),children:(0,a.jsxs)("button",{onClick:()=>t(_templateObject1()),type:"button",className:(0,r.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,a.jsx)(T,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"inline",children:"+0.50"})]})})}),(0,a.jsx)("li",{className:(0,l.d)("flex"),children:(0,a.jsx)("div",{className:(0,l.d)("flex flex-1 items-center justify-center text-center"),children:(0,a.jsxs)("button",{onClick:()=>t(_templateObject2()),type:"button",className:(0,r.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,a.jsx)(T,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"inline",children:"+0.10"})]})})}),(0,a.jsx)("li",{className:(0,l.d)("flex"),children:(0,a.jsx)("div",{className:(0,l.d)("flex flex-1 items-center justify-center text-center"),children:(0,a.jsxs)("button",{onClick:()=>t(_templateObject3()),type:"button",className:(0,r.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,a.jsx)(T,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"inline",children:"+0.05"})]})})}),(0,a.jsx)("li",{className:(0,l.d)("flex"),children:(0,a.jsx)("div",{className:(0,l.d)("flex flex-1 items-center justify-center text-center"),children:(0,a.jsxs)("button",{onClick:()=>t(_templateObject4()),type:"button",className:(0,r.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,a.jsx)(T,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"inline",children:"-0.05"})]})})}),(0,a.jsx)("li",{className:(0,l.d)("flex"),children:(0,a.jsx)("div",{className:(0,l.d)("flex flex-1 items-center justify-center text-center"),children:(0,a.jsxs)("button",{onClick:()=>t(_templateObject5()),type:"button",className:(0,r.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,a.jsx)(V,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"inline",children:"-0.10"})]})})}),(0,a.jsx)("li",{className:(0,l.d)("flex"),children:(0,a.jsx)("div",{className:(0,l.d)("flex flex-1 items-center justify-center text-center"),children:(0,a.jsxs)("button",{onClick:()=>t(_templateObject6()),type:"button",className:(0,r.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,a.jsx)(V,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"inline",children:"-0.50"})]})})}),(0,a.jsx)("li",{className:(0,l.d)("flex"),children:(0,a.jsx)("div",{className:(0,l.d)("flex flex-1 items-center justify-center text-center"),children:(0,a.jsxs)("button",{onClick:()=>t(_templateObject7()),type:"button",className:(0,r.m)("flex items-center justify-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-100"),children:[(0,a.jsx)(F,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"inline",children:"-1.00"})]})})})]})})};var A=n(74601),Z=n(50961),M=n(88116);let L={duration:150},Button=e=>{let[t]=(0,M.u)(),[n,o]=i.useState(!1),s=useDebounce(o,200),c=(0,i.useCallback)(async()=>{e.onClick&&!e.isLoading&&(s(!0),await e.onClick(),s(!1))},[s,e]);return(0,a.jsxs)("li",{className:(0,l.d)("flex"),children:["before"===e.subButtonPosition&&(0,a.jsx)("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),(0,a.jsx)("div",{className:(0,l.d)("flex items-center",e.isActive&&"dark:bg-zinc-800"),children:(0,a.jsxs)("button",{onClick:c,type:"button",title:e.title,className:(0,r.m)("flex items-center space-x-2 whitespace-nowrap px-5 py-3 text-sm font-medium text-zinc-700 transition-transform hover:text-black active:scale-95 dark:text-zinc-300 dark:hover:text-white",e.isActive?"hover:text-brand:600 text-brand-600 dark:text-brand-500 dark:hover:text-brand-500":"",e.hidden?"hidden":"",e.className),children:[e.icon&&(e.isLoading||n)&&(0,a.jsx)(m.$,{noMargin:!0,className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.icon&&!e.isLoading&&(0,a.jsx)(e.icon,{className:"inline h-5 w-5 flex-shrink-0","aria-hidden":"true"}),e.name&&(0,a.jsx)("span",{className:"inline",children:e.name})]})}),null!=e.subButtonPosition&&"before"!==e.subButtonPosition&&(0,a.jsx)("ol",{ref:t,className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",children:e.children}),null==e.subButtonPosition&&e.children&&e.children]},e.id)};function Toolbar(e){let[t]=(0,M.u)(L);return(0,a.jsx)("nav",{className:(0,r.m)("flex select-none overflow-hidden rounded-md border border-zinc-200 bg-white shadow dark:border-zinc-800 dark:bg-zinc-900/80",e.className),"aria-label":"Breadcrumb",children:(0,a.jsx)("ol",{role:"list",className:"flex divide-x divide-zinc-200 dark:divide-zinc-800",ref:t,children:e.buttons.map(t=>{var n;let a=null===(n=e.subButtons)||void 0===n?void 0:n.filter(e=>e.parent===t.id);return t.hidden?null:(0,i.createElement)(Button,{...t,key:t.id},null!=a&&a.length>0&&t.isActive?a.map(e=>e.hidden?null:(0,i.createElement)(Button,{...e,key:e.id})):t.children)})})})}var P=n(8930);let Slider=e=>{let{onChange:t,min:n,max:l,initialValue:r,step:o,isBoolean:s}=e,[c,d]=(0,i.useState)(null!=r?r:n),u=useDebounce((0,i.useCallback)(e=>{null==t||t(e)},[t]),100),m=(0,i.useCallback)(e=>{let t=o?parseFloat(e.target.value):parseInt(e.target.value,10);d(t),u(t)},[u,o]);return(0,a.jsxs)("div",{className:"relative mb-6",children:[(0,a.jsx)("input",{type:"range",value:c,onChange:m,min:n,max:l,step:null!=o?o:1,className:"h-2 w-full cursor-pointer appearance-none rounded-lg bg-zinc-200 dark:bg-zinc-700"}),(0,a.jsx)("span",{className:"absolute -bottom-6 start-0 text-sm text-zinc-500 dark:text-zinc-400",children:s?"Off":"Min (".concat(n,")")}),!s&&(0,a.jsx)("span",{className:"absolute -bottom-6 start-1/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(l/3).toFixed(2)}),!s&&(0,a.jsx)("span",{className:"absolute -bottom-6 start-2/3 -translate-x-1/2 text-sm text-zinc-500 dark:text-zinc-400 rtl:translate-x-1/2",children:(l/3*2).toFixed(2)}),(0,a.jsx)("span",{className:"absolute -bottom-6 end-0 text-sm text-zinc-500 dark:text-zinc-400",children:s?"On":"Max (".concat(l,")")})]})},StreamSettingsDialog=e=>{let{url:t,isConnected:n,isAdvancedVisible:i,isColorVisible:r,isExposureVisible:o}=e,[s,c,d]=(0,u.Fu)("RatOS","camera-stream-settings"),{options:m,setOption:x}=useStreamSettings({url:t,isConnected:n,settings:s,saveSettings:c,isInitialLoading:d.isInitialLoading,isFetched:d.isFetched}),[f]=(0,M.u)();return(0,a.jsx)(ScrollContainer,{className:(0,l.d)("absolute bottom-24 left-1/4 right-1/4 max-h-[50%] overflow-y-scroll overscroll-contain rounded-md bg-zinc-900/70",e.className),children:(0,a.jsxs)("div",{ref:f,children:[o&&m.filter(e=>e.key.toLowerCase().includes("gain")||e.key.toLowerCase().includes("exposure")||e.key.startsWith("Ae")||e.key.toLowerCase().includes("brightness")).filter(e=>"ColourGains"!==e.key).map(e=>(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),(0,a.jsx)(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>x(e.key,"toggle"in e?!!t:t)})]},e.key)),r&&m.filter(e=>e.key.toLowerCase().includes("saturation")||e.key.toLowerCase().includes("contrast")||e.key.startsWith("Awb")).map(e=>(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),(0,a.jsx)(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>x(e.key,"toggle"in e?!!t:t)})]},e.key)),i&&m.map(e=>(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("label",{className:"block text-center text-base font-semibold capitalize text-zinc-200",children:e.key}),(0,a.jsx)(Slider,{isBoolean:"toggle"in e,min:"toggle"in e?0:"min"in e?e.min:0,initialValue:!0===e.value?1:!1===e.value?0:e.value,max:"toggle"in e?1:"max"in e?e.max:0,step:"float"in e&&e.float?"any":1,onChange:t=>x(e.key,"toggle"in e?!!t:t)})]},e.key))]})})},EnterFullscreenIcon=e=>(0,a.jsx)("svg",{...e,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M2 2.5C2 2.22386 2.22386 2 2.5 2H5.5C5.77614 2 6 2.22386 6 2.5C6 2.77614 5.77614 3 5.5 3H3V5.5C3 5.77614 2.77614 6 2.5 6C2.22386 6 2 5.77614 2 5.5V2.5ZM9 2.5C9 2.22386 9.22386 2 9.5 2H12.5C12.7761 2 13 2.22386 13 2.5V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3H9.5C9.22386 3 9 2.77614 9 2.5ZM2.5 9C2.77614 9 3 9.22386 3 9.5V12H5.5C5.77614 12 6 12.2239 6 12.5C6 12.7761 5.77614 13 5.5 13H2.5C2.22386 13 2 12.7761 2 12.5V9.5C2 9.22386 2.22386 9 2.5 9ZM12.5 9C12.7761 9 13 9.22386 13 9.5V12.5C13 12.7761 12.7761 13 12.5 13H9.5C9.22386 13 9 12.7761 9 12.5C9 12.2239 9.22386 12 9.5 12H12V9.5C12 9.22386 12.2239 9 12.5 9Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})}),ExitFullscreenIcon=e=>(0,a.jsx)("svg",{...e,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M5.5 2C5.77614 2 6 2.22386 6 2.5V5.5C6 5.77614 5.77614 6 5.5 6H2.5C2.22386 6 2 5.77614 2 5.5C2 5.22386 2.22386 5 2.5 5H5V2.5C5 2.22386 5.22386 2 5.5 2ZM9.5 2C9.77614 2 10 2.22386 10 2.5V5H12.5C12.7761 5 13 5.22386 13 5.5C13 5.77614 12.7761 6 12.5 6H9.5C9.22386 6 9 5.77614 9 5.5V2.5C9 2.22386 9.22386 2 9.5 2ZM2 9.5C2 9.22386 2.22386 9 2.5 9H5.5C5.77614 9 6 9.22386 6 9.5V12.5C6 12.7761 5.77614 13 5.5 13C5.22386 13 5 12.7761 5 12.5V10H2.5C2.22386 10 2 9.77614 2 9.5ZM9 9.5C9 9.22386 9.22386 9 9.5 9H12.5C12.7761 9 13 9.22386 13 9.5C13 9.77614 12.7761 10 12.5 10H10V12.5C10 12.7761 9.77614 13 9.5 13C9.22386 13 9 12.7761 9 12.5V9.5Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})});function toolbars_templateObject(){let e=(0,x._)(["_VAOC_END"]);return toolbars_templateObject=function(){return e},e}function toolbars_templateObject1(){let e=(0,x._)(["_VAOC_START"]);return toolbars_templateObject1=function(){return e},e}function toolbars_templateObject2(){let e=(0,x._)(["_VAOC_LOAD_TOOL T=0"]);return toolbars_templateObject2=function(){return e},e}function toolbars_templateObject3(){let e=(0,x._)(["_VAOC_LOAD_TOOL T=1"]);return toolbars_templateObject3=function(){return e},e}function toolbars_templateObject4(){let e=(0,x._)(["_VAOC_SWITCH_LED STATE=",""]);return toolbars_templateObject4=function(){return e},e}function toolbars_templateObject5(){let e=(0,x._)(["_VAOC_SET_TOOL"]);return toolbars_templateObject5=function(){return e},e}function toolbars_templateObject6(){let e=(0,x._)(["_VAOC_PROBE_Z_OFFSET"]);return toolbars_templateObject6=function(){return e},e}let useToolbarState=e=>{var t,n;let[a,l]=(0,i.useState)(!1),[r,o]=(0,i.useState)(!1),[s,c]=(0,i.useState)(!1),[d,m]=(0,i.useState)(!1),[x,f]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!1),[g,v]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!1),[y,k]=(0,i.useState)(!1),[C,N]=(0,b.S)([e.zoom],2e3,!0),z=(0,i.useCallback)(()=>{w(e=>!e),N()},[N]),{hasZOffsetProbe:S}=null!==(t=(0,u.Q)(e=>({hasZOffsetProbe:null!=e.configfile.settings.z_offset_probe}),"configfile"))&&void 0!==t?t:{hasZOffsetProbe:!1},[_,O]=(0,i.useState)(!1),E=(0,u.Q)(e=>({homed_axes:e.toolhead.homed_axes,position:e.toolhead.position}),"toolhead"),R=(0,u.Q)(e=>({active:e["gcode_macro T0"].active}),"gcode_macro T0"),T=(0,u.Q)(e=>({active:e["gcode_macro T1"].active}),"gcode_macro T1"),{isVaocStarted:V}=null!==(n=(0,u.Q)(e=>({isVaocStarted:e["gcode_macro _VAOC"].is_started}),"gcode_macro _VAOC"))&&void 0!==n?n:{isVaocStarted:!1};return{toolhead:E,tool:(null==R?void 0:R.active)?"T0":(null==T?void 0:T.active)?"T1":null,isStartingVaoc:a,setIsStartingVaoc:l,isSettingsVisible:r,setIsSettingsVisible:o,isExposureVisible:s,setIsExposureVisible:c,isColorVisible:d,setIsColorVisible:m,isFocusVisible:x,setIsFocusVisible:f,isAdvancedVisible:h,setIsAdvancedVisible:p,light:g,setLight:v,isVaocStarted:V,isZoomExpanded:C||j,toggleIsZoomExpanded:z,hasZOffsetProbe:S,isZOffsetProbeVisible:_,setIsZOffsetProbeVisible:O,isCameraControlsVisible:y,setIsCameraControlsVisible:k}},Toolbars=e=>{let{canMove:t,isLockingCoordinates:n,zoom:l,setIsLockingCoordinates:r,setCanMove:o,setZoom:s,fps:c,url:d,isConnected:u,setSettings:m,settings:x,isSettingsFetched:f,isFullscreened:h}=e,{toolhead:p,tool:g,isStartingVaoc:v,setIsStartingVaoc:j,isSettingsVisible:R,setIsSettingsVisible:T,isExposureVisible:V,setIsExposureVisible:F,isColorVisible:M,setIsColorVisible:L,isFocusVisible:G,setIsFocusVisible:H,isAdvancedVisible:D,setIsAdvancedVisible:B,light:I,setLight:W,isVaocStarted:X,isZoomExpanded:U,toggleIsZoomExpanded:q,hasZOffsetProbe:Q,isZOffsetProbeVisible:Y,setIsZOffsetProbeVisible:J,isCameraControlsVisible:$,setIsCameraControlsVisible:K}=useToolbarState({zoom:l}),ee=useGcodeCommand(),[et]=(0,b.S)([n],200,!0),en=[{icon:X?A:Z,id:"start/stop",name:X?void 0:"Start Calibration",title:X?"Stop calibration":"Start calibration",onClick:async()=>{if(!v){if(X&&h){var t;null===(t=e.toggleFullscreen)||void 0===t||t.call(e,!1)}j(!0),await (X?ee(toolbars_templateObject()):ee(toolbars_templateObject1())),j(!1)}},isActive:X},{name:"T0",id:"t0",hidden:!X,title:"Switch to tool 0 (T0)",onClick:async()=>{o(!1),await ee(toolbars_templateObject2())},isActive:"T0"===g},{name:"T1",id:"t1",hidden:!X,title:"Switch to tool 1 (T1)",onClick:async()=>{o(!1),await ee(toolbars_templateObject3())},isActive:"T1"===g}],ea=[{icon:w,id:"zoom",title:"".concat(U?"Hide":"Show"," zoom controls"),subButtonPosition:"before",className:"font-mono",name:l>=10?"MAX!":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(P.ZP,{preserveValue:!0,start:0,end:Math.round(100*l),duration:.15}),"%"]}),onClick:()=>{q()},isActive:U},{icon:y,id:"light",title:"".concat(I?"Turn off":"Turn on"," the LEDs"),onClick:async()=>{let e=!I;await ee(toolbars_templateObject4(),e?1:0),W(e)},isActive:I},{icon:h?ExitFullscreenIcon:EnterFullscreenIcon,id:"fullscreen",title:"".concat(h?"Exit":"Enter"," fullscreen mode"),onClick:()=>{e.toggleFullscreen&&e.toggleFullscreen()},isActive:h}],ei=(0,i.useMemo)(()=>{var e,n,i,l;return[{name:"Settings",icon:k,id:"settings",title:"Show camera settings dialog",onClick:()=>{T(e=>!e)},isActive:R},{name:"T0"===g?"Set reference":"Set offset",icon:C,isLoading:et,hidden:!X,id:"reference",title:"Set the ".concat("T0"===g?"T0 reference point":"T1 offset"),onClick:async()=>{J(!!Q),r(!0),await ee(toolbars_templateObject5()),r(!1),o(!1)},isActive:et},{name:t?(0,a.jsxs)("span",{className:"font-mono",children:[(null!==(i=null==p?void 0:null===(e=p.position)||void 0===e?void 0:e[0])&&void 0!==i?i:0).toFixed(2),", ",(null!==(l=null==p?void 0:null===(n=p.position)||void 0===n?void 0:n[1])&&void 0!==l?l:0).toFixed(2)]}):"Move",icon:N,hidden:!X,id:"move",title:"".concat(t?"Disable":"Enable"," drag and drop calibration"),onClick:()=>{t?(H(!1),F(!1),L(!1),B(!1),K(!1)):(H(!0),F(!1),L(!1),B(!1),K(!0)),o(e=>!e)},isActive:t},{name:"Z-Probe",icon:z,title:"Probe the z endstop to set the Z offset",id:"z-probe",hidden:!X||!Q||!Y,onClick:async()=>{await ee(toolbars_templateObject6())},isActive:!1}]},[R,g,et,X,t,null==p?void 0:p.position,Q,Y,T,J,r,ee,o,H,F,L,B,K]),el=(0,i.useMemo)(()=>{let e=[{icon:S,name:(0,a.jsx)("span",{children:null==c?"Loading...":(0,a.jsxs)("span",{children:[(0,a.jsx)(P.ZP,{start:0,preserveValue:!0,duration:1,end:c})," FPS"]})}),className:"font-mono",id:"settings",subButtonPosition:"before",title:"".concat($?"Hide":"Show"," camera controls"),onClick:()=>{$&&(H(!1),F(!1),L(!1),B(!1)),K(e=>!e)},isActive:$}];return e},[c,$,B,K,L,F,H]),er=(0,i.useMemo)(()=>{let e=[{icon:_,id:"focus",parent:"settings",hidden:M||D||V,name:"Z Focus",title:"".concat(G?"Hide":"Show"," focus controls"),children:(0,a.jsx)(FocusControls,{isVisible:G,toggle:H}),onClick:()=>{H(e=>!e),F(!1),L(!1),B(!1)},isActive:G},{icon:ExposureIcon,id:"exposure",parent:"settings",hidden:M||D||G,title:"".concat(V?"Hide":"Show"," exposure controls"),name:"Exposure",onClick:()=>{F(e=>!e),L(!1),B(!1),H(!1)},isActive:V},{icon:O,id:"color",parent:"settings",title:"".concat(M?"Hide":"Show"," color controls"),hidden:V||D||G,name:"Color",onClick:()=>{L(e=>!e),F(!1),B(!1),H(!1)},isActive:M},{icon:E,id:"advanced-camera-controls",parent:"settings",title:"".concat(D?"Hide":"Show"," advanced camera controls"),name:"Advanced",hidden:V||M||G,onClick:()=>{B(e=>!e),F(!1),L(!1),H(!1)},isActive:D}];return e.reverse()},[M,D,V,G,H,F,L,B]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Toolbar,{className:"pointer-events-auto absolute left-5 top-5",buttons:en}),(0,a.jsx)(Toolbar,{className:"pointer-events-auto absolute bottom-5 right-5 overflow-visible",buttons:el,subButtons:er}),(0,a.jsx)(Toolbar,{className:"pointer-events-auto absolute right-5 top-5",buttons:ea,subButtons:[{name:"1X",id:"1x",parent:"zoom",title:"Set zoom to 1X (100%)",className:"font-mono",onClick:()=>{s(1)},isActive:!1},{name:"2X",id:"2x",parent:"zoom",title:"Set zoom to 2X (200%)",className:"font-mono",onClick:()=>{s(2)},isActive:!1},{name:"4X",id:"4x",parent:"zoom",title:"Set zoom to 4X (400%)",className:"font-mono",onClick:()=>{s(4)},isActive:!1}]}),(0,a.jsx)(Toolbar,{className:"pointer-events-auto absolute bottom-5 left-5",buttons:ei}),(0,a.jsx)(VaocSettingsDialog,{className:"pointer-events-auto",isVisible:R,toggle:T,settings:x,isSettingsFetched:f,setSettings:m}),(0,a.jsx)(StreamSettingsDialog,{className:"pointer-events-auto",url:d,isConnected:u,isExposureVisible:V,isColorVisible:M,isAdvancedVisible:D})]})},SafetyVisualization=e=>{let{gestureState:t}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,l.d)("absolute inset-0",t.dragOutside.x&&t.dragOutside.x>0?"left-0 right-2/3 bg-gradient-to-r from-red-500/70 to-red-500/0":"left-2/3 right-0 bg-gradient-to-l from-red-500/70 to-red-500/0"),style:{opacity:t.dragOutside.x?Math.abs(t.dragOutside.x-t.dragOffset.x)/200:0,transform:"translateX(".concat(t.scaledDragOffset.x,"px) translateY(").concat(t.scaledDragOffset.y,"px)")}}),(0,a.jsx)("div",{className:(0,l.d)("absolute inset-0",t.dragOutside.y&&t.dragOutside.y>0?"bottom-2/3 top-0 bg-gradient-to-b from-red-500/70 to-red-500/0":"bottom-0 top-2/3 bg-gradient-to-t from-red-500/70 to-red-500/0"),style:{opacity:t.dragOutside.y?Math.abs(t.dragOutside.y-t.dragOffset.y)/200:0,transform:"translateX(".concat(t.scaledDragOffset.x,"px) translateY(").concat(t.scaledDragOffset.y,"px)")}})]})},FillViewport=e=>(0,a.jsx)("div",{className:(0,l.d)("pointer-events-none absolute inset-0 flex items-center justify-center",e.className),children:e.children}),FillVideoFrame=e=>(0,a.jsx)("div",{className:(0,l.d)("pointer-events-none absolute inset-0 top-1/2 -translate-y-1/2 transition-all",e.className),style:e.videoAspectRatio?{aspectRatio:Math.max(e.videoAspectRatio/e.zoom,e.containerAspectRatio)}:{},children:e.children}),CrossHair=e=>{let{outerNozzleRadius:t,nozzleRadius:n,outerNozzleRadiusPercentWidth:i,outerNozzleRadiusPercentHeight:r,crosshairStrokeWidth:o,delayedIsLockingCoordinates:s}=useCrossHairState(e);return(0,a.jsx)(FillViewport,{children:(0,a.jsxs)("svg",{width:"100%",height:"100%",children:[(0,a.jsxs)("g",{className:(0,l.d)(e.isConnected&&t>0?"opacity-100":"opacity-0"),children:[(0,a.jsx)("rect",{x:"50%",y:"".concat(50-r,"%"),height:"".concat(2*r,"%"),width:o,shapeRendering:"geometricPrecision",className:"fill-brand-500 transition-all ease-in-out",style:{transform:"translateX(-".concat(o/2,")")}}),(0,a.jsx)("rect",{x:"".concat(50-i,"%"),y:"50%",width:"".concat(2*i,"%"),height:o,shapeRendering:"geometricPrecision",className:"fill-brand-500 transition-all ease-in-out",style:{transform:"translateY(-".concat(o/2,")")}})]}),(0,a.jsx)("circle",{cx:"50%",cy:"50%",r:s?t:1.5*t,fill:"none",className:(0,l.d)("ease-out",s?"fill-brand-300":"fill-brand-300/0 transition-all duration-700"),shapeRendering:"geometricPrecision",strokeWidth:0}),(0,a.jsx)("circle",{cx:"50%",cy:"50%",r:n,fill:"none",className:(0,l.d)("stroke-brand-500 transition-all ease-in-out",e.isConnected&&t>0?"opacity-100":"opacity-0"),shapeRendering:"geometricPrecision",strokeWidth:o}),(0,a.jsx)("circle",{cx:"50%",cy:"50%",r:t,fill:"none",className:(0,l.d)("stroke-brand-500 transition-all ease-in-out",e.isConnected&&t>0?"opacity-100":"opacity-0"),shapeRendering:"geometricPrecision",strokeWidth:o})]})})};function Page(){var e,t,n;let o=useVideoState(),{videoRef:s,connectionState:c}=function(e,t){let n=(0,i.useRef)(null),a=(0,i.useRef)(null),l=(0,i.useRef)(null),r=(0,i.useRef)(e),o=(0,i.useRef)(!1),[s,c]=(0,i.useState)(null),d=(0,i.useRef)(null),u=(0,i.useCallback)(e=>{if(e.candidate)return fetch(r.current,{body:JSON.stringify({type:"remote_candidate",id:d.current,candidates:[e.candidate]}),headers:{"Content-Type":"application/json"},method:"POST"}).catch(function(e){window.console.error(e)})},[]),m=(0,i.useCallback)(async()=>{l.current&&(l.current.close(),l.current=null),o.current=!0;try{c("new");var t={sdpSemantics:"unified-plan"};document.getElementById("use-stun")&&document.getElementById("use-stun").checked&&(t.iceServers=[{urls:["stun:stun.l.google.com:19302"]}]);let r=new URLSearchParams(e),o=Object.fromEntries(r.entries()),s=await fetch(e,{body:JSON.stringify({type:"request",res:o.res}),headers:{"Content-Type":"application/json"},method:"POST"});if(s.ok){let r=await s.json();r.iceServers&&(t.iceServers=r.iceServers),l.current=new RTCPeerConnection(t),l.current.addTransceiver("video",{direction:"recvonly"}),l.current.addEventListener("track",function(e){if("video"==e.track.kind){if(n.current)n.current.srcObject=e.streams[0];else throw Error("No video ref to set src on")}else a.current&&(a.current.srcObject=e.streams[0])}),l.current.addEventListener("connectionstatechange",()=>{var e;let t=null===(e=l.current)||void 0===e?void 0:e.connectionState;c(null!=t?t:null)}),d.current=r.id,await l.current.setRemoteDescription(r);let o=await l.current.createAnswer();await l.current.setLocalDescription(o),await new Promise(function(e){if(null==l.current)throw Error("peerConnection.current is null");"complete"===l.current.iceGatheringState?e(null):l.current.addEventListener("icegatheringstatechange",function checkState(){if(null==l.current)throw Error("peerConnection.current is null");"complete"===l.current.iceGatheringState&&(l.current.removeEventListener("icegatheringstatechange",checkState),e(null))})}),l.current.addEventListener("icecandidate",u);var i=l.current.localDescription;if(null==i)throw Error("No offer from peerConnection");await fetch(e,{body:JSON.stringify({type:i.type,id:d.current,sdp:i.sdp}),headers:{"Content-Type":"application/json"},method:"POST"})}else c("failed")}catch(e){console.error(e),c("failed")}finally{o.current=!1}},[u,e]);return(0,i.useEffect)(()=>{if(t){let e=setInterval(async()=>{if(l.current){let e=await l.current.getStats();e.forEach(e=>{"inbound-rtp"===e.type&&"video"===e.kind&&(null==t||t(e))})}},1e3);return()=>clearInterval(e)}},[t]),(0,i.useEffect)(()=>{e&&!1===o.current?m():l.current&&!1===o.current&&l.current.close()},[m,e]),(0,i.useEffect)(()=>{if(["failed","disconnected"].includes(null!=s?s:"")){let e=setTimeout(()=>{m()},5e3);return()=>clearTimeout(e)}},[m,s]),{videoRef:n,audioRef:a,connectionState:s,close:(0,i.useCallback)(()=>{var e;null===(e=l.current)||void 0===e||e.close()},[])}}(o.url+"/webrtc",o.onStreamStats),x="connected"===c,[f,h,p]=(0,u.Fu)("RatOS","camera-settings",d),b=useUIState(),g=useSpatialMapping({settings:f,containerRef:b.containerRef,videoRef:s,windowSize:b.windowSize,zoom:b.zoom}),v=useGestures({setZoom:b.setZoom,canMove:b.canMove,gestureRef:s,isConnected:x,toMillimeters:g.toMillimeters,toScreen:g.toScreen,zoom:b.zoom}),w=b.zoom*((null==f?void 0:f.flipHorizontal)?-1:1),y=b.zoom*((null==f?void 0:f.flipVertical)?-1:1),k=v.scaledDragOffset.x*((null==f?void 0:f.flipHorizontal)?-1:1),C=v.scaledDragOffset.y*((null==f?void 0:f.flipVertical)?-1:1);return(0,a.jsx)("div",{className:(0,l.d)(b.isFullscreened?"h-full":"h-[calc(100vh_-_64px)]","flex w-full select-none items-center"),ref:b.rootRef,children:(0,a.jsxs)("div",{className:"relative mx-auto flex h-full max-h-full min-h-[50vh] min-w-[50vw] max-w-fit items-center overflow-hidden object-contain shadow-lg",ref:b.containerRef,children:[(0,a.jsx)("video",{ref:s,className:(0,r.m)("h-full max-h-full w-full min-w-full max-w-full transform-gpu touch-none",b.canMove&&"cursor-move",!v.isDragging&&"transition-transform ease-in-out"),style:{transform:"scale3d(".concat(w,", ").concat(y,", 1) translate3d(").concat(k,"px, ").concat(C,"px, 0)")},autoPlay:!0,muted:!0,playsInline:!0}),(0,a.jsx)(FillVideoFrame,{videoAspectRatio:null!==(e=o.aspectRatio)&&void 0!==e?e:0,containerAspectRatio:b.containerAspectRatio,zoom:b.zoom,children:(0,a.jsx)(SafetyVisualization,{gestureState:v})}),(0,a.jsx)(CrossHair,{containerRef:b.containerRef,isConnected:x&&null!=o.aspectRatio,isLockingCoordinates:b.isLockingCoordinates,settings:f,toScreen:g.toScreen}),(0,a.jsxs)(FillViewport,{children:[(0,a.jsx)("h3",{className:(0,r.m)("absolute inset-0 flex items-center justify-center text-xl font-semibold text-rose-500 transition-all dark:text-rose-500","failed"===c?"animate-pulse opacity-100":"opacity-0"),children:"Webcam stream not found"}),(0,a.jsx)(m.$,{noMargin:!0,className:(0,r.m)("h-1/3 w-1/3 animate-spin text-inherit transition-all","text-green-500 dark:text-green-500",("connected"===c||"failed"===c)&&null!=o.aspectRatio&&"opacity-0","failed"===c&&"text-rose-500 dark:text-rose-500","connecting"===c&&"text-brand-500 dark:text-brand-500","closed"===c&&"text-yellow-500 dark:text-yellow-500","disconnected"===c&&"text-amber-500 dark:text-amber-500","new"===c&&"text-sky-500 dark:text-sky-500")})]}),(0,a.jsx)(FillVideoFrame,{videoAspectRatio:null!==(t=o.aspectRatio)&&void 0!==t?t:0,containerAspectRatio:b.containerAspectRatio,zoom:b.zoom,className:(0,l.d)(null!=o.aspectRatio?"opacity-100":"opacity-0"),children:(0,a.jsx)(Toolbars,{zoom:b.zoom,toggleFullscreen:j.Z.isEnabled?b.toggleFullscreen:null,isFullscreened:b.isFullscreened,setZoom:b.setZoom,setIsLockingCoordinates:b.setIsLockingCoordinates,setCanMove:b.setCanMove,canMove:b.canMove,fps:null!==(n=o.fps)&&void 0!==n?n:0,isConnected:x,isLockingCoordinates:b.isLockingCoordinates,url:o.url,setSettings:h,settings:f,isSettingsFetched:p.isFetched})})]})})}},81503:function(e,t,n){"use strict";n.d(t,{$:function(){return Spinner}});var a=n(26248),i=n(44838);let Spinner=e=>(0,a.jsxs)("svg",{className:(0,i.m)("h-5 w-5 animate-spin text-black dark:text-white",e.noMargin?"":"-ml-1 mr-3",e.className),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},48542:function(e,t,n){"use strict";n.d(t,{o:function(){return TextInput}});var a=n(26248),i=n(96148),l=n(6181),r=n(33964),o=n(32836),s=n.n(o),c=n(49738),d=n(50962);let TextInput=e=>{let t=(0,c.useRef)(s()(e)),{onChange:n}=e,[o,u]=(0,c.useState)(!1);(0,d.d)("h-5 w-5",(e.error,"text-red-500"));let m=e.error?(0,a.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:(0,a.jsx)(r,{className:"h-5 w-5 text-red-500","aria-hidden":"true"})}):null,x=(0,d.d)(e.error?"ring-red-300 text-red-900 placeholder-red-300 focus:ring-red-500 dark:ring-red-500 dark:text-red-400 dark:placeholder-red-700":"ring-zinc-300 text-zinc-900 placeholder-zinc-300 focus:ring-brand-600 dark:ring-zinc-700 dark:text-zinc-100 dark:placeholder-zinc-700 dark:focus:ring-brand-400 ","block w-full rounded-md bg-white py-1.5 pl-3 pr-3 text-leftshadow-sm ring-1 ring-inset focus:outline-none dark:bg-zinc-800 sm:text-sm sm:leading-6 border-0"),f=e.error?(0,a.jsx)("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",id:t.current+"-error",children:e.error}):null,h=e.help?(0,a.jsx)("p",{className:"mt-2 text-sm text-zinc-500",id:"email-description",children:e.help}):null,p=(0,c.useCallback)(t=>{null==n||n("number"===e.type?parseFloat(t.currentTarget.value):t.currentTarget.value)},[n,e.type]),b=(0,c.useCallback)(()=>{u(e=>!e)},[]),g="password"===e.type?(0,a.jsx)("div",{onClick:b,className:"absolute inset-y-0 ".concat(null!=m?"right-6":"right-0"," flex cursor-pointer items-center pr-3"),children:o?(0,a.jsx)(i,{className:"h-5 w-5 text-zinc-400"}):(0,a.jsx)(l,{className:"h-5 w-5 text-zinc-400"})}):null;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold leading-6 text-zinc-700 dark:text-zinc-300",children:e.label}),(0,a.jsxs)("div",{className:"relative mt-1 rounded-md shadow-sm",children:[(0,a.jsx)("input",{...e,type:o?"text":e.type,className:x,placeholder:e.placeholder,defaultValue:e.defaultValue,value:e.value,onChange:p,"aria-invalid":!!e.error,"aria-describedby":e.error?t.current+"-error":void 0}),m,g]}),null!=f?f:h]})}},63041:function(e,t,n){"use strict";n.d(t,{Z:function(){return Toggle}});var a=n(26248),i=n(40818);n(49738);var l=n(44838),r=n(50962);let Toggle=e=>(0,a.jsxs)(i.r.Group,{as:"div",className:"flex items-center justify-between gap-x-2",children:[(0,a.jsxs)("span",{className:"flex flex-grow flex-col",children:[(0,a.jsx)(i.r.Label,{as:"span",className:(0,l.m)("text-sm font-medium leading-6 text-zinc-700 dark:text-zinc-300",e.onLabel&&e.value&&"opacity-70",e.onLabel&&!e.value&&"text-brand-700 dark:text-brand-500"),passive:!0,children:e.label}),e.description&&(0,a.jsx)(i.r.Description,{as:"span",className:"text-sm text-zinc-500 dark:text-zinc-400",children:e.description})]}),(0,a.jsx)(i.r,{checked:e.value,onChange:e.onChange,className:(0,r.d)(e.value&&null==e.onLabel?"bg-brand-600":"bg-zinc-200 dark:bg-zinc-950/50","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none"),children:(0,a.jsx)("span",{"aria-hidden":"true",className:(0,r.d)(e.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-md shadow-black/20 ring-0 transition duration-200 ease-in-out dark:border-t dark:border-zinc-600 dark:bg-zinc-700 dark:shadow-black/100 ")})}),e.onLabel&&(0,a.jsx)("span",{className:"flex flex-grow flex-col",children:(0,a.jsx)(i.r.Label,{as:"span",className:(0,l.m)("text-sm font-medium leading-6 text-zinc-700 dark:text-zinc-300",e.onLabel&&!e.value&&"opacity-70",e.onLabel&&e.value&&"text-brand-700 dark:text-brand-500"),passive:!0,children:e.onLabel})})]})},21863:function(e,t,n){"use strict";n.d(t,{I:function(){return useDelayedChangeEffect},S:function(){return useChangeEffect}});var a=n(49738);let useChangeEffect=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],[i,l]=(0,a.useState)(0),r=(0,a.useRef)([...e]);(0,a.useEffect)(()=>{let t=!1;r.current.forEach((n,a)=>{n!==e[a]&&(t=!0)}),t&&l(e=>n?e+1:1),r.current=[...e]},[...e]);let o=(0,a.useCallback)(()=>{l(0)},[]);return(0,a.useEffect)(()=>{if(null!=t&&i>0){let e=setTimeout(()=>{l(0)},t);return()=>{clearTimeout(e)}}},[t,i]),[i>0,o]},useDelayedChangeEffect=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],[l,r]=(0,a.useState)(0),o=(0,a.useRef)([...e]),s=(0,a.useRef)(null);(0,a.useEffect)(()=>{let n=!1;if(o.current.forEach((t,a)=>{t!==e[a]&&(n=!0)}),n){let trigger=()=>r(e=>i?e+1:1);s.current=window.setTimeout(()=>{trigger(),s.current=null},t)}o.current=[...e]},[...e]),(0,a.useEffect)(()=>()=>{s.current&&clearTimeout(s.current)},[]);let[c,d]=useChangeEffect([l],n,i);return[c,d]}}},function(e){e.O(0,[393,838,982,346,539,955,399,625,744],function(){return e(e.s=10944)}),_N_E=e.O()}]);